<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › ti › wl12xx › main.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>main.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is part of wl1271</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2008-2010 Nokia Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * version 2 as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span>
<span class="cm"> * 02110-1301 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/platform_device.h&gt;</span>

<span class="cp">#include &lt;linux/err.h&gt;</span>

<span class="cp">#include &lt;linux/wl12xx.h&gt;</span>

<span class="cp">#include &quot;../wlcore/wlcore.h&quot;</span>
<span class="cp">#include &quot;../wlcore/debug.h&quot;</span>
<span class="cp">#include &quot;../wlcore/io.h&quot;</span>
<span class="cp">#include &quot;../wlcore/acx.h&quot;</span>
<span class="cp">#include &quot;../wlcore/tx.h&quot;</span>
<span class="cp">#include &quot;../wlcore/rx.h&quot;</span>
<span class="cp">#include &quot;../wlcore/io.h&quot;</span>
<span class="cp">#include &quot;../wlcore/boot.h&quot;</span>

<span class="cp">#include &quot;wl12xx.h&quot;</span>
<span class="cp">#include &quot;reg.h&quot;</span>
<span class="cp">#include &quot;cmd.h&quot;</span>
<span class="cp">#include &quot;acx.h&quot;</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">wlcore_conf</span> <span class="n">wl12xx_conf</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">sg</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_BT_MASTER_MIN_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_BT_MASTER_MAX_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_BT_SLAVE_MIN_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_BT_SLAVE_MAX_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_BT_MASTER_MIN_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_BT_MASTER_MAX_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_BT_SLAVE_MIN_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_BT_SLAVE_MAX_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_PS_MASTER_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_PS_SLAVE_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_PS_MASTER_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_PS_SLAVE_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_ACTIVE_MASTER_MIN_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_ACTIVE_MASTER_MAX_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_ACTIVE_SLAVE_MIN_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_ACTIVE_SLAVE_MAX_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">35</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_ACTIVE_MASTER_MIN_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_ACTIVE_MASTER_MAX_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_ACTIVE_SLAVE_MIN_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_WLAN_ACTIVE_SLAVE_MAX_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_ACTIVE_SCAN_WLAN_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_ACTIVE_SCAN_WLAN_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_PASSIVE_SCAN_BT_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">75</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_PASSIVE_SCAN_WLAN_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_PASSIVE_SCAN_BT_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">27</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACL_PASSIVE_SCAN_WLAN_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">17</span><span class="p">,</span>
			<span class="cm">/* active scan params */</span>
			<span class="p">[</span><span class="n">CONF_SG_AUTO_SCAN_PROBE_REQ</span><span class="p">]</span> <span class="o">=</span> <span class="mi">170</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACTIVE_SCAN_DURATION_FACTOR_HV3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ACTIVE_SCAN_DURATION_FACTOR_A2DP</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
			<span class="cm">/* passive scan params */</span>
			<span class="p">[</span><span class="n">CONF_SG_PASSIVE_SCAN_DURATION_FACTOR_A2DP_BR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_PASSIVE_SCAN_DURATION_FACTOR_A2DP_EDR</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_PASSIVE_SCAN_DURATION_FACTOR_HV3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
			<span class="cm">/* passive scan in dual antenna params */</span>
			<span class="p">[</span><span class="n">CONF_SG_CONSECUTIVE_HV3_IN_PASSIVE_SCAN</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_BCN_HV3_COLLISION_THRESH_IN_PASSIVE_SCAN</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_TX_RX_PROTECTION_BWIDTH_IN_PASSIVE_SCAN</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="cm">/* general params */</span>
			<span class="p">[</span><span class="n">CONF_SG_STA_FORCE_PS_IN_BT_SCO</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ANTENNA_CONFIGURATION</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_BEACON_MISS_PERCENT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_DHCP_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_RXT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_TXT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_ADAPTIVE_RXT_TXT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_GENERAL_USAGE_BIT_MAP</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_HV3_MAX_SERVED</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_PS_POLL_TIMEOUT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_UPSD_TIMEOUT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_CONSECUTIVE_CTS_THRESHOLD</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_STA_RX_WINDOW_AFTER_DTIM</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_STA_CONNECTION_PROTECTION_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
			<span class="cm">/* AP params */</span>
			<span class="p">[</span><span class="n">CONF_AP_BEACON_MISS_TX</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_AP_RX_WINDOW_AFTER_BEACON</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_AP_BEACON_WINDOW_INTERVAL</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_AP_CONNECTION_PROTECTION_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_AP_BT_ACL_VAL_BT_SERVE_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_AP_BT_ACL_VAL_WL_SERVE_TIME</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
			<span class="cm">/* CTS Diluting params */</span>
			<span class="p">[</span><span class="n">CONF_SG_CTS_DILUTED_BAD_RX_PACKETS_TH</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">[</span><span class="n">CONF_SG_CTS_CHOP_IN_DUAL_ANT_SCO_MASTER</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">CONF_SG_PROTECTIVE</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">rx</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rx_msdu_life_time</span>           <span class="o">=</span> <span class="mi">512000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">packet_detection_threshold</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ps_poll_timeout</span>             <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
		<span class="p">.</span><span class="n">upsd_timeout</span>                <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rts_threshold</span>               <span class="o">=</span> <span class="n">IEEE80211_MAX_RTS_THRESHOLD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rx_cca_threshold</span>            <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq_blk_threshold</span>           <span class="o">=</span> <span class="mh">0xFFFF</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq_pkt_threshold</span>           <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">irq_timeout</span>                 <span class="o">=</span> <span class="mi">600</span><span class="p">,</span>
		<span class="p">.</span><span class="n">queue_type</span>                  <span class="o">=</span> <span class="n">CONF_RX_QUEUE_TYPE_LOW_PRIORITY</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">tx</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">tx_energy_detection</span>         <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sta_rc_conf</span>                 <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">enabled_rates</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">short_retry_limit</span>   <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">.</span><span class="n">long_retry_limit</span>    <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
			<span class="p">.</span><span class="n">aflags</span>              <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">ac_conf_count</span>               <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ac_conf</span>                     <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">CONF_TX_AC_BE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">ac</span>          <span class="o">=</span> <span class="n">CONF_TX_AC_BE</span><span class="p">,</span>
				<span class="p">.</span><span class="n">cw_min</span>      <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
				<span class="p">.</span><span class="n">cw_max</span>      <span class="o">=</span> <span class="mi">63</span><span class="p">,</span>
				<span class="p">.</span><span class="n">aifsn</span>       <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tx_op_limit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">},</span>
			<span class="p">[</span><span class="n">CONF_TX_AC_BK</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">ac</span>          <span class="o">=</span> <span class="n">CONF_TX_AC_BK</span><span class="p">,</span>
				<span class="p">.</span><span class="n">cw_min</span>      <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
				<span class="p">.</span><span class="n">cw_max</span>      <span class="o">=</span> <span class="mi">63</span><span class="p">,</span>
				<span class="p">.</span><span class="n">aifsn</span>       <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tx_op_limit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">},</span>
			<span class="p">[</span><span class="n">CONF_TX_AC_VI</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">ac</span>          <span class="o">=</span> <span class="n">CONF_TX_AC_VI</span><span class="p">,</span>
				<span class="p">.</span><span class="n">cw_min</span>      <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
				<span class="p">.</span><span class="n">cw_max</span>      <span class="o">=</span> <span class="mi">63</span><span class="p">,</span>
				<span class="p">.</span><span class="n">aifsn</span>       <span class="o">=</span> <span class="n">CONF_TX_AIFS_PIFS</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tx_op_limit</span> <span class="o">=</span> <span class="mi">3008</span><span class="p">,</span>
			<span class="p">},</span>
			<span class="p">[</span><span class="n">CONF_TX_AC_VO</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">ac</span>          <span class="o">=</span> <span class="n">CONF_TX_AC_VO</span><span class="p">,</span>
				<span class="p">.</span><span class="n">cw_min</span>      <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
				<span class="p">.</span><span class="n">cw_max</span>      <span class="o">=</span> <span class="mi">63</span><span class="p">,</span>
				<span class="p">.</span><span class="n">aifsn</span>       <span class="o">=</span> <span class="n">CONF_TX_AIFS_PIFS</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tx_op_limit</span> <span class="o">=</span> <span class="mi">1504</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">max_tx_retries</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ap_aging_period</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tid_conf_count</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tid_conf</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="n">CONF_TX_AC_BE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">queue_id</span>    <span class="o">=</span> <span class="n">CONF_TX_AC_BE</span><span class="p">,</span>
				<span class="p">.</span><span class="n">channel_type</span> <span class="o">=</span> <span class="n">CONF_CHANNEL_TYPE_EDCF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tsid</span>        <span class="o">=</span> <span class="n">CONF_TX_AC_BE</span><span class="p">,</span>
				<span class="p">.</span><span class="n">ps_scheme</span>   <span class="o">=</span> <span class="n">CONF_PS_SCHEME_LEGACY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">ack_policy</span>  <span class="o">=</span> <span class="n">CONF_ACK_POLICY_LEGACY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">apsd_conf</span>   <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
			<span class="p">},</span>
			<span class="p">[</span><span class="n">CONF_TX_AC_BK</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">queue_id</span>    <span class="o">=</span> <span class="n">CONF_TX_AC_BK</span><span class="p">,</span>
				<span class="p">.</span><span class="n">channel_type</span> <span class="o">=</span> <span class="n">CONF_CHANNEL_TYPE_EDCF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tsid</span>        <span class="o">=</span> <span class="n">CONF_TX_AC_BK</span><span class="p">,</span>
				<span class="p">.</span><span class="n">ps_scheme</span>   <span class="o">=</span> <span class="n">CONF_PS_SCHEME_LEGACY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">ack_policy</span>  <span class="o">=</span> <span class="n">CONF_ACK_POLICY_LEGACY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">apsd_conf</span>   <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
			<span class="p">},</span>
			<span class="p">[</span><span class="n">CONF_TX_AC_VI</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">queue_id</span>    <span class="o">=</span> <span class="n">CONF_TX_AC_VI</span><span class="p">,</span>
				<span class="p">.</span><span class="n">channel_type</span> <span class="o">=</span> <span class="n">CONF_CHANNEL_TYPE_EDCF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tsid</span>        <span class="o">=</span> <span class="n">CONF_TX_AC_VI</span><span class="p">,</span>
				<span class="p">.</span><span class="n">ps_scheme</span>   <span class="o">=</span> <span class="n">CONF_PS_SCHEME_LEGACY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">ack_policy</span>  <span class="o">=</span> <span class="n">CONF_ACK_POLICY_LEGACY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">apsd_conf</span>   <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
			<span class="p">},</span>
			<span class="p">[</span><span class="n">CONF_TX_AC_VO</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">queue_id</span>    <span class="o">=</span> <span class="n">CONF_TX_AC_VO</span><span class="p">,</span>
				<span class="p">.</span><span class="n">channel_type</span> <span class="o">=</span> <span class="n">CONF_CHANNEL_TYPE_EDCF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tsid</span>        <span class="o">=</span> <span class="n">CONF_TX_AC_VO</span><span class="p">,</span>
				<span class="p">.</span><span class="n">ps_scheme</span>   <span class="o">=</span> <span class="n">CONF_PS_SCHEME_LEGACY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">ack_policy</span>  <span class="o">=</span> <span class="n">CONF_ACK_POLICY_LEGACY</span><span class="p">,</span>
				<span class="p">.</span><span class="n">apsd_conf</span>   <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">frag_threshold</span>              <span class="o">=</span> <span class="n">IEEE80211_MAX_FRAG_THRESHOLD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_compl_timeout</span>            <span class="o">=</span> <span class="mi">700</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_compl_threshold</span>          <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">basic_rate</span>                  <span class="o">=</span> <span class="n">CONF_HW_BIT_RATE_1MBPS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">basic_rate_5</span>                <span class="o">=</span> <span class="n">CONF_HW_BIT_RATE_6MBPS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tmpl_short_retry_limit</span>      <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tmpl_long_retry_limit</span>       <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_watchdog_timeout</span>         <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">conn</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">wake_up_event</span>               <span class="o">=</span> <span class="n">CONF_WAKE_UP_EVENT_DTIM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">listen_interval</span>             <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">suspend_wake_up_event</span>       <span class="o">=</span> <span class="n">CONF_WAKE_UP_EVENT_N_DTIM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">suspend_listen_interval</span>     <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bcn_filt_mode</span>               <span class="o">=</span> <span class="n">CONF_BCN_FILT_MODE_ENABLED</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bcn_filt_ie_count</span>           <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bcn_filt_ie</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">ie</span>          <span class="o">=</span> <span class="n">WLAN_EID_CHANNEL_SWITCH</span><span class="p">,</span>
				<span class="p">.</span><span class="n">rule</span>        <span class="o">=</span> <span class="n">CONF_BCN_RULE_PASS_ON_APPEARANCE</span><span class="p">,</span>
			<span class="p">},</span>
			<span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">ie</span>          <span class="o">=</span> <span class="n">WLAN_EID_HT_OPERATION</span><span class="p">,</span>
				<span class="p">.</span><span class="n">rule</span>        <span class="o">=</span> <span class="n">CONF_BCN_RULE_PASS_ON_CHANGE</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">synch_fail_thold</span>            <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bss_lose_timeout</span>            <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beacon_rx_timeout</span>           <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">broadcast_timeout</span>           <span class="o">=</span> <span class="mi">20000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rx_broadcast_in_ps</span>          <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ps_poll_threshold</span>           <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bet_enable</span>                  <span class="o">=</span> <span class="n">CONF_BET_MODE_ENABLE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bet_max_consecutive</span>         <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
		<span class="p">.</span><span class="n">psm_entry_retries</span>           <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">psm_exit_retries</span>            <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">psm_entry_nullfunc_retries</span>  <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dynamic_ps_timeout</span>          <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">forced_ps</span>                   <span class="o">=</span> <span class="nb">false</span><span class="p">,</span>
		<span class="p">.</span><span class="n">keep_alive_interval</span>         <span class="o">=</span> <span class="mi">55000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_listen_interval</span>         <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">itrim</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">enable</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span>
		<span class="p">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">pm_config</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">host_clk_settling_time</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">host_fast_wakeup_support</span> <span class="o">=</span> <span class="nb">false</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">roam_trigger</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">trigger_pacing</span>               <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">avg_weight_rssi_beacon</span>       <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">avg_weight_rssi_data</span>         <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">avg_weight_snr_beacon</span>        <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">avg_weight_snr_data</span>          <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">scan</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">min_dwell_time_active</span>        <span class="o">=</span> <span class="mi">7500</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_dwell_time_active</span>        <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_dwell_time_passive</span>       <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_dwell_time_passive</span>       <span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_probe_reqs</span>               <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">split_scan_timeout</span>           <span class="o">=</span> <span class="mi">50000</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">sched_scan</span> <span class="o">=</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * Values are in TU/1000 but since sched scan FW command</span>
<span class="cm">		 * params are in TUs rounding up may occur.</span>
<span class="cm">		 */</span>
		<span class="p">.</span><span class="n">base_dwell_time</span>		<span class="o">=</span> <span class="mi">7500</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_dwell_time_delta</span>		<span class="o">=</span> <span class="mi">22500</span><span class="p">,</span>
		<span class="cm">/* based on 250bits per probe @1Mbps */</span>
		<span class="p">.</span><span class="n">dwell_time_delta_per_probe</span>	<span class="o">=</span> <span class="mi">2000</span><span class="p">,</span>
		<span class="cm">/* based on 250bits per probe @6Mbps (plus a bit more) */</span>
		<span class="p">.</span><span class="n">dwell_time_delta_per_probe_5</span>	<span class="o">=</span> <span class="mi">350</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dwell_time_passive</span>		<span class="o">=</span> <span class="mi">100000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dwell_time_dfs</span>			<span class="o">=</span> <span class="mi">150000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_probe_reqs</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rssi_threshold</span>			<span class="o">=</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span>
		<span class="p">.</span><span class="n">snr_threshold</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">ht</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rx_ba_win_size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_ba_win_size</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
		<span class="p">.</span><span class="n">inactivity_timeout</span> <span class="o">=</span> <span class="mi">10000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_ba_tid_bitmap</span> <span class="o">=</span> <span class="n">CONF_TX_BA_ENABLED_TID_BITMAP</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="cm">/*</span>
<span class="cm">	 * Memory config for wl127x chips is given in the</span>
<span class="cm">	 * wl12xx_default_priv_conf struct. The below configuration is</span>
<span class="cm">	 * for wl128x chips.</span>
<span class="cm">	 */</span>
	<span class="p">.</span><span class="n">mem</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">num_stations</span>                 <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ssid_profiles</span>                <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rx_block_num</span>                 <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_min_block_num</span>             <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dynamic_memory</span>               <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_req_tx_blocks</span>            <span class="o">=</span> <span class="mi">45</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_req_rx_blocks</span>            <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_min</span>                       <span class="o">=</span> <span class="mi">27</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">fm_coex</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">enable</span>                       <span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
		<span class="p">.</span><span class="n">swallow_period</span>               <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">n_divider_fref_set_1</span>         <span class="o">=</span> <span class="mh">0xff</span><span class="p">,</span>       <span class="cm">/* default */</span>
		<span class="p">.</span><span class="n">n_divider_fref_set_2</span>         <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
		<span class="p">.</span><span class="n">m_divider_fref_set_1</span>         <span class="o">=</span> <span class="mi">148</span><span class="p">,</span>
		<span class="p">.</span><span class="n">m_divider_fref_set_2</span>         <span class="o">=</span> <span class="mh">0xffff</span><span class="p">,</span>     <span class="cm">/* default */</span>
		<span class="p">.</span><span class="n">coex_pll_stabilization_time</span>  <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">,</span> <span class="cm">/* default */</span>
		<span class="p">.</span><span class="n">ldo_stabilization_time</span>       <span class="o">=</span> <span class="mh">0xffff</span><span class="p">,</span>     <span class="cm">/* default */</span>
		<span class="p">.</span><span class="n">fm_disturbed_band_margin</span>     <span class="o">=</span> <span class="mh">0xff</span><span class="p">,</span>       <span class="cm">/* default */</span>
		<span class="p">.</span><span class="n">swallow_clk_diff</span>             <span class="o">=</span> <span class="mh">0xff</span><span class="p">,</span>       <span class="cm">/* default */</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">rx_streaming</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">duration</span>                      <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
		<span class="p">.</span><span class="n">queues</span>                        <span class="o">=</span> <span class="mh">0x1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">interval</span>                      <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">always</span>                        <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">fwlog</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">mode</span>                         <span class="o">=</span> <span class="n">WL12XX_FWLOG_ON_DEMAND</span><span class="p">,</span>
		<span class="p">.</span><span class="n">mem_blocks</span>                   <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">severity</span>                     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">timestamp</span>                    <span class="o">=</span> <span class="n">WL12XX_FWLOG_TIMESTAMP_DISABLED</span><span class="p">,</span>
		<span class="p">.</span><span class="n">output</span>                       <span class="o">=</span> <span class="n">WL12XX_FWLOG_OUTPUT_HOST</span><span class="p">,</span>
		<span class="p">.</span><span class="n">threshold</span>                    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">rate</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rate_retry_score</span> <span class="o">=</span> <span class="mi">32000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">per_add</span> <span class="o">=</span> <span class="mi">8192</span><span class="p">,</span>
		<span class="p">.</span><span class="n">per_th1</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
		<span class="p">.</span><span class="n">per_th2</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_per</span> <span class="o">=</span> <span class="mi">8100</span><span class="p">,</span>
		<span class="p">.</span><span class="n">inverse_curiosity_factor</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_fail_low_th</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_fail_high_th</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">per_alpha_shift</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">per_add_shift</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
		<span class="p">.</span><span class="n">per_beta1_shift</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">per_beta2_shift</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rate_check_up</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rate_check_down</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rate_retry_policy</span> <span class="o">=</span> <span class="p">{</span>
			<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
			<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
			<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">hangover</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">recover_time</span>               <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hangover_period</span>            <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dynamic_mode</span>               <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">early_termination_mode</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_period</span>                 <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_period</span>                 <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">increase_delta</span>             <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">decrease_delta</span>             <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">quiet_time</span>                 <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">increase_time</span>              <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">window_size</span>                <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">wl12xx_priv_conf</span> <span class="n">wl12xx_default_priv_conf</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">rf</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">tx_per_channel_power_compensation_2</span> <span class="o">=</span> <span class="p">{</span>
			<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">tx_per_channel_power_compensation_5</span> <span class="o">=</span> <span class="p">{</span>
			<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
			<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
			<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">mem_wl127x</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">num_stations</span>                 <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ssid_profiles</span>                <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rx_block_num</span>                 <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_min_block_num</span>             <span class="o">=</span> <span class="mi">40</span><span class="p">,</span>
		<span class="p">.</span><span class="n">dynamic_memory</span>               <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_req_tx_blocks</span>            <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
		<span class="p">.</span><span class="n">min_req_rx_blocks</span>            <span class="o">=</span> <span class="mi">22</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tx_min</span>                       <span class="o">=</span> <span class="mi">27</span><span class="p">,</span>
	<span class="p">},</span>

<span class="p">};</span>

<span class="cp">#define WL12XX_TX_HW_BLOCK_SPARE_DEFAULT        1</span>
<span class="cp">#define WL12XX_TX_HW_BLOCK_GEM_SPARE            2</span>
<span class="cp">#define WL12XX_TX_HW_BLOCK_SIZE                 252</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">wl12xx_rate_to_idx_2ghz</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* MCS rates are used only with 11n */</span>
	<span class="mi">7</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS7_SGI */</span>
	<span class="mi">7</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS7 */</span>
	<span class="mi">6</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS6 */</span>
	<span class="mi">5</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS5 */</span>
	<span class="mi">4</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS4 */</span>
	<span class="mi">3</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS3 */</span>
	<span class="mi">2</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS2 */</span>
	<span class="mi">1</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS1 */</span>
	<span class="mi">0</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS0 */</span>

	<span class="mi">11</span><span class="p">,</span>                            <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_54   */</span>
	<span class="mi">10</span><span class="p">,</span>                            <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_48   */</span>
	<span class="mi">9</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_36   */</span>
	<span class="mi">8</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_24   */</span>

	<span class="cm">/* TI-specific rate */</span>
	<span class="n">CONF_HW_RXTX_RATE_UNSUPPORTED</span><span class="p">,</span> <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_22   */</span>

	<span class="mi">7</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_18   */</span>
	<span class="mi">6</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_12   */</span>
	<span class="mi">3</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_11   */</span>
	<span class="mi">5</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_9    */</span>
	<span class="mi">4</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_6    */</span>
	<span class="mi">2</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_5_5  */</span>
	<span class="mi">1</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_2    */</span>
	<span class="mi">0</span>                              <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_1    */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">wl12xx_rate_to_idx_5ghz</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* MCS rates are used only with 11n */</span>
	<span class="mi">7</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS7_SGI */</span>
	<span class="mi">7</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS7 */</span>
	<span class="mi">6</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS6 */</span>
	<span class="mi">5</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS5 */</span>
	<span class="mi">4</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS4 */</span>
	<span class="mi">3</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS3 */</span>
	<span class="mi">2</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS2 */</span>
	<span class="mi">1</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS1 */</span>
	<span class="mi">0</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_MCS0 */</span>

	<span class="mi">7</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_54   */</span>
	<span class="mi">6</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_48   */</span>
	<span class="mi">5</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_36   */</span>
	<span class="mi">4</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_24   */</span>

	<span class="cm">/* TI-specific rate */</span>
	<span class="n">CONF_HW_RXTX_RATE_UNSUPPORTED</span><span class="p">,</span> <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_22   */</span>

	<span class="mi">3</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_18   */</span>
	<span class="mi">2</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_12   */</span>
	<span class="n">CONF_HW_RXTX_RATE_UNSUPPORTED</span><span class="p">,</span> <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_11   */</span>
	<span class="mi">1</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_9    */</span>
	<span class="mi">0</span><span class="p">,</span>                             <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_6    */</span>
	<span class="n">CONF_HW_RXTX_RATE_UNSUPPORTED</span><span class="p">,</span> <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_5_5  */</span>
	<span class="n">CONF_HW_RXTX_RATE_UNSUPPORTED</span><span class="p">,</span> <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_2    */</span>
	<span class="n">CONF_HW_RXTX_RATE_UNSUPPORTED</span>  <span class="cm">/* WL12XX_CONF_HW_RXTX_RATE_1    */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">wl12xx_band_rate_to_idx</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">IEEE80211_BAND_2GHZ</span><span class="p">]</span> <span class="o">=</span> <span class="n">wl12xx_rate_to_idx_2ghz</span><span class="p">,</span>
	<span class="p">[</span><span class="n">IEEE80211_BAND_5GHZ</span><span class="p">]</span> <span class="o">=</span> <span class="n">wl12xx_rate_to_idx_5ghz</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">wl12xx_hw_rates</span> <span class="p">{</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS7_SGI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS7</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS6</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS5</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS4</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS3</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS2</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS1</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS0</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_54</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_48</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_36</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_24</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_22</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_18</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_12</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_11</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_9</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_6</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_5_5</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_2</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_1</span><span class="p">,</span>
	<span class="n">WL12XX_CONF_HW_RXTX_RATE_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">wlcore_partition_set</span> <span class="n">wl12xx_ptable</span><span class="p">[</span><span class="n">PART_TABLE_LEN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">PART_DOWN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">mem</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x000177c0</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">reg</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">REGISTERS_BASE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00008800</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">mem2</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00000000</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">mem3</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00000000</span>
		<span class="p">},</span>
	<span class="p">},</span>

	<span class="p">[</span><span class="n">PART_BOOT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="cm">/* in wl12xx we can use a mix of work and down</span>
<span class="cm">			 * partition here */</span>
		<span class="p">.</span><span class="n">mem</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00014fc0</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">reg</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">REGISTERS_BASE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00008800</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">mem2</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00000000</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">mem3</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00000000</span>
		<span class="p">},</span>
	<span class="p">},</span>

	<span class="p">[</span><span class="n">PART_WORK</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">mem</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00014fc0</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">reg</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">REGISTERS_BASE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x0000a000</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">mem2</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x003004f8</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00000004</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">mem3</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00040404</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00000000</span>
		<span class="p">},</span>
	<span class="p">},</span>

	<span class="p">[</span><span class="n">PART_DRPW</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">mem</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00040000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00014fc0</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">reg</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">DRPW_BASE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00006000</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">mem2</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00000000</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">mem3</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mh">0x00000000</span><span class="p">,</span>
			<span class="p">.</span><span class="n">size</span>  <span class="o">=</span> <span class="mh">0x00000000</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">wl12xx_rtable</span><span class="p">[</span><span class="n">REG_TABLE_LEN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">REG_ECPU_CONTROL</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL12XX_REG_ECPU_CONTROL</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_INTERRUPT_NO_CLEAR</span><span class="p">]</span>	<span class="o">=</span> <span class="n">WL12XX_REG_INTERRUPT_NO_CLEAR</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_INTERRUPT_ACK</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL12XX_REG_INTERRUPT_ACK</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_COMMAND_MAILBOX_PTR</span><span class="p">]</span>	<span class="o">=</span> <span class="n">WL12XX_REG_COMMAND_MAILBOX_PTR</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_EVENT_MAILBOX_PTR</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL12XX_REG_EVENT_MAILBOX_PTR</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_INTERRUPT_TRIG</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL12XX_REG_INTERRUPT_TRIG</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_INTERRUPT_MASK</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL12XX_REG_INTERRUPT_MASK</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_PC_ON_RECOVERY</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL12XX_SCR_PAD4</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_CHIP_ID_B</span><span class="p">]</span>			<span class="o">=</span> <span class="n">WL12XX_CHIP_ID_B</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_CMD_MBOX_ADDRESS</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL12XX_CMD_MBOX_ADDRESS</span><span class="p">,</span>

	<span class="cm">/* data access memory addresses, used with partition translation */</span>
	<span class="p">[</span><span class="n">REG_SLV_MEM_DATA</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL1271_SLV_MEM_DATA</span><span class="p">,</span>
	<span class="p">[</span><span class="n">REG_SLV_REG_DATA</span><span class="p">]</span>		<span class="o">=</span> <span class="n">WL1271_SLV_REG_DATA</span><span class="p">,</span>

	<span class="cm">/* raw data access memory addresses */</span>
	<span class="p">[</span><span class="n">REG_RAW_FW_STATUS_ADDR</span><span class="p">]</span>	<span class="o">=</span> <span class="n">FW_STATUS_ADDR</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* TODO: maybe move to a new header file? */</span>
<span class="cp">#define WL127X_FW_NAME_MULTI	&quot;ti-connectivity/wl127x-fw-4-mr.bin&quot;</span>
<span class="cp">#define WL127X_FW_NAME_SINGLE	&quot;ti-connectivity/wl127x-fw-4-sr.bin&quot;</span>
<span class="cp">#define WL127X_PLT_FW_NAME	&quot;ti-connectivity/wl127x-fw-4-plt.bin&quot;</span>

<span class="cp">#define WL128X_FW_NAME_MULTI	&quot;ti-connectivity/wl128x-fw-4-mr.bin&quot;</span>
<span class="cp">#define WL128X_FW_NAME_SINGLE	&quot;ti-connectivity/wl128x-fw-4-sr.bin&quot;</span>
<span class="cp">#define WL128X_PLT_FW_NAME	&quot;ti-connectivity/wl128x-fw-4-plt.bin&quot;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl127x_prepare_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rx_desc</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">wl1271_acx_mem_map</span> <span class="o">*</span><span class="n">wl_mem_map</span> <span class="o">=</span> <span class="n">wl</span><span class="o">-&gt;</span><span class="n">target_mem_map</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">wl1271_rx_mem_pool_addr</span> <span class="n">rx_mem_addr</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * Choose the block we want to read</span>
<span class="cm">		 * For aggregated packets, only the first memory block</span>
<span class="cm">		 * should be retrieved. The FW takes care of the rest.</span>
<span class="cm">		 */</span>
		<span class="n">u32</span> <span class="n">mem_block</span> <span class="o">=</span> <span class="n">rx_desc</span> <span class="o">&amp;</span> <span class="n">RX_MEM_BLOCK_MASK</span><span class="p">;</span>

		<span class="n">rx_mem_addr</span><span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">mem_block</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
			<span class="n">le32_to_cpu</span><span class="p">(</span><span class="n">wl_mem_map</span><span class="o">-&gt;</span><span class="n">packet_memory_pool_start</span><span class="p">);</span>

		<span class="n">rx_mem_addr</span><span class="p">.</span><span class="n">addr_extra</span> <span class="o">=</span> <span class="n">rx_mem_addr</span><span class="p">.</span><span class="n">addr</span> <span class="o">+</span> <span class="mi">4</span><span class="p">;</span>

		<span class="n">wl1271_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL1271_SLV_REG_DATA</span><span class="p">,</span>
			     <span class="o">&amp;</span><span class="n">rx_mem_addr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">rx_mem_addr</span><span class="p">),</span> <span class="nb">false</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl12xx_identify_chip</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CHIP_ID_1271_PG10</span>:
		<span class="n">wl1271_warning</span><span class="p">(</span><span class="s">&quot;chip id 0x%x (1271 PG10) support is obsolete&quot;</span><span class="p">,</span>
			       <span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>

		<span class="cm">/* clear the alignment quirk, since we don&#39;t support it */</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">WLCORE_QUIRK_TX_BLOCKSIZE_ALIGN</span><span class="p">;</span>

		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">WLCORE_QUIRK_LEGACY_NVS</span><span class="p">;</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">sr_fw_name</span> <span class="o">=</span> <span class="n">WL127X_FW_NAME_SINGLE</span><span class="p">;</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">mr_fw_name</span> <span class="o">=</span> <span class="n">WL127X_FW_NAME_MULTI</span><span class="p">;</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">.</span><span class="n">mem</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl12xx_default_priv_conf</span><span class="p">.</span><span class="n">mem_wl127x</span><span class="p">,</span>
		       <span class="k">sizeof</span><span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">.</span><span class="n">mem</span><span class="p">));</span>

		<span class="cm">/* read data preparation is only needed by wl127x */</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">prepare_read</span> <span class="o">=</span> <span class="n">wl127x_prepare_read</span><span class="p">;</span>

		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">CHIP_ID_1271_PG20</span>:
		<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_BOOT</span><span class="p">,</span> <span class="s">&quot;chip id 0x%x (1271 PG20)&quot;</span><span class="p">,</span>
			     <span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>

		<span class="cm">/* clear the alignment quirk, since we don&#39;t support it */</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">WLCORE_QUIRK_TX_BLOCKSIZE_ALIGN</span><span class="p">;</span>

		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">WLCORE_QUIRK_LEGACY_NVS</span><span class="p">;</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">plt_fw_name</span> <span class="o">=</span> <span class="n">WL127X_PLT_FW_NAME</span><span class="p">;</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">sr_fw_name</span> <span class="o">=</span> <span class="n">WL127X_FW_NAME_SINGLE</span><span class="p">;</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">mr_fw_name</span> <span class="o">=</span> <span class="n">WL127X_FW_NAME_MULTI</span><span class="p">;</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">.</span><span class="n">mem</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl12xx_default_priv_conf</span><span class="p">.</span><span class="n">mem_wl127x</span><span class="p">,</span>
		       <span class="k">sizeof</span><span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">.</span><span class="n">mem</span><span class="p">));</span>

		<span class="cm">/* read data preparation is only needed by wl127x */</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">prepare_read</span> <span class="o">=</span> <span class="n">wl127x_prepare_read</span><span class="p">;</span>

		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">CHIP_ID_1283_PG20</span>:
		<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_BOOT</span><span class="p">,</span> <span class="s">&quot;chip id 0x%x (1283 PG20)&quot;</span><span class="p">,</span>
			     <span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">plt_fw_name</span> <span class="o">=</span> <span class="n">WL128X_PLT_FW_NAME</span><span class="p">;</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">sr_fw_name</span> <span class="o">=</span> <span class="n">WL128X_FW_NAME_SINGLE</span><span class="p">;</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">mr_fw_name</span> <span class="o">=</span> <span class="n">WL128X_FW_NAME_MULTI</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CHIP_ID_1283_PG10</span>:
	<span class="nl">default:</span>
		<span class="n">wl1271_warning</span><span class="p">(</span><span class="s">&quot;unsupported chip id: 0x%x&quot;</span><span class="p">,</span> <span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_top_reg_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* write address &gt;&gt; 1 + 0x30000 to OCP_POR_CTR */</span>
	<span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x30000</span><span class="p">;</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_OCP_POR_CTR</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>

	<span class="cm">/* write value to OCP_POR_WDATA */</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_OCP_DATA_WRITE</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="cm">/* write 1 to OCP_CMD */</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_OCP_CMD</span><span class="p">,</span> <span class="n">OCP_CMD_WRITE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u16</span> <span class="nf">wl12xx_top_reg_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">OCP_CMD_LOOP</span><span class="p">;</span>

	<span class="cm">/* write address &gt;&gt; 1 + 0x30000 to OCP_POR_CTR */</span>
	<span class="n">addr</span> <span class="o">=</span> <span class="p">(</span><span class="n">addr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mh">0x30000</span><span class="p">;</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_OCP_POR_CTR</span><span class="p">,</span> <span class="n">addr</span><span class="p">);</span>

	<span class="cm">/* write 2 to OCP_CMD */</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_OCP_CMD</span><span class="p">,</span> <span class="n">OCP_CMD_READ</span><span class="p">);</span>

	<span class="cm">/* poll for data ready */</span>
	<span class="k">do</span> <span class="p">{</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">wl1271_read32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_OCP_DATA_READ</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">OCP_READY_MASK</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">--</span><span class="n">timeout</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">timeout</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">wl1271_warning</span><span class="p">(</span><span class="s">&quot;Top register access timed out.&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* check data status and return if OK */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span> <span class="n">OCP_STATUS_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="n">OCP_STATUS_OK</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">wl1271_warning</span><span class="p">(</span><span class="s">&quot;Top register access returned error.&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl128x_switch_tcxo_to_fref</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">spare_reg</span><span class="p">;</span>

	<span class="cm">/* Mask bits [2] &amp; [8:4] in the sys_clk_cfg register */</span>
	<span class="n">spare_reg</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL_SPARE_REG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spare_reg</span> <span class="o">==</span> <span class="mh">0xFFFF</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="n">spare_reg</span> <span class="o">|=</span> <span class="p">(</span><span class="n">BIT</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
	<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL_SPARE_REG</span><span class="p">,</span> <span class="n">spare_reg</span><span class="p">);</span>

	<span class="cm">/* Enable FREF_CLK_REQ &amp; mux MCS and coex PLLs to FREF */</span>
	<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">SYS_CLK_CFG_REG</span><span class="p">,</span>
			     <span class="n">WL_CLK_REQ_TYPE_PG2</span> <span class="o">|</span> <span class="n">MCS_PLL_CLK_SEL_FREF</span><span class="p">);</span>

	<span class="cm">/* Delay execution for 15msec, to let the HW settle */</span>
	<span class="n">mdelay</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wl128x_is_tcxo_valid</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">tcxo_detection</span><span class="p">;</span>

	<span class="n">tcxo_detection</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">TCXO_CLK_DETECT_REG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tcxo_detection</span> <span class="o">&amp;</span> <span class="n">TCXO_DET_FAILED</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wl128x_is_fref_valid</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">fref_detection</span><span class="p">;</span>

	<span class="n">fref_detection</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">FREF_CLK_DETECT_REG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fref_detection</span> <span class="o">&amp;</span> <span class="n">FREF_CLK_DETECT_FAIL</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl128x_manually_configure_mcs_pll</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">MCS_PLL_M_REG</span><span class="p">,</span> <span class="n">MCS_PLL_M_REG_VAL</span><span class="p">);</span>
	<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">MCS_PLL_N_REG</span><span class="p">,</span> <span class="n">MCS_PLL_N_REG_VAL</span><span class="p">);</span>
	<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">MCS_PLL_CONFIG_REG</span><span class="p">,</span> <span class="n">MCS_PLL_CONFIG_REG_VAL</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl128x_configure_mcs_pll</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">clk</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">spare_reg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">pll_config</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">input_freq</span><span class="p">;</span>

	<span class="cm">/* Mask bits [3:1] in the sys_clk_cfg register */</span>
	<span class="n">spare_reg</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL_SPARE_REG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">spare_reg</span> <span class="o">==</span> <span class="mh">0xFFFF</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="n">spare_reg</span> <span class="o">|=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
	<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL_SPARE_REG</span><span class="p">,</span> <span class="n">spare_reg</span><span class="p">);</span>

	<span class="cm">/* Handle special cases of the TCXO clock */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">tcxo_clock</span> <span class="o">==</span> <span class="n">WL12XX_TCXOCLOCK_16_8</span> <span class="o">||</span>
	    <span class="n">wl</span><span class="o">-&gt;</span><span class="n">tcxo_clock</span> <span class="o">==</span> <span class="n">WL12XX_TCXOCLOCK_33_6</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">wl128x_manually_configure_mcs_pll</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>

	<span class="cm">/* Set the input frequency according to the selected clock source */</span>
	<span class="n">input_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">clk</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">pll_config</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">MCS_PLL_CONFIG_REG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pll_config</span> <span class="o">==</span> <span class="mh">0xFFFF</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
	<span class="n">pll_config</span> <span class="o">|=</span> <span class="p">(</span><span class="n">input_freq</span> <span class="o">&lt;&lt;</span> <span class="n">MCS_SEL_IN_FREQ_SHIFT</span><span class="p">);</span>
	<span class="n">pll_config</span> <span class="o">|=</span> <span class="n">MCS_PLL_ENABLE_HP</span><span class="p">;</span>
	<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">MCS_PLL_CONFIG_REG</span><span class="p">,</span> <span class="n">pll_config</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * WL128x has two clocks input - TCXO and FREF.</span>
<span class="cm"> * TCXO is the main clock of the device, while FREF is used to sync</span>
<span class="cm"> * between the GPS and the cellular modem.</span>
<span class="cm"> * In cases where TCXO is 32.736MHz or 16.368MHz, the FREF will be used</span>
<span class="cm"> * as the WLAN/BT main clock.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl128x_boot_clk</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">selected_clock</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">sys_clk_cfg</span><span class="p">;</span>

	<span class="cm">/* For XTAL-only modes, FREF will be used after switching from TCXO */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">==</span> <span class="n">WL12XX_REFCLOCK_26_XTAL</span> <span class="o">||</span>
	    <span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">==</span> <span class="n">WL12XX_REFCLOCK_38_XTAL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wl128x_switch_tcxo_to_fref</span><span class="p">(</span><span class="n">wl</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">fref_clk</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Query the HW, to determine which clock source we should use */</span>
	<span class="n">sys_clk_cfg</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">SYS_CLK_CFG_REG</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sys_clk_cfg</span> <span class="o">==</span> <span class="mh">0xFFFF</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sys_clk_cfg</span> <span class="o">&amp;</span> <span class="n">PRCM_CM_EN_MUX_WLAN_FREF</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">fref_clk</span><span class="p">;</span>

	<span class="cm">/* If TCXO is either 32.736MHz or 16.368MHz, switch to FREF */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">tcxo_clock</span> <span class="o">==</span> <span class="n">WL12XX_TCXOCLOCK_16_368</span> <span class="o">||</span>
	    <span class="n">wl</span><span class="o">-&gt;</span><span class="n">tcxo_clock</span> <span class="o">==</span> <span class="n">WL12XX_TCXOCLOCK_32_736</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wl128x_switch_tcxo_to_fref</span><span class="p">(</span><span class="n">wl</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">fref_clk</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* TCXO clock is selected */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wl128x_is_tcxo_valid</span><span class="p">(</span><span class="n">wl</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="o">*</span><span class="n">selected_clock</span> <span class="o">=</span> <span class="n">wl</span><span class="o">-&gt;</span><span class="n">tcxo_clock</span><span class="p">;</span>
	<span class="k">goto</span> <span class="n">config_mcs_pll</span><span class="p">;</span>

<span class="nl">fref_clk:</span>
	<span class="cm">/* FREF clock is selected */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wl128x_is_fref_valid</span><span class="p">(</span><span class="n">wl</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="o">*</span><span class="n">selected_clock</span> <span class="o">=</span> <span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span><span class="p">;</span>

<span class="nl">config_mcs_pll:</span>
	<span class="k">return</span> <span class="n">wl128x_configure_mcs_pll</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="o">*</span><span class="n">selected_clock</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl127x_boot_clk</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">pause</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">clk</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">WL127X_PG_GET_MAJOR</span><span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">hw_pg_ver</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">WLCORE_QUIRK_END_OF_TRANSACTION</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">==</span> <span class="n">CONF_REF_CLK_19_2_E</span> <span class="o">||</span>
	    <span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">==</span> <span class="n">CONF_REF_CLK_38_4_E</span> <span class="o">||</span>
	    <span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">==</span> <span class="n">CONF_REF_CLK_38_4_M_XTAL</span><span class="p">)</span>
		<span class="cm">/* ref clk: 19.2/38.4/38.4-XTAL */</span>
		<span class="n">clk</span> <span class="o">=</span> <span class="mh">0x3</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">==</span> <span class="n">CONF_REF_CLK_26_E</span> <span class="o">||</span>
		 <span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">==</span> <span class="n">CONF_REF_CLK_52_E</span><span class="p">)</span>
		<span class="cm">/* ref clk: 26/52 */</span>
		<span class="n">clk</span> <span class="o">=</span> <span class="mh">0x5</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">!=</span> <span class="n">CONF_REF_CLK_19_2_E</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">val</span><span class="p">;</span>
		<span class="cm">/* Set clock type (open drain) */</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">OCP_REG_CLK_TYPE</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="n">FREF_CLK_TYPE_BITS</span><span class="p">;</span>
		<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">OCP_REG_CLK_TYPE</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

		<span class="cm">/* Set clock pull mode (no pull) */</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">OCP_REG_CLK_PULL</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">NO_PULL</span><span class="p">;</span>
		<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">OCP_REG_CLK_PULL</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">val</span><span class="p">;</span>
		<span class="cm">/* Set clock polarity */</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">OCP_REG_CLK_POLARITY</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">&amp;=</span> <span class="n">FREF_CLK_POLARITY_BITS</span><span class="p">;</span>
		<span class="n">val</span> <span class="o">|=</span> <span class="n">CLK_REQ_OUTN_SEL</span><span class="p">;</span>
		<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">OCP_REG_CLK_POLARITY</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_PLL_PARAMETERS</span><span class="p">,</span> <span class="n">clk</span><span class="p">);</span>

	<span class="n">pause</span> <span class="o">=</span> <span class="n">wl1271_read32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_PLL_PARAMETERS</span><span class="p">);</span>

	<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_BOOT</span><span class="p">,</span> <span class="s">&quot;pause1 0x%x&quot;</span><span class="p">,</span> <span class="n">pause</span><span class="p">);</span>

	<span class="n">pause</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">WU_COUNTER_PAUSE_VAL</span><span class="p">);</span>
	<span class="n">pause</span> <span class="o">|=</span> <span class="n">WU_COUNTER_PAUSE_VAL</span><span class="p">;</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_WU_COUNTER_PAUSE</span><span class="p">,</span> <span class="n">pause</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl1271_boot_soft_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timeout</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">boot_data</span><span class="p">;</span>

	<span class="cm">/* perform soft reset */</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_SLV_SOFT_RESET</span><span class="p">,</span> <span class="n">ACX_SLV_SOFT_RESET_BIT</span><span class="p">);</span>

	<span class="cm">/* SOFT_RESET is self clearing */</span>
	<span class="n">timeout</span> <span class="o">=</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="n">usecs_to_jiffies</span><span class="p">(</span><span class="n">SOFT_RESET_MAX_TIME</span><span class="p">);</span>
	<span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">boot_data</span> <span class="o">=</span> <span class="n">wl1271_read32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_SLV_SOFT_RESET</span><span class="p">);</span>
		<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_BOOT</span><span class="p">,</span> <span class="s">&quot;soft reset bootdata 0x%x&quot;</span><span class="p">,</span> <span class="n">boot_data</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">boot_data</span> <span class="o">&amp;</span> <span class="n">ACX_SLV_SOFT_RESET_BIT</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">time_after</span><span class="p">(</span><span class="n">jiffies</span><span class="p">,</span> <span class="n">timeout</span><span class="p">))</span> <span class="p">{</span>
			<span class="cm">/* 1.2 check pWhalBus-&gt;uSelfClearTime if the</span>
<span class="cm">			 * timeout was reached */</span>
			<span class="n">wl1271_error</span><span class="p">(</span><span class="s">&quot;soft reset timeout&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">udelay</span><span class="p">(</span><span class="n">SOFT_RESET_STALL_TIME</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* disable Rx/Tx */</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_ENABLE</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>

	<span class="cm">/* disable auto calibration on start*/</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_SPARE_A2</span><span class="p">,</span> <span class="mh">0xffff</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl12xx_pre_boot</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">clk</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">selected_clock</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">wl128x_boot_clk</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">selected_clock</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">wl127x_boot_clk</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Continue the ELP wake up sequence */</span>
	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_WELP_ARM_COMMAND</span><span class="p">,</span> <span class="n">WELP_ARM_COMMAND_VAL</span><span class="p">);</span>
	<span class="n">udelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

	<span class="n">wlcore_set_partition</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ptable</span><span class="p">[</span><span class="n">PART_DRPW</span><span class="p">]);</span>

	<span class="cm">/* Read-modify-write DRPW_SCRATCH_START register (see next state)</span>
<span class="cm">	   to be used by DRPw FW. The RTRIM value will be added by the FW</span>
<span class="cm">	   before taking DRPw out of reset */</span>

	<span class="n">clk</span> <span class="o">=</span> <span class="n">wl1271_read32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_DRPW_SCRATCH_START</span><span class="p">);</span>

	<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_BOOT</span><span class="p">,</span> <span class="s">&quot;clk2 0x%x&quot;</span><span class="p">,</span> <span class="n">clk</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span>
		<span class="n">clk</span> <span class="o">|=</span> <span class="p">((</span><span class="n">selected_clock</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">clk</span> <span class="o">|=</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ref_clock</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_DRPW_SCRATCH_START</span><span class="p">,</span> <span class="n">clk</span><span class="p">);</span>

	<span class="n">wlcore_set_partition</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ptable</span><span class="p">[</span><span class="n">PART_WORK</span><span class="p">]);</span>

	<span class="cm">/* Disable interrupts */</span>
	<span class="n">wlcore_write_reg</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">REG_INTERRUPT_MASK</span><span class="p">,</span> <span class="n">WL1271_ACX_INTR_ALL</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wl1271_boot_soft_reset</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_pre_upload</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">tmp</span><span class="p">;</span>

	<span class="cm">/* write firmware&#39;s last address (ie. it&#39;s length) to</span>
<span class="cm">	 * ACX_EEPROMLESS_IND_REG */</span>
	<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_BOOT</span><span class="p">,</span> <span class="s">&quot;ACX_EEPROMLESS_IND_REG&quot;</span><span class="p">);</span>

	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_EEPROMLESS_IND</span><span class="p">,</span> <span class="n">WL12XX_EEPROMLESS_IND</span><span class="p">);</span>

	<span class="n">tmp</span> <span class="o">=</span> <span class="n">wlcore_read_reg</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">REG_CHIP_ID_B</span><span class="p">);</span>

	<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_BOOT</span><span class="p">,</span> <span class="s">&quot;chip id 0x%x&quot;</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>

	<span class="cm">/* 6. read the EEPROM parameters */</span>
	<span class="n">tmp</span> <span class="o">=</span> <span class="n">wl1271_read32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_SCR_PAD2</span><span class="p">);</span>

	<span class="cm">/* WL1271: The reference driver skips steps 7 to 10 (jumps directly</span>
<span class="cm">	 * to upload_fw) */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span>
		<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">SDIO_IO_DS</span><span class="p">,</span> <span class="n">HCI_IO_DS_6MA</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_enable_interrupts</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">polarity</span><span class="p">;</span>

	<span class="n">polarity</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">OCP_REG_POLARITY</span><span class="p">);</span>

	<span class="cm">/* We use HIGH polarity, so unset the LOW bit */</span>
	<span class="n">polarity</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">POLARITY_LOW</span><span class="p">;</span>
	<span class="n">wl12xx_top_reg_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">OCP_REG_POLARITY</span><span class="p">,</span> <span class="n">polarity</span><span class="p">);</span>

	<span class="n">wlcore_write_reg</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">REG_INTERRUPT_MASK</span><span class="p">,</span> <span class="n">WL1271_ACX_ALL_EVENTS_VECTOR</span><span class="p">);</span>

	<span class="n">wlcore_enable_interrupts</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
	<span class="n">wlcore_write_reg</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">REG_INTERRUPT_MASK</span><span class="p">,</span>
			 <span class="n">WL1271_ACX_INTR_ALL</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">WL1271_INTR_MASK</span><span class="p">));</span>

	<span class="n">wl1271_write32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_HI_CFG</span><span class="p">,</span> <span class="n">HI_CFG_DEF_VAL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl12xx_boot</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wl12xx_pre_boot</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wlcore_boot_upload_nvs</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">wl12xx_pre_upload</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wlcore_boot_upload_firmware</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wlcore_boot_run_firmware</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="n">wl12xx_enable_interrupts</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>

<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_trigger_cmd</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd_box_addr</span><span class="p">,</span>
			       <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wl1271_write</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">cmd_box_addr</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
	<span class="n">wlcore_write_reg</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">REG_INTERRUPT_TRIG</span><span class="p">,</span> <span class="n">WL12XX_INTR_TRIG_CMD</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_ack_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wlcore_write_reg</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">REG_INTERRUPT_TRIG</span><span class="p">,</span> <span class="n">WL12XX_INTR_TRIG_EVENT_ACK</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">wl12xx_calc_tx_blocks</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">,</span> <span class="n">u32</span> <span class="n">spare_blks</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">blk_size</span> <span class="o">=</span> <span class="n">WL12XX_TX_HW_BLOCK_SIZE</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">align_len</span> <span class="o">=</span> <span class="n">wlcore_calc_packet_alignment</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">align_len</span> <span class="o">+</span> <span class="n">blk_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">blk_size</span> <span class="o">+</span> <span class="n">spare_blks</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wl12xx_set_tx_desc_blocks</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">struct</span> <span class="n">wl1271_tx_hw_descr</span> <span class="o">*</span><span class="n">desc</span><span class="p">,</span>
			  <span class="n">u32</span> <span class="n">blks</span><span class="p">,</span> <span class="n">u32</span> <span class="n">spare_blks</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">desc</span><span class="o">-&gt;</span><span class="n">wl128x_mem</span><span class="p">.</span><span class="n">total_mem_blocks</span> <span class="o">=</span> <span class="n">blks</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">desc</span><span class="o">-&gt;</span><span class="n">wl127x_mem</span><span class="p">.</span><span class="n">extra_blocks</span> <span class="o">=</span> <span class="n">spare_blks</span><span class="p">;</span>
		<span class="n">desc</span><span class="o">-&gt;</span><span class="n">wl127x_mem</span><span class="p">.</span><span class="n">total_mem_blocks</span> <span class="o">=</span> <span class="n">blks</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span>
<span class="nf">wl12xx_set_tx_desc_data_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">struct</span> <span class="n">wl1271_tx_hw_descr</span> <span class="o">*</span><span class="n">desc</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">aligned_len</span> <span class="o">=</span> <span class="n">wlcore_calc_packet_alignment</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">desc</span><span class="o">-&gt;</span><span class="n">wl128x_mem</span><span class="p">.</span><span class="n">extra_bytes</span> <span class="o">=</span> <span class="n">aligned_len</span> <span class="o">-</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
		<span class="n">desc</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">aligned_len</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>

		<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_TX</span><span class="p">,</span>
			     <span class="s">&quot;tx_fill_hdr: hlid: %d len: %d life: %d mem: %d extra: %d&quot;</span><span class="p">,</span>
			     <span class="n">desc</span><span class="o">-&gt;</span><span class="n">hlid</span><span class="p">,</span>
			     <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">desc</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">),</span>
			     <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">desc</span><span class="o">-&gt;</span><span class="n">life_time</span><span class="p">),</span>
			     <span class="n">desc</span><span class="o">-&gt;</span><span class="n">wl128x_mem</span><span class="p">.</span><span class="n">total_mem_blocks</span><span class="p">,</span>
			     <span class="n">desc</span><span class="o">-&gt;</span><span class="n">wl128x_mem</span><span class="p">.</span><span class="n">extra_bytes</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* calculate number of padding bytes */</span>
		<span class="kt">int</span> <span class="n">pad</span> <span class="o">=</span> <span class="n">aligned_len</span> <span class="o">-</span> <span class="n">skb</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>
		<span class="n">desc</span><span class="o">-&gt;</span><span class="n">tx_attr</span> <span class="o">|=</span>
			<span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">pad</span> <span class="o">&lt;&lt;</span> <span class="n">TX_HW_ATTR_OFST_LAST_WORD_PAD</span><span class="p">);</span>

		<span class="cm">/* Store the aligned length in terms of words */</span>
		<span class="n">desc</span><span class="o">-&gt;</span><span class="n">length</span> <span class="o">=</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">aligned_len</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>

		<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_TX</span><span class="p">,</span>
			     <span class="s">&quot;tx_fill_hdr: pad: %d hlid: %d len: %d life: %d mem: %d&quot;</span><span class="p">,</span>
			     <span class="n">pad</span><span class="p">,</span> <span class="n">desc</span><span class="o">-&gt;</span><span class="n">hlid</span><span class="p">,</span>
			     <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">desc</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">),</span>
			     <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">desc</span><span class="o">-&gt;</span><span class="n">life_time</span><span class="p">),</span>
			     <span class="n">desc</span><span class="o">-&gt;</span><span class="n">wl127x_mem</span><span class="p">.</span><span class="n">total_mem_blocks</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">enum</span> <span class="n">wl_rx_buf_align</span>
<span class="nf">wl12xx_get_rx_buf_align</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rx_desc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rx_desc</span> <span class="o">&amp;</span> <span class="n">RX_BUF_UNALIGNED_PAYLOAD</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">WLCORE_RX_BUF_UNALIGNED</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">WLCORE_RX_BUF_ALIGNED</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">wl12xx_get_rx_packet_len</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">rx_data</span><span class="p">,</span>
				    <span class="n">u32</span> <span class="n">data_len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">wl1271_rx_descriptor</span> <span class="o">*</span><span class="n">desc</span> <span class="o">=</span> <span class="n">rx_data</span><span class="p">;</span>

	<span class="cm">/* invalid packet */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">data_len</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">desc</span><span class="p">)</span> <span class="o">||</span>
	    <span class="n">data_len</span> <span class="o">&lt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">desc</span><span class="p">)</span> <span class="o">+</span> <span class="n">desc</span><span class="o">-&gt;</span><span class="n">pad_len</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">data_len</span> <span class="o">-</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">desc</span><span class="p">)</span> <span class="o">-</span> <span class="n">desc</span><span class="o">-&gt;</span><span class="n">pad_len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_tx_delayed_compl</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">fw_status</span><span class="o">-&gt;</span><span class="n">tx_results_counter</span> <span class="o">==</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">tx_results_count</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">wl1271_tx_complete</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl12xx_hw_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">host_cfg_bitmap</span> <span class="o">=</span> <span class="n">HOST_IF_CFG_RX_FIFO_ENABLE</span><span class="p">;</span>

		<span class="n">ret</span> <span class="o">=</span> <span class="n">wl128x_cmd_general_parms</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">wl128x_cmd_radio_parms</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">WLCORE_QUIRK_TX_BLOCKSIZE_ALIGN</span><span class="p">)</span>
			<span class="cm">/* Enable SDIO padding */</span>
			<span class="n">host_cfg_bitmap</span> <span class="o">|=</span> <span class="n">HOST_IF_CFG_TX_PAD_TO_SDIO_BLK</span><span class="p">;</span>

		<span class="cm">/* Must be before wl1271_acx_init_mem_config() */</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">wl1271_acx_host_if_cfg_bitmap</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">host_cfg_bitmap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">wl1271_cmd_general_parms</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">wl1271_cmd_radio_parms</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">wl1271_cmd_ext_radio_parms</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">wl12xx_sta_get_ap_rate_mask</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span>
				       <span class="k">struct</span> <span class="n">wl12xx_vif</span> <span class="o">*</span><span class="n">wlvif</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">wlvif</span><span class="o">-&gt;</span><span class="n">rate_set</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wl12xx_identify_fw</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">fw_ver</span> <span class="o">=</span> <span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">fw_ver</span><span class="p">;</span>

	<span class="cm">/* Only new station firmwares support routing fw logs to the host */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">fw_ver</span><span class="p">[</span><span class="n">FW_VER_IF_TYPE</span><span class="p">]</span> <span class="o">==</span> <span class="n">FW_VER_IF_TYPE_STA</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">fw_ver</span><span class="p">[</span><span class="n">FW_VER_MINOR</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">FW_VER_MINOR_FWLOG_STA_MIN</span><span class="p">))</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">WLCORE_QUIRK_FWLOG_NOT_IMPLEMENTED</span><span class="p">;</span>

	<span class="cm">/* This feature is not yet supported for AP mode */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fw_ver</span><span class="p">[</span><span class="n">FW_VER_IF_TYPE</span><span class="p">]</span> <span class="o">==</span> <span class="n">FW_VER_IF_TYPE_AP</span><span class="p">)</span>
		<span class="n">wl</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">WLCORE_QUIRK_FWLOG_NOT_IMPLEMENTED</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_conf_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">wl12xx_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">wl</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="cm">/* apply driver default configuration */</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl12xx_conf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">wl12xx_conf</span><span class="p">));</span>

	<span class="cm">/* apply default private configuration */</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl12xx_default_priv_conf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wl12xx_mac_in_fuse</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">bool</span> <span class="n">supported</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">major</span> <span class="o">=</span> <span class="n">WL128X_PG_GET_MAJOR</span><span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">hw_pg_ver</span><span class="p">);</span>
		<span class="n">minor</span> <span class="o">=</span> <span class="n">WL128X_PG_GET_MINOR</span><span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">hw_pg_ver</span><span class="p">);</span>

		<span class="cm">/* in wl128x we have the MAC address if the PG is &gt;= (2, 1) */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">major</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="o">||</span> <span class="p">(</span><span class="n">major</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="n">minor</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">))</span>
			<span class="n">supported</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">major</span> <span class="o">=</span> <span class="n">WL127X_PG_GET_MAJOR</span><span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">hw_pg_ver</span><span class="p">);</span>
		<span class="n">minor</span> <span class="o">=</span> <span class="n">WL127X_PG_GET_MINOR</span><span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">hw_pg_ver</span><span class="p">);</span>

		<span class="cm">/* in wl127x we have the MAC address if the PG is &gt;= (3, 1) */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">major</span> <span class="o">==</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span> <span class="n">minor</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">supported</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">wl1271_debug</span><span class="p">(</span><span class="n">DEBUG_PROBE</span><span class="p">,</span>
		     <span class="s">&quot;PG Ver major = %d minor = %d, MAC %s present&quot;</span><span class="p">,</span>
		     <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">supported</span> <span class="o">?</span> <span class="s">&quot;is&quot;</span> <span class="o">:</span> <span class="s">&quot;is not&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">supported</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_get_fuse_mac</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">mac1</span><span class="p">,</span> <span class="n">mac2</span><span class="p">;</span>

	<span class="n">wlcore_set_partition</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ptable</span><span class="p">[</span><span class="n">PART_DRPW</span><span class="p">]);</span>

	<span class="n">mac1</span> <span class="o">=</span> <span class="n">wl1271_read32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_REG_FUSE_BD_ADDR_1</span><span class="p">);</span>
	<span class="n">mac2</span> <span class="o">=</span> <span class="n">wl1271_read32</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL12XX_REG_FUSE_BD_ADDR_2</span><span class="p">);</span>

	<span class="cm">/* these are the two parts of the BD_ADDR */</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">fuse_oui_addr</span> <span class="o">=</span> <span class="p">((</span><span class="n">mac2</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
		<span class="p">((</span><span class="n">mac1</span> <span class="o">&amp;</span> <span class="mh">0xff000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">);</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">fuse_nic_addr</span> <span class="o">=</span> <span class="n">mac1</span> <span class="o">&amp;</span> <span class="mh">0xffffff</span><span class="p">;</span>

	<span class="n">wlcore_set_partition</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ptable</span><span class="p">[</span><span class="n">PART_DOWN</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">s8</span> <span class="nf">wl12xx_get_pg_ver</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">die_info</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">chip</span><span class="p">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">CHIP_ID_1283_PG20</span><span class="p">)</span>
		<span class="n">die_info</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL128X_REG_FUSE_DATA_2_1</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">die_info</span> <span class="o">=</span> <span class="n">wl12xx_top_reg_read</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">WL127X_REG_FUSE_DATA_2_1</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">s8</span><span class="p">)</span> <span class="p">(</span><span class="n">die_info</span> <span class="o">&amp;</span> <span class="n">PG_VER_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">PG_VER_OFFSET</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">wl12xx_get_mac</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wl12xx_mac_in_fuse</span><span class="p">(</span><span class="n">wl</span><span class="p">))</span>
		<span class="n">wl12xx_get_fuse_mac</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">wlcore_ops</span> <span class="n">wl12xx_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">identify_chip</span>		<span class="o">=</span> <span class="n">wl12xx_identify_chip</span><span class="p">,</span>
	<span class="p">.</span><span class="n">identify_fw</span>		<span class="o">=</span> <span class="n">wl12xx_identify_fw</span><span class="p">,</span>
	<span class="p">.</span><span class="n">boot</span>			<span class="o">=</span> <span class="n">wl12xx_boot</span><span class="p">,</span>
	<span class="p">.</span><span class="n">trigger_cmd</span>		<span class="o">=</span> <span class="n">wl12xx_trigger_cmd</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ack_event</span>		<span class="o">=</span> <span class="n">wl12xx_ack_event</span><span class="p">,</span>
	<span class="p">.</span><span class="n">calc_tx_blocks</span>		<span class="o">=</span> <span class="n">wl12xx_calc_tx_blocks</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_tx_desc_blocks</span>	<span class="o">=</span> <span class="n">wl12xx_set_tx_desc_blocks</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_tx_desc_data_len</span>	<span class="o">=</span> <span class="n">wl12xx_set_tx_desc_data_len</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_rx_buf_align</span>	<span class="o">=</span> <span class="n">wl12xx_get_rx_buf_align</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_rx_packet_len</span>	<span class="o">=</span> <span class="n">wl12xx_get_rx_packet_len</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tx_immediate_compl</span>	<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tx_delayed_compl</span>	<span class="o">=</span> <span class="n">wl12xx_tx_delayed_compl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hw_init</span>		<span class="o">=</span> <span class="n">wl12xx_hw_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init_vif</span>		<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sta_get_ap_rate_mask</span>	<span class="o">=</span> <span class="n">wl12xx_sta_get_ap_rate_mask</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_pg_ver</span>		<span class="o">=</span> <span class="n">wl12xx_get_pg_ver</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_mac</span>		<span class="o">=</span> <span class="n">wl12xx_get_mac</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ieee80211_sta_ht_cap</span> <span class="n">wl12xx_ht_cap</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="n">IEEE80211_HT_CAP_GRN_FLD</span> <span class="o">|</span> <span class="n">IEEE80211_HT_CAP_SGI_20</span> <span class="o">|</span>
	       <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">IEEE80211_HT_CAP_RX_STBC_SHIFT</span><span class="p">),</span>
	<span class="p">.</span><span class="n">ht_supported</span> <span class="o">=</span> <span class="nb">true</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ampdu_factor</span> <span class="o">=</span> <span class="n">IEEE80211_HT_MAX_AMPDU_8K</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ampdu_density</span> <span class="o">=</span> <span class="n">IEEE80211_HT_MPDU_DENSITY_8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mcs</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rx_mask</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">},</span>
		<span class="p">.</span><span class="n">rx_highest</span> <span class="o">=</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="mi">72</span><span class="p">),</span>
		<span class="p">.</span><span class="n">tx_params</span> <span class="o">=</span> <span class="n">IEEE80211_HT_MCS_TX_DEFINED</span><span class="p">,</span>
		<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__devinit</span> <span class="nf">wl12xx_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wl12xx_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">;</span>

	<span class="n">hw</span> <span class="o">=</span> <span class="n">wlcore_alloc_hw</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">priv</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">IS_ERR</span><span class="p">(</span><span class="n">hw</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">wl1271_error</span><span class="p">(</span><span class="s">&quot;can&#39;t allocate hw&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">PTR_ERR</span><span class="p">(</span><span class="n">hw</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">wl</span> <span class="o">=</span> <span class="n">hw</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wl12xx_ops</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">ptable</span> <span class="o">=</span> <span class="n">wl12xx_ptable</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">rtable</span> <span class="o">=</span> <span class="n">wl12xx_rtable</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">num_tx_desc</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">normal_tx_spare</span> <span class="o">=</span> <span class="n">WL12XX_TX_HW_BLOCK_SPARE_DEFAULT</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">gem_tx_spare</span> <span class="o">=</span> <span class="n">WL12XX_TX_HW_BLOCK_GEM_SPARE</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">band_rate_to_idx</span> <span class="o">=</span> <span class="n">wl12xx_band_rate_to_idx</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">hw_tx_rate_tbl_size</span> <span class="o">=</span> <span class="n">WL12XX_CONF_HW_RXTX_RATE_MAX</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">hw_min_ht_rate</span> <span class="o">=</span> <span class="n">WL12XX_CONF_HW_RXTX_RATE_MCS0</span><span class="p">;</span>
	<span class="n">wl</span><span class="o">-&gt;</span><span class="n">fw_status_priv_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wl</span><span class="o">-&gt;</span><span class="n">ht_cap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wl12xx_ht_cap</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">wl12xx_ht_cap</span><span class="p">));</span>
	<span class="n">wl12xx_conf_init</span><span class="p">(</span><span class="n">wl</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">wlcore_probe</span><span class="p">(</span><span class="n">wl</span><span class="p">,</span> <span class="n">pdev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">platform_device_id</span> <span class="n">wl12xx_id_table</span><span class="p">[]</span> <span class="n">__devinitconst</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="s">&quot;wl12xx&quot;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="p">}</span> <span class="cm">/* Terminating Entry */</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">platform</span><span class="p">,</span> <span class="n">wl12xx_id_table</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_driver</span> <span class="n">wl12xx_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">wl12xx_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">__devexit_p</span><span class="p">(</span><span class="n">wlcore_remove</span><span class="p">),</span>
	<span class="p">.</span><span class="n">id_table</span>	<span class="o">=</span> <span class="n">wl12xx_id_table</span><span class="p">,</span>
	<span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;wl12xx_driver&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">owner</span>	<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">wl12xx_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">platform_driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wl12xx_driver</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_init</span><span class="p">(</span><span class="n">wl12xx_init</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">wl12xx_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">platform_driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wl12xx_driver</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">wl12xx_exit</span><span class="p">);</span>

<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL v2&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Luciano Coelho &lt;coelho@ti.com&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="n">WL127X_FW_NAME_SINGLE</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="n">WL127X_FW_NAME_MULTI</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="n">WL127X_PLT_FW_NAME</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="n">WL128X_FW_NAME_SINGLE</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="n">WL128X_FW_NAME_MULTI</span><span class="p">);</span>
<span class="n">MODULE_FIRMWARE</span><span class="p">(</span><span class="n">WL128X_PLT_FW_NAME</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
