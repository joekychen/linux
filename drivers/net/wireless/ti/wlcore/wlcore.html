<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › ti › wlcore › wlcore.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>wlcore.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is part of wlcore</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2011 Texas Instruments Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * version 2 as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span>
<span class="cm"> * 02110-1301 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __WLCORE_H__</span>
<span class="cp">#define __WLCORE_H__</span>

<span class="cp">#include &lt;linux/platform_device.h&gt;</span>

<span class="cp">#include &quot;wl12xx.h&quot;</span>
<span class="cp">#include &quot;event.h&quot;</span>

<span class="cm">/* The maximum number of Tx descriptors in all chip families */</span>
<span class="cp">#define WLCORE_MAX_TX_DESCRIPTORS 32</span>

<span class="cm">/* forward declaration */</span>
<span class="k">struct</span> <span class="n">wl1271_tx_hw_descr</span><span class="p">;</span>
<span class="k">enum</span> <span class="n">wl_rx_buf_align</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">wlcore_ops</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">identify_chip</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">identify_fw</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">boot</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">trigger_cmd</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">cmd_box_addr</span><span class="p">,</span>
			    <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">ack_event</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">calc_tx_blocks</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">,</span> <span class="n">u32</span> <span class="n">spare_blks</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_tx_desc_blocks</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">wl1271_tx_hw_descr</span> <span class="o">*</span><span class="n">desc</span><span class="p">,</span>
				   <span class="n">u32</span> <span class="n">blks</span><span class="p">,</span> <span class="n">u32</span> <span class="n">spare_blks</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_tx_desc_data_len</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">wl1271_tx_hw_descr</span> <span class="o">*</span><span class="n">desc</span><span class="p">,</span>
				     <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>
	<span class="k">enum</span> <span class="n">wl_rx_buf_align</span> <span class="p">(</span><span class="o">*</span><span class="n">get_rx_buf_align</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span>
						 <span class="n">u32</span> <span class="n">rx_desc</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">prepare_read</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="n">u32</span> <span class="n">rx_desc</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">get_rx_packet_len</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">rx_data</span><span class="p">,</span>
				 <span class="n">u32</span> <span class="n">data_len</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_delayed_compl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_immediate_compl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hw_init</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">init_vif</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">struct</span> <span class="n">wl12xx_vif</span> <span class="o">*</span><span class="n">wlvif</span><span class="p">);</span>
	<span class="n">u32</span> <span class="p">(</span><span class="o">*</span><span class="n">sta_get_ap_rate_mask</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">wl12xx_vif</span> <span class="o">*</span><span class="n">wlvif</span><span class="p">);</span>
	<span class="n">s8</span> <span class="p">(</span><span class="o">*</span><span class="n">get_pg_ver</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">get_mac</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">wlcore_partitions</span> <span class="p">{</span>
	<span class="n">PART_DOWN</span><span class="p">,</span>
	<span class="n">PART_WORK</span><span class="p">,</span>
	<span class="n">PART_BOOT</span><span class="p">,</span>
	<span class="n">PART_DRPW</span><span class="p">,</span>
	<span class="n">PART_TOP_PRCM_ELP_SOC</span><span class="p">,</span>
	<span class="n">PART_PHY_INIT</span><span class="p">,</span>

	<span class="n">PART_TABLE_LEN</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wlcore_partition</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">start</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wlcore_partition_set</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">wlcore_partition</span> <span class="n">mem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wlcore_partition</span> <span class="n">reg</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wlcore_partition</span> <span class="n">mem2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wlcore_partition</span> <span class="n">mem3</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">wlcore_registers</span> <span class="p">{</span>
	<span class="cm">/* register addresses, used with partition translation */</span>
	<span class="n">REG_ECPU_CONTROL</span><span class="p">,</span>
	<span class="n">REG_INTERRUPT_NO_CLEAR</span><span class="p">,</span>
	<span class="n">REG_INTERRUPT_ACK</span><span class="p">,</span>
	<span class="n">REG_COMMAND_MAILBOX_PTR</span><span class="p">,</span>
	<span class="n">REG_EVENT_MAILBOX_PTR</span><span class="p">,</span>
	<span class="n">REG_INTERRUPT_TRIG</span><span class="p">,</span>
	<span class="n">REG_INTERRUPT_MASK</span><span class="p">,</span>
	<span class="n">REG_PC_ON_RECOVERY</span><span class="p">,</span>
	<span class="n">REG_CHIP_ID_B</span><span class="p">,</span>
	<span class="n">REG_CMD_MBOX_ADDRESS</span><span class="p">,</span>

	<span class="cm">/* data access memory addresses, used with partition translation */</span>
	<span class="n">REG_SLV_MEM_DATA</span><span class="p">,</span>
	<span class="n">REG_SLV_REG_DATA</span><span class="p">,</span>

	<span class="cm">/* raw data access memory addresses */</span>
	<span class="n">REG_RAW_FW_STATUS_ADDR</span><span class="p">,</span>

	<span class="n">REG_TABLE_LEN</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wl1271</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">mac80211_registered</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">if_priv</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">wl1271_if_operations</span> <span class="o">*</span><span class="n">if_ops</span><span class="p">;</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_power</span><span class="p">)(</span><span class="n">bool</span> <span class="n">enable</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ref_clock</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">wl_lock</span><span class="p">;</span>

	<span class="k">enum</span> <span class="n">wl1271_state</span> <span class="n">state</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">wl12xx_fw_type</span> <span class="n">fw_type</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">plt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">last_vif_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mutex</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">wlcore_partition_set</span> <span class="n">curr_part</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">wl1271_chip</span> <span class="n">chip</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">cmd_box_addr</span><span class="p">;</span>

	<span class="n">u8</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">fw_len</span><span class="p">;</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">nvs</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">nvs_len</span><span class="p">;</span>

	<span class="n">s8</span> <span class="n">hw_pg_ver</span><span class="p">;</span>

	<span class="cm">/* address read from the fuse ROM */</span>
	<span class="n">u32</span> <span class="n">fuse_oui_addr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fuse_nic_addr</span><span class="p">;</span>

	<span class="cm">/* we have up to 2 MAC addresses */</span>
	<span class="k">struct</span> <span class="n">mac_address</span> <span class="n">addresses</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">channel</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">system_hlid</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">links_map</span><span class="p">[</span><span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">WL12XX_MAX_LINKS</span><span class="p">)];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">roles_map</span><span class="p">[</span><span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">WL12XX_MAX_ROLES</span><span class="p">)];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">roc_map</span><span class="p">[</span><span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">WL12XX_MAX_ROLES</span><span class="p">)];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">rate_policies_map</span><span class="p">[</span>
			<span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">WL12XX_MAX_RATE_POLICIES</span><span class="p">)];</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">wlvif_list</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">sta_count</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ap_count</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">wl1271_acx_mem_map</span> <span class="o">*</span><span class="n">target_mem_map</span><span class="p">;</span>

	<span class="cm">/* Accounting for allocated / available TX blocks on HW */</span>
	<span class="n">u32</span> <span class="n">tx_blocks_freed</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_blocks_available</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_allocated_blocks</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_results_count</span><span class="p">;</span>

	<span class="cm">/* Accounting for allocated / available Tx packets in HW */</span>
	<span class="n">u32</span> <span class="n">tx_pkts_freed</span><span class="p">[</span><span class="n">NUM_TX_QUEUES</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">tx_allocated_pkts</span><span class="p">[</span><span class="n">NUM_TX_QUEUES</span><span class="p">];</span>

	<span class="cm">/* Transmitted TX packets counter for chipset interface */</span>
	<span class="n">u32</span> <span class="n">tx_packets_count</span><span class="p">;</span>

	<span class="cm">/* Time-offset between host and chipset clocks */</span>
	<span class="n">s64</span> <span class="n">time_offset</span><span class="p">;</span>

	<span class="cm">/* Frames scheduled for transmission, not handled yet */</span>
	<span class="kt">int</span> <span class="n">tx_queue_count</span><span class="p">[</span><span class="n">NUM_TX_QUEUES</span><span class="p">];</span>
	<span class="kt">long</span> <span class="n">stopped_queues_map</span><span class="p">;</span>

	<span class="cm">/* Frames received, not handled yet by mac80211 */</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">deferred_rx_queue</span><span class="p">;</span>

	<span class="cm">/* Frames sent, not returned yet to mac80211 */</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">deferred_tx_queue</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">tx_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">workqueue_struct</span> <span class="o">*</span><span class="n">freezable_wq</span><span class="p">;</span>

	<span class="cm">/* Pending TX frames */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tx_frames_map</span><span class="p">[</span><span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">WLCORE_MAX_TX_DESCRIPTORS</span><span class="p">)];</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">tx_frames</span><span class="p">[</span><span class="n">WLCORE_MAX_TX_DESCRIPTORS</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">tx_frames_cnt</span><span class="p">;</span>

	<span class="cm">/* FW Rx counter */</span>
	<span class="n">u32</span> <span class="n">rx_counter</span><span class="p">;</span>

	<span class="cm">/* Rx memory pool address */</span>
	<span class="k">struct</span> <span class="n">wl1271_rx_mem_pool_addr</span> <span class="n">rx_mem_pool_addr</span><span class="p">;</span>

	<span class="cm">/* Intermediate buffer, used for packet aggregation */</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">aggr_buf</span><span class="p">;</span>

	<span class="cm">/* Reusable dummy packet template */</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">dummy_packet</span><span class="p">;</span>

	<span class="cm">/* Network stack work  */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">netstack_work</span><span class="p">;</span>

	<span class="cm">/* FW log buffer */</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">fwlog</span><span class="p">;</span>

	<span class="cm">/* Number of valid bytes in the FW log buffer */</span>
	<span class="kt">ssize_t</span> <span class="n">fwlog_size</span><span class="p">;</span>

	<span class="cm">/* Sysfs FW log entry readers wait queue */</span>
	<span class="n">wait_queue_head_t</span> <span class="n">fwlog_waitq</span><span class="p">;</span>

	<span class="cm">/* Hardware recovery work */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">recovery_work</span><span class="p">;</span>

	<span class="cm">/* Pointer that holds DMA-friendly block for the mailbox */</span>
	<span class="k">struct</span> <span class="n">event_mailbox</span> <span class="o">*</span><span class="n">mbox</span><span class="p">;</span>

	<span class="cm">/* The mbox event mask */</span>
	<span class="n">u32</span> <span class="n">event_mask</span><span class="p">;</span>

	<span class="cm">/* Mailbox pointers */</span>
	<span class="n">u32</span> <span class="n">mbox_ptr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* Are we currently scanning */</span>
	<span class="k">struct</span> <span class="n">ieee80211_vif</span> <span class="o">*</span><span class="n">scan_vif</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wl1271_scan</span> <span class="n">scan</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">scan_complete_work</span><span class="p">;</span>

	<span class="cm">/* Connection loss work */</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">connection_loss_work</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">sched_scanning</span><span class="p">;</span>

	<span class="cm">/* The current band */</span>
	<span class="k">enum</span> <span class="n">ieee80211_band</span> <span class="n">band</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">completion</span> <span class="o">*</span><span class="n">elp_compl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">elp_work</span><span class="p">;</span>

	<span class="cm">/* in dBm */</span>
	<span class="kt">int</span> <span class="n">power_level</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">wl1271_stats</span> <span class="n">stats</span><span class="p">;</span>

	<span class="n">__le32</span> <span class="n">buffer_32</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">buffer_cmd</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">buffer_busyword</span><span class="p">[</span><span class="n">WL1271_BUSY_WORD_CNT</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">wl_fw_status</span> <span class="o">*</span><span class="n">fw_status</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wl1271_tx_hw_res_if</span> <span class="o">*</span><span class="n">tx_res_if</span><span class="p">;</span>

	<span class="cm">/* Current chipset configuration */</span>
	<span class="k">struct</span> <span class="n">wlcore_conf</span> <span class="n">conf</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">sg_enabled</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">enable_11a</span><span class="p">;</span>

	<span class="cm">/* Most recently reported noise in dBm */</span>
	<span class="n">s8</span> <span class="n">noise</span><span class="p">;</span>

	<span class="cm">/* bands supported by this instance of wl12xx */</span>
	<span class="k">struct</span> <span class="n">ieee80211_supported_band</span> <span class="n">bands</span><span class="p">[</span><span class="n">IEEE80211_NUM_BANDS</span><span class="p">];</span>

	<span class="kt">int</span> <span class="n">tcxo_clock</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * wowlan trigger was configured during suspend.</span>
<span class="cm">	 * (currently, only &quot;ANY&quot; trigger is supported)</span>
<span class="cm">	 */</span>
	<span class="n">bool</span> <span class="n">wow_enabled</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">irq_wake_enabled</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * AP-mode - links indexed by HLID. The global and broadcast links</span>
<span class="cm">	 * are always active.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">wl1271_link</span> <span class="n">links</span><span class="p">[</span><span class="n">WL12XX_MAX_LINKS</span><span class="p">];</span>

	<span class="cm">/* AP-mode - a bitmap of links currently in PS mode according to FW */</span>
	<span class="n">u32</span> <span class="n">ap_fw_ps_map</span><span class="p">;</span>

	<span class="cm">/* AP-mode - a bitmap of links currently in PS mode in mac80211 */</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">ap_ps_map</span><span class="p">;</span>

	<span class="cm">/* Quirks of specific hardware revisions */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">quirks</span><span class="p">;</span>

	<span class="cm">/* Platform limitations */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">platform_quirks</span><span class="p">;</span>

	<span class="cm">/* number of currently active RX BA sessions */</span>
	<span class="kt">int</span> <span class="n">ba_rx_session_count</span><span class="p">;</span>

	<span class="cm">/* AP-mode - number of currently connected stations */</span>
	<span class="kt">int</span> <span class="n">active_sta_count</span><span class="p">;</span>

	<span class="cm">/* last wlvif we transmitted from */</span>
	<span class="k">struct</span> <span class="n">wl12xx_vif</span> <span class="o">*</span><span class="n">last_wlvif</span><span class="p">;</span>

	<span class="cm">/* work to fire when Tx is stuck */</span>
	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">tx_watchdog_work</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">wlcore_ops</span> <span class="o">*</span><span class="n">ops</span><span class="p">;</span>
	<span class="cm">/* pointer to the lower driver partition table */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">wlcore_partition_set</span> <span class="o">*</span><span class="n">ptable</span><span class="p">;</span>
	<span class="cm">/* pointer to the lower driver register table */</span>
	<span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">rtable</span><span class="p">;</span>
	<span class="cm">/* name of the firmwares to load - for PLT, single role, multi-role */</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">plt_fw_name</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sr_fw_name</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mr_fw_name</span><span class="p">;</span>

	<span class="cm">/* per-chip-family private structure */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">;</span>

	<span class="cm">/* number of TX descriptors the HW supports. */</span>
	<span class="n">u32</span> <span class="n">num_tx_desc</span><span class="p">;</span>

	<span class="cm">/* spare Tx blocks for normal/GEM operating modes */</span>
	<span class="n">u32</span> <span class="n">normal_tx_spare</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gem_tx_spare</span><span class="p">;</span>

	<span class="cm">/* translate HW Tx rates to standard rate-indices */</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">**</span><span class="n">band_rate_to_idx</span><span class="p">;</span>

	<span class="cm">/* size of table for HW rates that can be received from chip */</span>
	<span class="n">u8</span> <span class="n">hw_tx_rate_tbl_size</span><span class="p">;</span>

	<span class="cm">/* this HW rate and below are considered HT rates for this chip */</span>
	<span class="n">u8</span> <span class="n">hw_min_ht_rate</span><span class="p">;</span>

	<span class="cm">/* HW HT (11n) capabilities */</span>
	<span class="k">struct</span> <span class="n">ieee80211_sta_ht_cap</span> <span class="n">ht_cap</span><span class="p">;</span>

	<span class="cm">/* size of the private FW status data */</span>
	<span class="kt">size_t</span> <span class="n">fw_status_priv_len</span><span class="p">;</span>

	<span class="cm">/* RX Data filter rule state - enabled/disabled */</span>
	<span class="n">bool</span> <span class="n">rx_filter_enabled</span><span class="p">[</span><span class="n">WL1271_MAX_RX_FILTERS</span><span class="p">];</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">__devinit</span> <span class="n">wlcore_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">__devexit</span> <span class="n">wlcore_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">wlcore_alloc_hw</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">priv_size</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">wlcore_free_hw</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1271</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>

<span class="cm">/* Firmware image load chunk size */</span>
<span class="cp">#define CHUNK_SIZE	16384</span>

<span class="cm">/* Quirks */</span>

<span class="cm">/* Each RX/TX transaction requires an end-of-transaction transfer */</span>
<span class="cp">#define WLCORE_QUIRK_END_OF_TRANSACTION		BIT(0)</span>

<span class="cm">/* wl127x and SPI don&#39;t support SDIO block size alignment */</span>
<span class="cp">#define WLCORE_QUIRK_TX_BLOCKSIZE_ALIGN		BIT(2)</span>

<span class="cm">/* means aggregated Rx packets are aligned to a SDIO block */</span>
<span class="cp">#define WLCORE_QUIRK_RX_BLOCKSIZE_ALIGN		BIT(3)</span>

<span class="cm">/* Older firmwares did not implement the FW logger over bus feature */</span>
<span class="cp">#define WLCORE_QUIRK_FWLOG_NOT_IMPLEMENTED	BIT(4)</span>

<span class="cm">/* Older firmwares use an old NVS format */</span>
<span class="cp">#define WLCORE_QUIRK_LEGACY_NVS			BIT(5)</span>

<span class="cm">/* Some firmwares may not support ELP */</span>
<span class="cp">#define WLCORE_QUIRK_NO_ELP			BIT(6)</span>

<span class="cm">/* TODO: move to the lower drivers when all usages are abstracted */</span>
<span class="cp">#define CHIP_ID_1271_PG10              (0x4030101)</span>
<span class="cp">#define CHIP_ID_1271_PG20              (0x4030111)</span>
<span class="cp">#define CHIP_ID_1283_PG10              (0x05030101)</span>
<span class="cp">#define CHIP_ID_1283_PG20              (0x05030111)</span>

<span class="cm">/* TODO: move all these common registers and values elsewhere */</span>
<span class="cp">#define HW_ACCESS_ELP_CTRL_REG		0x1FFFC</span>

<span class="cm">/* ELP register commands */</span>
<span class="cp">#define ELPCTRL_WAKE_UP             0x1</span>
<span class="cp">#define ELPCTRL_WAKE_UP_WLAN_READY  0x5</span>
<span class="cp">#define ELPCTRL_SLEEP               0x0</span>
<span class="cm">/* ELP WLAN_READY bit */</span>
<span class="cp">#define ELPCTRL_WLAN_READY          0x2</span>

<span class="cm">/*************************************************************************</span>

<span class="cm">    Interrupt Trigger Register (Host -&gt; WiLink)</span>

<span class="cm">**************************************************************************/</span>

<span class="cm">/* Hardware to Embedded CPU Interrupts - first 32-bit register set */</span>

<span class="cm">/*</span>
<span class="cm"> * The host sets this bit to inform the Wlan</span>
<span class="cm"> * FW that a TX packet is in the XFER</span>
<span class="cm"> * Buffer #0.</span>
<span class="cm"> */</span>
<span class="cp">#define INTR_TRIG_TX_PROC0 BIT(2)</span>

<span class="cm">/*</span>
<span class="cm"> * The host sets this bit to inform the FW</span>
<span class="cm"> * that it read a packet from RX XFER</span>
<span class="cm"> * Buffer #0.</span>
<span class="cm"> */</span>
<span class="cp">#define INTR_TRIG_RX_PROC0 BIT(3)</span>

<span class="cp">#define INTR_TRIG_DEBUG_ACK BIT(4)</span>

<span class="cp">#define INTR_TRIG_STATE_CHANGED BIT(5)</span>

<span class="cm">/* Hardware to Embedded CPU Interrupts - second 32-bit register set */</span>

<span class="cm">/*</span>
<span class="cm"> * The host sets this bit to inform the FW</span>
<span class="cm"> * that it read a packet from RX XFER</span>
<span class="cm"> * Buffer #1.</span>
<span class="cm"> */</span>
<span class="cp">#define INTR_TRIG_RX_PROC1 BIT(17)</span>

<span class="cm">/*</span>
<span class="cm"> * The host sets this bit to inform the Wlan</span>
<span class="cm"> * hardware that a TX packet is in the XFER</span>
<span class="cm"> * Buffer #1.</span>
<span class="cm"> */</span>
<span class="cp">#define INTR_TRIG_TX_PROC1 BIT(18)</span>

<span class="cp">#define ACX_SLV_SOFT_RESET_BIT	BIT(1)</span>
<span class="cp">#define SOFT_RESET_MAX_TIME	1000000</span>
<span class="cp">#define SOFT_RESET_STALL_TIME	1000</span>

<span class="cp">#define ECPU_CONTROL_HALT	0x00000101</span>

<span class="cp">#define WELP_ARM_COMMAND_VAL	0x4</span>

<span class="cp">#endif </span><span class="cm">/* __WLCORE_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
