f | debug.h | s | 2.7K | 89 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wlcore/wl12xx: implement chip-specific partition tables  Add partition tables to wlcore, move and reorganize partition setting functions.  Move wl12xx partition table to use the wlcore partition table instead.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | init.c | s | 16K | 599 | Arik Nemtsov | arik@wizery.com | 1334209441 |  | wlcore/wl12xx: add hw op for vif init  Add an op for family-specific vif initialization.  Currently unused, but will be needed when wl18xx support is implemented.  Signed-off-by: Arik Nemtsov <arik@wizery.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | ps.c | s | 7.5K | 246 | Luciano Coelho | coelho@ti.com | 1334209438 |  | wlcore: add quirk to disable ELP  ELP is a very complicated process in the firmware.  Due to its complexity, in some early firmware revisions, the ELP feature is disabled.  To support this cases, this patch adds a quirk that disables ELP mode.  When ELP is not supported, do not attempt to enter ELP when requested by the driver.  Signed-off-by: Luciano Coelho <coelho@ti.com> Signed-off-by: Arik Nemtsov <arik@wizery.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | io.h | s | 5.1K | 146 | Luciano Coelho | coelho@ti.com | 1334209437 |  | wlcore/wl12xx: move top initialization to wl12xx  The top registers initialization is very specific to the actual hardware used, even the way in which we read from and write to the top registers varies from chip to chip.  This patch moves all top registers initialization to wl12xx.  Also add a boot op for the wlcore module to call at the right time and a few callbacks with the common called to be called from the lower drivers boot operations.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | Makefile | g | 444B |  | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: spin out the wl12xx probe from wlcore to a new wl12xx  Create a new small wl12xx module that only contains the probe functions and depends entirely on wlcore otherwise.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | scan.h | s | 5.6K | 185 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: move wl1271 struct to wlcore and add ops  In order to add chip-specific operations and prepare for future elements that need to be set by the lower driver, move the wl1271 structure to the wlcore.h file and add an empty placeholder for the operations structure.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | cmd.h | s | 15K | 541 | Luciano Coelho | coelho@ti.com | 1334209440 |  | wlcore/wl12xx: add hw_init operation  Move all the wl12xx-specific hw initialization procedures into a new hw_init op.  Move some commands and ACX functions to wl12xx.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | testmode.h | s | 970B | 27 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: rename wl12xx to wlcore  Rename the wl12xx driver directory to wlcore as an initial step towards the split of the driver into wlcore and wl12xx.  We just rename the directory first to keep git blame happy.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | debugfs.h | s | 1.0K | 29 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: move wl1271 struct to wlcore and add ops  In order to add chip-specific operations and prepare for future elements that need to be set by the lower driver, move the wl1271 structure to the wlcore.h file and add an empty placeholder for the operations structure.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | ps.h | s | 1.3K | 36 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: move wl1271 struct to wlcore and add ops  In order to add chip-specific operations and prepare for future elements that need to be set by the lower driver, move the wl1271 structure to the wlcore.h file and add an empty placeholder for the operations structure.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | tx.c | s | 27K | 877 | Arik Nemtsov | arik@wizery.com | 1334209440 |  | wlcore/wl12xx: turn no-Tx-align quirk into Tx-align  Inverting the quirk flag to indicate Tx-alignment. This aligns it with the similar Rx-side quirk.  The call to wl1271_set_block_size() decides whether SDIO block size alignment can be used or not.  In case we're using SPI, we can't use the block size alignment, so the function returns false.  So we set the quirk when wl1271_set_block_size() returns true and let the wl12xx lower driver unset the bit for wl127x (since it doesn't support this quirk).  Signed-off-by: Arik Nemtsov <arik@wizery.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | tx.h | s | 6.9K | 209 | Arik Nemtsov | arik@wizery.com | 1334209439 |  | wlcore/wl12xx: add global elements to convert hw-rates to standard rates  Rates reported by HW can be different between chip families. Make the rate-to-idx translation tables private per family and use them in a common translation function. Add a global element to help determine which rates are HW HT-rates.  Signed-off-by: Arik Nemtsov <arik@wizery.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | wlcore.h | s | 11K | 338 | Bartosz.Markowski@tieto.com | Bartosz.Markowski@tieto.com | 1337118805 |  | wlcore/wl12xx: implement better beacon loss handling  Make use of REGAINED_BSS_EVENT and instead of reporting connection loss immediately on each BEACON_LOSE event, try if not regained in reasonable period of time.  Signed-off-by: bartosz.markowski <bartosz.markowski@tieto.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | event.c | s | 7.7K | 252 | Bartosz.Markowski@tieto.com | Bartosz.Markowski@tieto.com | 1337118805 |  | wlcore/wl12xx: implement better beacon loss handling  Make use of REGAINED_BSS_EVENT and instead of reporting connection loss immediately on each BEACON_LOSE event, try if not regained in reasonable period of time.  Signed-off-by: bartosz.markowski <bartosz.markowski@tieto.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | boot.h | s | 1.5K | 45 | Luciano Coelho | coelho@ti.com | 1334209437 |  | wlcore/wl12xx: move top initialization to wl12xx  The top registers initialization is very specific to the actual hardware used, even the way in which we read from and write to the top registers varies from chip to chip.  This patch moves all top registers initialization to wl12xx.  Also add a boot op for the wlcore module to call at the right time and a few callbacks with the common called to be called from the lower drivers boot operations.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | scan.c | s | 20K | 660 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: move wl1271 struct to wlcore and add ops  In order to add chip-specific operations and prepare for future elements that need to be set by the lower driver, move the wl1271 structure to the wlcore.h file and add an empty placeholder for the operations structure.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | boot.c | s | 11K | 363 | Bartosz.Markowski@tieto.com | Bartosz.Markowski@tieto.com | 1337118805 |  | wlcore/wl12xx: implement better beacon loss handling  Make use of REGAINED_BSS_EVENT and instead of reporting connection loss immediately on each BEACON_LOSE event, try if not regained in reasonable period of time.  Signed-off-by: bartosz.markowski <bartosz.markowski@tieto.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | sdio.c | s | 9.1K | 308 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wlcore/wl12xx: implement chip-specific register tables  Add register tables support in wlcore, add some new IO functions to read and write to chip-specific register and data addresses.  Move some common register values from wl12xx to wlcore and add the registers table to wl12xx.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | conf.h | s | 27K | 1089 | Luciano Coelho | coelho@ti.com | 1334209441 |  | wlcore/wl12xx: use a single memory config and reset if using wl127x  Instead of having two memory configuration sets, one for wl127x and one for wl128x, we can use only one which should be correctly set by the lower driver.  The wl12xx driver now uses the wl128x memory config by default but changes it when if it identifies the wl127x chips.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | wl12xx_80211.h | s | 3.5K | 113 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: rename wl12xx to wlcore  Rename the wl12xx driver directory to wlcore as an initial step towards the split of the driver into wlcore and wl12xx.  We just rename the directory first to keep git blame happy.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | acx.h | s | 33K | 1102 | Eyal Shapira | eyal@wizery.com | 1338313523 |  | wlcore: fix undefined symbols when CONFIG_PM is not defined  commit c21eebb50379a96e1335e933583dcd5b455c6b64 "wl12xx: add RX filters ACX commands" breaks the build when CONFIG_PM isn't defined:  ERROR: "wl1271_rx_filter_get_fields_size" [drivers/net/wireless/ti/wlcore/wlcore.ko] undefined! ERROR: "wl1271_rx_filter_flatten_fields" [drivers/net/wireless/ti/wlcore/wlcore.ko] undefined!  code in drivers/net/wireless/ti/wlcore/acx.c is using these functions unconditionally while they are #ifdefed CONFIG_PM. Fix it by ifdefing all relevant RX filters code with CONFIG_PM.  Reported-by: Geert Uytterhoeven <geert@linux-m68k.org> Signed-off-by: Eyal Shapira <eyal@wizery.com> Acked-by: Luciano Coelho <coelho@ti.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | cmd.c | s | 38K | 1383 | Jesper Juhl | jj@chaosbits.net | 1337118804 |  | wlcore: fix size of two memset's in wl1271_cmd_build_arp_rsp()  We currently do this:  int wl1271_cmd_build_arp_rsp(struct wl1271 *wl, struct wl12xx_vif *wlvif) ...       struct wl12xx_arp_rsp_template *tmpl;       struct ieee80211_hdr_3addr *hdr; ...       tmpl = (struct wl12xx_arp_rsp_template *)skb_put(skb, sizeof(*tmpl));       memset(tmpl, 0, sizeof(tmpl)); ...       hdr = (struct ieee80211_hdr_3addr *)skb_push(skb, sizeof(*hdr));       memset(hdr, 0, sizeof(hdr)); ...  I believe we want to set the entire structures to 0 with those memset() calls, not just zero the initial part of them (size of the pointer bytes).  Signed-off-by: Jesper Juhl <jj@chaosbits.net> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | rx.c | s | 8.5K | 267 | Eyal Shapira | eyal@wizery.com | 1338313523 |  | wlcore: fix undefined symbols when CONFIG_PM is not defined  commit c21eebb50379a96e1335e933583dcd5b455c6b64 "wl12xx: add RX filters ACX commands" breaks the build when CONFIG_PM isn't defined:  ERROR: "wl1271_rx_filter_get_fields_size" [drivers/net/wireless/ti/wlcore/wlcore.ko] undefined! ERROR: "wl1271_rx_filter_flatten_fields" [drivers/net/wireless/ti/wlcore/wlcore.ko] undefined!  code in drivers/net/wireless/ti/wlcore/acx.c is using these functions unconditionally while they are #ifdefed CONFIG_PM. Fix it by ifdefing all relevant RX filters code with CONFIG_PM.  Reported-by: Geert Uytterhoeven <geert@linux-m68k.org> Signed-off-by: Eyal Shapira <eyal@wizery.com> Acked-by: Luciano Coelho <coelho@ti.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | ini.h | s | 7.1K | 195 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: rename wl12xx to wlcore  Rename the wl12xx driver directory to wlcore as an initial step towards the split of the driver into wlcore and wl12xx.  We just rename the directory first to keep git blame happy.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | Kconfig | g | 1.2K |  | Randy Dunlap | rdunlap@xenotime.net | 1340651653 |  | wlcore: drop INET dependency  Mainline build reports:  warning: (WL12XX) selects WLCORE which has unmet direct dependencies (NETDEVICES && WLAN && WL_TI && GENERIC_HARDIRQS && MAC80211 && INET)  The INET dependency was added in commit 3c6af5b54fe74b6e56efadc22927e4055d00e9fc:     wl1271_main.c:(.text+0x271052): undefined reference to `unregister_inetaddr_ notifier'     wl1271_main.c:(.text+0x2714d7): undefined reference to `register_inetaddr_no tifier'      Driver is doing some filtering based on IP addresses...  but this driver no longer has that code and it builds fine even when CONFIG_INET is not enabled, so drop that dependency and eliminate the kconfig warning message.  Signed-off-by: Randy Dunlap <rdunlap@xenotime.net> Cc: Luciano Coelho <luciano.coelho@nokia.com> Cc: John W. Linville <linville@tuxdriver.com> Acked-by: Luciano Coelho <coelho@ti.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | wl12xx.h | s | 12K | 400 | Eyal Shapira | eyal@wizery.com | 1337118803 |  | wl12xx: support wowlan wakeup patterns  Use FW RX data filters to support cfg80211 wowlan wakeup patterns. This enables to wake up the host from suspend following detection of certain configurable patterns within an incoming packet. Up to 5 patterns are supported. Once the host is resumed any configured RX data filter is cleared. A single pattern can match several bytes sequences with different offsets within a packet.  Signed-off-by: Eyal Shapira <eyal@wizery.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | debugfs.c | s | 32K | 991 | John W. Linville | linville@tuxdriver.com | 1334341736 |  | Merge branch 'for-linville' of git://git.kernel.org/pub/scm/linux/kernel/git/luca/wl12xx
f | wl12xx_platform_data.c | s | 1.3K | 42 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: rename wl12xx to wlcore  Rename the wl12xx driver directory to wlcore as an initial step towards the split of the driver into wlcore and wl12xx.  We just rename the directory first to keep git blame happy.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | acx.c | s | 40K | 1443 | Eyal Shapira | eyal@wizery.com | 1338313523 |  | wlcore: fix undefined symbols when CONFIG_PM is not defined  commit c21eebb50379a96e1335e933583dcd5b455c6b64 "wl12xx: add RX filters ACX commands" breaks the build when CONFIG_PM isn't defined:  ERROR: "wl1271_rx_filter_get_fields_size" [drivers/net/wireless/ti/wlcore/wlcore.ko] undefined! ERROR: "wl1271_rx_filter_flatten_fields" [drivers/net/wireless/ti/wlcore/wlcore.ko] undefined!  code in drivers/net/wireless/ti/wlcore/acx.c is using these functions unconditionally while they are #ifdefed CONFIG_PM. Fix it by ifdefing all relevant RX filters code with CONFIG_PM.  Reported-by: Geert Uytterhoeven <geert@linux-m68k.org> Signed-off-by: Eyal Shapira <eyal@wizery.com> Acked-by: Luciano Coelho <coelho@ti.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | event.h | s | 4.1K | 120 | Luciano Coelho | coelho@ti.com | 1334209438 |  | wlcore: remove some unnecessary event mailbox address reads  We were reading the even mailbox address three times, which was completely unnecessary and complicated things regarding partition selection.  Remove the unnecessry reads and set the address for mailbox 1 and 2 after the first read.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | io.c | s | 5.6K | 157 | Luciano Coelho | coelho@ti.com | 1334209437 |  | wlcore/wl12xx: move top initialization to wl12xx  The top registers initialization is very specific to the actual hardware used, even the way in which we read from and write to the top registers varies from chip to chip.  This patch moves all top registers initialization to wl12xx.  Also add a boot op for the wlcore module to call at the right time and a few callbacks with the common called to be called from the lower drivers boot operations.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | rx.h | s | 3.9K | 126 | Eyal Shapira | eyal@wizery.com | 1337118803 |  | wlcore: add RX filters driver state mgmt functions  More prep work to support wowlan wakeup patterns. Added some wrappers that also keep the current filters state updated in the driver.  Signed-off-by: Eyal Shapira <eyal@wizery.com> Signed-off-by: Luciano Coelho <coelho@ti.com>
f | testmode.c | s | 7.3K | 278 | John W. Linville | linville@tuxdriver.com | 1334773668 |  | Merge branch 'master' of git://git.kernel.org/pub/scm/linux/kernel/git/linville/wireless-next into for-davem  Conflicts: 	drivers/net/wireless/iwlwifi/iwl-testmode.c 	include/net/nfc/nfc.h 	net/nfc/netlink.c 	net/wireless/nl80211.c
f | init.h | s | 1.3K | 35 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wl12xx/wlcore: move wl1271 struct to wlcore and add ops  In order to add chip-specific operations and prepare for future elements that need to be set by the lower driver, move the wl1271 structure to the wlcore.h file and add an empty placeholder for the operations structure.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | hw_ops.h | s | 2.8K | 99 | Luciano Coelho | coelho@ti.com | 1334209442 |  | wlcore/wl12xx: move identify firmware function to a lower driver op  Different chip families have different firmware versions, so we need to identify the firmware to enable quirks, reject the used version etc. in the lower drivers.  This commit turns the fw_ver_quirks function into an identify_fw operation.  Signed-off-by: Luciano Coelho <coelho@ti.com>
f | main.c | s | 132K | 4411 | Luciano Coelho | coelho@ti.com | 1337188110 |  | wlcore: fix some sparse warnings due to missing static declaration  There were three sparse warnings in main.c due to missing static declaration:    CHECK   drivers/net/wireless/ti/wlcore/main.c drivers/net/wireless/ti/wlcore/main.c:1265:5: warning: symbol 'wl1271_validate_wowlan_pattern' was not declared. Should it be static? drivers/net/wireless/ti/wlcore/main.c:1408:5: warning: symbol 'wl1271_convert_wowlan_pattern_to_rx_filter' was not declared. Should it be static? drivers/net/wireless/ti/wlcore/main.c:4823:6: warning: symbol 'wl1271_connection_loss_work' was not declared. Should it be static?  Fix these by adding the static declaration to those functions.  Signed-off-by: Luciano Coelho <coelho@ti.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | spi.c | s | 10K | 354 | Luciano Coelho | coelho@ti.com | 1334209436 |  | wlcore/wl12xx: implement chip-specific register tables  Add register tables support in wlcore, add some new IO functions to read and write to chip-specific register and data addresses.  Move some common register values from wl12xx to wlcore and add the registers table to wl12xx.  Signed-off-by: Luciano Coelho <coelho@ti.com>
