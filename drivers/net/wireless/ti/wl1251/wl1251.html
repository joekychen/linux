<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › ti › wl1251 › wl1251.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>wl1251.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * This file is part of wl1251</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 1998-2007 Texas Instruments Incorporated</span>
<span class="cm"> * Copyright (C) 2008-2009 Nokia Corporation</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * version 2 as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span>
<span class="cm"> * 02110-1301 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __WL1251_H__</span>
<span class="cp">#define __WL1251_H__</span>

<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/bitops.h&gt;</span>
<span class="cp">#include &lt;net/mac80211.h&gt;</span>

<span class="cp">#define DRIVER_NAME &quot;wl1251&quot;</span>
<span class="cp">#define DRIVER_PREFIX DRIVER_NAME &quot;: &quot;</span>

<span class="k">enum</span> <span class="p">{</span>
	<span class="n">DEBUG_NONE</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">DEBUG_IRQ</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
	<span class="n">DEBUG_SPI</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
	<span class="n">DEBUG_BOOT</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
	<span class="n">DEBUG_MAILBOX</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
	<span class="n">DEBUG_NETLINK</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span>
	<span class="n">DEBUG_EVENT</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
	<span class="n">DEBUG_TX</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">6</span><span class="p">),</span>
	<span class="n">DEBUG_RX</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
	<span class="n">DEBUG_SCAN</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
	<span class="n">DEBUG_CRYPT</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">9</span><span class="p">),</span>
	<span class="n">DEBUG_PSM</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
	<span class="n">DEBUG_MAC80211</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span>
	<span class="n">DEBUG_CMD</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span>
	<span class="n">DEBUG_ACX</span>	<span class="o">=</span> <span class="n">BIT</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span>
	<span class="n">DEBUG_ALL</span>	<span class="o">=</span> <span class="o">~</span><span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define DEBUG_LEVEL (DEBUG_NONE)</span>

<span class="cp">#define DEBUG_DUMP_LIMIT 1024</span>

<span class="cp">#define wl1251_error(fmt, arg...) \</span>
<span class="cp">	printk(KERN_ERR DRIVER_PREFIX &quot;ERROR &quot; fmt &quot;\n&quot;, ##arg)</span>

<span class="cp">#define wl1251_warning(fmt, arg...) \</span>
<span class="cp">	printk(KERN_WARNING DRIVER_PREFIX &quot;WARNING &quot; fmt &quot;\n&quot;, ##arg)</span>

<span class="cp">#define wl1251_notice(fmt, arg...) \</span>
<span class="cp">	printk(KERN_INFO DRIVER_PREFIX fmt &quot;\n&quot;, ##arg)</span>

<span class="cp">#define wl1251_info(fmt, arg...) \</span>
<span class="cp">	printk(KERN_DEBUG DRIVER_PREFIX fmt &quot;\n&quot;, ##arg)</span>

<span class="cp">#define wl1251_debug(level, fmt, arg...) \</span>
<span class="cp">	do { \</span>
<span class="cp">		if (level &amp; DEBUG_LEVEL) \</span>
<span class="cp">			printk(KERN_DEBUG DRIVER_PREFIX fmt &quot;\n&quot;, ##arg); \</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define wl1251_dump(level, prefix, buf, len)	\</span>
<span class="cp">	do { \</span>
<span class="cp">		if (level &amp; DEBUG_LEVEL) \</span>
<span class="cp">			print_hex_dump(KERN_DEBUG, DRIVER_PREFIX prefix, \</span>
<span class="cp">				       DUMP_PREFIX_OFFSET, 16, 1,	\</span>
<span class="cp">				       buf,				\</span>
<span class="cp">				       min_t(size_t, len, DEBUG_DUMP_LIMIT), \</span>
<span class="cp">				       0);				\</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define wl1251_dump_ascii(level, prefix, buf, len)	\</span>
<span class="cp">	do { \</span>
<span class="cp">		if (level &amp; DEBUG_LEVEL) \</span>
<span class="cp">			print_hex_dump(KERN_DEBUG, DRIVER_PREFIX prefix, \</span>
<span class="cp">				       DUMP_PREFIX_OFFSET, 16, 1,	\</span>
<span class="cp">				       buf,				\</span>
<span class="cp">				       min_t(size_t, len, DEBUG_DUMP_LIMIT), \</span>
<span class="cp">				       true);				\</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define WL1251_DEFAULT_RX_CONFIG (CFG_UNI_FILTER_EN |	\</span>
<span class="cp">				  CFG_BSSID_FILTER_EN)</span>

<span class="cp">#define WL1251_DEFAULT_RX_FILTER (CFG_RX_PRSP_EN |  \</span>
<span class="cp">				  CFG_RX_MGMT_EN |  \</span>
<span class="cp">				  CFG_RX_DATA_EN |  \</span>
<span class="cp">				  CFG_RX_CTL_EN |   \</span>
<span class="cp">				  CFG_RX_BCN_EN |   \</span>
<span class="cp">				  CFG_RX_AUTH_EN |  \</span>
<span class="cp">				  CFG_RX_ASSOC_EN)</span>

<span class="cp">#define WL1251_BUSY_WORD_LEN 8</span>

<span class="k">struct</span> <span class="n">boot_attr</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">radio_type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mac_clock</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">arm_clock</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">firmware_debug</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">minor</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">major</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bugfix</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">wl1251_state</span> <span class="p">{</span>
	<span class="n">WL1251_STATE_OFF</span><span class="p">,</span>
	<span class="n">WL1251_STATE_ON</span><span class="p">,</span>
	<span class="n">WL1251_STATE_PLT</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">wl1251_partition_type</span> <span class="p">{</span>
	<span class="n">PART_DOWN</span><span class="p">,</span>
	<span class="n">PART_WORK</span><span class="p">,</span>
	<span class="n">PART_DRPW</span><span class="p">,</span>

	<span class="n">PART_TABLE_LEN</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">wl1251_station_mode</span> <span class="p">{</span>
	<span class="n">STATION_ACTIVE_MODE</span><span class="p">,</span>
	<span class="n">STATION_POWER_SAVE_MODE</span><span class="p">,</span>
	<span class="n">STATION_IDLE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wl1251_partition</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">start</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wl1251_partition_set</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">wl1251_partition</span> <span class="n">mem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wl1251_partition</span> <span class="n">reg</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wl1251</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">wl1251_stats</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">acx_statistics</span> <span class="o">*</span><span class="n">fw_stats</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">fw_stats_update</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">retry_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">excessive_retries</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wl1251_debugfs</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rootdir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">fw_statistics</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">tx_internal_desc_overflow</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rx_out_of_mem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rx_hdr_overflow</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rx_hw_stuck</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rx_dropped</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rx_fcs_err</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rx_xfr_hint_trig</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rx_path_reset</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rx_reset_counter</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dma_rx_requested</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dma_rx_errors</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dma_tx_requested</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">dma_tx_errors</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_cmd_cmplt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_fiqs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_rx_headers</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_rx_mem_overflow</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_rx_rdys</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_irqs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_tx_procs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_decrypt_done</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_dma0_done</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_dma1_done</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_tx_exch_complete</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_commands</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_rx_procs</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_hw_pm_mode_changes</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_host_acknowledges</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_pci_pm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_wakeups</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">isr_low_rssi</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">wep_addr_key_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">wep_default_key_count</span><span class="p">;</span>
	<span class="cm">/* skipping wep.reserved */</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">wep_key_not_found</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">wep_decrypt_fail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">wep_packets</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">wep_interrupt</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_ps_enter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_elp_enter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_missing_bcns</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_wake_on_host</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_wake_on_timer_exp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_tx_with_ps</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_tx_without_ps</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_rcvd_beacons</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_power_save_off</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_enable_ps</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_disable_ps</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_fix_tsf_ps</span><span class="p">;</span>
	<span class="cm">/* skipping cont_miss_bcns_spread for now */</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">pwr_rcvd_awake_beacons</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">mic_rx_pkts</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">mic_calc_failure</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">aes_encrypt_fail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">aes_decrypt_fail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">aes_encrypt_packets</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">aes_decrypt_packets</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">aes_encrypt_interrupt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">aes_decrypt_interrupt</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">event_heart_beat</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">event_calibration</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">event_rx_mismatch</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">event_rx_mem_empty</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">event_rx_pool</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">event_oom_late</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">event_phy_transmit_error</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">event_tx_stuck</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">ps_pspoll_timeouts</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">ps_upsd_timeouts</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">ps_upsd_max_sptime</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">ps_upsd_max_apturn</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">ps_pspoll_max_apturn</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">ps_pspoll_utilization</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">ps_upsd_utilization</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rxpipe_rx_prep_beacon_drop</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rxpipe_descr_host_int_trig_rx_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rxpipe_beacon_buffer_thres_host_int_trig_rx_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rxpipe_missed_beacon_host_int_trig_rx_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">rxpipe_tx_xfr_host_int_trig_rx_data</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">tx_queue_len</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">tx_queue_status</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">retry_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dentry</span> <span class="o">*</span><span class="n">excessive_retries</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wl1251_if_operations</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">read</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">write</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">len</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">read_elp</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">write_elp</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">);</span>
	<span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">power</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">,</span> <span class="n">bool</span> <span class="n">enable</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">reset</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">enable_irq</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">disable_irq</span><span class="p">)(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">wl1251</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">mac80211_registered</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">if_priv</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">wl1251_if_operations</span> <span class="o">*</span><span class="n">if_ops</span><span class="p">;</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">set_power</span><span class="p">)(</span><span class="n">bool</span> <span class="n">enable</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">use_eeprom</span><span class="p">;</span>

	<span class="n">spinlock_t</span> <span class="n">wl_lock</span><span class="p">;</span>

	<span class="k">enum</span> <span class="n">wl1251_state</span> <span class="n">state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mutex</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">physical_mem_addr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">physical_reg_addr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">virtual_mem_addr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">virtual_reg_addr</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">cmd_box_addr</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">event_box_addr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">boot_attr</span> <span class="n">boot_attr</span><span class="p">;</span>

	<span class="n">u8</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">fw_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">nvs</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">nvs_len</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">bssid</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">mac_addr</span><span class="p">[</span><span class="n">ETH_ALEN</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">bss_type</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">listen_int</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">channel</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">target_mem_map</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">acx_data_path_params_resp</span> <span class="o">*</span><span class="n">data_path</span><span class="p">;</span>

	<span class="cm">/* Number of TX packets transferred to the FW, modulo 16 */</span>
	<span class="n">u32</span> <span class="n">data_in_count</span><span class="p">;</span>

	<span class="cm">/* Frames scheduled for transmission, not handled yet */</span>
	<span class="k">struct</span> <span class="n">sk_buff_head</span> <span class="n">tx_queue</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">tx_queue_stopped</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">tx_work</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">filter_work</span><span class="p">;</span>

	<span class="cm">/* Pending TX frames */</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">tx_frames</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="cm">/*</span>
<span class="cm">	 * Index pointing to the next TX complete entry</span>
<span class="cm">	 * in the cyclic XT complete array we get from</span>
<span class="cm">	 * the FW.</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">next_tx_complete</span><span class="p">;</span>

	<span class="cm">/* FW Rx counter */</span>
	<span class="n">u32</span> <span class="n">rx_counter</span><span class="p">;</span>

	<span class="cm">/* Rx frames handled */</span>
	<span class="n">u32</span> <span class="n">rx_handled</span><span class="p">;</span>

	<span class="cm">/* Current double buffer */</span>
	<span class="n">u32</span> <span class="n">rx_current_buffer</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_last_id</span><span class="p">;</span>

	<span class="cm">/* The target interrupt mask */</span>
	<span class="n">u32</span> <span class="n">intr_mask</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">irq_work</span><span class="p">;</span>

	<span class="cm">/* The mbox event mask */</span>
	<span class="n">u32</span> <span class="n">event_mask</span><span class="p">;</span>

	<span class="cm">/* Mailbox pointers */</span>
	<span class="n">u32</span> <span class="n">mbox_ptr</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="cm">/* Are we currently scanning */</span>
	<span class="n">bool</span> <span class="n">scanning</span><span class="p">;</span>

	<span class="cm">/* Default key (for WEP) */</span>
	<span class="n">u32</span> <span class="n">default_key</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_mgmt_frm_rate</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tx_mgmt_frm_mod</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_config</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">rx_filter</span><span class="p">;</span>

	<span class="cm">/* is firmware in elp mode */</span>
	<span class="n">bool</span> <span class="n">elp</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">delayed_work</span> <span class="n">elp_work</span><span class="p">;</span>

	<span class="k">enum</span> <span class="n">wl1251_station_mode</span> <span class="n">station_mode</span><span class="p">;</span>

	<span class="cm">/* PSM mode requested */</span>
	<span class="n">bool</span> <span class="n">psm_requested</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">beacon_int</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">dtim_period</span><span class="p">;</span>

	<span class="cm">/* in dBm */</span>
	<span class="kt">int</span> <span class="n">power_level</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">rssi_thold</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">wl1251_stats</span> <span class="n">stats</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wl1251_debugfs</span> <span class="n">debugfs</span><span class="p">;</span>

	<span class="n">__le32</span> <span class="n">buffer_32</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">buffer_cmd</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">buffer_busyword</span><span class="p">[</span><span class="n">WL1251_BUSY_WORD_LEN</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">wl1251_rx_descriptor</span> <span class="o">*</span><span class="n">rx_descriptor</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ieee80211_vif</span> <span class="o">*</span><span class="n">vif</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">chip_id</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">fw_ver</span><span class="p">[</span><span class="mi">21</span><span class="p">];</span>

	<span class="cm">/* Most recently reported noise in dBm */</span>
	<span class="n">s8</span> <span class="n">noise</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">wl1251_plt_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">wl1251_plt_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">wl1251_alloc_hw</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">wl1251_free_hw</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">wl1251_init_ieee80211</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">wl1251_enable_interrupts</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">wl1251_disable_interrupts</span><span class="p">(</span><span class="k">struct</span> <span class="n">wl1251</span> <span class="o">*</span><span class="n">wl</span><span class="p">);</span>

<span class="cp">#define DEFAULT_HW_GEN_MODULATION_TYPE    CCK_LONG </span><span class="cm">/* Long Preamble */</span><span class="cp"></span>
<span class="cp">#define DEFAULT_HW_GEN_TX_RATE          RATE_2MBPS</span>
<span class="cp">#define JOIN_TIMEOUT 5000 </span><span class="cm">/* 5000 milliseconds to join */</span><span class="cp"></span>

<span class="cp">#define WL1251_DEFAULT_POWER_LEVEL 20</span>

<span class="cp">#define WL1251_TX_QUEUE_LOW_WATERMARK  10</span>
<span class="cp">#define WL1251_TX_QUEUE_HIGH_WATERMARK 25</span>

<span class="cp">#define WL1251_DEFAULT_BEACON_INT 100</span>
<span class="cp">#define WL1251_DEFAULT_DTIM_PERIOD 1</span>

<span class="cp">#define WL1251_DEFAULT_CHANNEL 0</span>

<span class="cp">#define WL1251_DEFAULT_BET_CONSECUTIVE 10</span>

<span class="cp">#define CHIP_ID_1251_PG10	           (0x7010101)</span>
<span class="cp">#define CHIP_ID_1251_PG11	           (0x7020101)</span>
<span class="cp">#define CHIP_ID_1251_PG12	           (0x7030101)</span>
<span class="cp">#define CHIP_ID_1271_PG10	           (0x4030101)</span>
<span class="cp">#define CHIP_ID_1271_PG20	           (0x4030111)</span>

<span class="cp">#define WL1251_FW_NAME &quot;wl1251-fw.bin&quot;</span>
<span class="cp">#define WL1251_NVS_NAME &quot;wl1251-nvs.bin&quot;</span>

<span class="cp">#define WL1251_POWER_ON_SLEEP 10 </span><span class="cm">/* in milliseconds */</span><span class="cp"></span>

<span class="cp">#define WL1251_PART_DOWN_MEM_START	0x0</span>
<span class="cp">#define WL1251_PART_DOWN_MEM_SIZE	0x16800</span>
<span class="cp">#define WL1251_PART_DOWN_REG_START	REGISTERS_BASE</span>
<span class="cp">#define WL1251_PART_DOWN_REG_SIZE	REGISTERS_DOWN_SIZE</span>

<span class="cp">#define WL1251_PART_WORK_MEM_START	0x28000</span>
<span class="cp">#define WL1251_PART_WORK_MEM_SIZE	0x14000</span>
<span class="cp">#define WL1251_PART_WORK_REG_START	REGISTERS_BASE</span>
<span class="cp">#define WL1251_PART_WORK_REG_SIZE	REGISTERS_WORK_SIZE</span>

<span class="cp">#define WL1251_DEFAULT_LOW_RSSI_WEIGHT          10</span>
<span class="cp">#define WL1251_DEFAULT_LOW_RSSI_DEPTH           10</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
