<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › ath › ath9k › debug.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>debug.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2008-2011 Atheros Communications Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="cm"> * purpose with or without fee is hereby granted, provided that the above</span>
<span class="cm"> * copyright notice and this permission notice appear in all copies.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="cm"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="cm"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="cm"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="cm"> * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/vmalloc.h&gt;</span>
<span class="cp">#include &lt;linux/export.h&gt;</span>
<span class="cp">#include &lt;asm/unaligned.h&gt;</span>

<span class="cp">#include &quot;ath9k.h&quot;</span>

<span class="cp">#define REG_WRITE_D(_ah, _reg, _val) \</span>
<span class="cp">	ath9k_hw_common(_ah)-&gt;ops-&gt;write((_ah), (_val), (_reg))</span>
<span class="cp">#define REG_READ_D(_ah, _reg) \</span>
<span class="cp">	ath9k_hw_common(_ah)-&gt;ops-&gt;read((_ah), (_reg))</span>


<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">ath9k_debugfs_read_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ath9k_debugfs_release_buf</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">vfree</span><span class="p">(</span><span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#ifdef CONFIG_ATH_DEBUG</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_debug</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">);</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">debug_mask</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">write_file_debug</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mask</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">buf</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strict_strtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mask</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">common</span><span class="o">-&gt;</span><span class="n">debug_mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_debug</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_debug</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">write_file_debug</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#endif</span>

<span class="cp">#define DMA_BUF_LEN 1024</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_tx_chainmask</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ah</span><span class="o">-&gt;</span><span class="n">txchainmask</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">write_file_tx_chainmask</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mask</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">buf</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strict_strtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mask</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">ah</span><span class="o">-&gt;</span><span class="n">txchainmask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">;</span>
	<span class="n">ah</span><span class="o">-&gt;</span><span class="n">caps</span><span class="p">.</span><span class="n">tx_chainmask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_tx_chainmask</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_tx_chainmask</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">write_file_tx_chainmask</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_rx_chainmask</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ah</span><span class="o">-&gt;</span><span class="n">rxchainmask</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">write_file_rx_chainmask</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mask</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">buf</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strict_strtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mask</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">ah</span><span class="o">-&gt;</span><span class="n">rxchainmask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">;</span>
	<span class="n">ah</span><span class="o">-&gt;</span><span class="n">caps</span><span class="p">.</span><span class="n">rx_chainmask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_rx_chainmask</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_rx_chainmask</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">write_file_rx_chainmask</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_disable_ani</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">);</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">disable_ani</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">write_file_disable_ani</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
				      <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">disable_ani</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">buf</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strict_strtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">disable_ani</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">common</span><span class="o">-&gt;</span><span class="n">disable_ani</span> <span class="o">=</span> <span class="o">!!</span><span class="n">disable_ani</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">disable_ani</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">SC_OP_ANI_RUN</span><span class="p">;</span>
		<span class="n">del_timer_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">common</span><span class="o">-&gt;</span><span class="n">ani</span><span class="p">.</span><span class="n">timer</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_flags</span> <span class="o">|=</span> <span class="n">SC_OP_ANI_RUN</span><span class="p">;</span>
		<span class="n">ath_start_ani</span><span class="p">(</span><span class="n">common</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_disable_ani</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_disable_ani</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">write_file_disable_ani</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_dma</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">retval</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">[</span><span class="n">ATH9K_NUM_DMA_DEBUG_REGS</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">qcuOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dcuOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">qcuBase</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">dcuBase</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">DMA_BUF_LEN</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">ath9k_ps_wakeup</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

	<span class="n">REG_WRITE_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">AR_MACMISC</span><span class="p">,</span>
		  <span class="p">((</span><span class="n">AR_MACMISC_DMA_OBS_LINE_8</span> <span class="o">&lt;&lt;</span> <span class="n">AR_MACMISC_DMA_OBS_S</span><span class="p">)</span> <span class="o">|</span>
		   <span class="p">(</span><span class="n">AR_MACMISC_MISC_OBS_BUS_1</span> <span class="o">&lt;&lt;</span>
		    <span class="n">AR_MACMISC_MISC_OBS_BUS_MSB_S</span><span class="p">)));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Raw DMA Debug values:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH9K_NUM_DMA_DEBUG_REGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">4</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">REG_READ_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">AR_DMADBG_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">)));</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%d: %08x &quot;</span><span class="p">,</span>
				<span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Num QCU: chain_st fsp_ok fsp_st DCU: chain_st</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH9K_NUM_QUEUES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="n">qcuOffset</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dcuOffset</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">qcuOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">qcuBase</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dcuOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">dcuBase</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%2d          %2x      %1x     %2x           %2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="n">qcuBase</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="n">qcuOffset</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">qcuOffset</span><span class="p">,</span>
			<span class="p">(</span><span class="o">*</span><span class="n">qcuBase</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x8</span> <span class="o">&lt;&lt;</span> <span class="n">qcuOffset</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">qcuOffset</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span>
			<span class="n">val</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span>
			<span class="p">(</span><span class="o">*</span><span class="n">dcuBase</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1f</span> <span class="o">&lt;&lt;</span> <span class="n">dcuOffset</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">dcuOffset</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
		<span class="s">&quot;qcu_stitch state:   %2x    qcu_fetch state:        %2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x003c0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">18</span><span class="p">,</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x03c00000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">22</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
		<span class="s">&quot;qcu_complete state: %2x    dcu_complete state:     %2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x1c000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">,</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
		<span class="s">&quot;dcu_arb state:      %2x    dcu_fp state:           %2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x06000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x38000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">27</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
		<span class="s">&quot;chan_idle_dur:     %3d    chan_idle_dur_valid:     %1d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x000003fc</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x00000400</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
		<span class="s">&quot;txfifo_valid_0:      %1d    txfifo_valid_1:          %1d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x00000800</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">,</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x00001000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
		<span class="s">&quot;txfifo_dcu_num_0:   %2d    txfifo_dcu_num_1:       %2d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x0001e000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">13</span><span class="p">,</span> <span class="p">(</span><span class="n">val</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x001e0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">17</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;pcu observe: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">REG_READ_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">AR_OBS_BUS_1</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">DMA_BUF_LEN</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;AR_CR: 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">REG_READ_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">AR_CR</span><span class="p">));</span>

	<span class="n">ath9k_ps_restore</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">DMA_BUF_LEN</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">DMA_BUF_LEN</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_dma</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_dma</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>


<span class="kt">void</span> <span class="nf">ath_debug_stat_interrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span><span class="p">,</span> <span class="k">enum</span> <span class="n">ath9k_int</span> <span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">total</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="o">-&gt;</span><span class="n">caps</span><span class="p">.</span><span class="n">hw_caps</span> <span class="o">&amp;</span> <span class="n">ATH9K_HW_CAP_EDMA</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RXLP</span><span class="p">)</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">rxlp</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RXHP</span><span class="p">)</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">rxhp</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_BB_WATCHDOG</span><span class="p">)</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">bb_watchdog</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RX</span><span class="p">)</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">rxok</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RXEOL</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">rxeol</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RXORN</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">rxorn</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_TX</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">txok</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_TXURN</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">txurn</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_MIB</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">mib</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RXPHY</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">rxphyerr</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RXKCM</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">rx_keycache_miss</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_SWBA</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">swba</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_BMISS</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">bmiss</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_BNR</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">bnr</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_CST</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">cst</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_GTT</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">gtt</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_TIM</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">tim</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_CABEND</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">cabend</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_DTIMSYNC</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">dtimsync</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_DTIM</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">dtim</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_TSFOOR</span><span class="p">)</span>
		<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">istats</span><span class="p">.</span><span class="n">tsfoor</span><span class="o">++</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_interrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				   <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mxlen</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">mxlen</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

<span class="cp">#define PR_IS(a, s)						\</span>
<span class="cp">	do {							\</span>
<span class="cp">		len += snprintf(buf + len, mxlen - len,		\</span>
<span class="cp">				&quot;%21s: %10u\n&quot;, a,		\</span>
<span class="cp">				sc-&gt;debug.stats.istats.s);	\</span>
<span class="cp">	} while (0)</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="o">-&gt;</span><span class="n">caps</span><span class="p">.</span><span class="n">hw_caps</span> <span class="o">&amp;</span> <span class="n">ATH9K_HW_CAP_EDMA</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RXLP&quot;</span><span class="p">,</span> <span class="n">rxlp</span><span class="p">);</span>
		<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RXHP&quot;</span><span class="p">,</span> <span class="n">rxhp</span><span class="p">);</span>
		<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;WATHDOG&quot;</span><span class="p">,</span> <span class="n">bb_watchdog</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RX&quot;</span><span class="p">,</span> <span class="n">rxok</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RXEOL&quot;</span><span class="p">,</span> <span class="n">rxeol</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RXORN&quot;</span><span class="p">,</span> <span class="n">rxorn</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;TX&quot;</span><span class="p">,</span> <span class="n">txok</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;TXURN&quot;</span><span class="p">,</span> <span class="n">txurn</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;MIB&quot;</span><span class="p">,</span> <span class="n">mib</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RXPHY&quot;</span><span class="p">,</span> <span class="n">rxphyerr</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RXKCM&quot;</span><span class="p">,</span> <span class="n">rx_keycache_miss</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;SWBA&quot;</span><span class="p">,</span> <span class="n">swba</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;BMISS&quot;</span><span class="p">,</span> <span class="n">bmiss</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;BNR&quot;</span><span class="p">,</span> <span class="n">bnr</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;CST&quot;</span><span class="p">,</span> <span class="n">cst</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;GTT&quot;</span><span class="p">,</span> <span class="n">gtt</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;TIM&quot;</span><span class="p">,</span> <span class="n">tim</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;CABEND&quot;</span><span class="p">,</span> <span class="n">cabend</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;DTIMSYNC&quot;</span><span class="p">,</span> <span class="n">dtimsync</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;DTIM&quot;</span><span class="p">,</span> <span class="n">dtim</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;TSFOOR&quot;</span><span class="p">,</span> <span class="n">tsfoor</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;TOTAL&quot;</span><span class="p">,</span> <span class="n">total</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">mxlen</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;SYNC_CAUSE stats:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;Sync-All&quot;</span><span class="p">,</span> <span class="n">sync_cause_all</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RTC-IRQ&quot;</span><span class="p">,</span> <span class="n">sync_rtc_irq</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;MAC-IRQ&quot;</span><span class="p">,</span> <span class="n">sync_mac_irq</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;EEPROM-Illegal-Access&quot;</span><span class="p">,</span> <span class="n">eeprom_illegal_access</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;APB-Timeout&quot;</span><span class="p">,</span> <span class="n">apb_timeout</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;PCI-Mode-Conflict&quot;</span><span class="p">,</span> <span class="n">pci_mode_conflict</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;HOST1-Fatal&quot;</span><span class="p">,</span> <span class="n">host1_fatal</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;HOST1-Perr&quot;</span><span class="p">,</span> <span class="n">host1_perr</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;TRCV-FIFO-Perr&quot;</span><span class="p">,</span> <span class="n">trcv_fifo_perr</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RADM-CPL-EP&quot;</span><span class="p">,</span> <span class="n">radm_cpl_ep</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RADM-CPL-DLLP-Abort&quot;</span><span class="p">,</span> <span class="n">radm_cpl_dllp_abort</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RADM-CPL-TLP-Abort&quot;</span><span class="p">,</span> <span class="n">radm_cpl_tlp_abort</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RADM-CPL-ECRC-Err&quot;</span><span class="p">,</span> <span class="n">radm_cpl_ecrc_err</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;RADM-CPL-Timeout&quot;</span><span class="p">,</span> <span class="n">radm_cpl_timeout</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;Local-Bus-Timeout&quot;</span><span class="p">,</span> <span class="n">local_timeout</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;PM-Access&quot;</span><span class="p">,</span> <span class="n">pm_access</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;MAC-Awake&quot;</span><span class="p">,</span> <span class="n">mac_awake</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;MAC-Asleep&quot;</span><span class="p">,</span> <span class="n">mac_asleep</span><span class="p">);</span>
	<span class="n">PR_IS</span><span class="p">(</span><span class="s">&quot;MAC-Sleep-Access&quot;</span><span class="p">,</span> <span class="n">mac_sleep_access</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">mxlen</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">mxlen</span><span class="p">;</span>

	<span class="n">rv</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">rv</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_interrupt</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_interrupt</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define PR_QNUM(_n) sc-&gt;tx.txq_map[_n]-&gt;axq_qnum</span>
<span class="cp">#define PR(str, elem)							\</span>
<span class="cp">	do {								\</span>
<span class="cp">		len += snprintf(buf + len, size - len,			\</span>
<span class="cp">				&quot;%s%13u%11u%10u%10u\n&quot;, str,		\</span>
<span class="cp">		sc-&gt;debug.stats.txstats[PR_QNUM(WME_AC_BE)].elem, \</span>
<span class="cp">		sc-&gt;debug.stats.txstats[PR_QNUM(WME_AC_BK)].elem, \</span>
<span class="cp">		sc-&gt;debug.stats.txstats[PR_QNUM(WME_AC_VI)].elem, \</span>
<span class="cp">		sc-&gt;debug.stats.txstats[PR_QNUM(WME_AC_VO)].elem); \</span>
<span class="cp">		if (len &gt;= size)			  \</span>
<span class="cp">			goto done;			  \</span>
<span class="cp">} while(0)</span>

<span class="cp">#define PRX(str, elem)							\</span>
<span class="cp">do {									\</span>
<span class="cp">	len += snprintf(buf + len, size - len,				\</span>
<span class="cp">			&quot;%s%13u%11u%10u%10u\n&quot;, str,			\</span>
<span class="cp">			(unsigned int)(sc-&gt;tx.txq_map[WME_AC_BE]-&gt;elem),	\</span>
<span class="cp">			(unsigned int)(sc-&gt;tx.txq_map[WME_AC_BK]-&gt;elem),	\</span>
<span class="cp">			(unsigned int)(sc-&gt;tx.txq_map[WME_AC_VI]-&gt;elem),	\</span>
<span class="cp">			(unsigned int)(sc-&gt;tx.txq_map[WME_AC_VO]-&gt;elem));	\</span>
<span class="cp">	if (len &gt;= size)						\</span>
<span class="cp">		goto done;						\</span>
<span class="cp">} while(0)</span>

<span class="cp">#define PRQLE(str, elem)						\</span>
<span class="cp">do {									\</span>
<span class="cp">	len += snprintf(buf + len, size - len,				\</span>
<span class="cp">			&quot;%s%13i%11i%10i%10i\n&quot;, str,			\</span>
<span class="cp">			list_empty(&amp;sc-&gt;tx.txq_map[WME_AC_BE]-&gt;elem),	\</span>
<span class="cp">			list_empty(&amp;sc-&gt;tx.txq_map[WME_AC_BK]-&gt;elem),	\</span>
<span class="cp">			list_empty(&amp;sc-&gt;tx.txq_map[WME_AC_VI]-&gt;elem),	\</span>
<span class="cp">			list_empty(&amp;sc-&gt;tx.txq_map[WME_AC_VO]-&gt;elem));	\</span>
<span class="cp">	if (len &gt;= size)						\</span>
<span class="cp">		goto done;						\</span>
<span class="cp">} while (0)</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_xmit</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">8000</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">tmp</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;Num-Tx-Queues: %i  tx-queues-setup: 0x%x&quot;</span>
		       <span class="s">&quot; poll-work-seen: %u</span><span class="se">\n</span><span class="s">&quot;</span>
		       <span class="s">&quot;%30s %10s%10s%10s</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">ATH9K_NUM_TX_QUEUES</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">txqsetup</span><span class="p">,</span>
		       <span class="n">sc</span><span class="o">-&gt;</span><span class="n">tx_complete_poll_work_seen</span><span class="p">,</span>
		       <span class="s">&quot;BE&quot;</span><span class="p">,</span> <span class="s">&quot;BK&quot;</span><span class="p">,</span> <span class="s">&quot;VI&quot;</span><span class="p">,</span> <span class="s">&quot;VO&quot;</span><span class="p">);</span>

	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;MPDUs Queued:    &quot;</span><span class="p">,</span> <span class="n">queued</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;MPDUs Completed: &quot;</span><span class="p">,</span> <span class="n">completed</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;MPDUs XRetried:  &quot;</span><span class="p">,</span> <span class="n">xretries</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;Aggregates:      &quot;</span><span class="p">,</span> <span class="n">a_aggr</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;AMPDUs Queued HW:&quot;</span><span class="p">,</span> <span class="n">a_queued_hw</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;AMPDUs Queued SW:&quot;</span><span class="p">,</span> <span class="n">a_queued_sw</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;AMPDUs Completed:&quot;</span><span class="p">,</span> <span class="n">a_completed</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;AMPDUs Retried:  &quot;</span><span class="p">,</span> <span class="n">a_retries</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;AMPDUs XRetried: &quot;</span><span class="p">,</span> <span class="n">a_xretries</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;FIFO Underrun:   &quot;</span><span class="p">,</span> <span class="n">fifo_underrun</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;TXOP Exceeded:   &quot;</span><span class="p">,</span> <span class="n">xtxop</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;TXTIMER Expiry:  &quot;</span><span class="p">,</span> <span class="n">timer_exp</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;DESC CFG Error:  &quot;</span><span class="p">,</span> <span class="n">desc_cfg_err</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;DATA Underrun:   &quot;</span><span class="p">,</span> <span class="n">data_underrun</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;DELIM Underrun:  &quot;</span><span class="p">,</span> <span class="n">delim_underrun</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;TX-Pkts-All:     &quot;</span><span class="p">,</span> <span class="n">tx_pkts_all</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;TX-Bytes-All:    &quot;</span><span class="p">,</span> <span class="n">tx_bytes_all</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;hw-put-tx-buf:   &quot;</span><span class="p">,</span> <span class="n">puttxbuf</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;hw-tx-start:     &quot;</span><span class="p">,</span> <span class="n">txstart</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;hw-tx-proc-desc: &quot;</span><span class="p">,</span> <span class="n">txprocdesc</span><span class="p">);</span>
	<span class="n">PR</span><span class="p">(</span><span class="s">&quot;TX-Failed:       &quot;</span><span class="p">,</span> <span class="n">txfailed</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%s%11p%11p%10p%10p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;txq-memory-address:&quot;</span><span class="p">,</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">txq_map</span><span class="p">[</span><span class="n">WME_AC_BE</span><span class="p">],</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">txq_map</span><span class="p">[</span><span class="n">WME_AC_BK</span><span class="p">],</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">txq_map</span><span class="p">[</span><span class="n">WME_AC_VI</span><span class="p">],</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">txq_map</span><span class="p">[</span><span class="n">WME_AC_VO</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>

	<span class="n">PRX</span><span class="p">(</span><span class="s">&quot;axq-qnum:        &quot;</span><span class="p">,</span> <span class="n">axq_qnum</span><span class="p">);</span>
	<span class="n">PRX</span><span class="p">(</span><span class="s">&quot;axq-depth:       &quot;</span><span class="p">,</span> <span class="n">axq_depth</span><span class="p">);</span>
	<span class="n">PRX</span><span class="p">(</span><span class="s">&quot;axq-ampdu_depth: &quot;</span><span class="p">,</span> <span class="n">axq_ampdu_depth</span><span class="p">);</span>
	<span class="n">PRX</span><span class="p">(</span><span class="s">&quot;axq-stopped      &quot;</span><span class="p">,</span> <span class="n">stopped</span><span class="p">);</span>
	<span class="n">PRX</span><span class="p">(</span><span class="s">&quot;tx-in-progress   &quot;</span><span class="p">,</span> <span class="n">axq_tx_inprogress</span><span class="p">);</span>
	<span class="n">PRX</span><span class="p">(</span><span class="s">&quot;pending-frames   &quot;</span><span class="p">,</span> <span class="n">pending_frames</span><span class="p">);</span>
	<span class="n">PRX</span><span class="p">(</span><span class="s">&quot;txq_headidx:     &quot;</span><span class="p">,</span> <span class="n">txq_headidx</span><span class="p">);</span>
	<span class="n">PRX</span><span class="p">(</span><span class="s">&quot;txq_tailidx:     &quot;</span><span class="p">,</span> <span class="n">txq_headidx</span><span class="p">);</span>

	<span class="n">PRQLE</span><span class="p">(</span><span class="s">&quot;axq_q empty:       &quot;</span><span class="p">,</span> <span class="n">axq_q</span><span class="p">);</span>
	<span class="n">PRQLE</span><span class="p">(</span><span class="s">&quot;axq_acq empty:     &quot;</span><span class="p">,</span> <span class="n">axq_acq</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH_TXFIFO_DEPTH</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snprintf</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;txq_fifo[%i] empty: &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">PRQLE</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">txq_fifo</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="cm">/* Print out more detailed queue-info */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">WME_AC_BK</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">ath_txq</span> <span class="o">*</span><span class="n">txq</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">txq</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">struct</span> <span class="n">ath_atx_ac</span> <span class="o">*</span><span class="n">ac</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">ath_atx_tid</span> <span class="o">*</span><span class="n">tid</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
		<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">txq</span><span class="o">-&gt;</span><span class="n">axq_lock</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">txq</span><span class="o">-&gt;</span><span class="n">axq_acq</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">ac</span> <span class="o">=</span> <span class="n">list_first_entry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">txq</span><span class="o">-&gt;</span><span class="n">axq_acq</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ath_atx_ac</span><span class="p">,</span>
					      <span class="n">list</span><span class="p">);</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					<span class="s">&quot;txq[%i] first-ac: %p sched: %i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">i</span><span class="p">,</span> <span class="n">ac</span><span class="p">,</span> <span class="n">ac</span><span class="o">-&gt;</span><span class="n">sched</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ac</span><span class="o">-&gt;</span><span class="n">tid_q</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">))</span>
				<span class="k">goto</span> <span class="n">done_for</span><span class="p">;</span>
			<span class="n">tid</span> <span class="o">=</span> <span class="n">list_first_entry</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ac</span><span class="o">-&gt;</span><span class="n">tid_q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ath_atx_tid</span><span class="p">,</span>
					       <span class="n">list</span><span class="p">);</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					<span class="s">&quot; first-tid: %p sched: %i paused: %i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">tid</span><span class="p">,</span> <span class="n">tid</span><span class="o">-&gt;</span><span class="n">sched</span><span class="p">,</span> <span class="n">tid</span><span class="o">-&gt;</span><span class="n">paused</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="nl">done_for:</span>
		<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">txq</span><span class="o">-&gt;</span><span class="n">axq_lock</span><span class="p">);</span>
	<span class="p">}</span>

<span class="nl">done:</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_stations</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				  <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">64000</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_node</span> <span class="o">*</span><span class="n">an</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">q</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Stations:</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot; tid: addr sched paused buf_q-empty an ac baw</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot; ac: addr sched tid_q-empty txq</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">nodes_lock</span><span class="p">);</span>
	<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">an</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">nodes</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">ma</span> <span class="o">=</span> <span class="n">an</span><span class="o">-&gt;</span><span class="n">maxampdu</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ma</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">ma</span> <span class="o">=</span> <span class="mi">65535</span><span class="p">;</span> <span class="cm">/* see ath_lookup_rate */</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
				<span class="s">&quot;iface: %pM  sta: %pM max-ampdu: %hu mpdu-density: %uus</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">an</span><span class="o">-&gt;</span><span class="n">vif</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">,</span> <span class="n">an</span><span class="o">-&gt;</span><span class="n">sta</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">,</span> <span class="n">ma</span><span class="p">,</span>
				<span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)(</span><span class="n">an</span><span class="o">-&gt;</span><span class="n">mpdudensity</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="n">WME_NUM_TID</span><span class="p">;</span> <span class="n">q</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">ath_atx_tid</span> <span class="o">*</span><span class="n">tid</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">an</span><span class="o">-&gt;</span><span class="n">tid</span><span class="p">[</span><span class="n">q</span><span class="p">]);</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					<span class="s">&quot; tid: %p %s %s %i %p %p %hu</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">tid</span><span class="p">,</span> <span class="n">tid</span><span class="o">-&gt;</span><span class="n">sched</span> <span class="o">?</span> <span class="s">&quot;sched&quot;</span> <span class="o">:</span> <span class="s">&quot;idle&quot;</span><span class="p">,</span>
					<span class="n">tid</span><span class="o">-&gt;</span><span class="n">paused</span> <span class="o">?</span> <span class="s">&quot;paused&quot;</span> <span class="o">:</span> <span class="s">&quot;running&quot;</span><span class="p">,</span>
					<span class="n">skb_queue_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tid</span><span class="o">-&gt;</span><span class="n">buf_q</span><span class="p">),</span>
					<span class="n">tid</span><span class="o">-&gt;</span><span class="n">an</span><span class="p">,</span> <span class="n">tid</span><span class="o">-&gt;</span><span class="n">ac</span><span class="p">,</span> <span class="n">tid</span><span class="o">-&gt;</span><span class="n">baw_size</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">)</span>
				<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">q</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">q</span> <span class="o">&lt;</span> <span class="n">WME_NUM_AC</span><span class="p">;</span> <span class="n">q</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">ath_atx_ac</span> <span class="o">*</span><span class="n">ac</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">an</span><span class="o">-&gt;</span><span class="n">ac</span><span class="p">[</span><span class="n">q</span><span class="p">]);</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					<span class="s">&quot; ac: %p %s %i %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">ac</span><span class="p">,</span> <span class="n">ac</span><span class="o">-&gt;</span><span class="n">sched</span> <span class="o">?</span> <span class="s">&quot;sched&quot;</span> <span class="o">:</span> <span class="s">&quot;idle&quot;</span><span class="p">,</span>
					<span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ac</span><span class="o">-&gt;</span><span class="n">tid_q</span><span class="p">),</span> <span class="n">ac</span><span class="o">-&gt;</span><span class="n">txq</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">)</span>
				<span class="k">goto</span> <span class="n">done</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

<span class="nl">done:</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">nodes_lock</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_misc</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ieee80211_hw</span> <span class="o">*</span><span class="n">hw</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath9k_vif_iter_data</span> <span class="n">iter_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rxfilter</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;BSSID: %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">curbssid</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;BSSID-MASK: %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">bssidmask</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;OPMODE: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ath_opmode_to_string</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="o">-&gt;</span><span class="n">opmode</span><span class="p">));</span>

	<span class="n">ath9k_ps_wakeup</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
	<span class="n">rxfilter</span> <span class="o">=</span> <span class="n">ath9k_hw_getrxfilter</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">);</span>
	<span class="n">ath9k_ps_restore</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;RXFILTER: 0x%x&quot;</span><span class="p">,</span> <span class="n">rxfilter</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_UCAST</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; UCAST&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_MCAST</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; MCAST&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_BCAST</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; BCAST&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_CONTROL</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; CONTROL&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_BEACON</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; BEACON&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_PROM</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; PROM&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_PROBEREQ</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; PROBEREQ&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_PHYERR</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; PHYERR&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_MYBEACON</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; MYBEACON&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_COMP_BAR</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; COMP_BAR&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_PSPOLL</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; PSPOLL&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_PHYRADAR</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; PHYRADAR&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_MCAST_BCAST_ALL</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; MCAST_BCAST_ALL&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxfilter</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_FILTER_CONTROL_WRAPPER</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; CONTROL_WRAPPER&quot;</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="o">-&gt;</span><span class="n">imask</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;INTERRUPT-MASK: 0x%x&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_SWBA</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; SWBA&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_BMISS</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; BMISS&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_CST</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; CST&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RX</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; RX&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RXHP</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; RXHP&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_RXLP</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; RXLP&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">ATH9K_INT_BB_WATCHDOG</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; BB_WATCHDOG&quot;</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">ath9k_calculate_iter_data</span><span class="p">(</span><span class="n">hw</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">iter_data</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;VIF-COUNTS: AP: %i STA: %i MESH: %i WDS: %i&quot;</span>
			<span class="s">&quot; ADHOC: %i TOTAL: %hi BEACON-VIF: %hi</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">iter_data</span><span class="p">.</span><span class="n">naps</span><span class="p">,</span> <span class="n">iter_data</span><span class="p">.</span><span class="n">nstations</span><span class="p">,</span> <span class="n">iter_data</span><span class="p">.</span><span class="n">nmeshes</span><span class="p">,</span>
			<span class="n">iter_data</span><span class="p">.</span><span class="n">nwds</span><span class="p">,</span> <span class="n">iter_data</span><span class="p">.</span><span class="n">nadhocs</span><span class="p">,</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">nvifs</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">nbcnvifs</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%17s: %2d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Baseband Hang&quot;</span><span class="p">,</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">reset</span><span class="p">[</span><span class="n">RESET_TYPE_BB_HANG</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%17s: %2d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Baseband Watchdog&quot;</span><span class="p">,</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">reset</span><span class="p">[</span><span class="n">RESET_TYPE_BB_WATCHDOG</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%17s: %2d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Fatal HW Error&quot;</span><span class="p">,</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">reset</span><span class="p">[</span><span class="n">RESET_TYPE_FATAL_INT</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%17s: %2d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;TX HW error&quot;</span><span class="p">,</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">reset</span><span class="p">[</span><span class="n">RESET_TYPE_TX_ERROR</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%17s: %2d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;TX Path Hang&quot;</span><span class="p">,</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">reset</span><span class="p">[</span><span class="n">RESET_TYPE_TX_HANG</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%17s: %2d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;PLL RX Hang&quot;</span><span class="p">,</span>
			<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">reset</span><span class="p">[</span><span class="n">RESET_TYPE_PLL_HANG</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ath_debug_stat_tx</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ath_buf</span> <span class="o">*</span><span class="n">bf</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">ath_tx_status</span> <span class="o">*</span><span class="n">ts</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ath_txq</span> <span class="o">*</span><span class="n">txq</span><span class="p">,</span>
		       <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define TX_SAMP_DBG(c) (sc-&gt;debug.bb_mac_samp[sc-&gt;debug.sampidx].ts\</span>
<span class="cp">			[sc-&gt;debug.tsidx].c)</span>
	<span class="kt">int</span> <span class="n">qnum</span> <span class="o">=</span> <span class="n">txq</span><span class="o">-&gt;</span><span class="n">axq_qnum</span><span class="p">;</span>

	<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">tx_pkts_all</span><span class="p">);</span>
	<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">txstats</span><span class="p">[</span><span class="n">qnum</span><span class="p">].</span><span class="n">tx_bytes_all</span> <span class="o">+=</span> <span class="n">bf</span><span class="o">-&gt;</span><span class="n">bf_mpdu</span><span class="o">-&gt;</span><span class="n">len</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">bf_isampdu</span><span class="p">(</span><span class="n">bf</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">ATH_TX_ERROR</span><span class="p">)</span>
			<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">a_xretries</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">a_completed</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_TXERR_XRETRY</span><span class="p">)</span>
			<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">xretries</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">completed</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_TXERR_FIFO</span><span class="p">)</span>
		<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">fifo_underrun</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_TXERR_XTXOP</span><span class="p">)</span>
		<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">xtxop</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_TXERR_TIMER_EXPIRED</span><span class="p">)</span>
		<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">timer_exp</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_flags</span> <span class="o">&amp;</span> <span class="n">ATH9K_TX_DESC_CFG_ERR</span><span class="p">)</span>
		<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">desc_cfg_err</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_flags</span> <span class="o">&amp;</span> <span class="n">ATH9K_TX_DATA_UNDERRUN</span><span class="p">)</span>
		<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">data_underrun</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_flags</span> <span class="o">&amp;</span> <span class="n">ATH9K_TX_DELIM_UNDERRUN</span><span class="p">)</span>
		<span class="n">TX_STAT_INC</span><span class="p">(</span><span class="n">qnum</span><span class="p">,</span> <span class="n">delim_underrun</span><span class="p">);</span>

<span class="cp">#ifdef CONFIG_ATH9K_MAC_DEBUG</span>
	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">samp_lock</span><span class="p">);</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">jiffies</span><span class="p">)</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ctl0</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_rssi_ctl0</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ctl1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_rssi_ctl1</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ctl2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_rssi_ctl2</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ext0</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_rssi_ext0</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ext1</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_rssi_ext1</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ext2</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_rssi_ext2</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rateindex</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_rateindex</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">isok</span><span class="p">)</span> <span class="o">=</span> <span class="o">!!</span><span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_TXERR_MASK</span><span class="p">);</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rts_fail_cnt</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_shortretry</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">data_fail_cnt</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_longretry</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_rssi</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">tid</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">tid</span><span class="p">;</span>
	<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">qid</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">qid</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ts</span><span class="o">-&gt;</span><span class="n">ts_flags</span> <span class="o">&amp;</span> <span class="n">ATH9K_TX_BA</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">ba_low</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ba_low</span><span class="p">;</span>
		<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">ba_high</span><span class="p">)</span> <span class="o">=</span> <span class="n">ts</span><span class="o">-&gt;</span><span class="n">ba_high</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">ba_low</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">TX_SAMP_DBG</span><span class="p">(</span><span class="n">ba_high</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tsidx</span> <span class="o">=</span> <span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tsidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">samp_lock</span><span class="p">);</span>
<span class="cp">#endif</span>

<span class="cp">#undef TX_SAMP_DBG</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_xmit</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_xmit</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_stations</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_stations</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_misc</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_misc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_reset</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_reset</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_recv</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define PHY_ERR(s, p) \</span>
<span class="cp">	len += snprintf(buf + len, size - len, &quot;%22s : %10u\n&quot;, s, \</span>
<span class="cp">			sc-&gt;debug.stats.rxstats.phy_err_stats[p]);</span>

<span class="cp">#define RXS_ERR(s, e)					    \</span>
<span class="cp">	do {						    \</span>
<span class="cp">		len += snprintf(buf + len, size - len,	    \</span>
<span class="cp">				&quot;%22s : %10u\n&quot;, s,	    \</span>
<span class="cp">				sc-&gt;debug.stats.rxstats.e); \</span>
<span class="cp">	} while (0)</span>

	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;CRC ERR&quot;</span><span class="p">,</span> <span class="n">crc_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;DECRYPT CRC ERR&quot;</span><span class="p">,</span> <span class="n">decrypt_crc_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;PHY ERR&quot;</span><span class="p">,</span> <span class="n">phy_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;MIC ERR&quot;</span><span class="p">,</span> <span class="n">mic_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;PRE-DELIM CRC ERR&quot;</span><span class="p">,</span> <span class="n">pre_delim_crc_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;POST-DELIM CRC ERR&quot;</span><span class="p">,</span> <span class="n">post_delim_crc_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;DECRYPT BUSY ERR&quot;</span><span class="p">,</span> <span class="n">decrypt_busy_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-LENGTH-ERR&quot;</span><span class="p">,</span> <span class="n">rx_len_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-OOM-ERR&quot;</span><span class="p">,</span> <span class="n">rx_oom_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-RATE-ERR&quot;</span><span class="p">,</span> <span class="n">rx_rate_err</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-DROP-RXFLUSH&quot;</span><span class="p">,</span> <span class="n">rx_drop_rxflush</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-TOO-MANY-FRAGS&quot;</span><span class="p">,</span> <span class="n">rx_too_many_frags_err</span><span class="p">);</span>

	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;UNDERRUN ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_UNDERRUN</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;TIMING ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_TIMING</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;PARITY ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_PARITY</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;RATE ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_RATE</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;LENGTH ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_LENGTH</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;RADAR ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_RADAR</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;SERVICE ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_SERVICE</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;TOR ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_TOR</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-TIMING ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_TIMING</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-SIGNAL-PARITY ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_SIGNAL_PARITY</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-RATE ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_RATE_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-LENGTH ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_LENGTH_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-POWER-DROP ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_POWER_DROP</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-SERVICE ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_SERVICE</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-RESTART ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_RESTART</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;FALSE-RADAR-EXT ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_FALSE_RADAR_EXT</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-TIMING ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_TIMING</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-HEADER-CRC ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_HEADER_CRC</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-RATE ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_RATE_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-SERVICE ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_SERVICE</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-RESTART ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_RESTART</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-LENGTH ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_LENGTH_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-POWER-DROP ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_POWER_DROP</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;HT-CRC ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_HT_CRC_ERROR</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;HT-LENGTH ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_HT_LENGTH_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;HT-RATE ERR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_HT_RATE_ILLEGAL</span><span class="p">);</span>

	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-Pkts-All&quot;</span><span class="p">,</span> <span class="n">rx_pkts_all</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-Bytes-All&quot;</span><span class="p">,</span> <span class="n">rx_bytes_all</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-Beacons&quot;</span><span class="p">,</span> <span class="n">rx_beacons</span><span class="p">);</span>
	<span class="n">RXS_ERR</span><span class="p">(</span><span class="s">&quot;RX-Frags&quot;</span><span class="p">,</span> <span class="n">rx_frags</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>

<span class="cp">#undef RXS_ERR</span>
<span class="cp">#undef PHY_ERR</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">ath_debug_stat_rx</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ath_rx_status</span> <span class="o">*</span><span class="n">rs</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define RX_PHY_ERR_INC(c) sc-&gt;debug.stats.rxstats.phy_err_stats[c]++</span>
<span class="cp">#define RX_SAMP_DBG(c) (sc-&gt;debug.bb_mac_samp[sc-&gt;debug.sampidx].rs\</span>
<span class="cp">			[sc-&gt;debug.rsidx].c)</span>

	<span class="n">RX_STAT_INC</span><span class="p">(</span><span class="n">rx_pkts_all</span><span class="p">);</span>
	<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">rxstats</span><span class="p">.</span><span class="n">rx_bytes_all</span> <span class="o">+=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_datalen</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RXERR_CRC</span><span class="p">)</span>
		<span class="n">RX_STAT_INC</span><span class="p">(</span><span class="n">crc_err</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RXERR_DECRYPT</span><span class="p">)</span>
		<span class="n">RX_STAT_INC</span><span class="p">(</span><span class="n">decrypt_crc_err</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RXERR_MIC</span><span class="p">)</span>
		<span class="n">RX_STAT_INC</span><span class="p">(</span><span class="n">mic_err</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_DELIM_CRC_PRE</span><span class="p">)</span>
		<span class="n">RX_STAT_INC</span><span class="p">(</span><span class="n">pre_delim_crc_err</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_DELIM_CRC_POST</span><span class="p">)</span>
		<span class="n">RX_STAT_INC</span><span class="p">(</span><span class="n">post_delim_crc_err</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_DECRYPT_BUSY</span><span class="p">)</span>
		<span class="n">RX_STAT_INC</span><span class="p">(</span><span class="n">decrypt_busy_err</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RXERR_PHY</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">RX_STAT_INC</span><span class="p">(</span><span class="n">phy_err</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_phyerr</span> <span class="o">&lt;</span> <span class="n">ATH9K_PHYERR_MAX</span><span class="p">)</span>
			<span class="n">RX_PHY_ERR_INC</span><span class="p">(</span><span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_phyerr</span><span class="p">);</span>
	<span class="p">}</span>

<span class="cp">#ifdef CONFIG_ATH9K_MAC_DEBUG</span>
	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">samp_lock</span><span class="p">);</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">jiffies</span><span class="p">)</span> <span class="o">=</span> <span class="n">jiffies</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ctl0</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_rssi_ctl0</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ctl1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_rssi_ctl1</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ctl2</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_rssi_ctl2</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ext0</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_rssi_ext0</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ext1</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_rssi_ext1</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi_ext2</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_rssi_ext2</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">antenna</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_antenna</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">rssi</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_rssi</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">rate</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">rs_rate</span><span class="p">;</span>
	<span class="n">RX_SAMP_DBG</span><span class="p">(</span><span class="n">is_mybeacon</span><span class="p">)</span> <span class="o">=</span> <span class="n">rs</span><span class="o">-&gt;</span><span class="n">is_mybeacon</span><span class="p">;</span>

	<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rsidx</span> <span class="o">=</span> <span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rsidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">samp_lock</span><span class="p">);</span>

<span class="cp">#endif</span>

<span class="cp">#undef RX_PHY_ERR_INC</span>
<span class="cp">#undef RX_SAMP_DBG</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_recv</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_recv</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_regidx</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
                                <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">regidx</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">write_file_regidx</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">regidx</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">buf</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strict_strtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regidx</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">regidx</span> <span class="o">=</span> <span class="n">regidx</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_regidx</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_regidx</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">write_file_regidx</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_regval</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">regval</span><span class="p">;</span>

	<span class="n">ath9k_ps_wakeup</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
	<span class="n">regval</span> <span class="o">=</span> <span class="n">REG_READ_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">regidx</span><span class="p">);</span>
	<span class="n">ath9k_ps_restore</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">write_file_regval</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">regval</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">buf</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strict_strtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">regval</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">ath9k_ps_wakeup</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
	<span class="n">REG_WRITE_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">regidx</span><span class="p">,</span> <span class="n">regval</span><span class="p">);</span>
	<span class="n">ath9k_ps_restore</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_regval</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_regval</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">write_file_regval</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define REGDUMP_LINE_SIZE	20</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">open_file_regdump</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_private</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">num_regs</span><span class="p">,</span> <span class="n">regdump_len</span><span class="p">,</span> <span class="n">max_reg_offset</span><span class="p">;</span>

	<span class="n">max_reg_offset</span> <span class="o">=</span> <span class="n">AR_SREV_9300_20_OR_LATER</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">)</span> <span class="o">?</span> <span class="mh">0x16bd4</span> <span class="o">:</span> <span class="mh">0xb500</span><span class="p">;</span>
	<span class="n">num_regs</span> <span class="o">=</span> <span class="n">max_reg_offset</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">regdump_len</span> <span class="o">=</span> <span class="n">num_regs</span> <span class="o">*</span> <span class="n">REGDUMP_LINE_SIZE</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">buf</span> <span class="o">=</span> <span class="n">vmalloc</span><span class="p">(</span><span class="n">regdump_len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">ath9k_ps_wakeup</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num_regs</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">regdump_len</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;0x%06x 0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">,</span> <span class="n">REG_READ</span><span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">,</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">));</span>
	<span class="n">ath9k_ps_restore</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

	<span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_regdump</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">open_file_regdump</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">ath9k_debugfs_read_buf</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">ath9k_debugfs_release_buf</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span><span class="cm">/* read accesses f_pos */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_dump_nfcal</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath9k_nfcal_hist</span> <span class="o">*</span><span class="n">h</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">caldata</span><span class="p">.</span><span class="n">nfCalHist</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">ah</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ieee80211_conf</span> <span class="o">*</span><span class="n">conf</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">common</span><span class="o">-&gt;</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">chainmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">rxchainmask</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="n">ah</span><span class="o">-&gt;</span><span class="n">rxchainmask</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">nread</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Channel Noise Floor : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ah</span><span class="o">-&gt;</span><span class="n">noise</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Chain | privNF | # Readings | NF Readings</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_NF_READINGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">chainmask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="o">||</span>
		    <span class="p">((</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">AR5416_MAX_CHAINS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">conf_is_ht40</span><span class="p">(</span><span class="n">conf</span><span class="p">)))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="n">nread</span> <span class="o">=</span> <span class="n">AR_PHY_CCA_FILTERWINDOW_LENGTH</span> <span class="o">-</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">invalidNFcount</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; %d</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\t\t</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">i</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">privNF</span><span class="p">,</span> <span class="n">nread</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nread</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					<span class="s">&quot; %d&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nfCalBuffer</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_dump_nfcal</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_dump_nfcal</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_base_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">ah</span><span class="o">-&gt;</span><span class="n">eep_ops</span><span class="o">-&gt;</span><span class="n">dump_eeprom</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="nb">true</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_base_eeprom</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_base_eeprom</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_modal_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">6000</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">size_t</span> <span class="n">retval</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">ah</span><span class="o">-&gt;</span><span class="n">eep_ops</span><span class="o">-&gt;</span><span class="n">dump_eeprom</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="nb">false</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_modal_eeprom</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_modal_eeprom</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#ifdef CONFIG_ATH9K_MAC_DEBUG</span>

<span class="kt">void</span> <span class="nf">ath9k_debug_samp_bb_mac</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define ATH_SAMP_DBG(c) (sc-&gt;debug.bb_mac_samp[sc-&gt;debug.sampidx].c)</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">ah</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">ath9k_ps_wakeup</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

	<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">samp_lock</span><span class="p">);</span>

	<span class="n">spin_lock_irqsave</span><span class="p">(</span><span class="o">&amp;</span><span class="n">common</span><span class="o">-&gt;</span><span class="n">cc_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>
	<span class="n">ath_hw_cycle_counters_update</span><span class="p">(</span><span class="n">common</span><span class="p">);</span>

	<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">cycles</span><span class="p">)</span> <span class="o">=</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">cc_ani</span><span class="p">.</span><span class="n">cycles</span><span class="p">;</span>
	<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">rx_busy</span><span class="p">)</span> <span class="o">=</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">cc_ani</span><span class="p">.</span><span class="n">rx_busy</span><span class="p">;</span>
	<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">rx_frame</span><span class="p">)</span> <span class="o">=</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">cc_ani</span><span class="p">.</span><span class="n">rx_frame</span><span class="p">;</span>
	<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">tx_frame</span><span class="p">)</span> <span class="o">=</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">cc_ani</span><span class="p">.</span><span class="n">tx_frame</span><span class="p">;</span>
	<span class="n">spin_unlock_irqrestore</span><span class="p">(</span><span class="o">&amp;</span><span class="n">common</span><span class="o">-&gt;</span><span class="n">cc_lock</span><span class="p">,</span> <span class="n">flags</span><span class="p">);</span>

	<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">noise</span><span class="p">)</span> <span class="o">=</span> <span class="n">ah</span><span class="o">-&gt;</span><span class="n">noise</span><span class="p">;</span>

	<span class="n">REG_WRITE_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">AR_MACMISC</span><span class="p">,</span>
		  <span class="p">((</span><span class="n">AR_MACMISC_DMA_OBS_LINE_8</span> <span class="o">&lt;&lt;</span> <span class="n">AR_MACMISC_DMA_OBS_S</span><span class="p">)</span> <span class="o">|</span>
		   <span class="p">(</span><span class="n">AR_MACMISC_MISC_OBS_BUS_1</span> <span class="o">&lt;&lt;</span>
		    <span class="n">AR_MACMISC_MISC_OBS_BUS_MSB_S</span><span class="p">)));</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH9K_NUM_DMA_DEBUG_REGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">=</span> <span class="n">REG_READ_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span>
				<span class="n">AR_DMADBG_0</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">)));</span>

	<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">pcu_obs</span><span class="p">)</span> <span class="o">=</span> <span class="n">REG_READ_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">AR_OBS_BUS_1</span><span class="p">);</span>
	<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">pcu_cr</span><span class="p">)</span> <span class="o">=</span> <span class="n">REG_READ_D</span><span class="p">(</span><span class="n">ah</span><span class="p">,</span> <span class="n">AR_CR</span><span class="p">);</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">nfCalHist</span><span class="p">),</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">caldata</span><span class="p">.</span><span class="n">nfCalHist</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">nfCalHist</span><span class="p">)));</span>

	<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">sampidx</span> <span class="o">=</span> <span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">sampidx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span>
	<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">samp_lock</span><span class="p">);</span>
	<span class="n">ath9k_ps_restore</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

<span class="cp">#undef ATH_SAMP_DBG</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">open_file_bb_mac_samps</span><span class="p">(</span><span class="k">struct</span> <span class="n">inode</span> <span class="o">*</span><span class="n">inode</span><span class="p">,</span> <span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define ATH_SAMP_DBG(c) bb_mac_samp[sampidx].c</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="n">inode</span><span class="o">-&gt;</span><span class="n">i_private</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span> <span class="o">=</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">ah</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ieee80211_conf</span> <span class="o">*</span><span class="n">conf</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">common</span><span class="o">-&gt;</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">conf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_dbg_bb_mac_samp</span> <span class="o">*</span><span class="n">bb_mac_samp</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath9k_nfcal_hist</span> <span class="o">*</span><span class="n">h</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">qcuOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dcuOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="o">*</span><span class="n">qcuBase</span><span class="p">,</span> <span class="o">*</span><span class="n">dcuBase</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sampidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">chainmask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">rxchainmask</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="n">ah</span><span class="o">-&gt;</span><span class="n">rxchainmask</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">nread</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_flags</span> <span class="o">&amp;</span> <span class="n">SC_OP_INVALID</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">vmalloc</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">bb_mac_samp</span> <span class="o">=</span> <span class="n">vmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">bb_mac_samp</span><span class="p">)</span> <span class="o">*</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bb_mac_samp</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">vfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="cm">/* Account the current state too */</span>
	<span class="n">ath9k_debug_samp_bb_mac</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

	<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">samp_lock</span><span class="p">);</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">bb_mac_samp</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">bb_mac_samp</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">bb_mac_samp</span><span class="p">)</span> <span class="o">*</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Current Sample Index: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">sampidx</span><span class="p">);</span>
	<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">samp_lock</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Raw DMA Debug Dump:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;Sample |</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH9K_NUM_DMA_DEBUG_REGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; DMA Reg%d |</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">sampidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sampidx</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">sampidx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%d</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sampidx</span><span class="p">);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH9K_NUM_DMA_DEBUG_REGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot; %08x</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="n">i</span><span class="p">]));</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Sample Num QCU: chain_st fsp_ok fsp_st DCU: chain_st</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sampidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sampidx</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">sampidx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">qcuBase</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">dcuBase</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH9K_NUM_QUEUES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span>
				<span class="n">qcuOffset</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dcuOffset</span> <span class="o">+=</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">qcuOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">qcuBase</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dcuOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">dcuBase</span><span class="o">++</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">stats</span><span class="p">.</span><span class="n">txstats</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queued</span><span class="p">)</span>
				<span class="k">continue</span><span class="p">;</span>

			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
				<span class="s">&quot;%4d %7d    %2x      %1x     %2x         %2x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">sampidx</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span>
				<span class="p">(</span><span class="o">*</span><span class="n">qcuBase</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="n">qcuOffset</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">qcuOffset</span><span class="p">,</span>
				<span class="p">(</span><span class="o">*</span><span class="n">qcuBase</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x8</span> <span class="o">&lt;&lt;</span> <span class="n">qcuOffset</span><span class="p">))</span> <span class="o">&gt;&gt;</span>
				<span class="p">(</span><span class="n">qcuOffset</span> <span class="o">+</span> <span class="mi">3</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">&amp;</span>
				<span class="p">(</span><span class="mh">0x7</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span>
				<span class="p">(</span><span class="o">*</span><span class="n">dcuBase</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mh">0x1f</span> <span class="o">&lt;&lt;</span> <span class="n">dcuOffset</span><span class="p">))</span> <span class="o">&gt;&gt;</span> <span class="n">dcuOffset</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;samp qcu_sh qcu_fh qcu_comp dcu_comp dcu_arb dcu_fp &quot;</span>
			<span class="s">&quot;ch_idle_dur ch_idle_dur_val txfifo_val0 txfifo_val1 &quot;</span>
			<span class="s">&quot;txfifo_dcu0 txfifo_dcu1 pcu_obs AR_CR</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">sampidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sampidx</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">sampidx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">qcuBase</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
		<span class="n">dcuBase</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">4</span><span class="p">]);</span>

		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%4d %5x %5x &quot;</span><span class="p">,</span> <span class="n">sampidx</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x003c0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">18</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x03c00000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">22</span><span class="p">);</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%7x %8x &quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x1c000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">26</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">));</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%7x %7x &quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x06000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">25</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x38000000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">27</span><span class="p">);</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%7d %12d &quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x000003fc</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x00000400</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">10</span><span class="p">);</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%12d %12d &quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x00000800</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x00001000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%12d %12d &quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x0001e000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">13</span><span class="p">,</span>
			<span class="p">(</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">dma_dbg_reg_vals</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0x001e0000</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">17</span><span class="p">);</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;0x%07x 0x%07x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">pcu_obs</span><span class="p">),</span> <span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">pcu_cr</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Sample ChNoise Chain privNF #Reading Readings</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sampidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sampidx</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">sampidx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">h</span> <span class="o">=</span> <span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">nfCalHist</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">noise</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_NF_READINGS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">chainmask</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="o">||</span>
			    <span class="p">((</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">AR5416_MAX_CHAINS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">conf_is_ht40</span><span class="p">(</span><span class="n">conf</span><span class="p">)))</span>
				<span class="k">continue</span><span class="p">;</span>

			<span class="n">nread</span> <span class="o">=</span> <span class="n">AR_PHY_CCA_FILTERWINDOW_LENGTH</span> <span class="o">-</span>
				<span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">invalidNFcount</span><span class="p">;</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					<span class="s">&quot;%4d %5d %4d</span><span class="se">\t</span><span class="s">   %d</span><span class="se">\t</span><span class="s"> %d</span><span class="se">\t</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">sampidx</span><span class="p">,</span> <span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">noise</span><span class="p">),</span>
					<span class="n">i</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">privNF</span><span class="p">,</span> <span class="n">nread</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nread</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
					<span class="s">&quot; %d&quot;</span><span class="p">,</span> <span class="n">h</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">nfCalBuffer</span><span class="p">[</span><span class="n">j</span><span class="p">]);</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">Cycle counters:</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;Sample Total    Rxbusy   Rxframes Txframes</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sampidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sampidx</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">sampidx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">cycles</span><span class="p">))</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
				<span class="s">&quot;%4d %08x %08x %08x %08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">sampidx</span><span class="p">,</span> <span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">cycles</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">rx_busy</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">rx_frame</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">cc</span><span class="p">.</span><span class="n">tx_frame</span><span class="p">));</span>
	<span class="p">}</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;Tx status Dump :</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Sample rssi:- ctl0 ctl1 ctl2 ext0 ext1 ext2 comb &quot;</span>
			<span class="s">&quot;isok rts_fail data_fail rate tid qid &quot;</span>
					<span class="s">&quot;ba_low  ba_high tx_before(ms)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sampidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sampidx</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">sampidx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">jiffies</span><span class="p">))</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%-14d&quot;</span>
				<span class="s">&quot;%-4d %-4d %-4d %-4d %-4d %-4d %-4d %-4d %-8d &quot;</span>
				<span class="s">&quot;%-9d %-4d %-3d %-3d %08x %08x %-11d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">sampidx</span><span class="p">,</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ctl0</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ctl1</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ctl2</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ext0</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ext1</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ext2</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">isok</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rts_fail_cnt</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data_fail_cnt</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rateindex</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">tid</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">qid</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ba_low</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">ba_high</span><span class="p">),</span>
				<span class="n">jiffies_to_msecs</span><span class="p">(</span><span class="n">jiffies</span> <span class="o">-</span>
					<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">ts</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">jiffies</span><span class="p">)));</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;Rx status Dump :</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;Sample rssi:- ctl0 ctl1 ctl2 &quot;</span>
			<span class="s">&quot;ext0 ext1 ext2 comb beacon ant rate rx_before(ms)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">sampidx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sampidx</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">sampidx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ATH_DBG_MAX_SAMPLES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">jiffies</span><span class="p">))</span>
				<span class="k">continue</span><span class="p">;</span>
			<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%-14d&quot;</span>
				<span class="s">&quot;%-4d %-4d %-4d %-4d %-4d %-4d %-4d %-9s %-2d %02x %-13d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">sampidx</span><span class="p">,</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ctl0</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ctl1</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ctl2</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ext0</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ext1</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi_ext2</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rssi</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">is_mybeacon</span><span class="p">)</span> <span class="o">?</span>
				<span class="s">&quot;True&quot;</span> <span class="o">:</span> <span class="s">&quot;False&quot;</span><span class="p">,</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">antenna</span><span class="p">),</span>
				<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">rate</span><span class="p">),</span>
				<span class="n">jiffies_to_msecs</span><span class="p">(</span><span class="n">jiffies</span> <span class="o">-</span>
					<span class="n">ATH_SAMP_DBG</span><span class="p">(</span><span class="n">rs</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">jiffies</span><span class="p">)));</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">vfree</span><span class="p">(</span><span class="n">bb_mac_samp</span><span class="p">);</span>
	<span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="cp">#undef ATH_SAMP_DBG</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_samps</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">open_file_bb_mac_samps</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">ath9k_debugfs_read_buf</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">ath9k_debugfs_release_buf</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#endif</span>

<span class="kt">int</span> <span class="nf">ath9k_init_debug</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">ah</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="n">sc</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ath_softc</span> <span class="o">*</span><span class="p">)</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="s">&quot;ath9k&quot;</span><span class="p">,</span>
						   <span class="n">sc</span><span class="o">-&gt;</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">wiphy</span><span class="o">-&gt;</span><span class="n">debugfsdir</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

<span class="cp">#ifdef CONFIG_ATH_DEBUG</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;debug&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">sc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_debug</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="n">ath9k_dfs_init_debug</span><span class="p">(</span><span class="n">sc</span><span class="p">);</span>

	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;dma&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_dma</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;interrupt&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_interrupt</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;xmit&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_xmit</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;stations&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_stations</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;misc&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_misc</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;reset&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_reset</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;recv&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_recv</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;rx_chainmask&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span>
			    <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_rx_chainmask</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;tx_chainmask&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span>
			    <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_tx_chainmask</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;disable_ani&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span>
			    <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_disable_ani</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;regidx&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">sc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_regidx</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;regval&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">sc</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_regval</span><span class="p">);</span>
	<span class="n">debugfs_create_bool</span><span class="p">(</span><span class="s">&quot;ignore_extcca&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span>
			    <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">config</span><span class="p">.</span><span class="n">cwm_ignore_extcca</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;regdump&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_regdump</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;dump_nfcal&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_dump_nfcal</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;base_eeprom&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_base_eeprom</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;modal_eeprom&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_modal_eeprom</span><span class="p">);</span>
<span class="cp">#ifdef CONFIG_ATH9K_MAC_DEBUG</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;samples&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="n">sc</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">fops_samps</span><span class="p">);</span>
<span class="cp">#endif</span>

	<span class="n">debugfs_create_u32</span><span class="p">(</span><span class="s">&quot;gpio_mask&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span>
			   <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="o">-&gt;</span><span class="n">gpio_mask</span><span class="p">);</span>

	<span class="n">debugfs_create_u32</span><span class="p">(</span><span class="s">&quot;gpio_val&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span>
			   <span class="n">sc</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sc</span><span class="o">-&gt;</span><span class="n">sc_ah</span><span class="o">-&gt;</span><span class="n">gpio_val</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
