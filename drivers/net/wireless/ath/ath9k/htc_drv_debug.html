<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › ath › ath9k › htc_drv_debug.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>htc_drv_debug.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2010-2011 Atheros Communications Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="cm"> * purpose with or without fee is hereby granted, provided that the above</span>
<span class="cm"> * copyright notice and this permission notice appear in all copies.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="cm"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="cm"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="cm"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="cm"> * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#include &quot;htc.h&quot;</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_tgt_int_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_target_int_stats</span> <span class="n">cmd_rsp</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cmd_rsp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">));</span>

	<span class="n">ath9k_htc_ps_wakeup</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>

	<span class="n">WMI_CMD</span><span class="p">(</span><span class="n">WMI_INT_STATS_CMDID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ath9k_htc_ps_restore</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ath9k_htc_ps_restore</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;RX&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">rx</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;RXORN&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">rxorn</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;RXEOL&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">rxeol</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;TXURN&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">txurn</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;TXTO&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">txto</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;CST&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">cst</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_tgt_int_stats</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_tgt_int_stats</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_tgt_tx_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_target_tx_stats</span> <span class="n">cmd_rsp</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cmd_rsp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">));</span>

	<span class="n">ath9k_htc_ps_wakeup</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>

	<span class="n">WMI_CMD</span><span class="p">(</span><span class="n">WMI_TX_STATS_CMDID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ath9k_htc_ps_restore</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ath9k_htc_ps_restore</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Xretries&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">xretries</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;FifoErr&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">fifoerr</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Filtered&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">filtered</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;TimerExp&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">timer_exp</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;ShortRetries&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">shortretries</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;LongRetries&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">longretries</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;QueueNull&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">qnull</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;EncapFail&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">encap_fail</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;NoBuf&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">nobuf</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_tgt_tx_stats</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_tgt_tx_stats</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_tgt_rx_stats</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_target_rx_stats</span> <span class="n">cmd_rsp</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cmd_rsp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">));</span>

	<span class="n">ath9k_htc_ps_wakeup</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>

	<span class="n">WMI_CMD</span><span class="p">(</span><span class="n">WMI_RX_STATS_CMDID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ath9k_htc_ps_restore</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ath9k_htc_ps_restore</span><span class="p">(</span><span class="n">priv</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;NoBuf&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">nobuf</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;HostSend&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">host_send</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;HostDone&quot;</span><span class="p">,</span>
			<span class="n">be32_to_cpu</span><span class="p">(</span><span class="n">cmd_rsp</span><span class="p">.</span><span class="n">host_done</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_tgt_rx_stats</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_tgt_rx_stats</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_xmit</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Buffers queued&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">buf_queued</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Buffers completed&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">buf_completed</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;SKBs queued&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">skb_queued</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;SKBs success&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">skb_success</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;SKBs failed&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">skb_failed</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;CAB queued&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">cab_queued</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;BE queued&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">queue_stats</span><span class="p">[</span><span class="n">WME_AC_BE</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;BK queued&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">queue_stats</span><span class="p">[</span><span class="n">WME_AC_BK</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;VI queued&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">queue_stats</span><span class="p">[</span><span class="n">WME_AC_VI</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;VO queued&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">tx_stats</span><span class="p">.</span><span class="n">queue_stats</span><span class="p">[</span><span class="n">WME_AC_VO</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_xmit</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_xmit</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">ath9k_htc_err_stat_rx</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">ath_htc_rx_status</span> <span class="o">*</span><span class="n">rxs</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define RX_PHY_ERR_INC(c) priv-&gt;debug.rx_stats.err_phy_stats[c]++</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RXERR_CRC</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_crc</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RXERR_DECRYPT</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_decrypt_crc</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RXERR_MIC</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_mic</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_DELIM_CRC_PRE</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_pre_delim</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_DELIM_CRC_POST</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_post_delim</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RX_DECRYPT_BUSY</span><span class="p">)</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_decrypt_busy</span><span class="o">++</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_status</span> <span class="o">&amp;</span> <span class="n">ATH9K_RXERR_PHY</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_phy</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_phyerr</span> <span class="o">&lt;</span> <span class="n">ATH9K_PHYERR_MAX</span><span class="p">)</span>
			<span class="n">RX_PHY_ERR_INC</span><span class="p">(</span><span class="n">rxs</span><span class="o">-&gt;</span><span class="n">rs_phyerr</span><span class="p">);</span>
	<span class="p">}</span>

<span class="cp">#undef RX_PHY_ERR_INC</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_recv</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define PHY_ERR(s, p)							\</span>
<span class="cp">	len += snprintf(buf + len, size - len, &quot;%20s : %10u\n&quot;, s,	\</span>
<span class="cp">			priv-&gt;debug.rx_stats.err_phy_stats[p]);</span>

	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;SKBs allocated&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">skb_allocated</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;SKBs completed&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">skb_completed</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;SKBs Dropped&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">skb_dropped</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;CRC ERR&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_crc</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;DECRYPT CRC ERR&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_decrypt_crc</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;MIC ERR&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_mic</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;PRE-DELIM CRC ERR&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_pre_delim</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;POST-DELIM CRC ERR&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_post_delim</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;DECRYPT BUSY ERR&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_decrypt_busy</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;TOTAL PHY ERR&quot;</span><span class="p">,</span>
			<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">rx_stats</span><span class="p">.</span><span class="n">err_phy</span><span class="p">);</span>


	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;UNDERRUN&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_UNDERRUN</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;TIMING&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_TIMING</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;PARITY&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_PARITY</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;RATE&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_RATE</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;LENGTH&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_LENGTH</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;RADAR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_RADAR</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;SERVICE&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_SERVICE</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;TOR&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_TOR</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-TIMING&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_TIMING</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-SIGNAL-PARITY&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_SIGNAL_PARITY</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-RATE&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_RATE_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-LENGTH&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_LENGTH_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-POWER-DROP&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_POWER_DROP</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-SERVICE&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_SERVICE</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;OFDM-RESTART&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_OFDM_RESTART</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;FALSE-RADAR-EXT&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_FALSE_RADAR_EXT</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-TIMING&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_TIMING</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-HEADER-CRC&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_HEADER_CRC</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-RATE&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_RATE_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-SERVICE&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_SERVICE</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-RESTART&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_RESTART</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-LENGTH&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_LENGTH_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;CCK-POWER-DROP&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_CCK_POWER_DROP</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;HT-CRC&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_HT_CRC_ERROR</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;HT-LENGTH&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_HT_LENGTH_ILLEGAL</span><span class="p">);</span>
	<span class="n">PHY_ERR</span><span class="p">(</span><span class="s">&quot;HT-RATE&quot;</span><span class="p">,</span> <span class="n">ATH9K_PHYERR_HT_RATE_ILLEGAL</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>

<span class="cp">#undef PHY_ERR</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_recv</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_recv</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_slot</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">tx_lock</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;TX slot bitmap : &quot;</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">bitmap_scnprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			       <span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">tx_slot</span><span class="p">,</span> <span class="n">MAX_TX_BUF_NUM</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;Used slots     : %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">bitmap_weight</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">tx_slot</span><span class="p">,</span> <span class="n">MAX_TX_BUF_NUM</span><span class="p">));</span>

	<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">tx_lock</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_slot</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_slot</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Mgmt endpoint&quot;</span><span class="p">,</span> <span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">mgmt_ep_queue</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Cab endpoint&quot;</span><span class="p">,</span> <span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">cab_ep_queue</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Data BE endpoint&quot;</span><span class="p">,</span> <span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">data_be_queue</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Data BK endpoint&quot;</span><span class="p">,</span> <span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">data_bk_queue</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Data VI endpoint&quot;</span><span class="p">,</span> <span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">data_vi_queue</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Data VO endpoint&quot;</span><span class="p">,</span> <span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">data_vo_queue</span><span class="p">));</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Failed queue&quot;</span><span class="p">,</span> <span class="n">skb_queue_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">tx_failed</span><span class="p">));</span>

	<span class="n">spin_lock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">tx_lock</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %10u</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Queued count&quot;</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">queued_cnt</span><span class="p">);</span>
	<span class="n">spin_unlock_bh</span><span class="p">(</span><span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">tx</span><span class="p">.</span><span class="n">tx_lock</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">))</span>
		<span class="n">len</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_queue</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_queue</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_debug</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
			       <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="p">);</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">debug_mask</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">write_file_debug</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				<span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">mask</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">ssize_t</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>

	<span class="n">buf</span><span class="p">[</span><span class="n">len</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">strict_strtoul</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mask</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">common</span><span class="o">-&gt;</span><span class="n">debug_mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_debug</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_debug</span><span class="p">,</span>
	<span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">write_file_debug</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_base_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">base_eep_header</span> <span class="o">*</span><span class="n">pBase</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">1500</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * This can be done since all the 3 EEPROM families have the</span>
<span class="cm">	 * same base header upto a certain point, and we are interested in</span>
<span class="cm">	 * the data only upto that point.</span>
<span class="cm">	 */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">AR_SREV_9271</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="p">))</span>
		<span class="n">pBase</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">base_eep_header</span> <span class="o">*</span><span class="p">)</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">map4k</span><span class="p">.</span><span class="n">baseEepHeader</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">hw_version</span><span class="p">.</span><span class="n">usbdev</span> <span class="o">==</span> <span class="n">AR9280_USB</span><span class="p">)</span>
		<span class="n">pBase</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">base_eep_header</span> <span class="o">*</span><span class="p">)</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">baseEepHeader</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">hw_version</span><span class="p">.</span><span class="n">usbdev</span> <span class="o">==</span> <span class="n">AR9287_USB</span><span class="p">)</span>
		<span class="n">pBase</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">base_eep_header</span> <span class="o">*</span><span class="p">)</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">map9287</span><span class="p">.</span><span class="n">baseEepHeader</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pBase</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ath_err</span><span class="p">(</span><span class="n">common</span><span class="p">,</span> <span class="s">&quot;Unknown EEPROM type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Major Version&quot;</span><span class="p">,</span>
			<span class="n">pBase</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Minor Version&quot;</span><span class="p">,</span>
			<span class="n">pBase</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">&amp;</span> <span class="mh">0xFFF</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Checksum&quot;</span><span class="p">,</span>
			<span class="n">pBase</span><span class="o">-&gt;</span><span class="n">checksum</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;Length&quot;</span><span class="p">,</span>
			<span class="n">pBase</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;RegDomain1&quot;</span><span class="p">,</span>
			<span class="n">pBase</span><span class="o">-&gt;</span><span class="n">regDmn</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;RegDomain2&quot;</span><span class="p">,</span>
			<span class="n">pBase</span><span class="o">-&gt;</span><span class="n">regDmn</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;TX Mask&quot;</span><span class="p">,</span> <span class="n">pBase</span><span class="o">-&gt;</span><span class="n">txMask</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;RX Mask&quot;</span><span class="p">,</span> <span class="n">pBase</span><span class="o">-&gt;</span><span class="n">rxMask</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Allow 5GHz&quot;</span><span class="p">,</span>
			<span class="o">!!</span><span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">opCapFlags</span> <span class="o">&amp;</span> <span class="n">AR5416_OPFLAGS_11A</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Allow 2GHz&quot;</span><span class="p">,</span>
			<span class="o">!!</span><span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">opCapFlags</span> <span class="o">&amp;</span> <span class="n">AR5416_OPFLAGS_11G</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Disable 2GHz HT20&quot;</span><span class="p">,</span>
			<span class="o">!!</span><span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">opCapFlags</span> <span class="o">&amp;</span> <span class="n">AR5416_OPFLAGS_N_2G_HT20</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Disable 2GHz HT40&quot;</span><span class="p">,</span>
			<span class="o">!!</span><span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">opCapFlags</span> <span class="o">&amp;</span> <span class="n">AR5416_OPFLAGS_N_2G_HT40</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Disable 5Ghz HT20&quot;</span><span class="p">,</span>
			<span class="o">!!</span><span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">opCapFlags</span> <span class="o">&amp;</span> <span class="n">AR5416_OPFLAGS_N_5G_HT20</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Disable 5Ghz HT40&quot;</span><span class="p">,</span>
			<span class="o">!!</span><span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">opCapFlags</span> <span class="o">&amp;</span> <span class="n">AR5416_OPFLAGS_N_5G_HT40</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Big Endian&quot;</span><span class="p">,</span>
			<span class="o">!!</span><span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">eepMisc</span> <span class="o">&amp;</span> <span class="mh">0x01</span><span class="p">));</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Cal Bin Major Ver&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">binBuildNumber</span> <span class="o">&gt;&gt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Cal Bin Minor Ver&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">binBuildNumber</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="s">&quot;Cal Bin Build&quot;</span><span class="p">,</span>
			<span class="p">(</span><span class="n">pBase</span><span class="o">-&gt;</span><span class="n">binBuildNumber</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * UB91 specific data.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">AR_SREV_9271</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">base_eep_header_4k</span> <span class="o">*</span><span class="n">pBase4k</span> <span class="o">=</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">map4k</span><span class="p">.</span><span class="n">baseEepHeader</span><span class="p">;</span>

		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
				<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="s">&quot;TX Gain type&quot;</span><span class="p">,</span>
				<span class="n">pBase4k</span><span class="o">-&gt;</span><span class="n">txGainType</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * UB95 specific data.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">hw_version</span><span class="p">.</span><span class="n">usbdev</span> <span class="o">==</span> <span class="n">AR9287_USB</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">base_eep_ar9287_header</span> <span class="o">*</span><span class="n">pBase9287</span> <span class="o">=</span>
			<span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">map9287</span><span class="p">.</span><span class="n">baseEepHeader</span><span class="p">;</span>

		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
				<span class="s">&quot;%20s : %10ddB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="s">&quot;Power Table Offset&quot;</span><span class="p">,</span>
				<span class="n">pBase9287</span><span class="o">-&gt;</span><span class="n">pwrTableOffset</span><span class="p">);</span>

		<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
				<span class="s">&quot;%20s : %10d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="s">&quot;OpenLoop Power Ctrl&quot;</span><span class="p">,</span>
				<span class="n">pBase9287</span><span class="o">-&gt;</span><span class="n">openLoopPwrCntl</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%20s : %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;MacAddress&quot;</span><span class="p">,</span>
			<span class="n">pBase</span><span class="o">-&gt;</span><span class="n">macAddr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_base_eeprom</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_base_eeprom</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_4k_modal_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
				    <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define PR_EEP(_s, _val)						\</span>
<span class="cp">	do {								\</span>
<span class="cp">		len += snprintf(buf + len, size - len, &quot;%20s : %10d\n&quot;,	\</span>
<span class="cp">				_s, (_val));				\</span>
<span class="cp">	} while (0)</span>

	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">modal_eep_4k_header</span> <span class="o">*</span><span class="n">pModal</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">map4k</span><span class="p">.</span><span class="n">modalHeader</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Ant. Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlChain</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Ant. Common Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlCommon</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Ant. Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antennaGainCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Switch Settle&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">switchSettling</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 TxRxAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txRxAttenCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 RxTxMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">rxTxMarginCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;ADC Desired size&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">adcDesiredSize</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;PGA Desired size&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">pgaDesiredSize</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 xlna Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xlnaGainCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txEndToXpaOff&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txEndToXpaOff</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txEndToRxOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txEndToRxOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToXpaOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToXpaOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;CCA Threshold)&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">thresh62</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 NF Threshold&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">noiseFloorThreshCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;xpdGain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpdGain</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;External PD&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpd</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 I Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalICh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Q Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalQCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;pdGainOverlap&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">pdGainOverlap</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;O/D Bias Version&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;CCK OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_0</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;BPSK OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_1</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;QPSK OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_2</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;16QAM OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_3</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;64QAM OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_4</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;CCK Driver1_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db1_0</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;BPSK Driver1_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db1_1</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;QPSK Driver1_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db1_2</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;16QAM Driver1_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db1_3</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;64QAM Driver1_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db1_4</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;CCK Driver2_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db2_0</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;BPSK Driver2_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db2_1</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;QPSK Driver2_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db2_2</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;16QAM Driver2_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db2_3</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;64QAM Driver2_Bias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db2_4</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;xPA Bias Level&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpaBiasLvl</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToDataStart&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToDataStart</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToPaOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToPaOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;HT40 Power Inc.&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ht40PowerIncForPdadc</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 bswAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswAtten</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 bswMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswMargin</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;HT40 Switch Settle&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">swSettleHt40</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 xatten2Db&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xatten2Db</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 xatten2Margin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xatten2Margin</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Ant. Diversity ctl1&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antdiv_ctl1</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Ant. Diversity ctl2&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antdiv_ctl2</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;TX Diversity&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">tx_diversity</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>

<span class="cp">#undef PR_EEP</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_def_modal_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
				     <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				     <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define PR_EEP(_s, _val)						\</span>
<span class="cp">	do {								\</span>
<span class="cp">		if (pBase-&gt;opCapFlags &amp; AR5416_OPFLAGS_11G) {		\</span>
<span class="cp">			pModal = &amp;priv-&gt;ah-&gt;eeprom.def.modalHeader[1];	\</span>
<span class="cp">			len += snprintf(buf + len, size - len, &quot;%20s : %8d%7s&quot;, \</span>
<span class="cp">					_s, (_val), &quot;|&quot;);		\</span>
<span class="cp">		}							\</span>
<span class="cp">		if (pBase-&gt;opCapFlags &amp; AR5416_OPFLAGS_11A) {		\</span>
<span class="cp">			pModal = &amp;priv-&gt;ah-&gt;eeprom.def.modalHeader[0];	\</span>
<span class="cp">			len += snprintf(buf + len, size - len, &quot;%9d\n&quot;, \</span>
<span class="cp">					(_val));			\</span>
<span class="cp">		}							\</span>
<span class="cp">	} while (0)</span>

	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">base_eep_header</span> <span class="o">*</span><span class="n">pBase</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">def</span><span class="p">.</span><span class="n">baseEepHeader</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">modal_eep_header</span> <span class="o">*</span><span class="n">pModal</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">3500</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%31s %15s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;2G&quot;</span><span class="p">,</span> <span class="s">&quot;5G&quot;</span><span class="p">);</span>
	<span class="n">len</span> <span class="o">+=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="n">len</span><span class="p">,</span>
			<span class="s">&quot;%32s %16s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="s">&quot;====&quot;</span><span class="p">,</span> <span class="s">&quot;====</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Ant. Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlChain</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 Ant. Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlChain</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 Ant. Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlChain</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Ant. Common Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlCommon</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Ant. Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antennaGainCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 Ant. Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antennaGainCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 Ant. Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antennaGainCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Switch Settle&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">switchSettling</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 TxRxAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txRxAttenCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 TxRxAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txRxAttenCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 TxRxAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txRxAttenCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 RxTxMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">rxTxMarginCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 RxTxMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">rxTxMarginCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 RxTxMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">rxTxMarginCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;ADC Desired size&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">adcDesiredSize</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;PGA Desired size&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">pgaDesiredSize</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 xlna Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xlnaGainCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 xlna Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xlnaGainCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 xlna Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xlnaGainCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txEndToXpaOff&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txEndToXpaOff</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txEndToRxOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txEndToRxOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToXpaOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToXpaOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;CCA Threshold)&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">thresh62</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 NF Threshold&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">noiseFloorThreshCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 NF Threshold&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">noiseFloorThreshCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 NF Threshold&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">noiseFloorThreshCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;xpdGain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpdGain</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;External PD&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpd</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 I Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalICh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 I Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalICh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 I Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalICh</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Q Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalQCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 Q Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalQCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 Q Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalQCh</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;pdGainOverlap&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">pdGainOverlap</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 DriverBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;xPA Bias Level&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpaBiasLvl</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;2chain pwr decrease&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">pwrDecreaseFor2Chain</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;3chain pwr decrease&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">pwrDecreaseFor3Chain</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToDataStart&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToDataStart</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToPaOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToPaOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;HT40 Power Inc.&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ht40PowerIncForPdadc</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 bswAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswAtten</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 bswAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswAtten</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 bswAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswAtten</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 bswMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswMargin</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 bswMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswMargin</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 bswMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswMargin</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;HT40 Switch Settle&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">swSettleHt40</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 xatten2Db&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xatten2Db</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 xatten2Db&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xatten2Db</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 xatten2Db&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xatten2Db</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 xatten2Margin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xatten2Margin</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 xatten2Margin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xatten2Margin</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain2 xatten2Margin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xatten2Margin</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_ch1</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 DriverBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db_ch1</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;LNA Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">lna_ctl</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;XPA Bias Freq0&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpaBiasLvlFreq</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;XPA Bias Freq1&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpaBiasLvlFreq</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;XPA Bias Freq2&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpaBiasLvlFreq</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>

<span class="cp">#undef PR_EEP</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_9287_modal_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span>
				      <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
<span class="cp">#define PR_EEP(_s, _val)						\</span>
<span class="cp">	do {								\</span>
<span class="cp">		len += snprintf(buf + len, size - len, &quot;%20s : %10d\n&quot;,	\</span>
<span class="cp">				_s, (_val));				\</span>
<span class="cp">	} while (0)</span>

	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">modal_eep_ar9287_header</span> <span class="o">*</span><span class="n">pModal</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">eeprom</span><span class="p">.</span><span class="n">map9287</span><span class="p">.</span><span class="n">modalHeader</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>
	<span class="kt">ssize_t</span> <span class="n">retval</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Ant. Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlChain</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 Ant. Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlChain</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Ant. Common Control&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antCtrlCommon</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Ant. Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antennaGainCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 Ant. Gain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">antennaGainCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Switch Settle&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">switchSettling</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 TxRxAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txRxAttenCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 TxRxAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txRxAttenCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 RxTxMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">rxTxMarginCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 RxTxMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">rxTxMarginCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;ADC Desired size&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">adcDesiredSize</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txEndToXpaOff&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txEndToXpaOff</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txEndToRxOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txEndToRxOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToXpaOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToXpaOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;CCA Threshold)&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">thresh62</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 NF Threshold&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">noiseFloorThreshCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 NF Threshold&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">noiseFloorThreshCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;xpdGain&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpdGain</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;External PD&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpd</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 I Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalICh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 I Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalICh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 Q Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalQCh</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 Q Coefficient&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">iqCalQCh</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;pdGainOverlap&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">pdGainOverlap</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;xPA Bias Level&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">xpaBiasLvl</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToDataStart&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToDataStart</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;txFrameToPaOn&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">txFrameToPaOn</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;HT40 Power Inc.&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ht40PowerIncForPdadc</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 bswAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswAtten</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 bswAtten&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswAtten</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain0 bswMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswMargin</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;Chain1 bswMargin&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">bswMargin</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;HT40 Switch Settle&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">swSettleHt40</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;AR92x7 Version&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">version</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;DriverBias1&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db1</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;DriverBias2&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">db1</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;CCK OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_cck</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;PSK OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_psk</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;QAM OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_qam</span><span class="p">);</span>
	<span class="n">PR_EEP</span><span class="p">(</span><span class="s">&quot;PAL_OFF OutputBias&quot;</span><span class="p">,</span> <span class="n">pModal</span><span class="o">-&gt;</span><span class="n">ob_pal_off</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">retval</span> <span class="o">=</span> <span class="n">simple_read_from_buffer</span><span class="p">(</span><span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">retval</span><span class="p">;</span>

<span class="cp">#undef PR_EEP</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">read_file_modal_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">user_buf</span><span class="p">,</span>
				      <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">AR_SREV_9271</span><span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">read_4k_modal_eeprom</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">hw_version</span><span class="p">.</span><span class="n">usbdev</span> <span class="o">==</span> <span class="n">AR9280_USB</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">read_def_modal_eeprom</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">ah</span><span class="o">-&gt;</span><span class="n">hw_version</span><span class="p">.</span><span class="n">usbdev</span> <span class="o">==</span> <span class="n">AR9287_USB</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">read_9287_modal_eeprom</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">user_buf</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">ppos</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">fops_modal_eeprom</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_file_modal_eeprom</span><span class="p">,</span>
	<span class="p">.</span><span class="n">open</span> <span class="o">=</span> <span class="n">simple_open</span><span class="p">,</span>
	<span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">llseek</span> <span class="o">=</span> <span class="n">default_llseek</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">ath9k_htc_init_debug</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath_hw</span> <span class="o">*</span><span class="n">ah</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ath_common</span> <span class="o">*</span><span class="n">common</span> <span class="o">=</span> <span class="n">ath9k_hw_common</span><span class="p">(</span><span class="n">ah</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ath9k_htc_priv</span> <span class="o">*</span><span class="p">)</span> <span class="n">common</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span> <span class="o">=</span> <span class="n">debugfs_create_dir</span><span class="p">(</span><span class="n">KBUILD_MODNAME</span><span class="p">,</span>
					     <span class="n">priv</span><span class="o">-&gt;</span><span class="n">hw</span><span class="o">-&gt;</span><span class="n">wiphy</span><span class="o">-&gt;</span><span class="n">debugfsdir</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;tgt_int_stats&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_tgt_int_stats</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;tgt_tx_stats&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_tgt_tx_stats</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;tgt_rx_stats&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_tgt_rx_stats</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;xmit&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_xmit</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;recv&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_recv</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;slot&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_slot</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;queue&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_queue</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;debug&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span> <span class="o">|</span> <span class="n">S_IWUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_debug</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;base_eeprom&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_base_eeprom</span><span class="p">);</span>
	<span class="n">debugfs_create_file</span><span class="p">(</span><span class="s">&quot;modal_eeprom&quot;</span><span class="p">,</span> <span class="n">S_IRUSR</span><span class="p">,</span> <span class="n">priv</span><span class="o">-&gt;</span><span class="n">debug</span><span class="p">.</span><span class="n">debugfs_phy</span><span class="p">,</span>
			    <span class="n">priv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fops_modal_eeprom</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
