f | qcu.c | s | 20K | 601 | Michal Kazior | michal.kazior@tieto.com | 1334341970 |  | mac80211: remove hw.conf.channel usage where possible  Removes hw.conf.channel usage from the following functions:  * ieee80211_mandatory_rates  * ieee80211_sta_get_rates  * ieee80211_frame_duration  * ieee80211_rts_duration  * ieee80211_ctstoself_duration  This is in preparation for multi-channel operation.  Signed-off-by: Michal Kazior <michal.kazior@tieto.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | rfbuffer.h | s | 35K | 782 | Nick Kossifidis | mickflemm@gmail.com | 1322509456 |  | ath5k: Cleanups v2 + add kerneldoc on all hw functions  No functional changes  Add kernel doc for all ath5k_hw_* functions and strcucts. Also do some cleanup, rename ath5k_hw_init_beacon to ath5k_hw_init_beacon_timers, remove an unused variable from ath5k_hw_pcu_init and a few obsolete macros, mostly related to XR.  Signed-off-by: Nick Kossifidis <mickflemm@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | reg.h | s | 95K | 2308 | Nick Kossifidis | mickflemm@gmail.com | 1322509450 |  | ath5k: Switch from read-and-clear to write-to-clear method when handling PISR/SISR registers  Since card has 12 tx queues and we want to keep track of the interrupts per queue we can't fit all these interrupt bits on a single register. So we have 5 registers, the primary interrupt status register (PISR) and the 4 secondary interupt status registers (SISRs).  In order to be able to read them all at once (atomic operation) Atheros introduced the Read-And-Clear registers to make things easier. So when reading RAC_PISR register, hw does a read on PISR and all SISRs, returns the value of PISR, copies all SISR values to their shadow copies (RAC_SISRx) and clears PISR and SISRs. This saves us from reading PISR/SISRs in a sequence.  So far we 've used this approach and MadWiFi/Windows driver etc also used it for years.  It turns out this operation is not atomic after all (at least not on all cards) That means it's possible to loose some interrupts because they came after the copy step and hw cleared them on the clean step !  That's probably the reason we got missed beacons, got stuck queues etc and couldn't figure out what was going on.  With this patch we switch from RaC operation to an alternative method (that makes more sense IMHO anyway, I just chose to be on the safe side so far). Instead of reading RAC registers, we read the normal PISR/SISR registers and clear any bits we got by writing them back on the register. This will clear only the bits we got on our read step and leave any new bits unaffected (at least that's what docs say). So if any new interrupts come up we won't miss it.  I've tested this with an AR5213 and an AR2425 and it seems O.K.  Many thanks to Adrian Chadd for debuging this and reviewing the patch !  v2: Make sure we don't clear PISR bits that map to SISR generated interrupts (added a comment on the code for this)  Signed-off-by: Nick Kossifidis <mickflemm@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | debug.h | s | 5.9K | 144 | Joe Perches | joe@perches.com | 1320107454 |  | treewide: use __printf not __attribute__((format(printf,...)))  Standardize the style for compiler based printf format verification. Standardized the location of __printf too.  Done via script and a little typing.  $ grep -rPl --include=*.[ch] -w "__attribute__" * || \   grep -vP "^(tools||scripts||include/linux/compiler-gcc.h)" || \   xargs perl -n -i -e 'local $/; while (<>) { s/\b__attribute__\s*\(\s*\(\s*format\s*\(\s*printf\s*,\s*(.+)\s*,\s*(.+)\s*\)\s*\)\s*\)/__printf($1, $2)/g ; print; }'  [akpm@linux-foundation.org: revert arch bits] Signed-off-by: Joe Perches <joe@perches.com> Cc: "Kirill A. Shutemov" <kirill@shutemov.name> Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
f | pci.c | s | 9.3K | 296 | Axel Lin | axel.lin@gmail.com | 1334601530 |  | net/wireless: use module_pci_driver  This patch converts the drivers in drivers/net/wireless/* to use module_pci_driver() macro which makes the code smaller and a bit simpler.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Cc: "John W. Linville" <linville@tuxdriver.com> Cc: Jiri Slaby <jirislaby@gmail.com> Cc: Nick Kossifidis <mickflemm@gmail.com> Cc: "Luis R. Rodriguez" <mcgrof@qca.qualcomm.com> Cc: Simon Kelley <simon@thekelleys.org.uk> Cc: Jouni Malinen <j@w1.fi> Cc: Lennert Buytenhek <buytenh@wantstofly.org> Cc: Christian Lamparter <chunkeey@googlemail.com> Cc: Ivo van Doorn <IvDoorn@gmail.com> Cc: Larry Finger <Larry.Finger@lwfinger.net> Cc: linux-wireless@vger.kernel.org Acked-by: Lennert Buytenhek <buytenh@wantstofly.org> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | ani.c | s | 23K | 662 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | trace.h | s | 2.4K | 85 | Luis R. Rodriguez | mcgrof@qca.qualcomm.com | 1325705440 |  | ath5k: avoid sparse warnings on tracing  Just skip the sparse checks on tracing.    CHECK   drivers/net/wireless/ath/ath5k/base.c include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:19:1: error: incompatible types for operation (<) include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:19:1:    left side has type struct ath5k_hw *<noident> include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:19:1:    right side has type int include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:37:1: error: incompatible types for operation (<) include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:37:1:    left side has type struct ath5k_hw *<noident> include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:37:1:    right side has type int include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:63:1: error: incompatible types for operation (<) include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:63:1:    left side has type struct ath5k_hw *<noident> include/trace/../../drivers/net/wireless/ath/ath5k/trace.h:63:1:    right side has type int /home/mcgrof/wireless-testing/arch/x86/include/asm/jump_label.h:16:9: error: bad asm output /home/mcgrof/wireless-testing/arch/x86/include/asm/jump_label.h:16:9: error: bad asm output /home/mcgrof/wireless-testing/arch/x86/include/asm/jump_label.h:16:9: error: bad asm output /home/mcgrof/wireless-testing/arch/x86/include/asm/jump_label.h:16:9: error: bad asm output   CC [M]  drivers/net/wireless/ath/ath5k/base.o  Signed-off-by: Luis R. Rodriguez <mcgrof@qca.qualcomm.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | Makefile | g | 512B |  | Bruno Randolf | br1@einfach.org | 1294169711 |  | ath5k: Move mac80211 functions into new file  Move mac80211 functions into new file mac80211-ops.c to have a better separation and to make base.c smaller.  Signed-off-by: Bruno Randolf <br1@einfach.org> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | debug.c | s | 30K | 883 | John W. Linville | linville@tuxdriver.com | 1334252968 |  | Merge branch 'master' of git://git.kernel.org/pub/scm/linux/kernel/git/linville/wireless
f | gpio.c | s | 5.4K | 180 | Nick Kossifidis | mickflemm@gmail.com | 1322509456 |  | ath5k: Cleanups v2 + add kerneldoc on all hw functions  No functional changes  Add kernel doc for all ath5k_hw_* functions and strcucts. Also do some cleanup, rename ath5k_hw_init_beacon to ath5k_hw_init_beacon_timers, remove an unused variable from ath5k_hw_pcu_init and a few obsolete macros, mostly related to XR.  Signed-off-by: Nick Kossifidis <mickflemm@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | reset.c | s | 36K | 1213 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | eeprom.c | s | 47K | 1480 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | base.c | s | 81K | 2630 | Bob Copeland | me@bobcopeland.com | 1340132185 |  | ath5k: remove _bh from inner locks  spin_unlock_bh(&txq->lock) already disables softirqs so we don't want to do it here.  Fixes smatch warnings:     drivers/net/wireless/ath/ath5k/base.c:1048 ath5k_drain_tx_buffs() error: double lock 'bottom_half:'    drivers/net/wireless/ath/ath5k/base.c:1056 ath5k_drain_tx_buffs() error: double unlock 'bottom_half:'  Reported-by: Johannes Berg <johannes.berg@intel.com> Signed-off-by: Bob Copeland <me@bobcopeland.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | dma.c | s | 23K | 795 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | eeprom.h | s | 19K | 450 | Pavel Roskin | proski@gnu.org | 1310410936 |  | ath5k: fix typos, bad comment formatting and GHz in place of MHz  Signed-off-by: Pavel Roskin <proski@gnu.org> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | ani.h | s | 4.1K | 102 | Nick Kossifidis | mickflemm@gmail.com | 1322509456 |  | ath5k: Cleanups v2 + add kerneldoc on all hw functions  No functional changes  Add kernel doc for all ath5k_hw_* functions and strcucts. Also do some cleanup, rename ath5k_hw_init_beacon to ath5k_hw_init_beacon_timers, remove an unused variable from ath5k_hw_pcu_init and a few obsolete macros, mostly related to XR.  Signed-off-by: Nick Kossifidis <mickflemm@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | ahb.c | s | 6.4K | 214 | Jonathan Bither | jonbither@gmail.com | 1335554647 |  | ath5k: add missing iounmap to AHB probe removal  When our driver device is removed on the AHB bus, our IO memory is never unmapped.  Signed-off-by: Jonathan Bither <jonbither@gmail.com> Reviewed-by: Pavel Roskin <proski@gnu.org> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | ath5k.h | s | 53K | 1494 | Michal Kazior | michal.kazior@tieto.com | 1334341970 |  | mac80211: remove hw.conf.channel usage where possible  Removes hw.conf.channel usage from the following functions:  * ieee80211_mandatory_rates  * ieee80211_sta_get_rates  * ieee80211_frame_duration  * ieee80211_rts_duration  * ieee80211_ctstoself_duration  This is in preparation for multi-channel operation.  Signed-off-by: Michal Kazior <michal.kazior@tieto.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | pcu.c | s | 27K | 884 | Michal Kazior | michal.kazior@tieto.com | 1334341970 |  | mac80211: remove hw.conf.channel usage where possible  Removes hw.conf.channel usage from the following functions:  * ieee80211_mandatory_rates  * ieee80211_sta_get_rates  * ieee80211_frame_duration  * ieee80211_rts_duration  * ieee80211_ctstoself_duration  This is in preparation for multi-channel operation.  Signed-off-by: Michal Kazior <michal.kazior@tieto.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | caps.c | s | 4.3K | 132 | Nick Kossifidis | mickflemm@gmail.com | 1322509459 |  | ath5k: MRR support and 2GHz radio override belong in ah_capabilities  MRR support and 2GHz radio override belong in ah_capabilities and we should use them (e.g. so far  we used to set mrr descriptor without checking if MRR support is enabled + we checked for MRR support 2 times, one by trying to set up an MRR descriptor and another one based on MAC version).  Signed-off-by: Nick Kossifidis <mickflemm@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | mac80211-ops.c | s | 22K | 687 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | initvals.c | s | 50K | 1536 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | base.h | s | 4.2K | 103 | Pavel Roskin | proski@gnu.org | 1312833854 |  | ath5k: remove last references to "softc"  Signed-off-by: Pavel Roskin <proski@gnu.org> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | rfkill.c | s | 3.9K | 96 | Pavel Roskin | proski@gnu.org | 1312833854 |  | ath5k: clean up base.h and its use  Remove unnecessary includes from base.h.  Add includes to other files as necessary.  Don't include base.h unless needed.  Move declarations for functions in base.c from ath5k.h to base.h.  Use a better named define to protect base.h against double inclusion.  Signed-off-by: Pavel Roskin <proski@gnu.org> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | sysfs.c | s | 3.5K | 105 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | attach.c | s | 9.9K | 308 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | rfgain.h | s | 23K | 517 | Nick Kossifidis | mickflemm@gmail.com | 1322509456 |  | ath5k: Cleanups v2 + add kerneldoc on all hw functions  No functional changes  Add kernel doc for all ath5k_hw_* functions and strcucts. Also do some cleanup, rename ath5k_hw_init_beacon to ath5k_hw_init_beacon_timers, remove an unused variable from ath5k_hw_pcu_init and a few obsolete macros, mostly related to XR.  Signed-off-by: Nick Kossifidis <mickflemm@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | Kconfig | g | 1.7K |  | Bob Copeland | me@bobcopeland.com | 1296247467 |  | ath5k: use tracing for packet tx/rx dump  This adds a few tracepoints to ath5k driver transmit and receive callbacks in order to record packet traffic. We record the entire packet in the trace buffer so that the data can be extracted with trace-cmd and external plugins.  Compared to the previous debugging calls, this approach removes an out-of-line function call from the tx and rx paths in the compiled-in-but-disabled case, while improving the ability to process the logged data.  A new option, CONFIG_ATH5K_TRACER, is added so that one may disable the tracepoints completely.  Signed-off-by: Bob Copeland <me@bobcopeland.com> Acked-by: Bruno Randolf <br1@einfach.org> Acked-by: Nick Kossifidis <mickflemm@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | desc.c | s | 21K | 669 | Qasim Javed | qasimj@gmail.com | 1334175838 |  | ath5k: Remove extraneous statements from ath5k_hw_proc_4word_tx_status and ath5k_hw_proc_2word_status.  Signed-off-by: Qasim Javed <qasimj@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | phy.c | s | 107K | 3412 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | led.c | s | 6.5K | 179 | Joe Perches | joe@perches.com | 1334083933 |  | ath: Add and use pr_fmt, convert printks to pr_<level>  Use a more current logging style. Make sure all output is prefixed appropriately.  Signed-off-by: Joe Perches <joe@perches.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
f | desc.h | s | 16K | 339 | Nick Kossifidis | mickflemm@gmail.com | 1322509456 |  | ath5k: Cleanups v2 + add kerneldoc on all hw functions  No functional changes  Add kernel doc for all ath5k_hw_* functions and strcucts. Also do some cleanup, rename ath5k_hw_init_beacon to ath5k_hw_init_beacon_timers, remove an unused variable from ath5k_hw_pcu_init and a few obsolete macros, mostly related to XR.  Signed-off-by: Nick Kossifidis <mickflemm@gmail.com> Signed-off-by: John W. Linville <linville@tuxdriver.com>
