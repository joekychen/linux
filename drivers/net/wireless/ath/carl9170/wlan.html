<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › ath › carl9170 › wlan.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>wlan.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Shared Atheros AR9170 Header</span>
<span class="cm"> *</span>
<span class="cm"> * RX/TX meta descriptor format</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2008, Johannes Berg &lt;johannes@sipsolutions.net&gt;</span>
<span class="cm"> * Copyright 2009-2011 Christian Lamparter &lt;chunkeey@googlemail.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; see the file COPYING.  If not, see</span>
<span class="cm"> * http://www.gnu.org/licenses/.</span>
<span class="cm"> *</span>
<span class="cm"> * This file incorporates work covered by the following copyright and</span>
<span class="cm"> * permission notice:</span>
<span class="cm"> *    Copyright (c) 2007-2008 Atheros Communications, Inc.</span>
<span class="cm"> *</span>
<span class="cm"> *    Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="cm"> *    purpose with or without fee is hereby granted, provided that the above</span>
<span class="cm"> *    copyright notice and this permission notice appear in all copies.</span>
<span class="cm"> *</span>
<span class="cm"> *    THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="cm"> *    WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="cm"> *    MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="cm"> *    ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="cm"> *    WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="cm"> *    ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="cm"> *    OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __CARL9170_SHARED_WLAN_H</span>
<span class="cp">#define __CARL9170_SHARED_WLAN_H</span>

<span class="cp">#include &quot;fwcmd.h&quot;</span>

<span class="cp">#define	AR9170_RX_PHY_RATE_CCK_1M		0x0a</span>
<span class="cp">#define	AR9170_RX_PHY_RATE_CCK_2M		0x14</span>
<span class="cp">#define	AR9170_RX_PHY_RATE_CCK_5M		0x37</span>
<span class="cp">#define	AR9170_RX_PHY_RATE_CCK_11M		0x6e</span>

<span class="cp">#define	AR9170_ENC_ALG_NONE			0x0</span>
<span class="cp">#define	AR9170_ENC_ALG_WEP64			0x1</span>
<span class="cp">#define	AR9170_ENC_ALG_TKIP			0x2</span>
<span class="cp">#define	AR9170_ENC_ALG_AESCCMP			0x4</span>
<span class="cp">#define	AR9170_ENC_ALG_WEP128			0x5</span>
<span class="cp">#define	AR9170_ENC_ALG_WEP256			0x6</span>
<span class="cp">#define	AR9170_ENC_ALG_CENC			0x7</span>

<span class="cp">#define	AR9170_RX_ENC_SOFTWARE			0x8</span>

<span class="cp">#define	AR9170_RX_STATUS_MODULATION		0x03</span>
<span class="cp">#define	AR9170_RX_STATUS_MODULATION_S		0</span>
<span class="cp">#define	AR9170_RX_STATUS_MODULATION_CCK		0x00</span>
<span class="cp">#define	AR9170_RX_STATUS_MODULATION_OFDM	0x01</span>
<span class="cp">#define	AR9170_RX_STATUS_MODULATION_HT		0x02</span>
<span class="cp">#define	AR9170_RX_STATUS_MODULATION_DUPOFDM	0x03</span>

<span class="cm">/* depends on modulation */</span>
<span class="cp">#define	AR9170_RX_STATUS_SHORT_PREAMBLE		0x08</span>
<span class="cp">#define	AR9170_RX_STATUS_GREENFIELD		0x08</span>

<span class="cp">#define	AR9170_RX_STATUS_MPDU			0x30</span>
<span class="cp">#define	AR9170_RX_STATUS_MPDU_S			4</span>
<span class="cp">#define	AR9170_RX_STATUS_MPDU_SINGLE		0x00</span>
<span class="cp">#define	AR9170_RX_STATUS_MPDU_FIRST		0x20</span>
<span class="cp">#define	AR9170_RX_STATUS_MPDU_MIDDLE		0x30</span>
<span class="cp">#define	AR9170_RX_STATUS_MPDU_LAST		0x10</span>

<span class="cp">#define	AR9170_RX_STATUS_CONT_AGGR		0x40</span>
<span class="cp">#define	AR9170_RX_STATUS_TOTAL_ERROR		0x80</span>

<span class="cp">#define	AR9170_RX_ERROR_RXTO			0x01</span>
<span class="cp">#define	AR9170_RX_ERROR_OVERRUN			0x02</span>
<span class="cp">#define	AR9170_RX_ERROR_DECRYPT			0x04</span>
<span class="cp">#define	AR9170_RX_ERROR_FCS			0x08</span>
<span class="cp">#define	AR9170_RX_ERROR_WRONG_RA		0x10</span>
<span class="cp">#define	AR9170_RX_ERROR_PLCP			0x20</span>
<span class="cp">#define	AR9170_RX_ERROR_MMIC			0x40</span>

<span class="cm">/* these are either-or */</span>
<span class="cp">#define	AR9170_TX_MAC_PROT_RTS			0x0001</span>
<span class="cp">#define	AR9170_TX_MAC_PROT_CTS			0x0002</span>
<span class="cp">#define	AR9170_TX_MAC_PROT			0x0003</span>

<span class="cp">#define	AR9170_TX_MAC_NO_ACK			0x0004</span>
<span class="cm">/* if unset, MAC will only do SIFS space before frame */</span>
<span class="cp">#define	AR9170_TX_MAC_BACKOFF			0x0008</span>
<span class="cp">#define	AR9170_TX_MAC_BURST			0x0010</span>
<span class="cp">#define	AR9170_TX_MAC_AGGR			0x0020</span>

<span class="cm">/* encryption is a two-bit field */</span>
<span class="cp">#define	AR9170_TX_MAC_ENCR_NONE			0x0000</span>
<span class="cp">#define	AR9170_TX_MAC_ENCR_RC4			0x0040</span>
<span class="cp">#define	AR9170_TX_MAC_ENCR_CENC			0x0080</span>
<span class="cp">#define	AR9170_TX_MAC_ENCR_AES			0x00c0</span>

<span class="cp">#define	AR9170_TX_MAC_MMIC			0x0100</span>
<span class="cp">#define	AR9170_TX_MAC_HW_DURATION		0x0200</span>
<span class="cp">#define	AR9170_TX_MAC_QOS_S			10</span>
<span class="cp">#define	AR9170_TX_MAC_QOS			0x0c00</span>
<span class="cp">#define	AR9170_TX_MAC_DISABLE_TXOP		0x1000</span>
<span class="cp">#define	AR9170_TX_MAC_TXOP_RIFS			0x2000</span>
<span class="cp">#define	AR9170_TX_MAC_IMM_BA			0x4000</span>

<span class="cm">/* either-or */</span>
<span class="cp">#define	AR9170_TX_PHY_MOD_CCK			0x00000000</span>
<span class="cp">#define	AR9170_TX_PHY_MOD_OFDM			0x00000001</span>
<span class="cp">#define	AR9170_TX_PHY_MOD_HT			0x00000002</span>

<span class="cm">/* depends on modulation */</span>
<span class="cp">#define	AR9170_TX_PHY_SHORT_PREAMBLE		0x00000004</span>
<span class="cp">#define	AR9170_TX_PHY_GREENFIELD		0x00000004</span>

<span class="cp">#define	AR9170_TX_PHY_BW_S			3</span>
<span class="cp">#define	AR9170_TX_PHY_BW			(3 &lt;&lt; AR9170_TX_PHY_BW_SHIFT)</span>
<span class="cp">#define	AR9170_TX_PHY_BW_20MHZ			0</span>
<span class="cp">#define	AR9170_TX_PHY_BW_40MHZ			2</span>
<span class="cp">#define	AR9170_TX_PHY_BW_40MHZ_DUP		3</span>

<span class="cp">#define	AR9170_TX_PHY_TX_HEAVY_CLIP_S		6</span>
<span class="cp">#define	AR9170_TX_PHY_TX_HEAVY_CLIP		(7 &lt;&lt; \</span>
<span class="cp">						 AR9170_TX_PHY_TX_HEAVY_CLIP_S)</span>

<span class="cp">#define	AR9170_TX_PHY_TX_PWR_S			9</span>
<span class="cp">#define	AR9170_TX_PHY_TX_PWR			(0x3f &lt;&lt; \</span>
<span class="cp">						 AR9170_TX_PHY_TX_PWR_S)</span>

<span class="cp">#define	AR9170_TX_PHY_TXCHAIN_S			15</span>
<span class="cp">#define	AR9170_TX_PHY_TXCHAIN			(7 &lt;&lt; \</span>
<span class="cp">						 AR9170_TX_PHY_TXCHAIN_S)</span>
<span class="cp">#define	AR9170_TX_PHY_TXCHAIN_1			1</span>
<span class="cm">/* use for cck, ofdm 6/9/12/18/24 and HT if capable */</span>
<span class="cp">#define	AR9170_TX_PHY_TXCHAIN_2			5</span>

<span class="cp">#define	AR9170_TX_PHY_MCS_S			18</span>
<span class="cp">#define	AR9170_TX_PHY_MCS			(0x7f &lt;&lt; \</span>
<span class="cp">						 AR9170_TX_PHY_MCS_S)</span>

<span class="cp">#define	AR9170_TX_PHY_RATE_CCK_1M		0x0</span>
<span class="cp">#define	AR9170_TX_PHY_RATE_CCK_2M		0x1</span>
<span class="cp">#define	AR9170_TX_PHY_RATE_CCK_5M		0x2</span>
<span class="cp">#define	AR9170_TX_PHY_RATE_CCK_11M		0x3</span>

<span class="cm">/* same as AR9170_RX_PHY_RATE */</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_OFDM_6M		0xb</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_OFDM_9M		0xf</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_OFDM_12M		0xa</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_OFDM_18M		0xe</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_OFDM_24M		0x9</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_OFDM_36M		0xd</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_OFDM_48M		0x8</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_OFDM_54M		0xc</span>

<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS0		0x0</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS1		0x1</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS2		0x2</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS3		0x3</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS4		0x4</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS5		0x5</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS6		0x6</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS7		0x7</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS8		0x8</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS9		0x9</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS10		0xa</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS11		0xb</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS12		0xc</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS13		0xd</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS14		0xe</span>
<span class="cp">#define	AR9170_TXRX_PHY_RATE_HT_MCS15		0xf</span>

<span class="cp">#define	AR9170_TX_PHY_SHORT_GI			0x80000000</span>

<span class="cp">#ifdef __CARL9170FW__</span>
<span class="k">struct</span> <span class="n">ar9170_tx_hw_mac_control</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="cm">/*</span>
<span class="cm">			 * Beware of compiler bugs in all gcc pre 4.4!</span>
<span class="cm">			 */</span>

			<span class="n">u8</span> <span class="n">erp_prot</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">no_ack</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">backoff</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">burst</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">ampdu</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

			<span class="n">u8</span> <span class="n">enc_mode</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>

			<span class="n">u8</span> <span class="n">hw_mmic</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">hw_duration</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

			<span class="n">u8</span> <span class="n">qos_queue</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>

			<span class="n">u8</span> <span class="n">disable_txop</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">txop_rifs</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

			<span class="n">u8</span> <span class="n">ba_end</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">probe</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

		<span class="n">__le16</span> <span class="n">set</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ar9170_tx_hw_phy_control</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="cm">/*</span>
<span class="cm">			 * Beware of compiler bugs in all gcc pre 4.4!</span>
<span class="cm">			 */</span>

			<span class="n">u8</span> <span class="n">modulation</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">preamble</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">bandwidth</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
			<span class="nl">u8:</span><span class="mi">1</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">heavy_clip</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">tx_power</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">chains</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">mcs</span><span class="o">:</span><span class="mi">7</span><span class="p">;</span>
			<span class="nl">u8:</span><span class="mi">6</span><span class="p">;</span>
			<span class="n">u8</span> <span class="n">short_gi</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

		<span class="n">__le32</span> <span class="n">set</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ar9170_tx_rate_info</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">tries</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">erp_prot</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ampdu</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">free</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span> <span class="cm">/* free for use (e.g.:RIFS/TXOP/AMPDU) */</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">carl9170_tx_superdesc</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rix</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cnt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cookie</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ampdu_density</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ampdu_factor</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ampdu_commit_density</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ampdu_commit_factor</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ampdu_unused_bit</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">queue</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">assign_seq</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">vif_id</span><span class="o">:</span><span class="mi">3</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fill_in_tsf</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cab</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">padding2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_tx_rate_info</span> <span class="n">ri</span><span class="p">[</span><span class="n">CARL9170_TX_MAX_RATES</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">ar9170_tx_hw_phy_control</span> <span class="n">rr</span><span class="p">[</span><span class="n">CARL9170_TX_MAX_RETRY_RATES</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ar9170_tx_hwdesc</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">length</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_tx_hw_mac_control</span> <span class="n">mac</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_tx_hw_phy_control</span> <span class="n">phy</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ar9170_tx_frame</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ar9170_tx_hwdesc</span> <span class="n">hdr</span><span class="p">;</span>

	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="n">i3e</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">payload</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">carl9170_tx_superframe</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">carl9170_tx_superdesc</span> <span class="n">s</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_tx_frame</span> <span class="n">f</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span> <span class="n">__aligned</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="cp">#endif </span><span class="cm">/* __CARL9170FW__ */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">_ar9170_tx_hwdesc</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">length</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">mac_control</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">phy_control</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define	CARL9170_TX_SUPER_AMPDU_DENSITY_S		0</span>
<span class="cp">#define	CARL9170_TX_SUPER_AMPDU_DENSITY			0x7</span>
<span class="cp">#define	CARL9170_TX_SUPER_AMPDU_FACTOR			0x18</span>
<span class="cp">#define	CARL9170_TX_SUPER_AMPDU_FACTOR_S		3</span>
<span class="cp">#define	CARL9170_TX_SUPER_AMPDU_COMMIT_DENSITY		0x20</span>
<span class="cp">#define	CARL9170_TX_SUPER_AMPDU_COMMIT_DENSITY_S	5</span>
<span class="cp">#define	CARL9170_TX_SUPER_AMPDU_COMMIT_FACTOR		0x40</span>
<span class="cp">#define	CARL9170_TX_SUPER_AMPDU_COMMIT_FACTOR_S		6</span>

<span class="cp">#define CARL9170_TX_SUPER_MISC_QUEUE			0x3</span>
<span class="cp">#define CARL9170_TX_SUPER_MISC_QUEUE_S			0</span>
<span class="cp">#define CARL9170_TX_SUPER_MISC_ASSIGN_SEQ		0x4</span>
<span class="cp">#define	CARL9170_TX_SUPER_MISC_VIF_ID			0x38</span>
<span class="cp">#define	CARL9170_TX_SUPER_MISC_VIF_ID_S			3</span>
<span class="cp">#define	CARL9170_TX_SUPER_MISC_FILL_IN_TSF		0x40</span>
<span class="cp">#define	CARL9170_TX_SUPER_MISC_CAB			0x80</span>

<span class="cp">#define CARL9170_TX_SUPER_RI_TRIES			0x7</span>
<span class="cp">#define CARL9170_TX_SUPER_RI_TRIES_S			0</span>
<span class="cp">#define CARL9170_TX_SUPER_RI_ERP_PROT			0x18</span>
<span class="cp">#define CARL9170_TX_SUPER_RI_ERP_PROT_S			3</span>
<span class="cp">#define CARL9170_TX_SUPER_RI_AMPDU			0x20</span>
<span class="cp">#define CARL9170_TX_SUPER_RI_AMPDU_S			5</span>

<span class="k">struct</span> <span class="n">_carl9170_tx_superdesc</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">rix</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cnt</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cookie</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ampdu_settings</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">misc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">padding</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ri</span><span class="p">[</span><span class="n">CARL9170_TX_MAX_RATES</span><span class="p">];</span>
	<span class="n">__le32</span> <span class="n">rr</span><span class="p">[</span><span class="n">CARL9170_TX_MAX_RETRY_RATES</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">_carl9170_tx_superframe</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">_carl9170_tx_superdesc</span> <span class="n">s</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">_ar9170_tx_hwdesc</span> <span class="n">f</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">frame_data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span> <span class="n">__aligned</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>

<span class="cp">#define	CARL9170_TX_SUPERDESC_LEN		24</span>
<span class="cp">#define	AR9170_TX_HWDESC_LEN			8</span>
<span class="cp">#define	CARL9170_TX_SUPERFRAME_LEN		(CARL9170_TX_SUPERDESC_LEN + \</span>
<span class="cp">						 AR9170_TX_HWDESC_LEN)</span>

<span class="k">struct</span> <span class="n">ar9170_rx_head</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">plcp</span><span class="p">[</span><span class="mi">12</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define	AR9170_RX_HEAD_LEN			12</span>

<span class="k">struct</span> <span class="n">ar9170_rx_phystatus</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="p">{</span>
			<span class="n">u8</span> <span class="n">rssi_ant0</span><span class="p">,</span> <span class="n">rssi_ant1</span><span class="p">,</span> <span class="n">rssi_ant2</span><span class="p">,</span>
				<span class="n">rssi_ant0x</span><span class="p">,</span> <span class="n">rssi_ant1x</span><span class="p">,</span> <span class="n">rssi_ant2x</span><span class="p">,</span>
				<span class="n">rssi_combined</span><span class="p">;</span>
		<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">rssi</span><span class="p">[</span><span class="mi">7</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">evm_stream0</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">evm_stream1</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">phy_err</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define	AR9170_RX_PHYSTATUS_LEN			20</span>

<span class="k">struct</span> <span class="n">ar9170_rx_macstatus</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">SAidx</span><span class="p">,</span> <span class="n">DAidx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">error</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">status</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cp">#define	AR9170_RX_MACSTATUS_LEN			4</span>

<span class="k">struct</span> <span class="n">ar9170_rx_frame_single</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ar9170_rx_head</span> <span class="n">phy_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="n">i3e</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_rx_phystatus</span> <span class="n">phy_tail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_rx_macstatus</span> <span class="n">macstatus</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ar9170_rx_frame_head</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ar9170_rx_head</span> <span class="n">phy_head</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="n">i3e</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_rx_macstatus</span> <span class="n">macstatus</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ar9170_rx_frame_middle</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="n">i3e</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_rx_macstatus</span> <span class="n">macstatus</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ar9170_rx_frame_tail</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ieee80211_hdr</span> <span class="n">i3e</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_rx_phystatus</span> <span class="n">phy_tail</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ar9170_rx_macstatus</span> <span class="n">macstatus</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">ar9170_rx_frame</span> <span class="p">{</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">ar9170_rx_frame_single</span> <span class="n">single</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">ar9170_rx_frame_head</span> <span class="n">head</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">ar9170_rx_frame_middle</span> <span class="n">middle</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">ar9170_rx_frame_tail</span> <span class="n">tail</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="n">u8</span> <span class="nf">ar9170_get_decrypt_type</span><span class="p">(</span><span class="k">struct</span> <span class="n">ar9170_rx_macstatus</span> <span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">SAidx</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span> <span class="o">|</span>
	       <span class="p">(</span><span class="n">t</span><span class="o">-&gt;</span><span class="n">DAidx</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">6</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * This is an workaround for several undocumented bugs.</span>
<span class="cm"> * Don&#39;t mess with the QoS/AC &lt;-&gt; HW Queue map, if you don&#39;t</span>
<span class="cm"> * know what you are doing.</span>
<span class="cm"> *</span>
<span class="cm"> * Known problems [hardware]:</span>
<span class="cm"> *  * The MAC does not aggregate frames on anything other</span>
<span class="cm"> *    than the first HW queue.</span>
<span class="cm"> *  * when an AMPDU is placed [in the first hw queue] and</span>
<span class="cm"> *    additional frames are already queued on a different</span>
<span class="cm"> *    hw queue, the MAC will ALWAYS freeze.</span>
<span class="cm"> *</span>
<span class="cm"> * In a nutshell: The hardware can either do QoS or</span>
<span class="cm"> * Aggregation but not both at the same time. As a</span>
<span class="cm"> * result, this makes the device pretty much useless</span>
<span class="cm"> * for any serious 802.11n setup.</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">ar9170_txq</span> <span class="p">{</span>
	<span class="n">AR9170_TXQ_BK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* TXQ0 */</span>
	<span class="n">AR9170_TXQ_BE</span><span class="p">,</span>		<span class="cm">/* TXQ1	*/</span>
	<span class="n">AR9170_TXQ_VI</span><span class="p">,</span>		<span class="cm">/* TXQ2	*/</span>
	<span class="n">AR9170_TXQ_VO</span><span class="p">,</span>		<span class="cm">/* TXQ3 */</span>

	<span class="n">__AR9170_NUM_TXQ</span><span class="p">,</span>
<span class="p">};</span>

<span class="cp">#define	AR9170_TXQ_DEPTH			32</span>

<span class="cp">#endif </span><span class="cm">/* __CARL9170_SHARED_WLAN_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
