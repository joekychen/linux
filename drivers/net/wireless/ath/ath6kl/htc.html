<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › net › wireless › ath › ath6kl › htc.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>htc.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Copyright (c) 2004-2011 Atheros Communications Inc.</span>
<span class="cm"> * Copyright (c) 2011 Qualcomm Atheros, Inc.</span>
<span class="cm"> *</span>
<span class="cm"> * Permission to use, copy, modify, and/or distribute this software for any</span>
<span class="cm"> * purpose with or without fee is hereby granted, provided that the above</span>
<span class="cm"> * copyright notice and this permission notice appear in all copies.</span>
<span class="cm"> *</span>
<span class="cm"> * THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES</span>
<span class="cm"> * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF</span>
<span class="cm"> * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR</span>
<span class="cm"> * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES</span>
<span class="cm"> * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN</span>
<span class="cm"> * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF</span>
<span class="cm"> * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef HTC_H</span>
<span class="cp">#define HTC_H</span>

<span class="cp">#include &quot;common.h&quot;</span>

<span class="cm">/* frame header flags */</span>

<span class="cm">/* send direction */</span>
<span class="cp">#define HTC_FLAGS_NEED_CREDIT_UPDATE (1 &lt;&lt; 0)</span>
<span class="cp">#define HTC_FLAGS_SEND_BUNDLE        (1 &lt;&lt; 1)</span>
<span class="cp">#define HTC_FLAGS_TX_FIXUP_NETBUF    (1 &lt;&lt; 2)</span>

<span class="cm">/* receive direction */</span>
<span class="cp">#define HTC_FLG_RX_UNUSED        (1 &lt;&lt; 0)</span>
<span class="cp">#define HTC_FLG_RX_TRAILER       (1 &lt;&lt; 1)</span>
<span class="cm">/* Bundle count maske and shift */</span>
<span class="cp">#define HTC_FLG_RX_BNDL_CNT	 (0xF0)</span>
<span class="cp">#define HTC_FLG_RX_BNDL_CNT_S	 4</span>

<span class="cp">#define HTC_HDR_LENGTH  (sizeof(struct htc_frame_hdr))</span>
<span class="cp">#define HTC_MAX_PAYLOAD_LENGTH   (4096 - sizeof(struct htc_frame_hdr))</span>

<span class="cm">/* HTC control message IDs */</span>

<span class="cp">#define HTC_MSG_READY_ID		1</span>
<span class="cp">#define HTC_MSG_CONN_SVC_ID		2</span>
<span class="cp">#define HTC_MSG_CONN_SVC_RESP_ID	3</span>
<span class="cp">#define HTC_MSG_SETUP_COMPLETE_ID	4</span>
<span class="cp">#define HTC_MSG_SETUP_COMPLETE_EX_ID	5</span>

<span class="cp">#define HTC_MAX_CTRL_MSG_LEN  256</span>

<span class="cp">#define HTC_VERSION_2P0  0x00</span>
<span class="cp">#define HTC_VERSION_2P1  0x01</span>

<span class="cp">#define HTC_SERVICE_META_DATA_MAX_LENGTH 128</span>

<span class="cp">#define HTC_CONN_FLGS_THRESH_LVL_QUAT		0x0</span>
<span class="cp">#define HTC_CONN_FLGS_THRESH_LVL_HALF		0x1</span>
<span class="cp">#define HTC_CONN_FLGS_THRESH_LVL_THREE_QUAT	0x2</span>
<span class="cp">#define HTC_CONN_FLGS_REDUCE_CRED_DRIB		0x4</span>
<span class="cp">#define HTC_CONN_FLGS_THRESH_MASK		0x3</span>
<span class="cm">/* disable credit flow control on a specific service */</span>
<span class="cp">#define HTC_CONN_FLGS_DISABLE_CRED_FLOW_CTRL          (1 &lt;&lt; 3)</span>
<span class="cp">#define HTC_CONN_FLGS_SET_RECV_ALLOC_SHIFT    8</span>
<span class="cp">#define HTC_CONN_FLGS_SET_RECV_ALLOC_MASK     0xFF00</span>

<span class="cm">/* connect response status codes */</span>
<span class="cp">#define HTC_SERVICE_SUCCESS      0</span>
<span class="cp">#define HTC_SERVICE_NOT_FOUND    1</span>
<span class="cp">#define HTC_SERVICE_FAILED       2</span>

<span class="cm">/* no resources (i.e. no more endpoints) */</span>
<span class="cp">#define HTC_SERVICE_NO_RESOURCES 3</span>

<span class="cm">/* specific service is not allowing any more endpoints */</span>
<span class="cp">#define HTC_SERVICE_NO_MORE_EP   4</span>

<span class="cm">/* report record IDs */</span>
<span class="cp">#define HTC_RECORD_NULL             0</span>
<span class="cp">#define HTC_RECORD_CREDITS          1</span>
<span class="cp">#define HTC_RECORD_LOOKAHEAD        2</span>
<span class="cp">#define HTC_RECORD_LOOKAHEAD_BUNDLE 3</span>

<span class="cp">#define HTC_SETUP_COMP_FLG_RX_BNDL_EN     (1 &lt;&lt; 0)</span>
<span class="cp">#define HTC_SETUP_COMP_FLG_DISABLE_TX_CREDIT_FLOW (1 &lt;&lt; 1)</span>

<span class="cp">#define MAKE_SERVICE_ID(group, index) \</span>
<span class="cp">	(int)(((int)group &lt;&lt; 8) | (int)(index))</span>

<span class="cm">/* NOTE: service ID of 0x0000 is reserved and should never be used */</span>
<span class="cp">#define HTC_CTRL_RSVD_SVC MAKE_SERVICE_ID(RSVD_SERVICE_GROUP, 1)</span>
<span class="cp">#define WMI_CONTROL_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 0)</span>
<span class="cp">#define WMI_DATA_BE_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 1)</span>
<span class="cp">#define WMI_DATA_BK_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 2)</span>
<span class="cp">#define WMI_DATA_VI_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 3)</span>
<span class="cp">#define WMI_DATA_VO_SVC   MAKE_SERVICE_ID(WMI_SERVICE_GROUP, 4)</span>
<span class="cp">#define WMI_MAX_SERVICES  5</span>

<span class="cp">#define WMM_NUM_AC  4</span>

<span class="cm">/* reserved and used to flush ALL packets */</span>
<span class="cp">#define HTC_TX_PACKET_TAG_ALL          0</span>
<span class="cp">#define HTC_SERVICE_TX_PACKET_TAG      1</span>
<span class="cp">#define HTC_TX_PACKET_TAG_USER_DEFINED (HTC_SERVICE_TX_PACKET_TAG + 9)</span>

<span class="cm">/* more packets on this endpoint are being fetched */</span>
<span class="cp">#define HTC_RX_FLAGS_INDICATE_MORE_PKTS  (1 &lt;&lt; 0)</span>

<span class="cm">/* TODO.. for BMI */</span>
<span class="cp">#define ENDPOINT1 0</span>
<span class="cm">/* TODO -remove me, but we have to fix BMI first */</span>
<span class="cp">#define HTC_MAILBOX_NUM_MAX    4</span>

<span class="cm">/* enable send bundle padding for this endpoint */</span>
<span class="cp">#define HTC_FLGS_TX_BNDL_PAD_EN	 (1 &lt;&lt; 0)</span>
<span class="cp">#define HTC_EP_ACTIVE                            ((u32) (1u &lt;&lt; 31))</span>

<span class="cm">/* HTC operational parameters */</span>
<span class="cp">#define HTC_TARGET_RESPONSE_TIMEOUT        2000	</span><span class="cm">/* in ms */</span><span class="cp"></span>
<span class="cp">#define HTC_TARGET_RESPONSE_POLL_WAIT      10</span>
<span class="cp">#define HTC_TARGET_RESPONSE_POLL_COUNT     200</span>
<span class="cp">#define HTC_TARGET_DEBUG_INTR_MASK         0x01</span>
<span class="cp">#define HTC_TARGET_CREDIT_INTR_MASK        0xF0</span>

<span class="cp">#define HTC_HOST_MAX_MSG_PER_BUNDLE        8</span>
<span class="cp">#define HTC_MIN_HTC_MSGS_TO_BUNDLE         2</span>

<span class="cm">/* packet flags */</span>

<span class="cp">#define HTC_RX_PKT_IGNORE_LOOKAHEAD      (1 &lt;&lt; 0)</span>
<span class="cp">#define HTC_RX_PKT_REFRESH_HDR           (1 &lt;&lt; 1)</span>
<span class="cp">#define HTC_RX_PKT_PART_OF_BUNDLE        (1 &lt;&lt; 2)</span>
<span class="cp">#define HTC_RX_PKT_NO_RECYCLE            (1 &lt;&lt; 3)</span>

<span class="cp">#define NUM_CONTROL_BUFFERS     8</span>
<span class="cp">#define NUM_CONTROL_TX_BUFFERS  2</span>
<span class="cp">#define NUM_CONTROL_RX_BUFFERS  (NUM_CONTROL_BUFFERS - NUM_CONTROL_TX_BUFFERS)</span>

<span class="cp">#define HTC_RECV_WAIT_BUFFERS        (1 &lt;&lt; 0)</span>
<span class="cp">#define HTC_OP_STATE_STOPPING        (1 &lt;&lt; 0)</span>
<span class="cp">#define HTC_OP_STATE_SETUP_COMPLETE  (1 &lt;&lt; 1)</span>

<span class="cm">/*</span>
<span class="cm"> * The frame header length and message formats defined herein were selected</span>
<span class="cm"> * to accommodate optimal alignment for target processing. This reduces</span>
<span class="cm"> * code size and improves performance. Any changes to the header length may</span>
<span class="cm"> * alter the alignment and cause exceptions on the target. When adding to</span>
<span class="cm"> * the messagestructures insure that fields are properly aligned.</span>
<span class="cm"> */</span>

<span class="cm">/* HTC frame header</span>
<span class="cm"> *</span>
<span class="cm"> * NOTE: do not remove or re-arrange the fields, these are minimally</span>
<span class="cm"> * required to take advantage of 4-byte lookaheads in some hardware</span>
<span class="cm"> * implementations.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">htc_frame_hdr</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">eid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>

	<span class="cm">/* length of data (including trailer) that follows the header */</span>
	<span class="n">__le16</span> <span class="n">payld_len</span><span class="p">;</span>

	<span class="cm">/* end of 4-byte lookahead */</span>

	<span class="n">u8</span> <span class="n">ctrl</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* HTC ready message */</span>
<span class="k">struct</span> <span class="n">htc_ready_msg</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">msg_id</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">cred_cnt</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">cred_sz</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">max_ep</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pad</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* extended HTC ready message */</span>
<span class="k">struct</span> <span class="n">htc_ready_ext_msg</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">htc_ready_msg</span> <span class="n">ver2_0_info</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">htc_ver</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">msg_per_htc_bndl</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* connect service */</span>
<span class="k">struct</span> <span class="n">htc_conn_service_msg</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">msg_id</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">svc_id</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">conn_flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">svc_meta_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pad</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* connect response */</span>
<span class="k">struct</span> <span class="n">htc_conn_service_resp</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">msg_id</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">svc_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">status</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">eid</span><span class="p">;</span>
	<span class="n">__le16</span> <span class="n">max_msg_sz</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">svc_meta_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pad</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">htc_setup_comp_msg</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">msg_id</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* extended setup completion message */</span>
<span class="k">struct</span> <span class="n">htc_setup_comp_ext_msg</span> <span class="p">{</span>
	<span class="n">__le16</span> <span class="n">msg_id</span><span class="p">;</span>
	<span class="n">__le32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">msg_per_rxbndl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Rsvd</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">htc_record_hdr</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">rec_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">htc_credit_report</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">eid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">credits</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/*</span>
<span class="cm"> * NOTE: The lk_ahd array is guarded by a pre_valid</span>
<span class="cm"> * and Post Valid guard bytes. The pre_valid bytes must</span>
<span class="cm"> * equal the inverse of the post_valid byte.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">htc_lookahead_report</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">pre_valid</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">lk_ahd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">post_valid</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">htc_bundle_lkahd_rpt</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">lk_ahd</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="cm">/* Current service IDs */</span>

<span class="k">enum</span> <span class="n">htc_service_grp_ids</span> <span class="p">{</span>
	<span class="n">RSVD_SERVICE_GROUP</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">WMI_SERVICE_GROUP</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="n">HTC_TEST_GROUP</span> <span class="o">=</span> <span class="mi">254</span><span class="p">,</span>
	<span class="n">HTC_SERVICE_GROUP_LAST</span> <span class="o">=</span> <span class="mi">255</span>
<span class="p">};</span>

<span class="cm">/* ------ endpoint IDS ------ */</span>

<span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="p">{</span>
	<span class="n">ENDPOINT_UNUSED</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">ENDPOINT_0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">ENDPOINT_1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">ENDPOINT_2</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">ENDPOINT_3</span><span class="p">,</span>
	<span class="n">ENDPOINT_4</span><span class="p">,</span>
	<span class="n">ENDPOINT_5</span><span class="p">,</span>
	<span class="n">ENDPOINT_6</span><span class="p">,</span>
	<span class="n">ENDPOINT_7</span><span class="p">,</span>
	<span class="n">ENDPOINT_8</span><span class="p">,</span>
	<span class="n">ENDPOINT_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">htc_tx_packet_info</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">tag</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cred_used</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">seqno</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">htc_rx_packet_info</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">exp_hdr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">indicat_flags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">htc_target</span><span class="p">;</span>

<span class="cm">/* wrapper around endpoint-specific packets */</span>
<span class="k">struct</span> <span class="n">htc_packet</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

	<span class="cm">/* caller&#39;s per packet specific context */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">pkt_cntxt</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * the true buffer start , the caller can store the real</span>
<span class="cm">	 * buffer start here.  In receive callbacks, the HTC layer</span>
<span class="cm">	 * sets buf to the start of the payload past the header.</span>
<span class="cm">	 * This field allows the caller to reset buf when it recycles</span>
<span class="cm">	 * receive packets back to HTC.</span>
<span class="cm">	 */</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">buf_start</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Pointer to the start of the buffer. In the transmit</span>
<span class="cm">	 * direction this points to the start of the payload. In the</span>
<span class="cm">	 * receive direction, however, the buffer when queued up</span>
<span class="cm">	 * points to the start of the HTC header but when returned</span>
<span class="cm">	 * to the caller points to the start of the payload</span>
<span class="cm">	 */</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">buf_len</span><span class="p">;</span>

	<span class="cm">/* actual length of payload */</span>
	<span class="n">u32</span> <span class="n">act_len</span><span class="p">;</span>

	<span class="cm">/* endpoint that this packet was sent/recv&#39;d from */</span>
	<span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">endpoint</span><span class="p">;</span>

	<span class="cm">/* completion status */</span>

	<span class="kt">int</span> <span class="n">status</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">htc_tx_packet_info</span> <span class="n">tx</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">htc_rx_packet_info</span> <span class="n">rx</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">info</span><span class="p">;</span>

	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">completion</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">context</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * optimization for network-oriented data, the HTC packet</span>
<span class="cm">	 * can pass the network buffer corresponding to the HTC packet</span>
<span class="cm">	 * lower layers may optimized the transfer knowing this is</span>
<span class="cm">	 * a network buffer</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">htc_send_full_action</span> <span class="p">{</span>
	<span class="n">HTC_SEND_FULL_KEEP</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">HTC_SEND_FULL_DROP</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">htc_ep_callbacks</span> <span class="p">{</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_complete</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">rx</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">rx_refill</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="p">,</span> <span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">endpoint</span><span class="p">);</span>
	<span class="k">enum</span> <span class="n">htc_send_full_action</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_full</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="p">,</span>
					      <span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">rx_allocthresh</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="p">,</span>
					      <span class="k">enum</span> <span class="n">htc_endpoint_id</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_comp_multi</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="p">,</span> <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">rx_alloc_thresh</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_refill_thresh</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* service connection information */</span>
<span class="k">struct</span> <span class="n">htc_service_connect_req</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">svc_id</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">conn_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">htc_ep_callbacks</span> <span class="n">ep_cb</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_txq_depth</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">flags</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">max_rxmsg_sz</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* service connection response information */</span>
<span class="k">struct</span> <span class="n">htc_service_connect_resp</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">buf_len</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">act_len</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">endpoint</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len_max</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">resp_code</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* endpoint distributionstructure */</span>
<span class="k">struct</span> <span class="n">htc_endpoint_credit_dist</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

	<span class="cm">/* Service ID (set by HTC) */</span>
	<span class="n">u16</span> <span class="n">svc_id</span><span class="p">;</span>

	<span class="cm">/* endpoint for this distributionstruct (set by HTC) */</span>
	<span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">endpoint</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">dist_flags</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * credits for normal operation, anything above this</span>
<span class="cm">	 * indicates the endpoint is over-subscribed.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">cred_norm</span><span class="p">;</span>

	<span class="cm">/* floor for credit distribution */</span>
	<span class="kt">int</span> <span class="n">cred_min</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">cred_assngd</span><span class="p">;</span>

	<span class="cm">/* current credits available */</span>
	<span class="kt">int</span> <span class="n">credits</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * pending credits to distribute on this endpoint, this</span>
<span class="cm">	 * is set by HTC when credit reports arrive.  The credit</span>
<span class="cm">	 * distribution functions sets this to zero when it distributes</span>
<span class="cm">	 * the credits.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">cred_to_dist</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * the number of credits that the current pending TX packet needs</span>
<span class="cm">	 * to transmit. This is set by HTC when endpoint needs credits in</span>
<span class="cm">	 * order to transmit.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">seek_cred</span><span class="p">;</span>

	<span class="cm">/* size in bytes of each credit */</span>
	<span class="kt">int</span> <span class="n">cred_sz</span><span class="p">;</span>

	<span class="cm">/* credits required for a maximum sized messages */</span>
	<span class="kt">int</span> <span class="n">cred_per_msg</span><span class="p">;</span>

	<span class="cm">/* reserved for HTC use */</span>
	<span class="k">struct</span> <span class="n">htc_endpoint</span> <span class="o">*</span><span class="n">htc_ep</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * current depth of TX queue , i.e. messages waiting for credits</span>
<span class="cm">	 * This field is valid only when HTC_CREDIT_DIST_ACTIVITY_CHANGE</span>
<span class="cm">	 * or HTC_CREDIT_DIST_SEND_COMPLETE is indicated on an endpoint</span>
<span class="cm">	 * that has non-zero credits to recover.</span>
<span class="cm">	 */</span>
	<span class="kt">int</span> <span class="n">txq_depth</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * credit distibution code that is passed into the distrbution function,</span>
<span class="cm"> * there are mandatory and optional codes that must be handled</span>
<span class="cm"> */</span>
<span class="k">enum</span> <span class="n">htc_credit_dist_reason</span> <span class="p">{</span>
	<span class="n">HTC_CREDIT_DIST_SEND_COMPLETE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">HTC_CREDIT_DIST_ACTIVITY_CHANGE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">HTC_CREDIT_DIST_SEEK_CREDITS</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ath6kl_htc_credit_info</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="n">total_avail_credits</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">cur_free_credits</span><span class="p">;</span>

	<span class="cm">/* list of lowest priority endpoints */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">lowestpri_ep_dist</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* endpoint statistics */</span>
<span class="k">struct</span> <span class="n">htc_endpoint_stats</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * number of times the host set the credit-low flag in a send</span>
<span class="cm">	 * message on this endpoint</span>
<span class="cm">	 */</span>
	<span class="n">u32</span> <span class="n">cred_low_indicate</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">tx_issued</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_pkt_bundled</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_bundles</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tx_dropped</span><span class="p">;</span>

	<span class="cm">/* running count of total credit reports received for this endpoint */</span>
	<span class="n">u32</span> <span class="n">tx_cred_rpt</span><span class="p">;</span>

	<span class="cm">/* credit reports received from this endpoint&#39;s RX packets */</span>
	<span class="n">u32</span> <span class="n">cred_rpt_from_rx</span><span class="p">;</span>

	<span class="cm">/* credit reports received from RX packets of other endpoints */</span>
	<span class="n">u32</span> <span class="n">cred_rpt_from_other</span><span class="p">;</span>

	<span class="cm">/* credit reports received from endpoint 0 RX packets */</span>
	<span class="n">u32</span> <span class="n">cred_rpt_ep0</span><span class="p">;</span>

	<span class="cm">/* count of credits received via Rx packets on this endpoint */</span>
	<span class="n">u32</span> <span class="n">cred_from_rx</span><span class="p">;</span>

	<span class="cm">/* count of credits received via another endpoint */</span>
	<span class="n">u32</span> <span class="n">cred_from_other</span><span class="p">;</span>

	<span class="cm">/* count of credits received via another endpoint */</span>
	<span class="n">u32</span> <span class="n">cred_from_ep0</span><span class="p">;</span>

	<span class="cm">/* count of consummed credits */</span>
	<span class="n">u32</span> <span class="n">cred_cosumd</span><span class="p">;</span>

	<span class="cm">/* count of credits returned */</span>
	<span class="n">u32</span> <span class="n">cred_retnd</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">rx_pkts</span><span class="p">;</span>

	<span class="cm">/* count of lookahead records found in Rx msg */</span>
	<span class="n">u32</span> <span class="n">rx_lkahds</span><span class="p">;</span>

	<span class="cm">/* count of recv packets received in a bundle */</span>
	<span class="n">u32</span> <span class="n">rx_bundl</span><span class="p">;</span>

	<span class="cm">/* count of number of bundled lookaheads */</span>
	<span class="n">u32</span> <span class="n">rx_bundle_lkahd</span><span class="p">;</span>

	<span class="cm">/* count of the number of bundle indications from the HTC header */</span>
	<span class="n">u32</span> <span class="n">rx_bundle_from_hdr</span><span class="p">;</span>

	<span class="cm">/* the number of times the recv allocation threshold was hit */</span>
	<span class="n">u32</span> <span class="n">rx_alloc_thresh_hit</span><span class="p">;</span>

	<span class="cm">/* total number of bytes */</span>
	<span class="n">u32</span> <span class="n">rxalloc_thresh_byte</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">htc_endpoint</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">eid</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">svc_id</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">txq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">rx_bufq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">htc_endpoint_credit_dist</span> <span class="n">cred_dist</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">htc_ep_callbacks</span> <span class="n">ep_cb</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_txq_depth</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len_max</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tx_proc_cnt</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_proc_cnt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">seqno</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">conn_flags</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">htc_endpoint_stats</span> <span class="n">ep_st</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tx_drop_packet_threshold</span><span class="p">;</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="n">u8</span> <span class="n">pipeid_ul</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">pipeid_dl</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">list_head</span> <span class="n">tx_lookup_queue</span><span class="p">;</span>
		<span class="n">bool</span> <span class="n">tx_credit_flow_enabled</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">pipe</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">htc_control_buffer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">htc_packet</span> <span class="n">packet</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">htc_pipe_txcredit_alloc</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">service_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">credit_alloc</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">htc_send_queue_result</span> <span class="p">{</span>
	<span class="n">HTC_SEND_QUEUE_OK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* packet was queued */</span>
	<span class="n">HTC_SEND_QUEUE_DROP</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* this packet should be dropped */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ath6kl_htc_ops</span> <span class="p">{</span>
	<span class="kt">void</span><span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">create</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ath6kl</span> <span class="o">*</span><span class="n">ar</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">wait_target</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">start</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">conn_service</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">htc_service_connect_req</span> <span class="o">*</span><span class="n">req</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">htc_service_connect_resp</span> <span class="o">*</span><span class="n">resp</span><span class="p">);</span>
	<span class="kt">int</span>  <span class="p">(</span><span class="o">*</span><span class="n">tx</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span> <span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="n">packet</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">stop</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">cleanup</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">flush_txep</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span>
			   <span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">u16</span> <span class="n">tag</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">flush_rx_buf</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">);</span>
	<span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">activity_changed</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span>
				 <span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">endpoint</span><span class="p">,</span>
				 <span class="n">bool</span> <span class="n">active</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">get_rxbuf_num</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span>
			     <span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">endpoint</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">add_rxbuf_multiple</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span>
				  <span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">pktq</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">credit_setup</span><span class="p">)(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">ath6kl_htc_credit_info</span> <span class="o">*</span><span class="n">cred_info</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">tx_complete</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ath6kl</span> <span class="o">*</span><span class="n">ar</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">rx_complete</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ath6kl</span> <span class="o">*</span><span class="n">ar</span><span class="p">,</span> <span class="k">struct</span> <span class="n">sk_buff</span> <span class="o">*</span><span class="n">skb</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pipe</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ath6kl_device</span><span class="p">;</span>

<span class="cm">/* our HTC target state */</span>
<span class="k">struct</span> <span class="n">htc_target</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">htc_endpoint</span> <span class="n">endpoint</span><span class="p">[</span><span class="n">ENDPOINT_MAX</span><span class="p">];</span>

	<span class="cm">/* contains struct htc_endpoint_credit_dist */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">cred_dist_list</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">free_ctrl_txbuf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">free_ctrl_rxbuf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ath6kl_htc_credit_info</span> <span class="o">*</span><span class="n">credit_info</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tgt_creds</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">tgt_cred_sz</span><span class="p">;</span>

	<span class="cm">/* protects free_ctrl_txbuf and free_ctrl_rxbuf */</span>
	<span class="n">spinlock_t</span> <span class="n">htc_lock</span><span class="p">;</span>

	<span class="cm">/* FIXME: does this protext rx_bufq and endpoint structures or what? */</span>
	<span class="n">spinlock_t</span> <span class="n">rx_lock</span><span class="p">;</span>

	<span class="cm">/* protects endpoint-&gt;txq */</span>
	<span class="n">spinlock_t</span> <span class="n">tx_lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ath6kl_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">htc_flags</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">rx_st_flags</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">ep_waiting</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">htc_tgt_ver</span><span class="p">;</span>

	<span class="cm">/* max messages per bundle for HTC */</span>
	<span class="kt">int</span> <span class="n">msg_per_bndl_max</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">tx_bndl_mask</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rx_bndl_enable</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_rx_bndl_sz</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_tx_bndl_sz</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">block_sz</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">block_mask</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">max_scat_entries</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">max_xfer_szper_scatreq</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">chk_irq_status_cnt</span><span class="p">;</span>

	<span class="cm">/* counts the number of Tx without bundling continously per AC */</span>
	<span class="n">u32</span> <span class="n">ac_tx_count</span><span class="p">[</span><span class="n">WMM_NUM_AC</span><span class="p">];</span>

	<span class="k">struct</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="n">htc_packet_pool</span><span class="p">;</span>
		<span class="n">u8</span> <span class="n">ctrl_response_buf</span><span class="p">[</span><span class="n">HTC_MAX_CTRL_MSG_LEN</span><span class="p">];</span>
		<span class="kt">int</span> <span class="n">ctrl_response_len</span><span class="p">;</span>
		<span class="n">bool</span> <span class="n">ctrl_response_valid</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">htc_pipe_txcredit_alloc</span> <span class="n">txcredit_alloc</span><span class="p">[</span><span class="n">ENDPOINT_MAX</span><span class="p">];</span>
	<span class="p">}</span> <span class="n">pipe</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">ath6kl_htc_rxmsg_pending_handler</span><span class="p">(</span><span class="k">struct</span> <span class="n">htc_target</span> <span class="o">*</span><span class="n">target</span><span class="p">,</span>
				     <span class="n">u32</span> <span class="n">msg_look_ahead</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">n_pkts</span><span class="p">);</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_htc_pkt_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="n">packet</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span>
				    <span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">len</span><span class="p">,</span>
				    <span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">eid</span><span class="p">,</span> <span class="n">u16</span> <span class="n">tag</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">pkt_cntxt</span> <span class="o">=</span> <span class="n">context</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">act_len</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">eid</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">info</span><span class="p">.</span><span class="n">tx</span><span class="p">.</span><span class="n">tag</span> <span class="o">=</span> <span class="n">tag</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">htc_rxpkt_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="n">packet</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">=</span> <span class="n">packet</span><span class="o">-&gt;</span><span class="n">buf_start</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">act_len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set_htc_rxpkt_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">htc_packet</span> <span class="o">*</span><span class="n">packet</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span>
				      <span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">len</span><span class="p">,</span>
				      <span class="k">enum</span> <span class="n">htc_endpoint_id</span> <span class="n">eid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">pkt_cntxt</span> <span class="o">=</span> <span class="n">context</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">buf</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">buf_start</span> <span class="o">=</span> <span class="n">buf</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">buf_len</span> <span class="o">=</span> <span class="n">len</span><span class="p">;</span>
	<span class="n">packet</span><span class="o">-&gt;</span><span class="n">endpoint</span> <span class="o">=</span> <span class="n">eid</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">get_queue_depth</span><span class="p">(</span><span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">queue</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="o">*</span><span class="n">tmp_list</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">list_for_each</span><span class="p">(</span><span class="n">tmp_list</span><span class="p">,</span> <span class="n">queue</span><span class="p">)</span>
	    <span class="n">depth</span><span class="o">++</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">depth</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">ath6kl_htc_pipe_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath6kl</span> <span class="o">*</span><span class="n">ar</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ath6kl_htc_mbox_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">ath6kl</span> <span class="o">*</span><span class="n">ar</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
