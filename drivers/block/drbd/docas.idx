f | drbd_int.h | s | 79K | 2182 | Lars Ellenberg | lars.ellenberg@linbit.com | 1336569427 |  | drbd: introduce a bio_set to allocate housekeeping bios from  Don't rely on availability of bios from the global fs_bio_set, we should use our own bio_set for meta data IO.  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_nl.c | s | 73K | 2272 | Linus Torvalds | torvalds@linux-foundation.org | 1338393947 |  | Merge branch 'for-3.5/drivers' of git://git.kernel.dk/linux-block  Pull block driver updates from Jens Axboe:  "Here are the driver related changes for 3.5.  It contains:     - The floppy changes from Jiri.  Jiri is now also marked as the      maintainer of floppy.c, I shall be publically branding his forehead      with red hot iron at the next opportune moment.     - A batch of drbd updates and fixes from the linbit crew, as well as      fixes from others.     - Two small fixes for xen-blkfront courtesy of Jan."  * 'for-3.5/drivers' of git://git.kernel.dk/linux-block: (70 commits)   floppy: take over maintainership   floppy: remove floppy-specific O_EXCL handling   floppy: convert to delayed work and single-thread wq   xen-blkfront: module exit handling adjustments   xen-blkfront: properly name all devices   drbd: grammar fix in log message   drbd: check MODULE for THIS_MODULE   drbd: Restore the request restart logic   drbd: introduce a bio_set to allocate housekeeping bios from   drbd: remove unused define   drbd: bm_page_async_io: properly initialize page->private   drbd: use the newly introduced page pool for bitmap IO   drbd: add page pool to be used for meta data IO   drbd: allow bitmap to change during writeout from resync_finished   drbd: fix race between drbdadm invalidate/verify and finishing resync   drbd: fix resend/resubmit of frozen IO   drbd: Ensure that data_size is not 0 before using data_size-1 as index   drbd: Delay/reject other state changes while establishing a connection   drbd: move put_ldev from __req_mod() to the endio callback   drbd: fix WRITE_ACKED_BY_PEER_AND_SIS to not set RQ_NET_DONE   ...
f | drbd_wrappers.h | s | 1.4K | 49 | Andreas Gruenbacher | agruen@linbit.com | 1299753375 |  | drbd: Get rid of unnecessary macros (2)  The FAULT_ACTIVE macro just wraps the drbd_insert_fault macro for no apparent reason.  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | Makefile | g | 190B |  | Jens Axboe | jens.axboe@oracle.com | 1254424678 |  | drbd: remove tracing bits  They should be reimplemented in the current scheme.  Signed-off-by: Jens Axboe <jens.axboe@oracle.com>
f | drbd_req.h | s | 11K | 334 | Philipp Reisner | philipp.reisner@linbit.com | 1336551364 |  | drbd: Immediately allow completion of IOs, that wait for IO completions on a failed disk  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_worker.c | s | 46K | 1465 | Lars Ellenberg | lars.ellenberg@linbit.com | 1336569411 |  | drbd: move put_ldev from __req_mod() to the endio callback  One invocation in the endio handler is good enough, we don't need mention it for each of the different ways it calls __req_mod().  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_strings.c | s | 4.2K | 100 | Andreas Gruenbacher | agruen@linbit.com | 1299753378 |  | drbd: Rename enum drbd_state_ret_codes to enum drbd_state_rv  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_proc.c | s | 9.3K | 280 | Lars Ellenberg | lars.ellenberg@linbit.com | 1336550499 |  | drbd: cosmetic: fix accidental division instead of modulo when pretty printing  For large resync rates, seq_printf_with_thousands_grouping() accidentally only produced Y,000,00Y, instead of the real numbers.  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_req.c | s | 39K | 1116 | Lars Ellenberg | lars.ellenberg@linbit.com | 1339504519 |  | drbd: fix null pointer dereference with on-congestion policy when diskless  We must not look at mdev->actlog, unless we have a get_ldev() reference. It also does not make much sense to try to disconnect or pull-ahead of the peer, if we don't have good local data.  Only even consider congestion policies, if our local disk is D_UP_TO_DATE.  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_actlog.c | s | 35K | 1129 | Lars Ellenberg | lars.ellenberg@linbit.com | 1336569427 |  | drbd: introduce a bio_set to allocate housekeeping bios from  Don't rely on availability of bios from the global fs_bio_set, we should use our own bio_set for meta data IO.  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_receiver.c | s | 129K | 4035 | Linus Torvalds | torvalds@linux-foundation.org | 1338393947 |  | Merge branch 'for-3.5/drivers' of git://git.kernel.dk/linux-block  Pull block driver updates from Jens Axboe:  "Here are the driver related changes for 3.5.  It contains:     - The floppy changes from Jiri.  Jiri is now also marked as the      maintainer of floppy.c, I shall be publically branding his forehead      with red hot iron at the next opportune moment.     - A batch of drbd updates and fixes from the linbit crew, as well as      fixes from others.     - Two small fixes for xen-blkfront courtesy of Jan."  * 'for-3.5/drivers' of git://git.kernel.dk/linux-block: (70 commits)   floppy: take over maintainership   floppy: remove floppy-specific O_EXCL handling   floppy: convert to delayed work and single-thread wq   xen-blkfront: module exit handling adjustments   xen-blkfront: properly name all devices   drbd: grammar fix in log message   drbd: check MODULE for THIS_MODULE   drbd: Restore the request restart logic   drbd: introduce a bio_set to allocate housekeeping bios from   drbd: remove unused define   drbd: bm_page_async_io: properly initialize page->private   drbd: use the newly introduced page pool for bitmap IO   drbd: add page pool to be used for meta data IO   drbd: allow bitmap to change during writeout from resync_finished   drbd: fix race between drbdadm invalidate/verify and finishing resync   drbd: fix resend/resubmit of frozen IO   drbd: Ensure that data_size is not 0 before using data_size-1 as index   drbd: Delay/reject other state changes while establishing a connection   drbd: move put_ldev from __req_mod() to the endio callback   drbd: fix WRITE_ACKED_BY_PEER_AND_SIS to not set RQ_NET_DONE   ...
f | Kconfig | g | 2.4K |  | Johannes Thoma | johannes.thoma@linbit.com | 1262104708 |  | drbd: Kconfig fix  !CONFIG_OPT evalues to FALSE if CONFIG_OPT='m'. Do not display the "DRBD disabled..." message if the dependencies are compiled as module.  Signed-off-by: Johannes Thoma <johannes.thoma@linbit.com> Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com>
f | drbd_bitmap.c | s | 46K | 1446 | Lars Ellenberg | lars.ellenberg@linbit.com | 1339504368 |  | drbd: fix access of unallocated pages and kernel panic  BUG: unable to handle kernel NULL pointer dereference at (null) ...  [<d1e17561>] ? _drbd_bm_set_bits+0x151/0x240 [drbd]  [<d1e236f8>] ? receive_bitmap+0x4f8/0xbc0 [drbd]  This fixes an off-by-one error in the receive_bitmap() path, if run-length encoded bitmap transfer is enabled.  If the bitmap is an exact multiple of PAGE_SIZE, which means the visible capacity of the drbd device is an exact multiple of 128 MiB (for 4k page size), and bitmap compression (use-rle) is enabled (which became default with 8.4), and the very last bit is dirty and reported in an rle comressed bitmap packet, we ended up trying to kmap_atomic a page pointer that does not exist (bitmap->bm_pages[last index + 1]).  bug introduced by:     Date:   Fri Jul 24 15:33:24 2009 +0200     set bits: optimize for complete last word, fix off-by-one-word corner case  made effective by:     Date:   Thu Dec 16 00:32:38 2010 +0100     drbd: get rid of unused debug code      Long time ago, we had paranoia code in the bitmap that allocated one     extra word, assigned a magic value, and checked on every occasion that     the magic value was still unchanged.      That debug code is unused, the extra long word complicates code a bit.     Get rid of it.  No-one triggered this bug in the last few years, because a large subset of our userbase is unaffected:  * typically the last few blocks of a device are not modified    frequently, and remain unset  * use-rle was disabled by default in drbd < 8.4  * those with slightly "odd" device sizes, or  * drbd internal meta data (which will skew the device size slightly,    thus makes it harder to have a bug relevant device size)  Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_main.c | s | 119K | 3708 | Cong Wang | xiyou.wangcong@gmail.com | 1336644054 |  | drbd: check MODULE for THIS_MODULE  THIS_MODULE is NULL only when drbd is compiled as built-in, so the #ifdef CONFIG_MODULES should be #ifdef MODULE instead.  This fixes the warning:  drivers/block/drbd/drbd_main.c: In function ‘drbd_buildtag’: drivers/block/drbd/drbd_main.c:4187:24: warning: the comparison will always evaluate as ‘true’ for the address of ‘__this_module’ will never be NULL [-Waddress]  Signed-off-by: WANG Cong <xiyou.wangcong@gmail.com> Signed-off-by: Philipp Reisner <philipp.reisner@linbit.com> Signed-off-by: Lars Ellenberg <lars.ellenberg@linbit.com>
f | drbd_vli.h | s | 11K | 301 | Lucas De Marchi | lucas.demarchi@profusion.mobi | 1301581583 |  | Fix common misspellings  Fixes generated by 'codespell' and manually reviewed.  Signed-off-by: Lucas De Marchi <lucas.demarchi@profusion.mobi>
