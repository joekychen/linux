<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › block › cciss_cmd.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>cciss_cmd.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#ifndef CCISS_CMD_H</span>
<span class="cp">#define CCISS_CMD_H</span>

<span class="cp">#include &lt;linux/cciss_defs.h&gt;</span>

<span class="cm">/* DEFINES */</span>
<span class="cp">#define CISS_VERSION &quot;1.00&quot;</span>

<span class="cm">/* general boundary definitions */</span>
<span class="cp">#define MAXSGENTRIES            32</span>
<span class="cp">#define CCISS_SG_CHAIN          0x80000000</span>
<span class="cp">#define MAXREPLYQS              256</span>

<span class="cm">/* Unit Attentions ASC&#39;s as defined for the MSA2012sa */</span>
<span class="cp">#define POWER_OR_RESET			0x29</span>
<span class="cp">#define STATE_CHANGED			0x2a</span>
<span class="cp">#define UNIT_ATTENTION_CLEARED		0x2f</span>
<span class="cp">#define LUN_FAILED			0x3e</span>
<span class="cp">#define REPORT_LUNS_CHANGED		0x3f</span>

<span class="cm">/* Unit Attentions ASCQ&#39;s as defined for the MSA2012sa */</span>

	<span class="cm">/* These ASCQ&#39;s defined for ASC = POWER_OR_RESET */</span>
<span class="cp">#define POWER_ON_RESET			0x00</span>
<span class="cp">#define POWER_ON_REBOOT			0x01</span>
<span class="cp">#define SCSI_BUS_RESET			0x02</span>
<span class="cp">#define MSA_TARGET_RESET		0x03</span>
<span class="cp">#define CONTROLLER_FAILOVER		0x04</span>
<span class="cp">#define TRANSCEIVER_SE			0x05</span>
<span class="cp">#define TRANSCEIVER_LVD			0x06</span>

	<span class="cm">/* These ASCQ&#39;s defined for ASC = STATE_CHANGED */</span>
<span class="cp">#define RESERVATION_PREEMPTED		0x03</span>
<span class="cp">#define ASYM_ACCESS_CHANGED		0x06</span>
<span class="cp">#define LUN_CAPACITY_CHANGED		0x09</span>

<span class="cm">/* config space register offsets */</span>
<span class="cp">#define CFG_VENDORID            0x00</span>
<span class="cp">#define CFG_DEVICEID            0x02</span>
<span class="cp">#define CFG_I2OBAR              0x10</span>
<span class="cp">#define CFG_MEM1BAR             0x14</span>

<span class="cm">/* i2o space register offsets */</span>
<span class="cp">#define I2O_IBDB_SET            0x20</span>
<span class="cp">#define I2O_IBDB_CLEAR          0x70</span>
<span class="cp">#define I2O_INT_STATUS          0x30</span>
<span class="cp">#define I2O_INT_MASK            0x34</span>
<span class="cp">#define I2O_IBPOST_Q            0x40</span>
<span class="cp">#define I2O_OBPOST_Q            0x44</span>
<span class="cp">#define I2O_DMA1_CFG		0x214</span>

<span class="cm">/* Configuration Table */</span>
<span class="cp">#define CFGTBL_ChangeReq        0x00000001l</span>
<span class="cp">#define CFGTBL_AccCmds          0x00000001l</span>
<span class="cp">#define DOORBELL_CTLR_RESET     0x00000004l</span>
<span class="cp">#define DOORBELL_CTLR_RESET2    0x00000020l</span>

<span class="cp">#define CFGTBL_Trans_Simple     0x00000002l</span>
<span class="cp">#define CFGTBL_Trans_Performant 0x00000004l</span>
<span class="cp">#define CFGTBL_Trans_use_short_tags 0x20000000l</span>

<span class="cp">#define CFGTBL_BusType_Ultra2   0x00000001l</span>
<span class="cp">#define CFGTBL_BusType_Ultra3   0x00000002l</span>
<span class="cp">#define CFGTBL_BusType_Fibre1G  0x00000100l</span>
<span class="cp">#define CFGTBL_BusType_Fibre2G  0x00000200l</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_vals32</span>
<span class="p">{</span>
        <span class="n">__u32</span>   <span class="n">lower</span><span class="p">;</span>
        <span class="n">__u32</span>   <span class="n">upper</span><span class="p">;</span>
<span class="p">}</span> <span class="n">vals32</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">union</span> <span class="n">_u64bit</span>
<span class="p">{</span>
   <span class="n">vals32</span>	<span class="n">val32</span><span class="p">;</span>
   <span class="n">__u64</span>	<span class="n">val</span><span class="p">;</span>
<span class="p">}</span> <span class="n">u64bit</span><span class="p">;</span>

<span class="cm">/* Type defs used in the following structs */</span>
<span class="cp">#define QWORD vals32 </span>

<span class="cm">/* STRUCTURES */</span>
<span class="cp">#define CISS_MAX_PHYS_LUN	1024</span>
<span class="cm">/* SCSI-3 Cmmands */</span>

<span class="cp">#pragma pack(1)	</span>

<span class="cp">#define CISS_INQUIRY 0x12</span>
<span class="cm">/* Date returned */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_InquiryData_struct</span>
<span class="p">{</span>
  <span class="n">BYTE</span> <span class="n">data_byte</span><span class="p">[</span><span class="mi">36</span><span class="p">];</span>
<span class="p">}</span> <span class="n">InquiryData_struct</span><span class="p">;</span>

<span class="cp">#define CISS_REPORT_LOG 0xc2    </span><span class="cm">/* Report Logical LUNs */</span><span class="cp"></span>
<span class="cp">#define CISS_REPORT_PHYS 0xc3   </span><span class="cm">/* Report Physical LUNs */</span><span class="cp"></span>
<span class="cm">/* Data returned */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_ReportLUNdata_struct</span>
<span class="p">{</span>
  <span class="n">BYTE</span> <span class="n">LUNListLength</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="n">DWORD</span> <span class="n">reserved</span><span class="p">;</span>
  <span class="n">BYTE</span> <span class="n">LUN</span><span class="p">[</span><span class="n">CISS_MAX_LUN</span><span class="p">][</span><span class="mi">8</span><span class="p">];</span>
<span class="p">}</span> <span class="n">ReportLunData_struct</span><span class="p">;</span>

<span class="cp">#define CCISS_READ_CAPACITY 0x25 </span><span class="cm">/* Read Capacity */</span><span class="cp"> </span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_ReadCapdata_struct</span>
<span class="p">{</span>
  <span class="n">BYTE</span> <span class="n">total_size</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* Total size in blocks */</span>
  <span class="n">BYTE</span> <span class="n">block_size</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>	<span class="cm">/* Size of blocks in bytes */</span>
<span class="p">}</span> <span class="n">ReadCapdata_struct</span><span class="p">;</span>

<span class="cp">#define CCISS_READ_CAPACITY_16 0x9e </span><span class="cm">/* Read Capacity 16 */</span><span class="cp"></span>

<span class="cm">/* service action to differentiate a 16 byte read capacity from</span>
<span class="cm">   other commands that use the 0x9e SCSI op code */</span>

<span class="cp">#define CCISS_READ_CAPACITY_16_SERVICE_ACT 0x10</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_ReadCapdata_struct_16</span>
<span class="p">{</span>
	<span class="n">BYTE</span> <span class="n">total_size</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>   <span class="cm">/* Total size in blocks */</span>
	<span class="n">BYTE</span> <span class="n">block_size</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>   <span class="cm">/* Size of blocks in bytes */</span>
	<span class="n">BYTE</span> <span class="n">prot_en</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>       <span class="cm">/* protection enable bit */</span>
	<span class="n">BYTE</span> <span class="n">rto_en</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>        <span class="cm">/* reference tag own enable bit */</span>
	<span class="n">BYTE</span> <span class="n">reserved</span><span class="o">:</span><span class="mi">6</span><span class="p">;</span>      <span class="cm">/* reserved bits */</span>
	<span class="n">BYTE</span> <span class="n">reserved2</span><span class="p">[</span><span class="mi">18</span><span class="p">];</span>   <span class="cm">/* reserved bytes per spec */</span>
<span class="p">}</span> <span class="n">ReadCapdata_struct_16</span><span class="p">;</span>

<span class="cm">/* Define the supported read/write commands for cciss based controllers */</span>

<span class="cp">#define CCISS_READ_10   0x28    </span><span class="cm">/* Read(10)  */</span><span class="cp"></span>
<span class="cp">#define CCISS_WRITE_10  0x2a    </span><span class="cm">/* Write(10) */</span><span class="cp"></span>
<span class="cp">#define CCISS_READ_16   0x88    </span><span class="cm">/* Read(16)  */</span><span class="cp"></span>
<span class="cp">#define CCISS_WRITE_16  0x8a    </span><span class="cm">/* Write(16) */</span><span class="cp"></span>

<span class="cm">/* Define the CDB lengths supported by cciss based controllers */</span>

<span class="cp">#define CDB_LEN10	10</span>
<span class="cp">#define CDB_LEN16	16</span>

<span class="cm">/* BMIC commands */</span>
<span class="cp">#define BMIC_READ 0x26</span>
<span class="cp">#define BMIC_WRITE 0x27</span>
<span class="cp">#define BMIC_CACHE_FLUSH 0xc2</span>
<span class="cp">#define CCISS_CACHE_FLUSH 0x01	</span><span class="cm">/* C2 was already being used by CCISS */</span><span class="cp"></span>

<span class="cp">#define CCISS_ABORT_MSG 0x00</span>
<span class="cp">#define CCISS_RESET_MSG 0x01</span>
<span class="cp">#define CCISS_RESET_TYPE_CONTROLLER 0x00</span>
<span class="cp">#define CCISS_RESET_TYPE_BUS 0x01</span>
<span class="cp">#define CCISS_RESET_TYPE_TARGET 0x03</span>
<span class="cp">#define CCISS_RESET_TYPE_LUN 0x04</span>
<span class="cp">#define CCISS_NOOP_MSG 0x03</span>

<span class="cm">/* Command List Structure */</span>
<span class="cp">#define CTLR_LUNID &quot;\0\0\0\0\0\0\0\0&quot;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_CommandListHeader_struct</span> <span class="p">{</span>
  <span class="n">BYTE</span>              <span class="n">ReplyQueue</span><span class="p">;</span>
  <span class="n">BYTE</span>              <span class="n">SGList</span><span class="p">;</span>
  <span class="n">HWORD</span>             <span class="n">SGTotal</span><span class="p">;</span>
  <span class="n">QWORD</span>             <span class="n">Tag</span><span class="p">;</span>
  <span class="n">LUNAddr_struct</span>    <span class="n">LUN</span><span class="p">;</span>
<span class="p">}</span> <span class="n">CommandListHeader_struct</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_ErrDescriptor_struct</span> <span class="p">{</span>
  <span class="n">QWORD</span>  <span class="n">Addr</span><span class="p">;</span>
  <span class="n">DWORD</span>  <span class="n">Len</span><span class="p">;</span>
<span class="p">}</span> <span class="n">ErrDescriptor_struct</span><span class="p">;</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_SGDescriptor_struct</span> <span class="p">{</span>
  <span class="n">QWORD</span>  <span class="n">Addr</span><span class="p">;</span>
  <span class="n">DWORD</span>  <span class="n">Len</span><span class="p">;</span>
  <span class="n">DWORD</span>  <span class="n">Ext</span><span class="p">;</span>
<span class="p">}</span> <span class="n">SGDescriptor_struct</span><span class="p">;</span>

<span class="cm">/* Command types */</span>
<span class="cp">#define CMD_RWREQ       0x00</span>
<span class="cp">#define CMD_IOCTL_PEND  0x01</span>
<span class="cp">#define CMD_SCSI	0x03</span>
<span class="cp">#define CMD_MSG_DONE	0x04</span>
<span class="cp">#define CMD_MSG_TIMEOUT 0x05</span>
<span class="cp">#define CMD_MSG_STALE	0xff</span>

<span class="cm">/* This structure needs to be divisible by COMMANDLIST_ALIGNMENT</span>
<span class="cm"> * because low bits of the address are used to to indicate that</span>
<span class="cm"> * whether the tag contains an index or an address.  PAD_32 and</span>
<span class="cm"> * PAD_64 can be adjusted independently as needed for 32-bit</span>
<span class="cm"> * and 64-bits systems.</span>
<span class="cm"> */</span>
<span class="cp">#define COMMANDLIST_ALIGNMENT (32)</span>
<span class="cp">#define IS_64_BIT ((sizeof(long) - 4)/4)</span>
<span class="cp">#define IS_32_BIT (!IS_64_BIT)</span>
<span class="cp">#define PAD_32 (0)</span>
<span class="cp">#define PAD_64 (4)</span>
<span class="cp">#define PADSIZE (IS_32_BIT * PAD_32 + IS_64_BIT * PAD_64)</span>
<span class="cp">#define DIRECT_LOOKUP_BIT 0x10</span>
<span class="cp">#define DIRECT_LOOKUP_SHIFT 5</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_CommandList_struct</span> <span class="p">{</span>
  <span class="n">CommandListHeader_struct</span> <span class="n">Header</span><span class="p">;</span>
  <span class="n">RequestBlock_struct</span>      <span class="n">Request</span><span class="p">;</span>
  <span class="n">ErrDescriptor_struct</span>     <span class="n">ErrDesc</span><span class="p">;</span>
  <span class="n">SGDescriptor_struct</span>      <span class="n">SG</span><span class="p">[</span><span class="n">MAXSGENTRIES</span><span class="p">];</span>
	<span class="cm">/* information associated with the command */</span> 
  <span class="n">__u32</span>			   <span class="n">busaddr</span><span class="p">;</span> <span class="cm">/* physical address of this record */</span>
  <span class="n">ErrorInfo_struct</span> <span class="o">*</span> 	   <span class="n">err_info</span><span class="p">;</span> <span class="cm">/* pointer to the allocated mem */</span> 
  <span class="kt">int</span>			   <span class="n">ctlr</span><span class="p">;</span>
  <span class="kt">int</span>			   <span class="n">cmd_type</span><span class="p">;</span> 
  <span class="kt">long</span>			   <span class="n">cmdindex</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">request</span> <span class="o">*</span>	   <span class="n">rq</span><span class="p">;</span>
  <span class="k">struct</span> <span class="n">completion</span> <span class="o">*</span><span class="n">waiting</span><span class="p">;</span>
  <span class="kt">int</span>	 <span class="n">retry_count</span><span class="p">;</span>
  <span class="kt">void</span> <span class="o">*</span> <span class="n">scsi_cmd</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">pad</span><span class="p">[</span><span class="n">PADSIZE</span><span class="p">];</span>
<span class="p">}</span> <span class="n">CommandList_struct</span><span class="p">;</span>

<span class="cm">/* Configuration Table Structure */</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_HostWrite_struct</span> <span class="p">{</span>
  <span class="n">DWORD</span> <span class="n">TransportRequest</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">Reserved</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">CoalIntDelay</span><span class="p">;</span>
  <span class="n">DWORD</span> <span class="n">CoalIntCount</span><span class="p">;</span>
<span class="p">}</span> <span class="n">HostWrite_struct</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_CfgTable_struct</span> <span class="p">{</span>
  <span class="n">BYTE</span>             <span class="n">Signature</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
  <span class="n">DWORD</span>            <span class="n">SpecValence</span><span class="p">;</span>
<span class="cp">#define SIMPLE_MODE	0x02</span>
<span class="cp">#define PERFORMANT_MODE	0x04</span>
<span class="cp">#define MEMQ_MODE	0x08</span>
  <span class="n">DWORD</span>            <span class="n">TransportSupport</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">TransportActive</span><span class="p">;</span>
  <span class="n">HostWrite_struct</span> <span class="n">HostWrite</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">CmdsOutMax</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">BusTypes</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">TransMethodOffset</span><span class="p">;</span>
  <span class="n">BYTE</span>             <span class="n">ServerName</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
  <span class="n">DWORD</span>            <span class="n">HeartBeat</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">SCSI_Prefetch</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">MaxSGElements</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">MaxLogicalUnits</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">MaxPhysicalDrives</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">MaxPhysicalDrivesPerLogicalUnit</span><span class="p">;</span>
  <span class="n">DWORD</span>            <span class="n">MaxPerformantModeCommands</span><span class="p">;</span>
  <span class="n">u8</span>		   <span class="n">reserved</span><span class="p">[</span><span class="mh">0x78</span> <span class="o">-</span> <span class="mh">0x58</span><span class="p">];</span>
  <span class="n">u32</span>		   <span class="n">misc_fw_support</span><span class="p">;</span> <span class="cm">/* offset 0x78 */</span>
<span class="cp">#define MISC_FW_DOORBELL_RESET (0x02)</span>
<span class="cp">#define MISC_FW_DOORBELL_RESET2 (0x10)</span>
	<span class="n">u8</span>	   <span class="n">driver_version</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">}</span> <span class="n">CfgTable_struct</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">TransTable_struct</span> <span class="p">{</span>
  <span class="n">u32</span> <span class="n">BlockFetch0</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">BlockFetch1</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">BlockFetch2</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">BlockFetch3</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">BlockFetch4</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">BlockFetch5</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">BlockFetch6</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">BlockFetch7</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">RepQSize</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">RepQCount</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">RepQCtrAddrLow32</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">RepQCtrAddrHigh32</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">RepQAddr0Low32</span><span class="p">;</span>
  <span class="n">u32</span> <span class="n">RepQAddr0High32</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#pragma pack()	 </span>
<span class="cp">#endif </span><span class="cm">/* CCISS_CMD_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
