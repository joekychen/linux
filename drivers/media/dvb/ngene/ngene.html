<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › ngene › ngene.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ngene.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * ngene.h: nGene PCIe bridge driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2005-2007 Micronas</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * version 2 only, as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span>
<span class="cm"> * 02110-1301, USA</span>
<span class="cm"> * Or, point your browser to http://www.gnu.org/copyleft/gpl.html</span>
<span class="cm"> */</span>

<span class="cp">#ifndef _NGENE_H_</span>
<span class="cp">#define _NGENE_H_</span>

<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/interrupt.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;asm/dma.h&gt;</span>
<span class="cp">#include &lt;linux/scatterlist.h&gt;</span>

<span class="cp">#include &lt;linux/dvb/frontend.h&gt;</span>

<span class="cp">#include &quot;dmxdev.h&quot;</span>
<span class="cp">#include &quot;dvbdev.h&quot;</span>
<span class="cp">#include &quot;dvb_demux.h&quot;</span>
<span class="cp">#include &quot;dvb_ca_en50221.h&quot;</span>
<span class="cp">#include &quot;dvb_frontend.h&quot;</span>
<span class="cp">#include &quot;dvb_ringbuffer.h&quot;</span>
<span class="cp">#include &quot;dvb_net.h&quot;</span>
<span class="cp">#include &quot;cxd2099.h&quot;</span>

<span class="cp">#define DEVICE_NAME &quot;ngene&quot;</span>

<span class="cp">#define NGENE_VID       0x18c3</span>
<span class="cp">#define NGENE_PID       0x0720</span>

<span class="cp">#ifndef VIDEO_CAP_VC1</span>
<span class="cp">#define VIDEO_CAP_AVC   128</span>
<span class="cp">#define VIDEO_CAP_H264  128</span>
<span class="cp">#define VIDEO_CAP_VC1   256</span>
<span class="cp">#define VIDEO_CAP_WMV9  256</span>
<span class="cp">#define VIDEO_CAP_MPEG4 512</span>
<span class="cp">#endif</span>

<span class="k">enum</span> <span class="n">STREAM</span> <span class="p">{</span>
	<span class="n">STREAM_VIDEOIN1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>        <span class="cm">/* ITU656 or TS Input */</span>
	<span class="n">STREAM_VIDEOIN2</span><span class="p">,</span>
	<span class="n">STREAM_AUDIOIN1</span><span class="p">,</span>            <span class="cm">/* I2S or SPI Input */</span>
	<span class="n">STREAM_AUDIOIN2</span><span class="p">,</span>
	<span class="n">STREAM_AUDIOOUT</span><span class="p">,</span>
	<span class="n">MAX_STREAM</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">SMODE_BITS</span> <span class="p">{</span>
	<span class="n">SMODE_AUDIO_SPDIF</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">SMODE_AVSYNC</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">SMODE_TRANSPORT_STREAM</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">SMODE_AUDIO_CAPTURE</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">SMODE_VBI_CAPTURE</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">SMODE_VIDEO_CAPTURE</span> <span class="o">=</span> <span class="mh">0x01</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">STREAM_FLAG_BITS</span> <span class="p">{</span>
	<span class="n">SFLAG_CHROMA_FORMAT_2COMP</span>  <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span> <span class="cm">/* Chroma Format : 2&#39;s complement */</span>
	<span class="n">SFLAG_CHROMA_FORMAT_OFFSET</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* Chroma Format : Binary offset */</span>
	<span class="n">SFLAG_ORDER_LUMA_CHROMA</span>    <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span> <span class="cm">/* Byte order: Y,Cb,Y,Cr */</span>
	<span class="n">SFLAG_ORDER_CHROMA_LUMA</span>    <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* Byte order: Cb,Y,Cr,Y */</span>
	<span class="n">SFLAG_COLORBAR</span>             <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span> <span class="cm">/* Select colorbar */</span>
<span class="p">};</span>

<span class="cp">#define PROGRAM_ROM     0x0000</span>
<span class="cp">#define PROGRAM_SRAM    0x1000</span>
<span class="cp">#define PERIPHERALS0    0x8000</span>
<span class="cp">#define PERIPHERALS1    0x9000</span>
<span class="cp">#define SHARED_BUFFER   0xC000</span>

<span class="cp">#define HOST_TO_NGENE    (SHARED_BUFFER+0x0000)</span>
<span class="cp">#define NGENE_TO_HOST    (SHARED_BUFFER+0x0100)</span>
<span class="cp">#define NGENE_COMMAND    (SHARED_BUFFER+0x0200)</span>
<span class="cp">#define NGENE_COMMAND_HI (SHARED_BUFFER+0x0204)</span>
<span class="cp">#define NGENE_STATUS     (SHARED_BUFFER+0x0208)</span>
<span class="cp">#define NGENE_STATUS_HI  (SHARED_BUFFER+0x020C)</span>
<span class="cp">#define NGENE_EVENT      (SHARED_BUFFER+0x0210)</span>
<span class="cp">#define NGENE_EVENT_HI   (SHARED_BUFFER+0x0214)</span>
<span class="cp">#define VARIABLES        (SHARED_BUFFER+0x0210)</span>

<span class="cp">#define NGENE_INT_COUNTS       (SHARED_BUFFER+0x0260)</span>
<span class="cp">#define NGENE_INT_ENABLE       (SHARED_BUFFER+0x0264)</span>
<span class="cp">#define NGENE_VBI_LINE_COUNT   (SHARED_BUFFER+0x0268)</span>

<span class="cp">#define BUFFER_GP_XMIT  (SHARED_BUFFER+0x0800)</span>
<span class="cp">#define BUFFER_GP_RECV  (SHARED_BUFFER+0x0900)</span>
<span class="cp">#define EEPROM_AREA     (SHARED_BUFFER+0x0A00)</span>

<span class="cp">#define SG_V_IN_1       (SHARED_BUFFER+0x0A80)</span>
<span class="cp">#define SG_VBI_1        (SHARED_BUFFER+0x0B00)</span>
<span class="cp">#define SG_A_IN_1       (SHARED_BUFFER+0x0B80)</span>
<span class="cp">#define SG_V_IN_2       (SHARED_BUFFER+0x0C00)</span>
<span class="cp">#define SG_VBI_2        (SHARED_BUFFER+0x0C80)</span>
<span class="cp">#define SG_A_IN_2       (SHARED_BUFFER+0x0D00)</span>
<span class="cp">#define SG_V_OUT        (SHARED_BUFFER+0x0D80)</span>
<span class="cp">#define SG_A_OUT2       (SHARED_BUFFER+0x0E00)</span>

<span class="cp">#define DATA_A_IN_1     (SHARED_BUFFER+0x0E80)</span>
<span class="cp">#define DATA_A_IN_2     (SHARED_BUFFER+0x0F00)</span>
<span class="cp">#define DATA_A_OUT      (SHARED_BUFFER+0x0F80)</span>
<span class="cp">#define DATA_V_IN_1     (SHARED_BUFFER+0x1000)</span>
<span class="cp">#define DATA_V_IN_2     (SHARED_BUFFER+0x2000)</span>
<span class="cp">#define DATA_V_OUT      (SHARED_BUFFER+0x3000)</span>

<span class="cp">#define DATA_FIFO_AREA  (SHARED_BUFFER+0x1000)</span>

<span class="cp">#define TIMESTAMPS      0xA000</span>
<span class="cp">#define SCRATCHPAD      0xA080</span>
<span class="cp">#define FORCE_INT       0xA088</span>
<span class="cp">#define FORCE_NMI       0xA090</span>
<span class="cp">#define INT_STATUS      0xA0A0</span>

<span class="cp">#define DEV_VER         0x9004</span>

<span class="cp">#define FW_DEBUG_DEFAULT (PROGRAM_SRAM+0x00FF)</span>

<span class="k">struct</span> <span class="n">SG_ADDR</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">start</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">curr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">curr_ptr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">elements</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pad</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">SHARED_MEMORY</span> <span class="p">{</span>
	<span class="cm">/* C000 */</span>
	<span class="n">u32</span> <span class="n">HostToNgene</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

	<span class="cm">/* C100 */</span>
	<span class="n">u32</span> <span class="n">NgeneToHost</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>

	<span class="cm">/* C200 */</span>
	<span class="n">u64</span> <span class="n">NgeneCommand</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">NgeneStatus</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">NgeneEvent</span><span class="p">;</span>

	<span class="cm">/* C210 */</span>
	<span class="n">u8</span> <span class="n">pad1</span><span class="p">[</span><span class="mh">0xc260</span> <span class="o">-</span> <span class="mh">0xc218</span><span class="p">];</span>

	<span class="cm">/* C260 */</span>
	<span class="n">u32</span> <span class="n">IntCounts</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">IntEnable</span><span class="p">;</span>

	<span class="cm">/* C268 */</span>
	<span class="n">u8</span> <span class="n">pad2</span><span class="p">[</span><span class="mh">0xd000</span> <span class="o">-</span> <span class="mh">0xc268</span><span class="p">];</span>

<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">BUFFER_STREAM_RESULTS</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">Clock</span><span class="p">;</span>           <span class="cm">/* Stream time in 100ns units */</span>
	<span class="n">u16</span> <span class="n">RemainingLines</span><span class="p">;</span>  <span class="cm">/* Remaining lines in this field.</span>
<span class="cm">				0 for complete field */</span>
	<span class="n">u8</span>  <span class="n">FieldCount</span><span class="p">;</span>      <span class="cm">/* Video field number */</span>
	<span class="n">u8</span>  <span class="n">Flags</span><span class="p">;</span>           <span class="cm">/* Bit 7 = Done, Bit 6 = seen, Bit 5 = overflow,</span>
<span class="cm">				Bit 0 = FieldID */</span>
	<span class="n">u16</span> <span class="n">BlockCount</span><span class="p">;</span>      <span class="cm">/* Audio block count (unused) */</span>
	<span class="n">u8</span>  <span class="n">Reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">DTOUpdate</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">HW_SCATTER_GATHER_ELEMENT</span> <span class="p">{</span>
	<span class="n">u64</span> <span class="n">Address</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">Length</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">Reserved</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">BUFFER_HEADER</span> <span class="p">{</span>
	<span class="n">u64</span>    <span class="n">Next</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">BUFFER_STREAM_RESULTS</span> <span class="n">SR</span><span class="p">;</span>

	<span class="n">u32</span>    <span class="n">Number_of_entries_1</span><span class="p">;</span>
	<span class="n">u32</span>    <span class="n">Reserved5</span><span class="p">;</span>
	<span class="n">u64</span>    <span class="n">Address_of_first_entry_1</span><span class="p">;</span>

	<span class="n">u32</span>    <span class="n">Number_of_entries_2</span><span class="p">;</span>
	<span class="n">u32</span>    <span class="n">Reserved7</span><span class="p">;</span>
	<span class="n">u64</span>    <span class="n">Address_of_first_entry_2</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">EVENT_BUFFER</span> <span class="p">{</span>
	<span class="n">u32</span>    <span class="n">TimeStamp</span><span class="p">;</span>
	<span class="n">u8</span>     <span class="n">GPIOStatus</span><span class="p">;</span>
	<span class="n">u8</span>     <span class="n">UARTStatus</span><span class="p">;</span>
	<span class="n">u8</span>     <span class="n">RXCharacter</span><span class="p">;</span>
	<span class="n">u8</span>     <span class="n">EventStatus</span><span class="p">;</span>
	<span class="n">u32</span>    <span class="n">Reserved</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="cm">/* Firmware commands. */</span>

<span class="k">enum</span> <span class="n">OPCODES</span> <span class="p">{</span>
	<span class="n">CMD_NOP</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">CMD_FWLOAD_PREPARE</span>  <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">CMD_FWLOAD_FINISH</span>   <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">CMD_I2C_READ</span>        <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">CMD_I2C_WRITE</span>       <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>

	<span class="n">CMD_I2C_WRITE_NOSTOP</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">CMD_I2C_CONTINUE_WRITE</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="n">CMD_I2C_CONTINUE_WRITE_NOSTOP</span> <span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>

	<span class="n">CMD_DEBUG_OUTPUT</span>    <span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>

	<span class="n">CMD_CONTROL</span>         <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">CMD_CONFIGURE_BUFFER</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="n">CMD_CONFIGURE_FREE_BUFFER</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span>

	<span class="n">CMD_SPI_READ</span>        <span class="o">=</span> <span class="mh">0x13</span><span class="p">,</span>
	<span class="n">CMD_SPI_WRITE</span>       <span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>

	<span class="n">CMD_MEM_READ</span>        <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">CMD_MEM_WRITE</span>	    <span class="o">=</span> <span class="mh">0x21</span><span class="p">,</span>
	<span class="n">CMD_SFR_READ</span>	    <span class="o">=</span> <span class="mh">0x22</span><span class="p">,</span>
	<span class="n">CMD_SFR_WRITE</span>	    <span class="o">=</span> <span class="mh">0x23</span><span class="p">,</span>
	<span class="n">CMD_IRAM_READ</span>	    <span class="o">=</span> <span class="mh">0x24</span><span class="p">,</span>
	<span class="n">CMD_IRAM_WRITE</span>	    <span class="o">=</span> <span class="mh">0x25</span><span class="p">,</span>
	<span class="n">CMD_SET_GPIO_PIN</span>    <span class="o">=</span> <span class="mh">0x26</span><span class="p">,</span>
	<span class="n">CMD_SET_GPIO_INT</span>    <span class="o">=</span> <span class="mh">0x27</span><span class="p">,</span>
	<span class="n">CMD_CONFIGURE_UART</span>  <span class="o">=</span> <span class="mh">0x28</span><span class="p">,</span>
	<span class="n">CMD_WRITE_UART</span>      <span class="o">=</span> <span class="mh">0x29</span><span class="p">,</span>
	<span class="n">MAX_CMD</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">RESPONSES</span> <span class="p">{</span>
	<span class="n">OK</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">ERROR</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">Opcode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Length</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_I2C_WRITE</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Device</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Data</span><span class="p">[</span><span class="mi">250</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_I2C_CONTINUE_WRITE</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Data</span><span class="p">[</span><span class="mi">250</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_I2C_READ</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Device</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Data</span><span class="p">[</span><span class="mi">252</span><span class="p">];</span>    <span class="cm">/* followed by two bytes of read data count */</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_SPI_WRITE</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ModeSelect</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Data</span><span class="p">[</span><span class="mi">250</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_SPI_READ</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ModeSelect</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Data</span><span class="p">[</span><span class="mi">252</span><span class="p">];</span>    <span class="cm">/* followed by two bytes of read data count */</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_FWLOAD_PREPARE</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_FWLOAD_FINISH</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">Address</span><span class="p">;</span>     <span class="cm">/* address of final block */</span>
	<span class="n">u16</span> <span class="n">Length</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="cm">/*</span>
<span class="cm"> * Meaning of FW_STREAM_CONTROL::Mode bits:</span>
<span class="cm"> *  Bit 7: Loopback PEXin to PEXout using TVOut channel</span>
<span class="cm"> *  Bit 6: AVLOOP</span>
<span class="cm"> *  Bit 5: Audio select; 0=I2S, 1=SPDIF</span>
<span class="cm"> *  Bit 4: AVSYNC</span>
<span class="cm"> *  Bit 3: Enable transport stream</span>
<span class="cm"> *  Bit 2: Enable audio capture</span>
<span class="cm"> *  Bit 1: Enable ITU-Video VBI capture</span>
<span class="cm"> *  Bit 0: Enable ITU-Video capture</span>
<span class="cm"> *</span>
<span class="cm"> * Meaning of FW_STREAM_CONTROL::Control bits (see UVI1_CTL)</span>
<span class="cm"> *  Bit 7: continuous capture</span>
<span class="cm"> *  Bit 6: capture one field</span>
<span class="cm"> *  Bit 5: capture one frame</span>
<span class="cm"> *  Bit 4: unused</span>
<span class="cm"> *  Bit 3: starting field; 0=odd, 1=even</span>
<span class="cm"> *  Bit 2: sample size; 0=8-bit, 1=10-bit</span>
<span class="cm"> *  Bit 1: data format; 0=UYVY, 1=YUY2</span>
<span class="cm"> *  Bit 0: resets buffer pointers</span>
<span class="cm">*/</span>

<span class="k">enum</span> <span class="n">FSC_MODE_BITS</span> <span class="p">{</span>
	<span class="n">SMODE_LOOPBACK</span>          <span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="n">SMODE_AVLOOP</span>            <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">_SMODE_AUDIO_SPDIF</span>      <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">_SMODE_AVSYNC</span>           <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">_SMODE_TRANSPORT_STREAM</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">_SMODE_AUDIO_CAPTURE</span>    <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">_SMODE_VBI_CAPTURE</span>      <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">_SMODE_VIDEO_CAPTURE</span>    <span class="o">=</span> <span class="mh">0x01</span>
<span class="p">};</span>


<span class="cm">/* Meaning of FW_STREAM_CONTROL::Stream bits:</span>
<span class="cm"> * Bit 3: Audio sample count:  0 = relative, 1 = absolute</span>
<span class="cm"> * Bit 2: color bar select; 1=color bars, 0=CV3 decoder</span>
<span class="cm"> * Bits 1-0: stream select, UVI1, UVI2, TVOUT</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">FW_STREAM_CONTROL</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span>     <span class="n">Stream</span><span class="p">;</span>             <span class="cm">/* Stream number (UVI1, UVI2, TVOUT) */</span>
	<span class="n">u8</span>     <span class="n">Control</span><span class="p">;</span>            <span class="cm">/* Value written to UVI1_CTL */</span>
	<span class="n">u8</span>     <span class="n">Mode</span><span class="p">;</span>               <span class="cm">/* Controls clock source */</span>
	<span class="n">u8</span>     <span class="n">SetupDataLen</span><span class="p">;</span>	   <span class="cm">/* Length of setup data, MSB=1 write</span>
<span class="cm">				      backwards */</span>
	<span class="n">u16</span>    <span class="n">CaptureBlockCount</span><span class="p">;</span>  <span class="cm">/* Blocks (a 256 Bytes) to capture per buffer</span>
<span class="cm">				      for TS and Audio */</span>
	<span class="n">u64</span>    <span class="n">Buffer_Address</span><span class="p">;</span>	   <span class="cm">/* Address of first buffer header */</span>
	<span class="n">u16</span>    <span class="n">BytesPerVideoLine</span><span class="p">;</span>
	<span class="n">u16</span>    <span class="n">MaxLinesPerField</span><span class="p">;</span>
	<span class="n">u16</span>    <span class="n">MinLinesPerField</span><span class="p">;</span>
	<span class="n">u16</span>    <span class="n">Reserved_1</span><span class="p">;</span>
	<span class="n">u16</span>    <span class="n">BytesPerVBILine</span><span class="p">;</span>
	<span class="n">u16</span>    <span class="n">MaxVBILinesPerField</span><span class="p">;</span>
	<span class="n">u16</span>    <span class="n">MinVBILinesPerField</span><span class="p">;</span>
	<span class="n">u16</span>    <span class="n">SetupDataAddr</span><span class="p">;</span>      <span class="cm">/* ngene relative address of setup data */</span>
	<span class="n">u8</span>     <span class="n">SetupData</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>      <span class="cm">/* setup data */</span>
<span class="p">}</span> <span class="n">__attribute__</span><span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="cp">#define AUDIO_BLOCK_SIZE    256</span>
<span class="cp">#define TS_BLOCK_SIZE       256</span>

<span class="k">struct</span> <span class="n">FW_MEM_READ</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u16</span>   <span class="n">address</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_MEM_WRITE</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u16</span>   <span class="n">address</span><span class="p">;</span>
	<span class="n">u8</span>    <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_SFR_IRAM_READ</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span>    <span class="n">address</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_SFR_IRAM_WRITE</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span>    <span class="n">address</span><span class="p">;</span>
	<span class="n">u8</span>    <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_SET_GPIO_PIN</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span>    <span class="n">select</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_SET_GPIO_INT</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span>    <span class="n">select</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_SET_DEBUGMODE</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">debug_flags</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_CONFIGURE_BUFFERS</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">config</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">enum</span> <span class="n">_BUFFER_CONFIGS</span> <span class="p">{</span>
	<span class="cm">/* 4k UVI1, 4k UVI2, 2k AUD1, 2k AUD2  (standard usage) */</span>
	<span class="n">BUFFER_CONFIG_4422</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="cm">/* 3k UVI1, 3k UVI2, 3k AUD1, 3k AUD2  (4x TS input usage) */</span>
	<span class="n">BUFFER_CONFIG_3333</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="cm">/* 8k UVI1, 0k UVI2, 2k AUD1, 2k I2SOut  (HDTV decoder usage) */</span>
	<span class="n">BUFFER_CONFIG_8022</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">BUFFER_CONFIG_FW17</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span> <span class="cm">/* Use new FW 17 command */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">FW_CONFIGURE_FREE_BUFFERS</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">UVI1_BufferLength</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">UVI2_BufferLength</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">TVO_BufferLength</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">AUD1_BufferLength</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">AUD2_BufferLength</span><span class="p">;</span>
	<span class="n">u8</span>   <span class="n">TVA_BufferLength</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">struct</span> <span class="n">FW_CONFIGURE_UART</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">UartControl</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="k">enum</span> <span class="n">_UART_CONFIG</span> <span class="p">{</span>
	<span class="n">_UART_BAUDRATE_19200</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">_UART_BAUDRATE_9600</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">_UART_BAUDRATE_4800</span>  <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="n">_UART_BAUDRATE_2400</span>  <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="n">_UART_RX_ENABLE</span>      <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">_UART_TX_ENABLE</span>      <span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">FW_WRITE_UART</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">FW_HEADER</span> <span class="n">hdr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">Data</span><span class="p">[</span><span class="mi">252</span><span class="p">];</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>


<span class="k">struct</span> <span class="n">ngene_command</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">in_len</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">out_len</span><span class="p">;</span>
	<span class="k">union</span> <span class="p">{</span>
		<span class="n">u32</span>                              <span class="n">raw</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
		<span class="n">u8</span>                               <span class="n">raw8</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>
		<span class="k">struct</span> <span class="n">FW_HEADER</span>                 <span class="n">hdr</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_I2C_WRITE</span>              <span class="n">I2CWrite</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_I2C_CONTINUE_WRITE</span>     <span class="n">I2CContinueWrite</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_I2C_READ</span>               <span class="n">I2CRead</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_STREAM_CONTROL</span>         <span class="n">StreamControl</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_FWLOAD_PREPARE</span>         <span class="n">FWLoadPrepare</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_FWLOAD_FINISH</span>          <span class="n">FWLoadFinish</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_MEM_READ</span>		 <span class="n">MemoryRead</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_MEM_WRITE</span>		 <span class="n">MemoryWrite</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_SFR_IRAM_READ</span>		 <span class="n">SfrIramRead</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_SFR_IRAM_WRITE</span>         <span class="n">SfrIramWrite</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_SPI_WRITE</span>              <span class="n">SPIWrite</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_SPI_READ</span>               <span class="n">SPIRead</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_SET_GPIO_PIN</span>           <span class="n">SetGpioPin</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_SET_GPIO_INT</span>           <span class="n">SetGpioInt</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_SET_DEBUGMODE</span>          <span class="n">SetDebugMode</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_CONFIGURE_BUFFERS</span>      <span class="n">ConfigureBuffers</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_CONFIGURE_FREE_BUFFERS</span> <span class="n">ConfigureFreeBuffers</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_CONFIGURE_UART</span>         <span class="n">ConfigureUart</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">FW_WRITE_UART</span>             <span class="n">WriteUart</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">cmd</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__attribute__</span> <span class="p">((</span><span class="n">__packed__</span><span class="p">));</span>

<span class="cp">#define NGENE_INTERFACE_VERSION 0x103</span>
<span class="cp">#define MAX_VIDEO_BUFFER_SIZE   (417792) </span><span class="cm">/* 288*1440 rounded up to next page */</span><span class="cp"></span>
<span class="cp">#define MAX_AUDIO_BUFFER_SIZE     (8192) </span><span class="cm">/* Gives room for about 23msec@48KHz */</span><span class="cp"></span>
<span class="cp">#define MAX_VBI_BUFFER_SIZE      (28672) </span><span class="cm">/* 1144*18 rounded up to next page */</span><span class="cp"></span>
<span class="cp">#define MAX_TS_BUFFER_SIZE       (98304) </span><span class="cm">/* 512*188 rounded up to next page */</span><span class="cp"></span>
<span class="cp">#define MAX_HDTV_BUFFER_SIZE   (2080768) </span><span class="cm">/* 541*1920*2 rounded up to next page</span>
<span class="cm">					    Max: (1920x1080i60) */</span><span class="cp"></span>

<span class="cp">#define OVERFLOW_BUFFER_SIZE    (8192)</span>

<span class="cp">#define RING_SIZE_VIDEO     4</span>
<span class="cp">#define RING_SIZE_AUDIO     8</span>
<span class="cp">#define RING_SIZE_TS        8</span>

<span class="cp">#define NUM_SCATTER_GATHER_ENTRIES  8</span>

<span class="cp">#define MAX_DMA_LENGTH (((MAX_VIDEO_BUFFER_SIZE + MAX_VBI_BUFFER_SIZE) * \</span>
<span class="cp">			RING_SIZE_VIDEO * 2) + \</span>
<span class="cp">			(MAX_AUDIO_BUFFER_SIZE * RING_SIZE_AUDIO * 2) + \</span>
<span class="cp">			(MAX_TS_BUFFER_SIZE * RING_SIZE_TS * 4) + \</span>
<span class="cp">			(RING_SIZE_VIDEO * PAGE_SIZE * 2) + \</span>
<span class="cp">			(RING_SIZE_AUDIO * PAGE_SIZE * 2) + \</span>
<span class="cp">			(RING_SIZE_TS    * PAGE_SIZE * 4) + \</span>
<span class="cp">			 8 * PAGE_SIZE + OVERFLOW_BUFFER_SIZE + PAGE_SIZE)</span>

<span class="cp">#define EVENT_QUEUE_SIZE    16</span>

<span class="cm">/* Gathers the current state of a single channel. */</span>

<span class="k">struct</span> <span class="n">SBufferHeader</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">BUFFER_HEADER</span>   <span class="n">ngeneBuffer</span><span class="p">;</span> <span class="cm">/* Physical descriptor */</span>
	<span class="k">struct</span> <span class="n">SBufferHeader</span>  <span class="o">*</span><span class="n">Next</span><span class="p">;</span>
	<span class="kt">void</span>                  <span class="o">*</span><span class="n">Buffer1</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">HW_SCATTER_GATHER_ELEMENT</span> <span class="o">*</span><span class="n">scList1</span><span class="p">;</span>
	<span class="kt">void</span>                  <span class="o">*</span><span class="n">Buffer2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">HW_SCATTER_GATHER_ELEMENT</span> <span class="o">*</span><span class="n">scList2</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Sizeof SBufferHeader aligned to next 64 Bit boundary (hw restriction) */</span>
<span class="cp">#define SIZEOF_SBufferHeader ((sizeof(struct SBufferHeader) + 63) &amp; ~63)</span>

<span class="k">enum</span> <span class="n">HWSTATE</span> <span class="p">{</span>
	<span class="n">HWSTATE_STOP</span><span class="p">,</span>
	<span class="n">HWSTATE_STARTUP</span><span class="p">,</span>
	<span class="n">HWSTATE_RUN</span><span class="p">,</span>
	<span class="n">HWSTATE_PAUSE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">KSSTATE</span> <span class="p">{</span>
	<span class="n">KSSTATE_STOP</span><span class="p">,</span>
	<span class="n">KSSTATE_ACQUIRE</span><span class="p">,</span>
	<span class="n">KSSTATE_PAUSE</span><span class="p">,</span>
	<span class="n">KSSTATE_RUN</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SRingBufferDescriptor</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">SBufferHeader</span> <span class="o">*</span><span class="n">Head</span><span class="p">;</span> <span class="cm">/* Points to first buffer in ring buffer</span>
<span class="cm">				       structure*/</span>
	<span class="n">u64</span>   <span class="n">PAHead</span><span class="p">;</span>         <span class="cm">/* Physical address of first buffer */</span>
	<span class="n">u32</span>   <span class="n">MemSize</span><span class="p">;</span>        <span class="cm">/* Memory size of allocated ring buffers</span>
<span class="cm">				 (needed for freeing) */</span>
	<span class="n">u32</span>   <span class="n">NumBuffers</span><span class="p">;</span>     <span class="cm">/* Number of buffers in the ring */</span>
	<span class="n">u32</span>   <span class="n">Buffer1Length</span><span class="p">;</span>  <span class="cm">/* Allocated length of Buffer 1 */</span>
	<span class="n">u32</span>   <span class="n">Buffer2Length</span><span class="p">;</span>  <span class="cm">/* Allocated length of Buffer 2 */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">SCListMem</span><span class="p">;</span>      <span class="cm">/* Memory to hold scatter gather lists for this</span>
<span class="cm">				 ring */</span>
	<span class="n">u64</span>   <span class="n">PASCListMem</span><span class="p">;</span>    <span class="cm">/* Physical address  .. */</span>
	<span class="n">u32</span>   <span class="n">SCListMemSize</span><span class="p">;</span>  <span class="cm">/* Size of this memory */</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">STREAMMODEFLAGS</span> <span class="p">{</span>
	<span class="n">StreamMode_NONE</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* Stream not used */</span>
	<span class="n">StreamMode_ANALOG</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="cm">/* Analog: Stream 0,1 = Video, 2,3 = Audio */</span>
	<span class="n">StreamMode_TSIN</span>   <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="cm">/* Transport stream input (all) */</span>
	<span class="n">StreamMode_HDTV</span>   <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="cm">/* HDTV: Maximum 1920x1080p30,1920x1080i60</span>
<span class="cm">				  (only stream 0) */</span>
	<span class="n">StreamMode_TSOUT</span>  <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="cm">/* Transport stream output (only stream 3) */</span>
<span class="p">};</span>


<span class="k">enum</span> <span class="n">BufferExchangeFlags</span> <span class="p">{</span>
	<span class="n">BEF_EVEN_FIELD</span>   <span class="o">=</span> <span class="mh">0x00000001</span><span class="p">,</span>
	<span class="n">BEF_CONTINUATION</span> <span class="o">=</span> <span class="mh">0x00000002</span><span class="p">,</span>
	<span class="n">BEF_MORE_DATA</span>    <span class="o">=</span> <span class="mh">0x00000004</span><span class="p">,</span>
	<span class="n">BEF_OVERFLOW</span>     <span class="o">=</span> <span class="mh">0x00000008</span><span class="p">,</span>
	<span class="n">DF_SWAP32</span>        <span class="o">=</span> <span class="mh">0x00010000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="kt">void</span> <span class="o">*</span><span class="p">(</span><span class="n">IBufferExchange</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">MICI_STREAMINFO</span> <span class="p">{</span>
	<span class="n">IBufferExchange</span>    <span class="o">*</span><span class="n">pExchange</span><span class="p">;</span>
	<span class="n">IBufferExchange</span>    <span class="o">*</span><span class="n">pExchangeVBI</span><span class="p">;</span>     <span class="cm">/* Secondary (VBI, ancillary) */</span>
	<span class="n">u8</span>  <span class="n">Stream</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">Flags</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">Mode</span><span class="p">;</span>
	<span class="n">u8</span>  <span class="n">Reserved</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">nLinesVideo</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">nBytesPerLineVideo</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">nLinesVBI</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">nBytesPerLineVBI</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">CaptureLength</span><span class="p">;</span>    <span class="cm">/* Used for audio and transport stream */</span>
<span class="p">};</span>

<span class="cm">/****************************************************************************/</span>
<span class="cm">/* STRUCTS ******************************************************************/</span>
<span class="cm">/****************************************************************************/</span>

<span class="cm">/* sound hardware definition */</span>
<span class="cp">#define MIXER_ADDR_TVTUNER      0</span>
<span class="cp">#define MIXER_ADDR_LAST         0</span>

<span class="k">struct</span> <span class="n">ngene_channel</span><span class="p">;</span>

<span class="cm">/*struct sound chip*/</span>

<span class="k">struct</span> <span class="n">mychip</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ngene_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_card</span> <span class="o">*</span><span class="n">card</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_pcm</span> <span class="o">*</span><span class="n">pcm</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">port</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">irq</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">mixer_lock</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">lock</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mixer_volume</span><span class="p">[</span><span class="n">MIXER_ADDR_LAST</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">capture_source</span><span class="p">[</span><span class="n">MIXER_ADDR_LAST</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#ifdef NGENE_V4L</span>
<span class="k">struct</span> <span class="n">ngene_overlay</span> <span class="p">{</span>
	<span class="kt">int</span>                    <span class="n">tvnorm</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_rect</span>       <span class="n">w</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">v4l2_field</span>        <span class="n">field</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_clip</span>       <span class="o">*</span><span class="n">clips</span><span class="p">;</span>
	<span class="kt">int</span>                    <span class="n">nclips</span><span class="p">;</span>
	<span class="kt">int</span>                    <span class="n">setup_ok</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ngene_tvnorm</span> <span class="p">{</span>
	<span class="kt">int</span>   <span class="n">v4l2_id</span><span class="p">;</span>
	<span class="kt">char</span>  <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u16</span>   <span class="n">swidth</span><span class="p">,</span> <span class="n">sheight</span><span class="p">;</span> <span class="cm">/* scaled standard width, height */</span>
	<span class="kt">int</span>   <span class="n">tuner_norm</span><span class="p">;</span>
	<span class="kt">int</span>   <span class="n">soundstd</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ngene_vopen</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">ngene_channel</span>      <span class="o">*</span><span class="n">ch</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">v4l2_priority</span>         <span class="n">prio</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">width</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">height</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">depth</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">videobuf_queue</span>      <span class="n">vbuf_q</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">videobuf_queue</span>      <span class="n">vbi</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">fourcc</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">picxcount</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">resources</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">v4l2_buf_type</span>         <span class="n">type</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">ngene_format</span> <span class="o">*</span><span class="n">fmt</span><span class="p">;</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">ngene_format</span> <span class="o">*</span><span class="n">ovfmt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ngene_overlay</span>       <span class="n">ov</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">ngene_channel</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span>         <span class="n">device</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span>    <span class="n">i2c_adapter</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ngene</span>         <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">number</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">type</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">mode</span><span class="p">;</span>
	<span class="n">bool</span>                  <span class="n">has_adapter</span><span class="p">;</span>
	<span class="n">bool</span>                  <span class="n">has_demux</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">demod_type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">gate_ctrl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>

	<span class="k">struct</span> <span class="n">dvb_frontend</span>  <span class="o">*</span><span class="n">fe</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span>  <span class="o">*</span><span class="n">fe2</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmxdev</span>         <span class="n">dmxdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_demux</span>      <span class="n">demux</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_net</span>        <span class="n">dvbnet</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmx_frontend</span>   <span class="n">hw_frontend</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmx_frontend</span>   <span class="n">mem_frontend</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">users</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span>  <span class="o">*</span><span class="n">v4l_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_device</span>    <span class="o">*</span><span class="n">ci_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tasklet_struct</span> <span class="n">demux_tasklet</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">SBufferHeader</span> <span class="o">*</span><span class="n">nextBuffer</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">KSSTATE</span>          <span class="n">State</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">HWSTATE</span>          <span class="n">HWState</span><span class="p">;</span>
	<span class="n">u8</span>                    <span class="n">Stream</span><span class="p">;</span>
	<span class="n">u8</span>                    <span class="n">Flags</span><span class="p">;</span>
	<span class="n">u8</span>                    <span class="n">Mode</span><span class="p">;</span>
	<span class="n">IBufferExchange</span>      <span class="o">*</span><span class="n">pBufferExchange</span><span class="p">;</span>
	<span class="n">IBufferExchange</span>      <span class="o">*</span><span class="n">pBufferExchange2</span><span class="p">;</span>

	<span class="n">spinlock_t</span>            <span class="n">state_lock</span><span class="p">;</span>
	<span class="n">u16</span>                   <span class="n">nLines</span><span class="p">;</span>
	<span class="n">u16</span>                   <span class="n">nBytesPerLine</span><span class="p">;</span>
	<span class="n">u16</span>                   <span class="n">nVBILines</span><span class="p">;</span>
	<span class="n">u16</span>                   <span class="n">nBytesPerVBILine</span><span class="p">;</span>
	<span class="n">u16</span>                   <span class="n">itumode</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">Capture1Length</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">Capture2Length</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SRingBufferDescriptor</span> <span class="n">RingBuffer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SRingBufferDescriptor</span> <span class="n">TSRingBuffer</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">SRingBufferDescriptor</span> <span class="n">TSIdleBuffer</span><span class="p">;</span>

	<span class="n">u32</span>                   <span class="n">DataFormatFlags</span><span class="p">;</span>

	<span class="kt">int</span>                   <span class="n">AudioDTOUpdated</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">AudioDTOValue</span><span class="p">;</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">set_tone</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="p">,</span> <span class="n">fe_sec_tone_mode_t</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">lnbh</span><span class="p">;</span>

	<span class="cm">/* stuff from analog driver */</span>

	<span class="kt">int</span> <span class="n">minor</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mychip</span>        <span class="o">*</span><span class="n">mychip</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">snd_card</span>      <span class="o">*</span><span class="n">soundcard</span><span class="p">;</span>
	<span class="n">u8</span>                   <span class="o">*</span><span class="n">evenbuffer</span><span class="p">;</span>
	<span class="n">u8</span>                    <span class="n">dma_on</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">soundstreamon</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">audiomute</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">soundbuffisallocated</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">sndbuffflag</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">tun_rdy</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">dec_rdy</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">tun_dec_rdy</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">lastbufferflag</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ngene_tvnorm</span>  <span class="o">*</span><span class="n">tvnorms</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">tvnorm_num</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">tvnorm</span><span class="p">;</span>

<span class="cp">#ifdef NGENE_V4L</span>
	<span class="kt">int</span>                   <span class="n">videousers</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_prio_state</span> <span class="n">prio</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ngene_vopen</span>    <span class="n">init</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">resources</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_framebuffer</span> <span class="n">fbuf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">ngene_buffer</span>  <span class="o">*</span><span class="n">screen</span><span class="p">;</span>     <span class="cm">/* overlay             */</span>
	<span class="k">struct</span> <span class="n">list_head</span>      <span class="n">capture</span><span class="p">;</span>    <span class="cm">/* video capture queue */</span>
	<span class="n">spinlock_t</span> <span class="n">s_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span> <span class="n">reslock</span><span class="p">;</span>
<span class="cp">#endif</span>

	<span class="kt">int</span> <span class="n">running</span><span class="p">;</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">ngene_ci</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span>         <span class="n">device</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span>    <span class="n">i2c_adapter</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ngene</span>         <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_ca_en50221</span> <span class="o">*</span><span class="n">en</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ngene</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="n">rx_cb_t</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ngene</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">,</span> <span class="n">u8</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="n">tx_cb_t</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ngene</span> <span class="o">*</span><span class="p">,</span> <span class="n">u32</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">ngene</span> <span class="p">{</span>
	<span class="kt">int</span>                   <span class="n">nr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>       <span class="o">*</span><span class="n">pci_dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>        <span class="o">*</span><span class="n">iomem</span><span class="p">;</span>

	<span class="cm">/*struct i2c_adapter  i2c_adapter;*/</span>

	<span class="n">u32</span>                   <span class="n">device_version</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">fw_interface_version</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">icounts</span><span class="p">;</span>
	<span class="n">bool</span>                  <span class="n">msi_enabled</span><span class="p">;</span>
	<span class="n">bool</span>                  <span class="n">cmd_timeout_workaround</span><span class="p">;</span>

	<span class="n">u8</span>                   <span class="o">*</span><span class="n">CmdDoneByte</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">BootFirmware</span><span class="p">;</span>
	<span class="kt">void</span>                 <span class="o">*</span><span class="n">OverflowBuffer</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>            <span class="n">PAOverflowBuffer</span><span class="p">;</span>
	<span class="kt">void</span>                 <span class="o">*</span><span class="n">FWInterfaceBuffer</span><span class="p">;</span>
	<span class="n">dma_addr_t</span>            <span class="n">PAFWInterfaceBuffer</span><span class="p">;</span>
	<span class="n">u8</span>                   <span class="o">*</span><span class="n">ngenetohost</span><span class="p">;</span>
	<span class="n">u8</span>                   <span class="o">*</span><span class="n">hosttongene</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">EVENT_BUFFER</span>   <span class="n">EventQueue</span><span class="p">[</span><span class="n">EVENT_QUEUE_SIZE</span><span class="p">];</span>
	<span class="kt">int</span>                   <span class="n">EventQueueOverflowCount</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">EventQueueOverflowFlag</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tasklet_struct</span> <span class="n">event_tasklet</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">EVENT_BUFFER</span>  <span class="o">*</span><span class="n">EventBuffer</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">EventQueueWriteIndex</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">EventQueueReadIndex</span><span class="p">;</span>

	<span class="n">wait_queue_head_t</span>     <span class="n">cmd_wq</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">cmd_done</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span>      <span class="n">cmd_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span>      <span class="n">stream_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span>      <span class="n">pll_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">semaphore</span>      <span class="n">i2c_switch_mutex</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">i2c_current_channel</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">i2c_current_bus</span><span class="p">;</span>
	<span class="n">spinlock_t</span>            <span class="n">cmd_lock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dvb_adapter</span>    <span class="n">adapter</span><span class="p">[</span><span class="n">MAX_STREAM</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">dvb_adapter</span>    <span class="o">*</span><span class="n">first_adapter</span><span class="p">;</span> <span class="cm">/* &quot;one_adapter&quot; modprobe opt */</span>
	<span class="k">struct</span> <span class="n">ngene_channel</span>  <span class="n">channel</span><span class="p">[</span><span class="n">MAX_STREAM</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">ngene_info</span>    <span class="o">*</span><span class="n">card_info</span><span class="p">;</span>

	<span class="n">tx_cb_t</span>              <span class="o">*</span><span class="n">TxEventNotify</span><span class="p">;</span>
	<span class="n">rx_cb_t</span>              <span class="o">*</span><span class="n">RxEventNotify</span><span class="p">;</span>
	<span class="kt">int</span>                   <span class="n">tx_busy</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span>     <span class="n">tx_wq</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span>     <span class="n">rx_wq</span><span class="p">;</span>
<span class="cp">#define UART_RBUF_LEN 4096</span>
	<span class="n">u8</span>                    <span class="n">uart_rbuf</span><span class="p">[</span><span class="n">UART_RBUF_LEN</span><span class="p">];</span>
	<span class="kt">int</span>                   <span class="n">uart_rp</span><span class="p">,</span> <span class="n">uart_wp</span><span class="p">;</span>

<span class="cp">#define TS_FILLER  0x6f</span>

	<span class="n">u8</span>                   <span class="o">*</span><span class="n">tsout_buf</span><span class="p">;</span>
<span class="cp">#define TSOUT_BUF_SIZE (512*188*8)</span>
	<span class="k">struct</span> <span class="n">dvb_ringbuffer</span> <span class="n">tsout_rbuf</span><span class="p">;</span>

	<span class="n">u8</span>                   <span class="o">*</span><span class="n">tsin_buf</span><span class="p">;</span>
<span class="cp">#define TSIN_BUF_SIZE (512*188*8)</span>
	<span class="k">struct</span> <span class="n">dvb_ringbuffer</span> <span class="n">tsin_rbuf</span><span class="p">;</span>

	<span class="n">u8</span>                   <span class="o">*</span><span class="n">ain_buf</span><span class="p">;</span>
<span class="cp">#define AIN_BUF_SIZE (128*1024)</span>
	<span class="k">struct</span> <span class="n">dvb_ringbuffer</span> <span class="n">ain_rbuf</span><span class="p">;</span>


	<span class="n">u8</span>                   <span class="o">*</span><span class="n">vin_buf</span><span class="p">;</span>
<span class="cp">#define VIN_BUF_SIZE (4*1920*1080)</span>
	<span class="k">struct</span> <span class="n">dvb_ringbuffer</span> <span class="n">vin_rbuf</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">long</span>         <span class="n">exp_val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">prev_cmd</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">ngene_ci</span>       <span class="n">ci</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">ngene_info</span> <span class="p">{</span>
	<span class="kt">int</span>   <span class="n">type</span><span class="p">;</span>
<span class="cp">#define NGENE_APP        0</span>
<span class="cp">#define NGENE_TERRATEC   1</span>
<span class="cp">#define NGENE_SIDEWINDER 2</span>
<span class="cp">#define NGENE_RACER      3</span>
<span class="cp">#define NGENE_VIPER      4</span>
<span class="cp">#define NGENE_PYTHON     5</span>
<span class="cp">#define NGENE_VBOX_V1	 6</span>
<span class="cp">#define NGENE_VBOX_V2	 7</span>

	<span class="kt">int</span>   <span class="n">fw_version</span><span class="p">;</span>
	<span class="n">bool</span>  <span class="n">msi_supported</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

	<span class="kt">int</span>   <span class="n">io_type</span><span class="p">[</span><span class="n">MAX_STREAM</span><span class="p">];</span>
<span class="cp">#define NGENE_IO_NONE    0</span>
<span class="cp">#define NGENE_IO_TV      1</span>
<span class="cp">#define NGENE_IO_HDTV    2</span>
<span class="cp">#define NGENE_IO_TSIN    4</span>
<span class="cp">#define NGENE_IO_TSOUT   8</span>
<span class="cp">#define NGENE_IO_AIN     16</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">fe_config</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">tuner_config</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">demod_attach</span><span class="p">[</span><span class="mi">4</span><span class="p">])(</span><span class="k">struct</span> <span class="n">ngene_channel</span> <span class="o">*</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">tuner_attach</span><span class="p">[</span><span class="mi">4</span><span class="p">])(</span><span class="k">struct</span> <span class="n">ngene_channel</span> <span class="o">*</span><span class="p">);</span>

	<span class="n">u8</span>    <span class="n">avf</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span>    <span class="n">msp</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span>    <span class="n">demoda</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span>    <span class="n">lnb</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="kt">int</span>   <span class="n">i2c_access</span><span class="p">;</span>
	<span class="n">u8</span>    <span class="n">ntsc</span><span class="p">;</span>
	<span class="n">u8</span>    <span class="n">tsf</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u8</span>    <span class="n">i2s</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">gate_ctrl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">switch_ctrl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">ngene_channel</span> <span class="o">*</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#ifdef NGENE_V4L</span>
<span class="k">struct</span> <span class="n">ngene_format</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span>   <span class="n">fourcc</span><span class="p">;</span>          <span class="cm">/* video4linux 2      */</span>
	<span class="kt">int</span>   <span class="n">btformat</span><span class="p">;</span>        <span class="cm">/* BT848_COLOR_FMT_*  */</span>
	<span class="kt">int</span>   <span class="n">format</span><span class="p">;</span>
	<span class="kt">int</span>   <span class="n">btswap</span><span class="p">;</span>          <span class="cm">/* BT848_COLOR_CTL_*  */</span>
	<span class="kt">int</span>   <span class="n">depth</span><span class="p">;</span>           <span class="cm">/* bit/pixel          */</span>
	<span class="kt">int</span>   <span class="n">flags</span><span class="p">;</span>
	<span class="kt">int</span>   <span class="n">hshift</span><span class="p">,</span> <span class="n">vshift</span><span class="p">;</span>  <span class="cm">/* for planar modes   */</span>
	<span class="kt">int</span>   <span class="n">palette</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define RESOURCE_OVERLAY       1</span>
<span class="cp">#define RESOURCE_VIDEO         2</span>
<span class="cp">#define RESOURCE_VBI           4</span>

<span class="k">struct</span> <span class="n">ngene_buffer</span> <span class="p">{</span>
	<span class="cm">/* common v4l buffer stuff -- must be first */</span>
	<span class="k">struct</span> <span class="n">videobuf_buffer</span>     <span class="n">vb</span><span class="p">;</span>

	<span class="cm">/* ngene specific */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">ngene_format</span> <span class="o">*</span><span class="n">fmt</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">tvnorm</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">btformat</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">btswap</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>


<span class="cm">/* Provided by ngene-core.c */</span>
<span class="kt">int</span> <span class="n">__devinit</span> <span class="n">ngene_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci_dev</span><span class="p">,</span>
			  <span class="k">const</span> <span class="k">struct</span> <span class="n">pci_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">__devexit</span> <span class="n">ngene_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">ngene_shutdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pdev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ngene_command</span><span class="p">(</span><span class="k">struct</span> <span class="n">ngene</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">ngene_command</span> <span class="o">*</span><span class="n">com</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ngene_command_gpio_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">ngene</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">select</span><span class="p">,</span> <span class="n">u8</span> <span class="n">level</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">set_transfer</span><span class="p">(</span><span class="k">struct</span> <span class="n">ngene_channel</span> <span class="o">*</span><span class="n">chan</span><span class="p">,</span> <span class="kt">int</span> <span class="n">state</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">FillTSBuffer</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">Buffer</span><span class="p">,</span> <span class="kt">int</span> <span class="n">Length</span><span class="p">,</span> <span class="n">u32</span> <span class="n">Flags</span><span class="p">);</span>

<span class="cm">/* Provided by ngene-i2c.c */</span>
<span class="kt">int</span> <span class="n">ngene_i2c_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">ngene</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">dev_nr</span><span class="p">);</span>

<span class="cm">/* Provided by ngene-dvb.c */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">dvb_device</span> <span class="n">ngene_dvbdev_ci</span><span class="p">;</span>
<span class="kt">void</span> <span class="o">*</span><span class="n">tsout_exchange</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">,</span> <span class="n">u32</span> <span class="n">clock</span><span class="p">,</span> <span class="n">u32</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">void</span> <span class="o">*</span><span class="n">tsin_exchange</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">,</span> <span class="n">u32</span> <span class="n">clock</span><span class="p">,</span> <span class="n">u32</span> <span class="n">flags</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ngene_start_feed</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_demux_feed</span> <span class="o">*</span><span class="n">dvbdmxfeed</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">ngene_stop_feed</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_demux_feed</span> <span class="o">*</span><span class="n">dvbdmxfeed</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">my_dvb_dmx_ts_card_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_demux</span> <span class="o">*</span><span class="n">dvbdemux</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">id</span><span class="p">,</span>
			    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">start_feed</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dvb_demux_feed</span> <span class="o">*</span><span class="p">),</span>
			    <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">stop_feed</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dvb_demux_feed</span> <span class="o">*</span><span class="p">),</span>
			    <span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">my_dvb_dmxdev_ts_card_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">dmxdev</span> <span class="o">*</span><span class="n">dmxdev</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">dvb_demux</span> <span class="o">*</span><span class="n">dvbdemux</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">dmx_frontend</span> <span class="o">*</span><span class="n">hw_frontend</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">dmx_frontend</span> <span class="o">*</span><span class="n">mem_frontend</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">dvb_adapter</span> <span class="o">*</span><span class="n">dvb_adapter</span><span class="p">);</span>

<span class="cp">#endif</span>

<span class="cm">/*  LocalWords:  Endif</span>
<span class="cm"> */</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
