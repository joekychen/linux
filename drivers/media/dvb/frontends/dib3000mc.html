<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › frontends › dib3000mc.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>dib3000mc.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Driver for DiBcom DiB3000MC/P-demodulator.</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2004-7 DiBcom (http://www.dibcom.fr/)</span>
<span class="cm"> * Copyright (C) 2004-5 Patrick Boettcher (patrick.boettcher@desy.de)</span>
<span class="cm"> *</span>
<span class="cm"> * This code is partially based on the previous dib3000mc.c .</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> *	modify it under the terms of the GNU General Public License as</span>
<span class="cm"> *	published by the Free Software Foundation, version 2.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>

<span class="cp">#include &quot;dvb_frontend.h&quot;</span>

<span class="cp">#include &quot;dib3000mc.h&quot;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">debug</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="s">&quot;turn on debugging (default: 0)&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">buggy_sfn_workaround</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">buggy_sfn_workaround</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">buggy_sfn_workaround</span><span class="p">,</span> <span class="s">&quot;Enable work-around for buggy SFNs (default: 0)&quot;</span><span class="p">);</span>

<span class="cp">#define dprintk(args...) do { if (debug) { printk(KERN_DEBUG &quot;DiB3000MC/P:&quot;); printk(args); printk(&quot;\n&quot;); } } while (0)</span>

<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="n">demod</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib3000mc_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">i2c_addr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c_adap</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">dibx000_i2c_master</span> <span class="n">i2c_master</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">timf</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">current_bandwidth</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">dev_id</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">sfn_workaround_active</span> <span class="o">:</span><span class="mi">1</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">u16</span> <span class="nf">dib3000mc_read_word</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="n">u16</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">wb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xff</span> <span class="p">};</span>
	<span class="n">u8</span> <span class="n">rb</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>        <span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">wb</span><span class="p">,</span> <span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">},</span>
		<span class="p">{</span> <span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">I2C_M_RD</span><span class="p">,</span> <span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">rb</span><span class="p">,</span> <span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i2c_transfer</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;i2c read error on %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">reg</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">rb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">rb</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_write_word</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="n">u16</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">b</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">(</span><span class="n">reg</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
		<span class="p">(</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">4</span>
	<span class="p">};</span>
	<span class="k">return</span> <span class="n">i2c_transfer</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span> <span class="o">?</span> <span class="o">-</span><span class="n">EREMOTEIO</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_identify</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">value</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">value</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1025</span><span class="p">))</span> <span class="o">!=</span> <span class="mh">0x01b3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;-E-  DiB3000MC/P: wrong Vendor ID (read=0x%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EREMOTEIO</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">value</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1026</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="mh">0x3001</span> <span class="o">&amp;&amp;</span> <span class="n">value</span> <span class="o">!=</span> <span class="mh">0x3002</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;-E-  DiB3000MC/P: wrong Device ID (%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">value</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EREMOTEIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">dev_id</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;-I-  found DiB3000MC/P: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">dev_id</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_set_timing</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="n">s16</span> <span class="n">nfft</span><span class="p">,</span> <span class="n">u32</span> <span class="n">bw</span><span class="p">,</span> <span class="n">u8</span> <span class="n">update_offset</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">timf</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">timf</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">timf</span> <span class="o">=</span> <span class="mi">1384402</span><span class="p">;</span> <span class="c1">// default value for 8MHz</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">update_offset</span><span class="p">)</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span> <span class="c1">// first time we do an update</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">timf</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">timf</span><span class="p">;</span>

	<span class="n">timf</span> <span class="o">*=</span> <span class="p">(</span><span class="n">bw</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">update_offset</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">s16</span> <span class="n">tim_offs</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">416</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">tim_offs</span> <span class="o">&amp;</span>  <span class="mh">0x2000</span><span class="p">)</span>
			<span class="n">tim_offs</span> <span class="o">-=</span> <span class="mh">0x4000</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">nfft</span> <span class="o">==</span> <span class="n">TRANSMISSION_MODE_2K</span><span class="p">)</span>
			<span class="n">tim_offs</span> <span class="o">*=</span> <span class="mi">4</span><span class="p">;</span>

		<span class="n">timf</span> <span class="o">+=</span> <span class="n">tim_offs</span><span class="p">;</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">timf</span> <span class="o">=</span> <span class="n">timf</span> <span class="o">/</span> <span class="p">(</span><span class="n">bw</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;timf: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">timf</span><span class="p">);</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">timf</span> <span class="o">&gt;&gt;</span> <span class="mi">16</span><span class="p">));</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="p">(</span><span class="n">timf</span>      <span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_setup_pwm_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">reg_51</span><span class="p">,</span> <span class="n">reg_52</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">agc</span><span class="o">-&gt;</span><span class="n">setup</span> <span class="o">&amp;</span> <span class="mh">0xfefb</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">pwm3_inversion</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg_51</span> <span class="o">=</span>  <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">reg_52</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">reg_51</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">reg_52</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="n">reg_51</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="n">reg_52</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">use_pwm3</span><span class="p">)</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">));</span>
	<span class="k">else</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">245</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

    <span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1040</span><span class="p">,</span> <span class="mh">0x3</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_set_output_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span>    <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">fifo_threshold</span> <span class="o">=</span> <span class="mi">1792</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">outreg</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">outmode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">elecout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">smo_reg</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">206</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x0010</span><span class="p">;</span> <span class="cm">/* keep the pid_parse bit */</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;-I-  Setting output mode for demod %p to %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">demod</span><span class="p">,</span> <span class="n">mode</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">mode</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">OUTMODE_HIGH_Z</span>:  <span class="c1">// disable</span>
			<span class="n">elecout</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OUTMODE_MPEG2_PAR_GATED_CLK</span>:   <span class="c1">// STBs with parallel gated clock</span>
			<span class="n">outmode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OUTMODE_MPEG2_PAR_CONT_CLK</span>:    <span class="c1">// STBs with parallel continues clock</span>
			<span class="n">outmode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OUTMODE_MPEG2_SERIAL</span>:          <span class="c1">// STBs with serial input</span>
			<span class="n">outmode</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OUTMODE_MPEG2_FIFO</span>:            <span class="c1">// e.g. USB feeding</span>
			<span class="n">elecout</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
			<span class="cm">/*ADDR @ 206 :</span>
<span class="cm">			P_smo_error_discard  [1;6:6] = 0</span>
<span class="cm">			P_smo_rs_discard     [1;5:5] = 0</span>
<span class="cm">			P_smo_pid_parse      [1;4:4] = 0</span>
<span class="cm">			P_smo_fifo_flush     [1;3:3] = 0</span>
<span class="cm">			P_smo_mode           [2;2:1] = 11</span>
<span class="cm">			P_smo_ovf_prot       [1;0:0] = 0</span>
<span class="cm">			*/</span>
			<span class="n">smo_reg</span> <span class="o">|=</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">fifo_threshold</span> <span class="o">=</span> <span class="mi">512</span><span class="p">;</span>
			<span class="n">outmode</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">OUTMODE_DIVERSITY</span>:
			<span class="n">outmode</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
			<span class="n">elecout</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;Unhandled output_mode passed to be set for demod %p</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">demod</span><span class="p">);</span>
			<span class="n">outmode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">output_mpeg2_in_188_bytes</span><span class="p">))</span>
		<span class="n">smo_reg</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span> <span class="c1">// P_smo_rs_discard     [1;5:5] = 1</span>

	<span class="n">outreg</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">244</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x07FF</span><span class="p">;</span>
	<span class="n">outreg</span> <span class="o">|=</span> <span class="p">(</span><span class="n">outmode</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">);</span>
	<span class="n">ret</span> <span class="o">|=</span> <span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>  <span class="mi">244</span><span class="p">,</span> <span class="n">outreg</span><span class="p">);</span>
	<span class="n">ret</span> <span class="o">|=</span> <span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>  <span class="mi">206</span><span class="p">,</span> <span class="n">smo_reg</span><span class="p">);</span>   <span class="cm">/*smo_ mode*/</span>
	<span class="n">ret</span> <span class="o">|=</span> <span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>  <span class="mi">207</span><span class="p">,</span> <span class="n">fifo_threshold</span><span class="p">);</span> <span class="cm">/* synchronous fread */</span>
	<span class="n">ret</span> <span class="o">|=</span> <span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1040</span><span class="p">,</span> <span class="n">elecout</span><span class="p">);</span>         <span class="cm">/* P_out_cfg */</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_set_bandwidth</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="n">u32</span> <span class="n">bw</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="n">u16</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="n">u16</span> <span class="n">reg</span><span class="p">;</span>

<span class="cm">/* settings here are for 27.7MHz */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">bw</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">8000</span>:
			<span class="n">bw_cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0019</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x5c30</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0054</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x88a0</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01a6</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xab20</span><span class="p">;</span>
			<span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04db</span><span class="p">;</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00db</span><span class="p">;</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00b7</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mi">7000</span>:
			<span class="n">bw_cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x001c</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xfba5</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0060</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x9c25</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01e3</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0cb7</span><span class="p">;</span>
			<span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04c0</span><span class="p">;</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00c0</span><span class="p">;</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00a0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mi">6000</span>:
			<span class="n">bw_cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0021</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xd040</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0070</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xb62b</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0233</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x8ed5</span><span class="p">;</span>
			<span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04a5</span><span class="p">;</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00a5</span><span class="p">;</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0089</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mi">5000</span>:
			<span class="n">bw_cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0028</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x9380</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0087</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x4100</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02a4</span><span class="p">;</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x4500</span><span class="p">;</span>
			<span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0489</span><span class="p">;</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0089</span><span class="p">;</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0072</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="nl">default:</span> <span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">reg</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">;</span> <span class="n">reg</span><span class="o">++</span><span class="p">)</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">bw_cfg</span><span class="p">[</span><span class="n">reg</span> <span class="o">-</span> <span class="mi">6</span><span class="p">]);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mh">0x03e8</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mh">0x03f2</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mh">0xb0d0</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>P<em>sec</em>len</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mh">0x0393</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mh">0x8700</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">reg</span> <span class="o">=</span> <span class="mi">55</span><span class="p">;</span> <span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">58</span><span class="p">;</span> <span class="n">reg</span><span class="o">++</span><span class="p">)</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">imp_bw_cfg</span><span class="p">[</span><span class="n">reg</span> <span class="o">-</span> <span class="mi">55</span><span class="p">]);</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>Timing configuration</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_set_timing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">TRANSMISSION_MODE_2K</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u16</span> <span class="n">impulse_noise_val</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span> <span class="o">=</span>

<span class="p">{</span>
	<span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x6d9</span><span class="p">,</span> <span class="mh">0x3f28</span><span class="p">,</span> <span class="mh">0x7a7</span><span class="p">,</span> <span class="mh">0x3a74</span><span class="p">,</span> <span class="mh">0x196</span><span class="p">,</span> <span class="mh">0x32a</span><span class="p">,</span> <span class="mh">0x48c</span><span class="p">,</span> <span class="mh">0x3ffe</span><span class="p">,</span> <span class="mh">0x7f3</span><span class="p">,</span>
	<span class="mh">0x2d94</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x53d</span><span class="p">,</span> <span class="mh">0x3ff8</span><span class="p">,</span> <span class="mh">0x7e3</span><span class="p">,</span> <span class="mh">0x3320</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x5b3</span><span class="p">,</span> <span class="mh">0x3feb</span><span class="p">,</span> <span class="mh">0x7d2</span><span class="p">,</span>
	<span class="mh">0x365e</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x48c</span><span class="p">,</span> <span class="mh">0x3ffe</span><span class="p">,</span> <span class="mh">0x5b3</span><span class="p">,</span> <span class="mh">0x3feb</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0xd</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dib3000mc_set_impulse_noise</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">,</span> <span class="n">s16</span> <span class="n">nfft</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">58</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">87</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">impulse_noise_val</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">58</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">nfft</span> <span class="o">==</span> <span class="n">TRANSMISSION_MODE_8K</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">58</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">84</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mh">0x8200</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mh">0x1294</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mh">0x1ff8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">55</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">demod</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">demod</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="o">*</span><span class="n">agc</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">agc</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>Restart Configuration</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1027</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1027</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>power up the demod + mobility configuration</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1031</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">mobile_mode</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span>  <span class="mh">0x0002</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1032</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">139</span><span class="p">,</span>  <span class="mh">0x0001</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">141</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span>  <span class="mh">0x0000</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1032</span><span class="p">,</span> <span class="mh">0x012C</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1033</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>P<em>clk</em>cfg</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1037</span><span class="p">,</span> <span class="mh">0x3130</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>other configurations</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>P<em>ctrl</em>sfreq</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">));</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">88</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x10</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">));</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Phase noise control
P<em>fft</em>phacor<em>inh, P</em>fft<em>phacor</em>cpe, P<em>fft</em>powrange</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">99</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x20</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">phase_noise_mode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">111</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>P<em>agc</em>global</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mh">0x8000</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>agc setup misc</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_setup_pwm_state</span><span class="p">(</span><span class="n">state</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>P<em>agc</em>counter_lock</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>P<em>agc</em>counter_unlock</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">);</span>

	<span class="cm">/* agc */</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">max_time</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">agc_command1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">agc_command2</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mh">0x1d</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">));</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">pwm3_value</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">39</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">ln_adc_level</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>set<em>agc</em>loop_Bw</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mh">0x0179</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mh">0x03f0</span><span class="p">);</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc1_max</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc1_min</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">44</span><span class="p">,</span> <span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc2_max</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc2_min</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="p">(</span><span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc1_pt1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc1_pt2</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="p">(</span><span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc1_slope1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc1_slope2</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="p">(</span><span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc2_pt1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc2_pt2</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="p">(</span><span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc2_slope1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">agc</span><span class="o">-&gt;</span><span class="n">agc2_slope2</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>Begin: TimeOut registers
P<em>pha3</em>thres</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mi">3277</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>P<em>timf</em>alpha = 6, P<em>corm</em>alpha = 6, P<em>corm</em>thres = 0x80</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>  <span class="mi">26</span><span class="p">,</span> <span class="mh">0x6680</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>lock_mask0</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>lock_mask1</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>lock_mask2</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mh">0x1000</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-20"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-20">&#182;</a></div><p>P<em>search</em>maxtrial=1</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib3000mc_set_bandwidth</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">8000</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-21"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-21">&#182;</a></div><p>div<em>lock</em>mask</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>  <span class="mi">4</span><span class="p">,</span> <span class="mh">0x814</span><span class="p">);</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x164</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mh">0x463d</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-22"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-22">&#182;</a></div><p>Spurious rm cfg
P<em>cspu</em>regul, P<em>cspu</em>win_cut</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mh">0x200f</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-23"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-23">&#182;</a></div><p>P<em>adp</em>selec_monit</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">134</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-24"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-24">&#182;</a></div><p>Fec cfg</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">195</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-25"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-25">&#182;</a></div><p>diversity register: P<em>dvsy</em>sync_wait..</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mh">0x2FF0</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-26"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-26">&#182;</a></div><p>Impulse noise configuration</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_set_impulse_noise</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">TRANSMISSION_MODE_8K</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-27"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-27">&#182;</a></div><p>output mode set-up</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_set_output_mode</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">OUTMODE_HIGH_Z</span><span class="p">);</span>

	<span class="cm">/* close the i2c-gate */</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">769</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_sleep</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">demod</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">demod</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1031</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1032</span><span class="p">,</span> <span class="mh">0xFFFF</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1033</span><span class="p">,</span> <span class="mh">0xFFF0</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dib3000mc_set_adp_cfg</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="n">s16</span> <span class="n">qam</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">},</span><span class="n">reg</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">qam</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">QPSK</span>:
			<span class="n">cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x099a</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x7fae</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0333</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x7ff0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">QAM_16</span>:
			<span class="n">cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x023d</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x7fdf</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00a4</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x7ff0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">QAM_64</span>:
			<span class="n">cfg</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0148</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x7ff0</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00a4</span><span class="p">;</span> <span class="n">cfg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x7ff8</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">reg</span> <span class="o">=</span> <span class="mi">129</span><span class="p">;</span> <span class="n">reg</span> <span class="o">&lt;</span> <span class="mi">133</span><span class="p">;</span> <span class="n">reg</span><span class="o">++</span><span class="p">)</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">cfg</span><span class="p">[</span><span class="n">reg</span> <span class="o">-</span> <span class="mi">129</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dib3000mc_set_channel_cfg</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span> <span class="n">u16</span> <span class="n">seq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">value</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bw</span> <span class="o">=</span> <span class="n">BANDWIDTH_TO_KHZ</span><span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">bandwidth_hz</span><span class="p">);</span>

	<span class="n">dib3000mc_set_bandwidth</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">bw</span><span class="p">);</span>
	<span class="n">dib3000mc_set_timing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">ch</span><span class="o">-&gt;</span><span class="n">transmission_mode</span><span class="p">,</span> <span class="n">bw</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-28"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-28">&#182;</a></div><p>if (boost)
    dib3000mc<em>write</em>word(state, 100, (11 &lt;&lt; 6) + 6);
else</p></td><td class="code"><div class="highlight"><pre>		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="p">(</span><span class="mi">16</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="mi">9</span><span class="p">);</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1027</span><span class="p">,</span> <span class="mh">0x0800</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">1027</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-29"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-29">&#182;</a></div><p>Default cfg isi offset adp</p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span>  <span class="mh">0x6680</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span>  <span class="mh">0x1273</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span>       <span class="mi">5</span><span class="p">);</span>
	<span class="n">dib3000mc_set_adp_cfg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">QAM_16</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span>  <span class="mi">15564</span><span class="p">);</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">12</span> <span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">13</span> <span class="p">,</span> <span class="mh">0x3e8</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">14</span> <span class="p">,</span> <span class="mh">0x0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">15</span> <span class="p">,</span> <span class="mh">0x3f2</span><span class="p">);</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">93</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">94</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>

	<span class="n">dib3000mc_set_impulse_noise</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ch</span><span class="o">-&gt;</span><span class="n">transmission_mode</span><span class="p">);</span>

	<span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">transmission_mode</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TRANSMISSION_MODE_2K</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
		<span class="k">case</span> <span class="n">TRANSMISSION_MODE_8K</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">guard_interval</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">GUARD_INTERVAL_1_32</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">GUARD_INTERVAL_1_16</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">GUARD_INTERVAL_1_4</span>:  <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
		<span class="k">case</span> <span class="n">GUARD_INTERVAL_1_8</span>:  <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">modulation</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">QPSK</span>:  <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">QAM_16</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
		<span class="k">case</span> <span class="n">QAM_64</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">HIERARCHY_1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">HIERARCHY_2</span>: <span class="n">value</span> <span class="o">|=</span> <span class="mi">2</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">HIERARCHY_4</span>: <span class="n">value</span> <span class="o">|=</span> <span class="mi">4</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
		<span class="k">case</span> <span class="n">HIERARCHY_1</span>: <span class="n">value</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">seq</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">));</span>

	<span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">hierarchy</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">value</span> <span class="o">|=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">((</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">hierarchy</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="n">ch</span><span class="o">-&gt;</span><span class="n">code_rate_HP</span> <span class="o">:</span> <span class="n">ch</span><span class="o">-&gt;</span><span class="n">code_rate_LP</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">FEC_2_3</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">FEC_3_4</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">FEC_5_6</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">FEC_7_8</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
		<span class="k">case</span> <span class="n">FEC_1_2</span>: <span class="n">value</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">181</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-30"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-30">&#182;</a></div><p>diversity synchro delay add 50% SFN margin</p></td><td class="code"><div class="highlight"><pre>	<span class="k">switch</span> <span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">transmission_mode</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TRANSMISSION_MODE_8K</span>: <span class="n">value</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TRANSMISSION_MODE_2K</span>:
		<span class="nl">default:</span> <span class="n">value</span> <span class="o">=</span> <span class="mi">64</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">guard_interval</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">GUARD_INTERVAL_1_16</span>: <span class="n">value</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">GUARD_INTERVAL_1_8</span>:  <span class="n">value</span> <span class="o">*=</span> <span class="mi">4</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">GUARD_INTERVAL_1_4</span>:  <span class="n">value</span> <span class="o">*=</span> <span class="mi">8</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
		<span class="k">case</span> <span class="n">GUARD_INTERVAL_1_32</span>: <span class="n">value</span> <span class="o">*=</span> <span class="mi">1</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">value</span> <span class="o">&lt;&lt;=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">value</span> <span class="o">|=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x000f</span><span class="p">;</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-31"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-31">&#182;</a></div><p>restart demod</p></td><td class="code"><div class="highlight"><pre>	<span class="n">value</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">value</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">));</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>

	<span class="n">dib3000mc_set_impulse_noise</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span><span class="o">-&gt;</span><span class="n">impulse_noise_mode</span><span class="p">,</span> <span class="n">ch</span><span class="o">-&gt;</span><span class="n">transmission_mode</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_autosearch_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">demod</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">chan</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">demod</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">demod</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">reg</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-32"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-32">&#182;</a></div><p>u32 val;</p></td><td class="code"><div class="highlight"><pre>	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="n">schan</span><span class="p">;</span>

	<span class="n">schan</span> <span class="o">=</span> <span class="o">*</span><span class="n">chan</span><span class="p">;</span>

	<span class="cm">/* TODO what is that ? */</span>

	<span class="cm">/* a channel for autosearch */</span>
	<span class="n">schan</span><span class="p">.</span><span class="n">transmission_mode</span> <span class="o">=</span> <span class="n">TRANSMISSION_MODE_8K</span><span class="p">;</span>
	<span class="n">schan</span><span class="p">.</span><span class="n">guard_interval</span> <span class="o">=</span> <span class="n">GUARD_INTERVAL_1_32</span><span class="p">;</span>
	<span class="n">schan</span><span class="p">.</span><span class="n">modulation</span> <span class="o">=</span> <span class="n">QAM_64</span><span class="p">;</span>
	<span class="n">schan</span><span class="p">.</span><span class="n">code_rate_HP</span> <span class="o">=</span> <span class="n">FEC_2_3</span><span class="p">;</span>
	<span class="n">schan</span><span class="p">.</span><span class="n">code_rate_LP</span> <span class="o">=</span> <span class="n">FEC_2_3</span><span class="p">;</span>
	<span class="n">schan</span><span class="p">.</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">dib3000mc_set_channel_cfg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">schan</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>

	<span class="n">reg</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reg</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">));</span>
	<span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">511</span><span class="p">);</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_autosearch_is_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">demod</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">demod</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">irq_pending</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">511</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">irq_pending</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="c1">// failed</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">irq_pending</span> <span class="o">&amp;</span> <span class="mh">0x2</span><span class="p">)</span> <span class="c1">// succeeded</span>
		<span class="k">return</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// still pending</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_tune</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">demod</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">ch</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">demod</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">demod</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-33"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-33">&#182;</a></div><p><em>* configure demod *</em></p></td><td class="code"><div class="highlight"><pre>	<span class="n">dib3000mc_set_channel_cfg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-34"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-34">&#182;</a></div><p>activates isi</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">sfn_workaround_active</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;SFN workaround is active</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mh">0x1273</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mh">0x4000</span><span class="p">);</span> <span class="c1">// P_pha3_force_pha_shift</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="mh">0x1073</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span> <span class="c1">// P_pha3_force_pha_shift</span>
	<span class="p">}</span>

	<span class="n">dib3000mc_set_adp_cfg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="p">(</span><span class="n">u8</span><span class="p">)</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">modulation</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">transmission_mode</span> <span class="o">==</span> <span class="n">TRANSMISSION_MODE_8K</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">38528</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">30336</span><span class="p">);</span>
		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">509</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span>
		<span class="n">dib3000mc_set_timing</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">ch</span><span class="o">-&gt;</span><span class="n">transmission_mode</span><span class="p">,</span>
				     <span class="n">BANDWIDTH_TO_KHZ</span><span class="p">(</span><span class="n">ch</span><span class="o">-&gt;</span><span class="n">bandwidth_hz</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span> <span class="nf">dib3000mc_get_tuner_i2c_master</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">demod</span><span class="p">,</span> <span class="kt">int</span> <span class="n">gating</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">demod</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">dibx000_get_i2c_adapter</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">i2c_master</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="n">gating</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">dib3000mc_get_tuner_i2c_master</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_get_frontend</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span><span class="o">*</span> <span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">fep</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tps</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="mi">458</span><span class="p">);</span>

	<span class="n">fep</span><span class="o">-&gt;</span><span class="n">inversion</span> <span class="o">=</span> <span class="n">INVERSION_AUTO</span><span class="p">;</span>

	<span class="n">fep</span><span class="o">-&gt;</span><span class="n">bandwidth_hz</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">current_bandwidth</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">((</span><span class="n">tps</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">transmission_mode</span> <span class="o">=</span> <span class="n">TRANSMISSION_MODE_2K</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">transmission_mode</span> <span class="o">=</span> <span class="n">TRANSMISSION_MODE_8K</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">tps</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">guard_interval</span> <span class="o">=</span> <span class="n">GUARD_INTERVAL_1_32</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">guard_interval</span> <span class="o">=</span> <span class="n">GUARD_INTERVAL_1_16</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">guard_interval</span> <span class="o">=</span> <span class="n">GUARD_INTERVAL_1_8</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">guard_interval</span> <span class="o">=</span> <span class="n">GUARD_INTERVAL_1_4</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">((</span><span class="n">tps</span> <span class="o">&gt;&gt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">modulation</span> <span class="o">=</span> <span class="n">QPSK</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">modulation</span> <span class="o">=</span> <span class="n">QAM_16</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
		<span class="nl">default:</span> <span class="n">fep</span><span class="o">-&gt;</span><span class="n">modulation</span> <span class="o">=</span> <span class="n">QAM_64</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* as long as the frontend_param structure is fixed for hierarchical transmission I refuse to use it */</span>
	<span class="cm">/* (tps &gt;&gt; 12) &amp; 0x1 == hrch is used, (tps &gt;&gt; 9) &amp; 0x7 == alpha */</span>

	<span class="n">fep</span><span class="o">-&gt;</span><span class="n">hierarchy</span> <span class="o">=</span> <span class="n">HIERARCHY_NONE</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">((</span><span class="n">tps</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_HP</span> <span class="o">=</span> <span class="n">FEC_1_2</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_HP</span> <span class="o">=</span> <span class="n">FEC_2_3</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_HP</span> <span class="o">=</span> <span class="n">FEC_3_4</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">5</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_HP</span> <span class="o">=</span> <span class="n">FEC_5_6</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">7</span>:
		<span class="nl">default:</span> <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_HP</span> <span class="o">=</span> <span class="n">FEC_7_8</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>

	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">((</span><span class="n">tps</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_LP</span> <span class="o">=</span> <span class="n">FEC_1_2</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_LP</span> <span class="o">=</span> <span class="n">FEC_2_3</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_LP</span> <span class="o">=</span> <span class="n">FEC_3_4</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">5</span>: <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_LP</span> <span class="o">=</span> <span class="n">FEC_5_6</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">7</span>:
		<span class="nl">default:</span> <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_LP</span> <span class="o">=</span> <span class="n">FEC_7_8</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_set_frontend</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">fep</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">dib3000mc_set_output_mode</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">OUTMODE_HIGH_Z</span><span class="p">);</span>

	<span class="n">state</span><span class="o">-&gt;</span><span class="n">current_bandwidth</span> <span class="o">=</span> <span class="n">fep</span><span class="o">-&gt;</span><span class="n">bandwidth_hz</span><span class="p">;</span>
	<span class="n">dib3000mc_set_bandwidth</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">BANDWIDTH_TO_KHZ</span><span class="p">(</span><span class="n">fep</span><span class="o">-&gt;</span><span class="n">bandwidth_hz</span><span class="p">));</span>

	<span class="cm">/* maybe the parameter has been changed */</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">sfn_workaround_active</span> <span class="o">=</span> <span class="n">buggy_sfn_workaround</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fep</span><span class="o">-&gt;</span><span class="n">transmission_mode</span>  <span class="o">==</span> <span class="n">TRANSMISSION_MODE_AUTO</span> <span class="o">||</span>
	    <span class="n">fep</span><span class="o">-&gt;</span><span class="n">guard_interval</span> <span class="o">==</span> <span class="n">GUARD_INTERVAL_AUTO</span> <span class="o">||</span>
	    <span class="n">fep</span><span class="o">-&gt;</span><span class="n">modulation</span>     <span class="o">==</span> <span class="n">QAM_AUTO</span> <span class="o">||</span>
	    <span class="n">fep</span><span class="o">-&gt;</span><span class="n">code_rate_HP</span>   <span class="o">==</span> <span class="n">FEC_AUTO</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">found</span><span class="p">;</span>

		<span class="n">dib3000mc_autosearch_start</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
			<span class="n">found</span> <span class="o">=</span> <span class="n">dib3000mc_autosearch_is_irq</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">found</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">i</span><span class="o">--</span><span class="p">);</span>

		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;autosearch returns: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">found</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">found</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">found</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// no channel found</span>

		<span class="n">dib3000mc_get_frontend</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">dib3000mc_tune</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>

	<span class="cm">/* make this a config parameter */</span>
	<span class="n">dib3000mc_set_output_mode</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_read_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">fe_status_t</span> <span class="o">*</span><span class="n">stat</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">lock</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">509</span><span class="p">);</span>

	<span class="o">*</span><span class="n">stat</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">lock</span> <span class="o">&amp;</span> <span class="mh">0x8000</span><span class="p">)</span>
		<span class="o">*</span><span class="n">stat</span> <span class="o">|=</span> <span class="n">FE_HAS_SIGNAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lock</span> <span class="o">&amp;</span> <span class="mh">0x3000</span><span class="p">)</span>
		<span class="o">*</span><span class="n">stat</span> <span class="o">|=</span> <span class="n">FE_HAS_CARRIER</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lock</span> <span class="o">&amp;</span> <span class="mh">0x0100</span><span class="p">)</span>
		<span class="o">*</span><span class="n">stat</span> <span class="o">|=</span> <span class="n">FE_HAS_VITERBI</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lock</span> <span class="o">&amp;</span> <span class="mh">0x0010</span><span class="p">)</span>
		<span class="o">*</span><span class="n">stat</span> <span class="o">|=</span> <span class="n">FE_HAS_SYNC</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lock</span> <span class="o">&amp;</span> <span class="mh">0x0008</span><span class="p">)</span>
		<span class="o">*</span><span class="n">stat</span> <span class="o">|=</span> <span class="n">FE_HAS_LOCK</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_read_ber</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">ber</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="o">*</span><span class="n">ber</span> <span class="o">=</span> <span class="p">(</span><span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">|</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">501</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_read_unc_blocks</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">unc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="o">*</span><span class="n">unc</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">508</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_read_signal_strength</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">strength</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">val</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">392</span><span class="p">);</span>
	<span class="o">*</span><span class="n">strength</span> <span class="o">=</span> <span class="mi">65535</span> <span class="o">-</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_read_snr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span><span class="o">*</span> <span class="n">fe</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">snr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="n">snr</span> <span class="o">=</span> <span class="mh">0x0000</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib3000mc_fe_get_tune_settings</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span><span class="o">*</span> <span class="n">fe</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dvb_frontend_tune_settings</span> <span class="o">*</span><span class="n">tune</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">tune</span><span class="o">-&gt;</span><span class="n">min_delay_ms</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dib3000mc_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">dibx000_exit_i2c_master</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">i2c_master</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">dib3000mc_pid_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pid</span><span class="p">,</span><span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">212</span> <span class="o">+</span> <span class="n">index</span><span class="p">,</span>  <span class="n">onoff</span> <span class="o">?</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">|</span> <span class="n">pid</span> <span class="o">:</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">dib3000mc_pid_control</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">dib3000mc_pid_parse</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">dib3000mc_read_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">206</span><span class="p">)</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">tmp</span> <span class="o">|=</span> <span class="p">(</span><span class="n">onoff</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">206</span><span class="p">,</span> <span class="n">tmp</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">dib3000mc_pid_parse</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">dib3000mc_set_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dib3000mc_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">dib3000mc_set_config</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">dib3000mc_i2c_enumeration</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">no_of_demods</span><span class="p">,</span> <span class="n">u8</span> <span class="n">default_addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dib3000mc_config</span> <span class="n">cfg</span><span class="p">[])</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">dmcst</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">k</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">new_addr</span><span class="p">;</span>

	<span class="k">static</span> <span class="n">u8</span> <span class="n">DIB3000MC_I2C_ADDRESS</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">20</span><span class="p">,</span><span class="mi">22</span><span class="p">,</span><span class="mi">24</span><span class="p">,</span><span class="mi">26</span><span class="p">};</span>

	<span class="n">dmcst</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dmcst</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">dmcst</span><span class="o">-&gt;</span><span class="n">i2c_adap</span> <span class="o">=</span> <span class="n">i2c</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="n">no_of_demods</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="n">k</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dmcst</span><span class="o">-&gt;</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>

		<span class="cm">/* designated i2c address */</span>
		<span class="n">new_addr</span>          <span class="o">=</span> <span class="n">DIB3000MC_I2C_ADDRESS</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
		<span class="n">dmcst</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">=</span> <span class="n">new_addr</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dib3000mc_identify</span><span class="p">(</span><span class="n">dmcst</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dmcst</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">=</span> <span class="n">default_addr</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dib3000mc_identify</span><span class="p">(</span><span class="n">dmcst</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;-E-  DiB3000P/MC #%d: not identified</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
				<span class="n">kfree</span><span class="p">(</span><span class="n">dmcst</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>

		<span class="n">dib3000mc_set_output_mode</span><span class="p">(</span><span class="n">dmcst</span><span class="p">,</span> <span class="n">OUTMODE_MPEG2_PAR_CONT_CLK</span><span class="p">);</span></pre></div></td></tr>


<tr id="section-35"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-35">&#182;</a></div><p>set new i2c address and force divstr (Bit 1) to value 0 (Bit 0)</p></td><td class="code"><div class="highlight"><pre>		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">dmcst</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="p">(</span><span class="n">new_addr</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x1</span><span class="p">);</span>
		<span class="n">dmcst</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">=</span> <span class="n">new_addr</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">no_of_demods</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dmcst</span><span class="o">-&gt;</span><span class="n">cfg</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
		<span class="n">dmcst</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">=</span> <span class="n">DIB3000MC_I2C_ADDRESS</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>

		<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">dmcst</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">dmcst</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">);</span>

		<span class="cm">/* turn off data output */</span>
		<span class="n">dib3000mc_set_output_mode</span><span class="p">(</span><span class="n">dmcst</span><span class="p">,</span> <span class="n">OUTMODE_HIGH_Z</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">dmcst</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">dib3000mc_i2c_enumeration</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_frontend_ops</span> <span class="n">dib3000mc_ops</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span> <span class="nf">dib3000mc_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="n">u8</span> <span class="n">i2c_addr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">dib3000mc_config</span> <span class="o">*</span><span class="n">cfg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">demod</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib3000mc_state</span> <span class="o">*</span><span class="n">st</span><span class="p">;</span>
	<span class="n">st</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib3000mc_state</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">st</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">cfg</span> <span class="o">=</span> <span class="n">cfg</span><span class="p">;</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">i2c_adap</span> <span class="o">=</span> <span class="n">i2c_adap</span><span class="p">;</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">=</span> <span class="n">i2c_addr</span><span class="p">;</span>

	<span class="n">demod</span>                   <span class="o">=</span> <span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">demod</span><span class="p">;</span>
	<span class="n">demod</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span> <span class="o">=</span> <span class="n">st</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">demod</span><span class="p">.</span><span class="n">ops</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib3000mc_ops</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend_ops</span><span class="p">));</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib3000mc_identify</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

	<span class="n">dibx000_init_i2c_master</span><span class="p">(</span><span class="o">&amp;</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">i2c_master</span><span class="p">,</span> <span class="n">DIB3000MC</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="n">st</span><span class="o">-&gt;</span><span class="n">i2c_addr</span><span class="p">);</span>

	<span class="n">dib3000mc_write_word</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="mi">1037</span><span class="p">,</span> <span class="mh">0x3130</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">demod</span><span class="p">;</span>

<span class="nl">error:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">st</span><span class="p">);</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">dib3000mc_attach</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_frontend_ops</span> <span class="n">dib3000mc_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">delsys</span> <span class="o">=</span> <span class="p">{</span> <span class="n">SYS_DVBT</span> <span class="p">},</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;DiBcom 3000MC/P&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">frequency_min</span>      <span class="o">=</span> <span class="mi">44250000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">frequency_max</span>      <span class="o">=</span> <span class="mi">867250000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">frequency_stepsize</span> <span class="o">=</span> <span class="mi">62500</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">FE_CAN_INVERSION_AUTO</span> <span class="o">|</span>
			<span class="n">FE_CAN_FEC_1_2</span> <span class="o">|</span> <span class="n">FE_CAN_FEC_2_3</span> <span class="o">|</span> <span class="n">FE_CAN_FEC_3_4</span> <span class="o">|</span>
			<span class="n">FE_CAN_FEC_5_6</span> <span class="o">|</span> <span class="n">FE_CAN_FEC_7_8</span> <span class="o">|</span> <span class="n">FE_CAN_FEC_AUTO</span> <span class="o">|</span>
			<span class="n">FE_CAN_QPSK</span> <span class="o">|</span> <span class="n">FE_CAN_QAM_16</span> <span class="o">|</span> <span class="n">FE_CAN_QAM_64</span> <span class="o">|</span> <span class="n">FE_CAN_QAM_AUTO</span> <span class="o">|</span>
			<span class="n">FE_CAN_TRANSMISSION_MODE_AUTO</span> <span class="o">|</span>
			<span class="n">FE_CAN_GUARD_INTERVAL_AUTO</span> <span class="o">|</span>
			<span class="n">FE_CAN_RECOVER</span> <span class="o">|</span>
			<span class="n">FE_CAN_HIERARCHY_AUTO</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">.</span><span class="n">release</span>              <span class="o">=</span> <span class="n">dib3000mc_release</span><span class="p">,</span>

	<span class="p">.</span><span class="n">init</span>                 <span class="o">=</span> <span class="n">dib3000mc_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sleep</span>                <span class="o">=</span> <span class="n">dib3000mc_sleep</span><span class="p">,</span>

	<span class="p">.</span><span class="n">set_frontend</span>         <span class="o">=</span> <span class="n">dib3000mc_set_frontend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_tune_settings</span>    <span class="o">=</span> <span class="n">dib3000mc_fe_get_tune_settings</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_frontend</span>         <span class="o">=</span> <span class="n">dib3000mc_get_frontend</span><span class="p">,</span>

	<span class="p">.</span><span class="n">read_status</span>          <span class="o">=</span> <span class="n">dib3000mc_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_ber</span>             <span class="o">=</span> <span class="n">dib3000mc_read_ber</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_signal_strength</span> <span class="o">=</span> <span class="n">dib3000mc_read_signal_strength</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_snr</span>             <span class="o">=</span> <span class="n">dib3000mc_read_snr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_ucblocks</span>        <span class="o">=</span> <span class="n">dib3000mc_read_unc_blocks</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Patrick Boettcher &lt;pboettcher@dibcom.fr&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Driver for the DiBcom 3000MC/P COFDM demodulator&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
