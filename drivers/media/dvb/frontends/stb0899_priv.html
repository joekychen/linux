<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › frontends › stb0899_priv.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>stb0899_priv.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">	STB0899 Multistandard Frontend driver</span>
<span class="cm">	Copyright (C) Manu Abraham (abraham.manu@gmail.com)</span>

<span class="cm">	Copyright (C) ST Microelectronics</span>

<span class="cm">	This program is free software; you can redistribute it and/or modify</span>
<span class="cm">	it under the terms of the GNU General Public License as published by</span>
<span class="cm">	the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm">	(at your option) any later version.</span>

<span class="cm">	This program is distributed in the hope that it will be useful,</span>
<span class="cm">	but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">	MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">	GNU General Public License for more details.</span>

<span class="cm">	You should have received a copy of the GNU General Public License</span>
<span class="cm">	along with this program; if not, write to the Free Software</span>
<span class="cm">	Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm">*/</span>

<span class="cp">#ifndef __STB0899_PRIV_H</span>
<span class="cp">#define __STB0899_PRIV_H</span>

<span class="cp">#include &quot;dvb_frontend.h&quot;</span>
<span class="cp">#include &quot;stb0899_drv.h&quot;</span>

<span class="cp">#define FE_ERROR				0</span>
<span class="cp">#define FE_NOTICE				1</span>
<span class="cp">#define FE_INFO					2</span>
<span class="cp">#define FE_DEBUG				3</span>
<span class="cp">#define FE_DEBUGREG				4</span>

<span class="cp">#define dprintk(x, y, z, format, arg...) do {						\</span>
<span class="cp">	if (z) {									\</span>
<span class="cp">		if	((*x &gt; FE_ERROR) &amp;&amp; (*x &gt; y))					\</span>
<span class="cp">			printk(KERN_ERR &quot;%s: &quot; format &quot;\n&quot;, __func__ , ##arg);		\</span>
<span class="cp">		else if	((*x &gt; FE_NOTICE) &amp;&amp; (*x &gt; y))					\</span>
<span class="cp">			printk(KERN_NOTICE &quot;%s: &quot; format &quot;\n&quot;, __func__ , ##arg);	\</span>
<span class="cp">		else if ((*x &gt; FE_INFO) &amp;&amp; (*x &gt; y))					\</span>
<span class="cp">			printk(KERN_INFO &quot;%s: &quot; format &quot;\n&quot;, __func__ , ##arg);		\</span>
<span class="cp">		else if ((*x &gt; FE_DEBUG) &amp;&amp; (*x &gt; y))					\</span>
<span class="cp">			printk(KERN_DEBUG &quot;%s: &quot; format &quot;\n&quot;, __func__ , ##arg);	\</span>
<span class="cp">	} else {									\</span>
<span class="cp">		if (*x &gt; y)								\</span>
<span class="cp">			printk(format, ##arg);						\</span>
<span class="cp">	}										\</span>
<span class="cp">} while(0)</span>

<span class="cp">#define INRANGE(val, x, y)			(((x &lt;= val) &amp;&amp; (val &lt;= y)) ||		\</span>
<span class="cp">						 ((y &lt;= val) &amp;&amp; (val &lt;= x)) ? 1 : 0)</span>

<span class="cp">#define BYTE0					0</span>
<span class="cp">#define BYTE1					8</span>
<span class="cp">#define BYTE2					16</span>
<span class="cp">#define BYTE3					24</span>

<span class="cp">#define GETBYTE(x, y)				(((x) &gt;&gt; (y)) &amp; 0xff)</span>
<span class="cp">#define MAKEWORD32(a, b, c, d)			(((a) &lt;&lt; 24) | ((b) &lt;&lt; 16) | ((c) &lt;&lt; 8) | (d))</span>
<span class="cp">#define MAKEWORD16(a, b)			(((a) &lt;&lt; 8) | (b))</span>

<span class="cp">#define LSB(x)					((x &amp; 0xff))</span>
<span class="cp">#define MSB(y)					((y &gt;&gt; 8) &amp; 0xff)</span>


<span class="cp">#define STB0899_GETFIELD(bitf, val)		((val &gt;&gt; STB0899_OFFST_##bitf) &amp; ((1 &lt;&lt; STB0899_WIDTH_##bitf) - 1))</span>


<span class="cp">#define STB0899_SETFIELD(mask, val, width, offset)      (mask &amp; (~(((1 &lt;&lt; width) - 1) &lt;&lt;	\</span>
<span class="cp">							 offset))) | ((val &amp;			\</span>
<span class="cp">							 ((1 &lt;&lt; width) - 1)) &lt;&lt; offset)</span>

<span class="cp">#define STB0899_SETFIELD_VAL(bitf, mask, val)	(mask = (mask &amp; (~(((1 &lt;&lt; STB0899_WIDTH_##bitf) - 1) &lt;&lt;\</span>
<span class="cp">							 STB0899_OFFST_##bitf))) | \</span>
<span class="cp">							 (val &lt;&lt; STB0899_OFFST_##bitf))</span>


<span class="k">enum</span> <span class="n">stb0899_status</span> <span class="p">{</span>
	<span class="n">NOAGC1</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">AGC1OK</span><span class="p">,</span>
	<span class="n">NOTIMING</span><span class="p">,</span>
	<span class="n">ANALOGCARRIER</span><span class="p">,</span>
	<span class="n">TIMINGOK</span><span class="p">,</span>
	<span class="n">NOAGC2</span><span class="p">,</span>
	<span class="n">AGC2OK</span><span class="p">,</span>
	<span class="n">NOCARRIER</span><span class="p">,</span>
	<span class="n">CARRIEROK</span><span class="p">,</span>
	<span class="n">NODATA</span><span class="p">,</span>
	<span class="n">FALSELOCK</span><span class="p">,</span>
	<span class="n">DATAOK</span><span class="p">,</span>
	<span class="n">OUTOFRANGE</span><span class="p">,</span>
	<span class="n">RANGEOK</span><span class="p">,</span>
	<span class="n">DVBS2_DEMOD_LOCK</span><span class="p">,</span>
	<span class="n">DVBS2_DEMOD_NOLOCK</span><span class="p">,</span>
	<span class="n">DVBS2_FEC_LOCK</span><span class="p">,</span>
	<span class="n">DVBS2_FEC_NOLOCK</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">stb0899_modcod</span> <span class="p">{</span>
	<span class="n">STB0899_DUMMY_PLF</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_14</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_13</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_25</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_12</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_35</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_23</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_34</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_45</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_56</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_89</span><span class="p">,</span>
	<span class="n">STB0899_QPSK_910</span><span class="p">,</span>
	<span class="n">STB0899_8PSK_35</span><span class="p">,</span>
	<span class="n">STB0899_8PSK_23</span><span class="p">,</span>
	<span class="n">STB0899_8PSK_34</span><span class="p">,</span>
	<span class="n">STB0899_8PSK_56</span><span class="p">,</span>
	<span class="n">STB0899_8PSK_89</span><span class="p">,</span>
	<span class="n">STB0899_8PSK_910</span><span class="p">,</span>
	<span class="n">STB0899_16APSK_23</span><span class="p">,</span>
	<span class="n">STB0899_16APSK_34</span><span class="p">,</span>
	<span class="n">STB0899_16APSK_45</span><span class="p">,</span>
	<span class="n">STB0899_16APSK_56</span><span class="p">,</span>
	<span class="n">STB0899_16APSK_89</span><span class="p">,</span>
	<span class="n">STB0899_16APSK_910</span><span class="p">,</span>
	<span class="n">STB0899_32APSK_34</span><span class="p">,</span>
	<span class="n">STB0899_32APSK_45</span><span class="p">,</span>
	<span class="n">STB0899_32APSK_56</span><span class="p">,</span>
	<span class="n">STB0899_32APSK_89</span><span class="p">,</span>
	<span class="n">STB0899_32APSK_910</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">stb0899_frame</span> <span class="p">{</span>
	<span class="n">STB0899_LONG_FRAME</span><span class="p">,</span>
	<span class="n">STB0899_SHORT_FRAME</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">stb0899_alpha</span> <span class="p">{</span>
	<span class="n">RRC_20</span><span class="p">,</span>
	<span class="n">RRC_25</span><span class="p">,</span>
	<span class="n">RRC_35</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">stb0899_tab</span> <span class="p">{</span>
	<span class="n">s32</span> <span class="n">real</span><span class="p">;</span>
	<span class="n">s32</span> <span class="n">read</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">stb0899_fec</span> <span class="p">{</span>
	<span class="n">STB0899_FEC_1_2</span>			<span class="o">=</span> <span class="mi">13</span><span class="p">,</span>
	<span class="n">STB0899_FEC_2_3</span>			<span class="o">=</span> <span class="mi">18</span><span class="p">,</span>
	<span class="n">STB0899_FEC_3_4</span>			<span class="o">=</span> <span class="mi">21</span><span class="p">,</span>
	<span class="n">STB0899_FEC_5_6</span>			<span class="o">=</span> <span class="mi">24</span><span class="p">,</span>
	<span class="n">STB0899_FEC_6_7</span>			<span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
	<span class="n">STB0899_FEC_7_8</span>			<span class="o">=</span> <span class="mi">26</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">stb0899_params</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">freq</span><span class="p">;</span>					<span class="cm">/* Frequency	*/</span>
	<span class="n">u32</span>	<span class="n">srate</span><span class="p">;</span>					<span class="cm">/* Symbol rate	*/</span>
	<span class="k">enum</span> <span class="n">fe_code_rate</span> <span class="n">fecrate</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">stb0899_internal</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">master_clk</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">freq</span><span class="p">;</span>			<span class="cm">/* Demod internal Frequency		*/</span>
	<span class="n">u32</span>			<span class="n">srate</span><span class="p">;</span>			<span class="cm">/* Demod internal Symbol rate		*/</span>
	<span class="k">enum</span> <span class="n">stb0899_fec</span>	<span class="n">fecrate</span><span class="p">;</span>		<span class="cm">/* Demod internal FEC rate		*/</span>
	<span class="n">s32</span>			<span class="n">srch_range</span><span class="p">;</span>		<span class="cm">/* Demod internal Search Range		*/</span>
	<span class="n">s32</span>			<span class="n">sub_range</span><span class="p">;</span>		<span class="cm">/* Demod current sub range (Hz)		*/</span>
	<span class="n">s32</span>			<span class="n">tuner_step</span><span class="p">;</span>		<span class="cm">/* Tuner step (Hz)			*/</span>
	<span class="n">s32</span>			<span class="n">tuner_offst</span><span class="p">;</span>		<span class="cm">/* Relative offset to carrier (Hz)	*/</span>
	<span class="n">u32</span>			<span class="n">tuner_bw</span><span class="p">;</span>		<span class="cm">/* Current bandwidth of the tuner (Hz)	*/</span>

	<span class="n">s32</span>			<span class="n">mclk</span><span class="p">;</span>			<span class="cm">/* Masterclock Divider factor (binary)	*/</span>
	<span class="n">s32</span>			<span class="n">rolloff</span><span class="p">;</span>		<span class="cm">/* Current RollOff of the filter (x100)	*/</span>

	<span class="n">s16</span>			<span class="n">derot_freq</span><span class="p">;</span>		<span class="cm">/* Current derotator frequency (Hz)	*/</span>
	<span class="n">s16</span>			<span class="n">derot_percent</span><span class="p">;</span>

	<span class="n">s16</span>			<span class="n">direction</span><span class="p">;</span>		<span class="cm">/* Current derotator search direction	*/</span>
	<span class="n">s16</span>			<span class="n">derot_step</span><span class="p">;</span>		<span class="cm">/* Derotator step (binary value)	*/</span>
	<span class="n">s16</span>			<span class="n">t_derot</span><span class="p">;</span>		<span class="cm">/* Derotator time constant (ms)		*/</span>
	<span class="n">s16</span>			<span class="n">t_data</span><span class="p">;</span>			<span class="cm">/* Data recovery time constant (ms)	*/</span>
	<span class="n">s16</span>			<span class="n">sub_dir</span><span class="p">;</span>		<span class="cm">/* Direction of the next sub range	*/</span>

	<span class="n">s16</span>			<span class="n">t_agc1</span><span class="p">;</span>			<span class="cm">/* Agc1 time constant (ms)		*/</span>
	<span class="n">s16</span>			<span class="n">t_agc2</span><span class="p">;</span>			<span class="cm">/* Agc2 time constant (ms)		*/</span>

	<span class="n">u32</span>			<span class="n">lock</span><span class="p">;</span>			<span class="cm">/* Demod internal lock state		*/</span>
	<span class="k">enum</span> <span class="n">stb0899_status</span>	<span class="n">status</span><span class="p">;</span>			<span class="cm">/* Demod internal status		*/</span>

	<span class="cm">/* DVB-S2 */</span>
	<span class="n">s32</span>			<span class="n">agc_gain</span><span class="p">;</span>		<span class="cm">/* RF AGC Gain				*/</span>
	<span class="n">s32</span>			<span class="n">center_freq</span><span class="p">;</span>		<span class="cm">/* Nominal carrier frequency		*/</span>
	<span class="n">s32</span>			<span class="n">av_frame_coarse</span><span class="p">;</span>	<span class="cm">/* Coarse carrier freq search frames	*/</span>
	<span class="n">s32</span>			<span class="n">av_frame_fine</span><span class="p">;</span>		<span class="cm">/* Fine carrier freq search frames	*/</span>

	<span class="n">s16</span>			<span class="n">step_size</span><span class="p">;</span>		<span class="cm">/* Carrier frequency search step size	*/</span>

	<span class="k">enum</span> <span class="n">stb0899_alpha</span>	<span class="n">rrc_alpha</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">stb0899_inversion</span>	<span class="n">inversion</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">stb0899_modcod</span>	<span class="n">modcod</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">pilots</span><span class="p">;</span>			<span class="cm">/* Pilots found				*/</span>

	<span class="k">enum</span> <span class="n">stb0899_frame</span>	<span class="n">frame_length</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">v_status</span><span class="p">;</span>		<span class="cm">/* VSTATUS				*/</span>
	<span class="n">u8</span>			<span class="n">err_ctrl</span><span class="p">;</span>		<span class="cm">/* ERRCTRLn				*/</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">stb0899_state</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span>		<span class="o">*</span><span class="n">i2c</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">stb0899_config</span>		<span class="o">*</span><span class="n">config</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span>		<span class="n">frontend</span><span class="p">;</span>

	<span class="n">u32</span>				<span class="o">*</span><span class="n">verbose</span><span class="p">;</span>	<span class="cm">/* Cached module verbosity level	*/</span>

	<span class="k">struct</span> <span class="n">stb0899_internal</span>		<span class="n">internal</span><span class="p">;</span>	<span class="cm">/* Device internal parameters		*/</span>

	<span class="cm">/*	cached params from API	*/</span>
	<span class="k">enum</span> <span class="n">fe_delivery_system</span>		<span class="n">delsys</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">stb0899_params</span>		<span class="n">params</span><span class="p">;</span>

	<span class="n">u32</span>				<span class="n">rx_freq</span><span class="p">;</span>	<span class="cm">/* DiSEqC 2.0 receiver freq		*/</span>
	<span class="k">struct</span> <span class="n">mutex</span>			<span class="n">search_lock</span><span class="p">;</span>
<span class="p">};</span>
<span class="cm">/* stb0899.c		*/</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">stb0899_read_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span>
			    <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">);</span>

<span class="k">extern</span> <span class="n">u32</span> <span class="n">_stb0899_read_s2reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span>
			       <span class="n">u32</span> <span class="n">stb0899_i2cdev</span><span class="p">,</span>
			       <span class="n">u32</span> <span class="n">stb0899_base_addr</span><span class="p">,</span>
			       <span class="n">u16</span> <span class="n">stb0899_reg_offset</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">stb0899_read_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			     <span class="n">u32</span> <span class="n">count</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">stb0899_write_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span>
			      <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>
			      <span class="n">u32</span> <span class="n">count</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">stb0899_write_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span>
			     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">,</span>
			     <span class="n">u8</span> <span class="n">data</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">stb0899_write_s2reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span>
			       <span class="n">u32</span> <span class="n">stb0899_i2cdev</span><span class="p">,</span>
			       <span class="n">u32</span> <span class="n">stb0899_base_addr</span><span class="p">,</span>
			       <span class="n">u16</span> <span class="n">stb0899_reg_offset</span><span class="p">,</span>
			       <span class="n">u32</span> <span class="n">stb0899_data</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">stb0899_i2c_gate_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">);</span>


<span class="cp">#define STB0899_READ_S2REG(DEVICE, REG) 	(_stb0899_read_s2reg(state, DEVICE, STB0899_BASE_##REG, STB0899_OFF0_##REG))</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><h1>define STB0899<em>WRITE</em>S2REG(DEVICE, REG, DATA)    (<em>stb0899</em>write<em>s2reg(state, DEVICE, STB0899</em>BASE<em>##REG, STB0899</em>OFF0_##REG, DATA))</h1></td><td class="code"><div class="highlight"><pre><span class="cm">/* stb0899_algo.c	*/</span>
<span class="k">extern</span> <span class="k">enum</span> <span class="n">stb0899_status</span> <span class="n">stb0899_dvbs_algo</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">enum</span> <span class="n">stb0899_status</span> <span class="n">stb0899_dvbs2_algo</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">long</span> <span class="n">stb0899_carr_width</span><span class="p">(</span><span class="k">struct</span> <span class="n">stb0899_state</span> <span class="o">*</span><span class="n">state</span><span class="p">);</span>

<span class="cp">#endif </span><span class="c1">//__STB0899_PRIV_H</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
