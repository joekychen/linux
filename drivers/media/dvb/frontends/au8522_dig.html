<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › frontends › au8522_dig.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>au8522_dig.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm">    Auvitek AU8522 QAM/8VSB demodulator driver</span>

<span class="cm">    Copyright (C) 2008 Steven Toth &lt;stoth@linuxtv.org&gt;</span>

<span class="cm">    This program is free software; you can redistribute it and/or modify</span>
<span class="cm">    it under the terms of the GNU General Public License as published by</span>
<span class="cm">    the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm">    (at your option) any later version.</span>

<span class="cm">    This program is distributed in the hope that it will be useful,</span>
<span class="cm">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">    GNU General Public License for more details.</span>

<span class="cm">    You should have received a copy of the GNU General Public License</span>
<span class="cm">    along with this program; if not, write to the Free Software</span>
<span class="cm">    Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>

<span class="cm">*/</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/string.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &quot;dvb_frontend.h&quot;</span>
<span class="cp">#include &quot;au8522.h&quot;</span>
<span class="cp">#include &quot;au8522_priv.h&quot;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">debug</span><span class="p">;</span>

<span class="cp">#define dprintk(arg...)\</span>
<span class="cp">	do { if (debug)\</span>
<span class="cp">		printk(arg);\</span>
<span class="cp">	} while (0)</span>

<span class="k">struct</span> <span class="n">mse2snr_tab</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">data</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* VSB SNR lookup table */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mse2snr_tab</span> <span class="n">vsb_mse2snr_tab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">270</span> <span class="p">},</span>
	<span class="p">{</span>   <span class="mi">2</span><span class="p">,</span> <span class="mi">250</span> <span class="p">},</span>
	<span class="p">{</span>   <span class="mi">3</span><span class="p">,</span> <span class="mi">240</span> <span class="p">},</span>
	<span class="p">{</span>   <span class="mi">5</span><span class="p">,</span> <span class="mi">230</span> <span class="p">},</span>
	<span class="p">{</span>   <span class="mi">7</span><span class="p">,</span> <span class="mi">220</span> <span class="p">},</span>
	<span class="p">{</span>   <span class="mi">9</span><span class="p">,</span> <span class="mi">210</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">12</span><span class="p">,</span> <span class="mi">200</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">13</span><span class="p">,</span> <span class="mi">195</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">15</span><span class="p">,</span> <span class="mi">190</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">17</span><span class="p">,</span> <span class="mi">185</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">19</span><span class="p">,</span> <span class="mi">180</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">21</span><span class="p">,</span> <span class="mi">175</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">24</span><span class="p">,</span> <span class="mi">170</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">27</span><span class="p">,</span> <span class="mi">165</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">31</span><span class="p">,</span> <span class="mi">160</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">32</span><span class="p">,</span> <span class="mi">158</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">33</span><span class="p">,</span> <span class="mi">156</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">36</span><span class="p">,</span> <span class="mi">152</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">37</span><span class="p">,</span> <span class="mi">150</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">39</span><span class="p">,</span> <span class="mi">148</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">40</span><span class="p">,</span> <span class="mi">146</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">41</span><span class="p">,</span> <span class="mi">144</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">43</span><span class="p">,</span> <span class="mi">142</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">44</span><span class="p">,</span> <span class="mi">140</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">48</span><span class="p">,</span> <span class="mi">135</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">50</span><span class="p">,</span> <span class="mi">130</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">43</span><span class="p">,</span> <span class="mi">142</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">53</span><span class="p">,</span> <span class="mi">125</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">56</span><span class="p">,</span> <span class="mi">120</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">115</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* QAM64 SNR lookup table */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mse2snr_tab</span> <span class="n">qam64_mse2snr_tab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>  <span class="mi">15</span><span class="p">,</span>   <span class="mi">0</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">16</span><span class="p">,</span> <span class="mi">290</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">17</span><span class="p">,</span> <span class="mi">288</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">18</span><span class="p">,</span> <span class="mi">286</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">19</span><span class="p">,</span> <span class="mi">284</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">20</span><span class="p">,</span> <span class="mi">282</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">21</span><span class="p">,</span> <span class="mi">281</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">22</span><span class="p">,</span> <span class="mi">279</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">23</span><span class="p">,</span> <span class="mi">277</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">24</span><span class="p">,</span> <span class="mi">275</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">25</span><span class="p">,</span> <span class="mi">273</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">271</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">27</span><span class="p">,</span> <span class="mi">269</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">28</span><span class="p">,</span> <span class="mi">268</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">29</span><span class="p">,</span> <span class="mi">266</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">30</span><span class="p">,</span> <span class="mi">264</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">31</span><span class="p">,</span> <span class="mi">262</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">32</span><span class="p">,</span> <span class="mi">260</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">33</span><span class="p">,</span> <span class="mi">259</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">34</span><span class="p">,</span> <span class="mi">258</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">35</span><span class="p">,</span> <span class="mi">256</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">36</span><span class="p">,</span> <span class="mi">255</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">37</span><span class="p">,</span> <span class="mi">254</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">38</span><span class="p">,</span> <span class="mi">252</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">39</span><span class="p">,</span> <span class="mi">251</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">40</span><span class="p">,</span> <span class="mi">250</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">41</span><span class="p">,</span> <span class="mi">249</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">42</span><span class="p">,</span> <span class="mi">248</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">43</span><span class="p">,</span> <span class="mi">246</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">44</span><span class="p">,</span> <span class="mi">245</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">45</span><span class="p">,</span> <span class="mi">244</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">46</span><span class="p">,</span> <span class="mi">242</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">47</span><span class="p">,</span> <span class="mi">241</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">48</span><span class="p">,</span> <span class="mi">240</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">50</span><span class="p">,</span> <span class="mi">239</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">51</span><span class="p">,</span> <span class="mi">238</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">53</span><span class="p">,</span> <span class="mi">237</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">54</span><span class="p">,</span> <span class="mi">236</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">56</span><span class="p">,</span> <span class="mi">235</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">57</span><span class="p">,</span> <span class="mi">234</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">59</span><span class="p">,</span> <span class="mi">233</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">60</span><span class="p">,</span> <span class="mi">232</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">62</span><span class="p">,</span> <span class="mi">231</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">63</span><span class="p">,</span> <span class="mi">230</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">65</span><span class="p">,</span> <span class="mi">229</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">67</span><span class="p">,</span> <span class="mi">228</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">68</span><span class="p">,</span> <span class="mi">227</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">70</span><span class="p">,</span> <span class="mi">226</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">71</span><span class="p">,</span> <span class="mi">225</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">73</span><span class="p">,</span> <span class="mi">224</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">74</span><span class="p">,</span> <span class="mi">223</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">76</span><span class="p">,</span> <span class="mi">222</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">78</span><span class="p">,</span> <span class="mi">221</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">80</span><span class="p">,</span> <span class="mi">220</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">82</span><span class="p">,</span> <span class="mi">219</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">85</span><span class="p">,</span> <span class="mi">218</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">88</span><span class="p">,</span> <span class="mi">217</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">90</span><span class="p">,</span> <span class="mi">216</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">92</span><span class="p">,</span> <span class="mi">215</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">93</span><span class="p">,</span> <span class="mi">214</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">94</span><span class="p">,</span> <span class="mi">212</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">95</span><span class="p">,</span> <span class="mi">211</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">97</span><span class="p">,</span> <span class="mi">210</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">99</span><span class="p">,</span> <span class="mi">209</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">101</span><span class="p">,</span> <span class="mi">208</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">207</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">206</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">205</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">111</span><span class="p">,</span> <span class="mi">204</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">114</span><span class="p">,</span> <span class="mi">203</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">202</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">201</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">200</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">199</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">198</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">132</span><span class="p">,</span> <span class="mi">197</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">190</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* QAM256 SNR lookup table */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mse2snr_tab</span> <span class="n">qam256_mse2snr_tab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>  <span class="mi">16</span><span class="p">,</span>   <span class="mi">0</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">17</span><span class="p">,</span> <span class="mi">400</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">18</span><span class="p">,</span> <span class="mi">398</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">19</span><span class="p">,</span> <span class="mi">396</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">20</span><span class="p">,</span> <span class="mi">394</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">21</span><span class="p">,</span> <span class="mi">392</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">22</span><span class="p">,</span> <span class="mi">390</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">23</span><span class="p">,</span> <span class="mi">388</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">24</span><span class="p">,</span> <span class="mi">386</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">25</span><span class="p">,</span> <span class="mi">384</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">26</span><span class="p">,</span> <span class="mi">382</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">27</span><span class="p">,</span> <span class="mi">380</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">28</span><span class="p">,</span> <span class="mi">379</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">29</span><span class="p">,</span> <span class="mi">378</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">30</span><span class="p">,</span> <span class="mi">377</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">31</span><span class="p">,</span> <span class="mi">376</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">32</span><span class="p">,</span> <span class="mi">375</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">33</span><span class="p">,</span> <span class="mi">374</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">34</span><span class="p">,</span> <span class="mi">373</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">35</span><span class="p">,</span> <span class="mi">372</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">36</span><span class="p">,</span> <span class="mi">371</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">37</span><span class="p">,</span> <span class="mi">370</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">38</span><span class="p">,</span> <span class="mi">362</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">39</span><span class="p">,</span> <span class="mi">354</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">40</span><span class="p">,</span> <span class="mi">346</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">41</span><span class="p">,</span> <span class="mi">338</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">42</span><span class="p">,</span> <span class="mi">330</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">43</span><span class="p">,</span> <span class="mi">328</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">44</span><span class="p">,</span> <span class="mi">326</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">45</span><span class="p">,</span> <span class="mi">324</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">46</span><span class="p">,</span> <span class="mi">322</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">47</span><span class="p">,</span> <span class="mi">320</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">48</span><span class="p">,</span> <span class="mi">319</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">49</span><span class="p">,</span> <span class="mi">318</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">50</span><span class="p">,</span> <span class="mi">317</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">51</span><span class="p">,</span> <span class="mi">316</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">52</span><span class="p">,</span> <span class="mi">315</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">53</span><span class="p">,</span> <span class="mi">314</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">54</span><span class="p">,</span> <span class="mi">313</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">55</span><span class="p">,</span> <span class="mi">312</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">56</span><span class="p">,</span> <span class="mi">311</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">57</span><span class="p">,</span> <span class="mi">310</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">58</span><span class="p">,</span> <span class="mi">308</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">59</span><span class="p">,</span> <span class="mi">306</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">60</span><span class="p">,</span> <span class="mi">304</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">61</span><span class="p">,</span> <span class="mi">302</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">62</span><span class="p">,</span> <span class="mi">300</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">63</span><span class="p">,</span> <span class="mi">298</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">65</span><span class="p">,</span> <span class="mi">295</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">68</span><span class="p">,</span> <span class="mi">294</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">70</span><span class="p">,</span> <span class="mi">293</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">73</span><span class="p">,</span> <span class="mi">292</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">76</span><span class="p">,</span> <span class="mi">291</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">78</span><span class="p">,</span> <span class="mi">290</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">79</span><span class="p">,</span> <span class="mi">289</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">81</span><span class="p">,</span> <span class="mi">288</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">82</span><span class="p">,</span> <span class="mi">287</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">83</span><span class="p">,</span> <span class="mi">286</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">84</span><span class="p">,</span> <span class="mi">285</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">85</span><span class="p">,</span> <span class="mi">284</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">86</span><span class="p">,</span> <span class="mi">283</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">88</span><span class="p">,</span> <span class="mi">282</span> <span class="p">},</span>
	<span class="p">{</span>  <span class="mi">89</span><span class="p">,</span> <span class="mi">281</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">280</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_mse2snr_lookup</span><span class="p">(</span><span class="k">struct</span> <span class="n">mse2snr_tab</span> <span class="o">*</span><span class="n">tab</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sz</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mse</span><span class="p">,</span>
				 <span class="n">u16</span> <span class="o">*</span><span class="n">snr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">sz</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">mse</span> <span class="o">&lt;</span> <span class="n">tab</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
			<span class="o">*</span><span class="n">snr</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">;</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() snr=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">snr</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_set_if</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="k">enum</span> <span class="n">au8522_if_freq</span> <span class="n">if_freq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">r0b5</span><span class="p">,</span> <span class="n">r0b6</span><span class="p">,</span> <span class="n">r0b7</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">ifmhz</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">if_freq</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AU8522_IF_3_25MHZ</span>:
		<span class="n">ifmhz</span> <span class="o">=</span> <span class="s">&quot;3.25&quot;</span><span class="p">;</span>
		<span class="n">r0b5</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">r0b6</span> <span class="o">=</span> <span class="mh">0x3d</span><span class="p">;</span>
		<span class="n">r0b7</span> <span class="o">=</span> <span class="mh">0xa0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AU8522_IF_4MHZ</span>:
		<span class="n">ifmhz</span> <span class="o">=</span> <span class="s">&quot;4.00&quot;</span><span class="p">;</span>
		<span class="n">r0b5</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">r0b6</span> <span class="o">=</span> <span class="mh">0x4b</span><span class="p">;</span>
		<span class="n">r0b7</span> <span class="o">=</span> <span class="mh">0xd9</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AU8522_IF_6MHZ</span>:
		<span class="n">ifmhz</span> <span class="o">=</span> <span class="s">&quot;6.00&quot;</span><span class="p">;</span>
		<span class="n">r0b5</span> <span class="o">=</span> <span class="mh">0xfb</span><span class="p">;</span>
		<span class="n">r0b6</span> <span class="o">=</span> <span class="mh">0x8e</span><span class="p">;</span>
		<span class="n">r0b7</span> <span class="o">=</span> <span class="mh">0x39</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() IF Frequency not supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() %s MHz</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">ifmhz</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x80b5</span><span class="p">,</span> <span class="n">r0b5</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x80b6</span><span class="p">,</span> <span class="n">r0b6</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x80b7</span><span class="p">,</span> <span class="n">r0b7</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* VSB Modulation table */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">VSB_mod_tab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x8090</span><span class="p">,</span> <span class="mh">0x84</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4092</span><span class="p">,</span> <span class="mh">0x11</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2005</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8091</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a3</span><span class="p">,</span> <span class="mh">0x0c</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a4</span><span class="p">,</span> <span class="mh">0xe8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8081</span><span class="p">,</span> <span class="mh">0xc4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a5</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a7</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a6</span><span class="p">,</span> <span class="mh">0x67</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8262</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x821c</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d8</span><span class="p">,</span> <span class="mh">0x1a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8227</span><span class="p">,</span> <span class="mh">0xa0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8121</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a8</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a9</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80aa</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80ab</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80ac</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80ad</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80ae</span><span class="p">,</span> <span class="mh">0x41</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80af</span><span class="p">,</span> <span class="mh">0x66</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x821b</span><span class="p">,</span> <span class="mh">0xcc</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x821d</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a4</span><span class="p">,</span> <span class="mh">0xe8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8231</span><span class="p">,</span> <span class="mh">0x13</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* QAM64 Modulation table */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">QAM64_mod_tab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x00a3</span><span class="p">,</span> <span class="mh">0x09</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00a4</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0081</span><span class="p">,</span> <span class="mh">0xc4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00a5</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00aa</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00ad</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00a6</span><span class="p">,</span> <span class="mh">0x67</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0262</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x021c</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00b8</span><span class="p">,</span> <span class="mh">0x3e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00b9</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00ba</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00bb</span><span class="p">,</span> <span class="mh">0x18</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00bc</span><span class="p">,</span> <span class="mh">0x50</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00bd</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00be</span><span class="p">,</span> <span class="mh">0xea</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00bf</span><span class="p">,</span> <span class="mh">0xef</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c0</span><span class="p">,</span> <span class="mh">0xfc</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c1</span><span class="p">,</span> <span class="mh">0xbd</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c2</span><span class="p">,</span> <span class="mh">0x1f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c3</span><span class="p">,</span> <span class="mh">0xfc</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c4</span><span class="p">,</span> <span class="mh">0xdd</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c5</span><span class="p">,</span> <span class="mh">0xaf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c6</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c7</span><span class="p">,</span> <span class="mh">0x38</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c8</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00c9</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00ca</span><span class="p">,</span> <span class="mh">0x4a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00cb</span><span class="p">,</span> <span class="mh">0xd0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00cc</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00cd</span><span class="p">,</span> <span class="mh">0xd9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00ce</span><span class="p">,</span> <span class="mh">0x6f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00cf</span><span class="p">,</span> <span class="mh">0xf9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00d0</span><span class="p">,</span> <span class="mh">0x70</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00d1</span><span class="p">,</span> <span class="mh">0xdf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00d2</span><span class="p">,</span> <span class="mh">0xf7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00d3</span><span class="p">,</span> <span class="mh">0xc2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00d4</span><span class="p">,</span> <span class="mh">0xdf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00d5</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00d6</span><span class="p">,</span> <span class="mh">0x9a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00d7</span><span class="p">,</span> <span class="mh">0xd0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0250</span><span class="p">,</span> <span class="mh">0x0d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0251</span><span class="p">,</span> <span class="mh">0xcd</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0252</span><span class="p">,</span> <span class="mh">0xe0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0253</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0254</span><span class="p">,</span> <span class="mh">0xa7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0255</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0256</span><span class="p">,</span> <span class="mh">0xed</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0257</span><span class="p">,</span> <span class="mh">0x5b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0258</span><span class="p">,</span> <span class="mh">0xae</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0259</span><span class="p">,</span> <span class="mh">0xe6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x025a</span><span class="p">,</span> <span class="mh">0x3d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x025b</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x025c</span><span class="p">,</span> <span class="mh">0x0d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x025d</span><span class="p">,</span> <span class="mh">0xea</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x025e</span><span class="p">,</span> <span class="mh">0xf2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x025f</span><span class="p">,</span> <span class="mh">0x51</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0260</span><span class="p">,</span> <span class="mh">0xf5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0261</span><span class="p">,</span> <span class="mh">0x06</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x021a</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0546</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0210</span><span class="p">,</span> <span class="mh">0xc7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0211</span><span class="p">,</span> <span class="mh">0xaa</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0212</span><span class="p">,</span> <span class="mh">0xab</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0213</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0502</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0121</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0122</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x052e</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00a4</span><span class="p">,</span> <span class="mh">0xca</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00a7</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0526</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* QAM256 Modulation table */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span> <span class="n">QAM256_mod_tab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x80a3</span><span class="p">,</span> <span class="mh">0x09</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a4</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8081</span><span class="p">,</span> <span class="mh">0xc4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a5</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80aa</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80ad</span><span class="p">,</span> <span class="mh">0x77</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a6</span><span class="p">,</span> <span class="mh">0x67</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8262</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x821c</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80b8</span><span class="p">,</span> <span class="mh">0x3e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80b9</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80ba</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80bb</span><span class="p">,</span> <span class="mh">0x18</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80bc</span><span class="p">,</span> <span class="mh">0x50</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80bd</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80be</span><span class="p">,</span> <span class="mh">0xea</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80bf</span><span class="p">,</span> <span class="mh">0xef</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c0</span><span class="p">,</span> <span class="mh">0xfc</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c1</span><span class="p">,</span> <span class="mh">0xbd</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c2</span><span class="p">,</span> <span class="mh">0x1f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c3</span><span class="p">,</span> <span class="mh">0xfc</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c4</span><span class="p">,</span> <span class="mh">0xdd</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c5</span><span class="p">,</span> <span class="mh">0xaf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c6</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c7</span><span class="p">,</span> <span class="mh">0x38</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c8</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80c9</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80ca</span><span class="p">,</span> <span class="mh">0x4a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80cb</span><span class="p">,</span> <span class="mh">0xd0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80cc</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80cd</span><span class="p">,</span> <span class="mh">0xd9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80ce</span><span class="p">,</span> <span class="mh">0x6f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80cf</span><span class="p">,</span> <span class="mh">0xf9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d0</span><span class="p">,</span> <span class="mh">0x70</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d1</span><span class="p">,</span> <span class="mh">0xdf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d2</span><span class="p">,</span> <span class="mh">0xf7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d3</span><span class="p">,</span> <span class="mh">0xc2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d4</span><span class="p">,</span> <span class="mh">0xdf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d5</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d6</span><span class="p">,</span> <span class="mh">0x9a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80d7</span><span class="p">,</span> <span class="mh">0xd0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8250</span><span class="p">,</span> <span class="mh">0x0d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8251</span><span class="p">,</span> <span class="mh">0xcd</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8252</span><span class="p">,</span> <span class="mh">0xe0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8253</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8254</span><span class="p">,</span> <span class="mh">0xa7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8255</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8256</span><span class="p">,</span> <span class="mh">0xed</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8257</span><span class="p">,</span> <span class="mh">0x5b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8258</span><span class="p">,</span> <span class="mh">0xae</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8259</span><span class="p">,</span> <span class="mh">0xe6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x825a</span><span class="p">,</span> <span class="mh">0x3d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x825b</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x825c</span><span class="p">,</span> <span class="mh">0x0d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x825d</span><span class="p">,</span> <span class="mh">0xea</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x825e</span><span class="p">,</span> <span class="mh">0xf2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x825f</span><span class="p">,</span> <span class="mh">0x51</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8260</span><span class="p">,</span> <span class="mh">0xf5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8261</span><span class="p">,</span> <span class="mh">0x06</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x821a</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8546</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8210</span><span class="p">,</span> <span class="mh">0x26</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8211</span><span class="p">,</span> <span class="mh">0xf6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8212</span><span class="p">,</span> <span class="mh">0x84</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8213</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8502</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8121</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8122</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x852e</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a4</span><span class="p">,</span> <span class="mh">0xca</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80a7</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8526</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_enable_modulation</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span>
				    <span class="n">fe_modulation_t</span> <span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s(0x%08x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">m</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">VSB_8</span>:
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() VSB_8</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">VSB_mod_tab</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
				<span class="n">VSB_mod_tab</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg</span><span class="p">,</span>
				<span class="n">VSB_mod_tab</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">);</span>
		<span class="n">au8522_set_if</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">vsb_if</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">QAM_64</span>:
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() QAM 64</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">QAM64_mod_tab</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
				<span class="n">QAM64_mod_tab</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg</span><span class="p">,</span>
				<span class="n">QAM64_mod_tab</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">);</span>
		<span class="n">au8522_set_if</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">qam_if</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">QAM_256</span>:
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() QAM 256</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">QAM256_mod_tab</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
				<span class="n">QAM256_mod_tab</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg</span><span class="p">,</span>
				<span class="n">QAM256_mod_tab</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">);</span>
		<span class="n">au8522_set_if</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">qam_if</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() Invalid modulation</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span> <span class="o">=</span> <span class="n">m</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Talk to the demod, set the FEC, GUARD, QAM settings etc */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_set_frontend</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s(frequency=%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">frequency</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">current_frequency</span> <span class="o">==</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">frequency</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span> <span class="o">==</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">modulation</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">)</span>
			<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">)</span>
			<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="cm">/* Allow the tuner to settle */</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="n">au8522_enable_modulation</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">modulation</span><span class="p">);</span>

	<span class="n">state</span><span class="o">-&gt;</span><span class="n">current_frequency</span> <span class="o">=</span> <span class="n">c</span><span class="o">-&gt;</span><span class="n">frequency</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_read_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">fe_status_t</span> <span class="o">*</span><span class="n">status</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tuner_status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="o">*</span><span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span> <span class="o">==</span> <span class="n">VSB_8</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() Checking VSB_8</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x4088</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span>
			<span class="o">*</span><span class="n">status</span> <span class="o">|=</span> <span class="n">FE_HAS_LOCK</span> <span class="o">|</span> <span class="n">FE_HAS_SYNC</span> <span class="o">|</span> <span class="n">FE_HAS_VITERBI</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() Checking QAM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x4541</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span>
			<span class="o">*</span><span class="n">status</span> <span class="o">|=</span> <span class="n">FE_HAS_VITERBI</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span>
			<span class="o">*</span><span class="n">status</span> <span class="o">|=</span> <span class="n">FE_HAS_LOCK</span> <span class="o">|</span> <span class="n">FE_HAS_SYNC</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">status_mode</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">AU8522_DEMODLOCKING</span>:
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() DEMODLOCKING</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">FE_HAS_VITERBI</span><span class="p">)</span>
			<span class="o">*</span><span class="n">status</span> <span class="o">|=</span> <span class="n">FE_HAS_CARRIER</span> <span class="o">|</span> <span class="n">FE_HAS_SIGNAL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">AU8522_TUNERLOCKING</span>:
		<span class="cm">/* Get the tuner status */</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() TUNERLOCKING</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">get_status</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">)</span>
				<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

			<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">get_status</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tuner_status</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">)</span>
				<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tuner_status</span><span class="p">)</span>
			<span class="o">*</span><span class="n">status</span> <span class="o">|=</span> <span class="n">FE_HAS_CARRIER</span> <span class="o">|</span> <span class="n">FE_HAS_SIGNAL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">fe_status</span> <span class="o">=</span> <span class="o">*</span><span class="n">status</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">FE_HAS_LOCK</span><span class="p">)</span>
		<span class="cm">/* turn on LED, if it isn&#39;t on already */</span>
		<span class="n">au8522_led_ctrl</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="cm">/* turn off LED */</span>
		<span class="n">au8522_led_ctrl</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s() status 0x%08x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="o">*</span><span class="n">status</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_led_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="k">const</span> <span class="n">u16</span> <span class="o">*</span><span class="n">snr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_led_config</span> <span class="o">*</span><span class="n">led_config</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">led_cfg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">led</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">strong</span><span class="p">;</span>

	<span class="cm">/* bail out if we can&#39;t control an LED */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">led_config</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">fe_status</span> <span class="o">&amp;</span> <span class="n">FE_HAS_LOCK</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">au8522_led_ctrl</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span> <span class="o">==</span> <span class="n">QAM_256</span><span class="p">)</span>
		<span class="n">strong</span> <span class="o">=</span> <span class="n">led_config</span><span class="o">-&gt;</span><span class="n">qam256_strong</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span> <span class="o">==</span> <span class="n">QAM_64</span><span class="p">)</span>
		<span class="n">strong</span> <span class="o">=</span> <span class="n">led_config</span><span class="o">-&gt;</span><span class="n">qam64_strong</span><span class="p">;</span>
	<span class="k">else</span> <span class="cm">/* (state-&gt;current_modulation == VSB_8) */</span>
		<span class="n">strong</span> <span class="o">=</span> <span class="n">led_config</span><span class="o">-&gt;</span><span class="n">vsb8_strong</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">snr</span> <span class="o">&gt;=</span> <span class="n">strong</span><span class="p">)</span>
		<span class="n">led</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">led</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">led_state</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(((</span><span class="n">strong</span> <span class="o">&lt;</span> <span class="o">*</span><span class="n">snr</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="o">*</span><span class="n">snr</span> <span class="o">-</span> <span class="n">strong</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="n">strong</span> <span class="o">-</span> <span class="o">*</span><span class="n">snr</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">))</span>
		<span class="cm">/* snr didn&#39;t change enough to bother</span>
<span class="cm">		 * changing the color of the led */</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">au8522_led_ctrl</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">led</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_read_snr</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">snr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s()</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span> <span class="o">==</span> <span class="n">QAM_256</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">au8522_mse2snr_lookup</span><span class="p">(</span><span class="n">qam256_mse2snr_tab</span><span class="p">,</span>
					    <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">qam256_mse2snr_tab</span><span class="p">),</span>
					    <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x4522</span><span class="p">),</span>
					    <span class="n">snr</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span> <span class="o">==</span> <span class="n">QAM_64</span><span class="p">)</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">au8522_mse2snr_lookup</span><span class="p">(</span><span class="n">qam64_mse2snr_tab</span><span class="p">,</span>
					    <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">qam64_mse2snr_tab</span><span class="p">),</span>
					    <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x4522</span><span class="p">),</span>
					    <span class="n">snr</span><span class="p">);</span>
	<span class="k">else</span> <span class="cm">/* VSB_8 */</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">au8522_mse2snr_lookup</span><span class="p">(</span><span class="n">vsb_mse2snr_tab</span><span class="p">,</span>
					    <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">vsb_mse2snr_tab</span><span class="p">),</span>
					    <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x4311</span><span class="p">),</span>
					    <span class="n">snr</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span><span class="o">-&gt;</span><span class="n">led_cfg</span><span class="p">)</span>
		<span class="n">au8522_led_status</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">snr</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_read_signal_strength</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span>
				       <span class="n">u16</span> <span class="o">*</span><span class="n">signal_strength</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* borrowed from lgdt330x.c</span>
<span class="cm">	 *</span>
<span class="cm">	 * Calculate strength from SNR up to 35dB</span>
<span class="cm">	 * Even though the SNR can go higher than 35dB,</span>
<span class="cm">	 * there is some comfort factor in having a range of</span>
<span class="cm">	 * strong signals that can show at 100%</span>
<span class="cm">	 */</span>
	<span class="n">u16</span> <span class="n">snr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tmp</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">au8522_read_snr</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">snr</span><span class="p">);</span>

	<span class="o">*</span><span class="n">signal_strength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The following calculation method was chosen</span>
<span class="cm">		 * purely for the sake of code re-use from the</span>
<span class="cm">		 * other demod drivers that use this method */</span>

		<span class="cm">/* Convert from SNR in dB * 10 to 8.24 fixed-point */</span>
		<span class="n">tmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">snr</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10</span><span class="p">));</span>

		<span class="cm">/* Convert from 8.24 fixed-point to</span>
<span class="cm">		 * scale the range 0 - 35*2^24 into 0 - 65535*/</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">tmp</span> <span class="o">&gt;=</span> <span class="mi">8960</span> <span class="o">*</span> <span class="mh">0x10000</span><span class="p">)</span>
			<span class="o">*</span><span class="n">signal_strength</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="o">*</span><span class="n">signal_strength</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">/</span> <span class="mi">8960</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_read_ucblocks</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">ucblocks</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span> <span class="o">==</span> <span class="n">VSB_8</span><span class="p">)</span>
		<span class="o">*</span><span class="n">ucblocks</span> <span class="o">=</span> <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x4087</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="o">*</span><span class="n">ucblocks</span> <span class="o">=</span> <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x4543</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_read_ber</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">ber</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">au8522_read_ucblocks</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">ber</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_get_frontend</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">c</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>

	<span class="n">c</span><span class="o">-&gt;</span><span class="n">frequency</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">current_frequency</span><span class="p">;</span>
	<span class="n">c</span><span class="o">-&gt;</span><span class="n">modulation</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">current_modulation</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_get_tune_settings</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">dvb_frontend_tune_settings</span> <span class="o">*</span><span class="n">tune</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">tune</span><span class="o">-&gt;</span><span class="n">min_delay_ms</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_frontend_ops</span> <span class="n">au8522_ops</span><span class="p">;</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">au8522_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">demodulator_priv</span><span class="p">;</span>
	<span class="n">au8522_release_state</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="nf">au8522_attach</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">au8522_config</span> <span class="o">*</span><span class="n">config</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">instance</span><span class="p">;</span>

	<span class="cm">/* allocate memory for the internal state */</span>
	<span class="n">instance</span> <span class="o">=</span> <span class="n">au8522_get_state</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">,</span> <span class="n">i2c</span><span class="p">,</span> <span class="n">config</span><span class="o">-&gt;</span><span class="n">demod_address</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s state allocation failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="cm">/* new demod instance */</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s using new instance</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="cm">/* existing demod instance */</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="s">&quot;%s using existing instance</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* setup the state */</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">i2c</span> <span class="o">=</span> <span class="n">i2c</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">operational_mode</span> <span class="o">=</span> <span class="n">AU8522_DIGITAL_MODE</span><span class="p">;</span>

	<span class="cm">/* create dvb_frontend */</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend</span><span class="p">.</span><span class="n">ops</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">au8522_ops</span><span class="p">,</span>
	       <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend_ops</span><span class="p">));</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend</span><span class="p">.</span><span class="n">demodulator_priv</span> <span class="o">=</span> <span class="n">state</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">au8522_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;%s: Failed to initialize correctly</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Note: Leaving the I2C gate open here. */</span>
	<span class="n">au8522_i2c_gate_ctrl</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend</span><span class="p">;</span>

<span class="nl">error:</span>
	<span class="n">au8522_release_state</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">au8522_attach</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_frontend_ops</span> <span class="n">au8522_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">delsys</span> <span class="o">=</span> <span class="p">{</span> <span class="n">SYS_ATSC</span><span class="p">,</span> <span class="n">SYS_DVBC_ANNEX_B</span> <span class="p">},</span>
	<span class="p">.</span><span class="n">info</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>			<span class="o">=</span> <span class="s">&quot;Auvitek AU8522 QAM/8VSB Frontend&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">frequency_min</span>		<span class="o">=</span> <span class="mi">54000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">frequency_max</span>		<span class="o">=</span> <span class="mi">858000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">frequency_stepsize</span>	<span class="o">=</span> <span class="mi">62500</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">FE_CAN_QAM_64</span> <span class="o">|</span> <span class="n">FE_CAN_QAM_256</span> <span class="o">|</span> <span class="n">FE_CAN_8VSB</span>
	<span class="p">},</span>

	<span class="p">.</span><span class="n">init</span>                 <span class="o">=</span> <span class="n">au8522_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sleep</span>                <span class="o">=</span> <span class="n">au8522_sleep</span><span class="p">,</span>
	<span class="p">.</span><span class="n">i2c_gate_ctrl</span>        <span class="o">=</span> <span class="n">au8522_i2c_gate_ctrl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_frontend</span>         <span class="o">=</span> <span class="n">au8522_set_frontend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_frontend</span>         <span class="o">=</span> <span class="n">au8522_get_frontend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_tune_settings</span>    <span class="o">=</span> <span class="n">au8522_get_tune_settings</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_status</span>          <span class="o">=</span> <span class="n">au8522_read_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_ber</span>             <span class="o">=</span> <span class="n">au8522_read_ber</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_signal_strength</span> <span class="o">=</span> <span class="n">au8522_read_signal_strength</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_snr</span>             <span class="o">=</span> <span class="n">au8522_read_snr</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_ucblocks</span>        <span class="o">=</span> <span class="n">au8522_read_ucblocks</span><span class="p">,</span>
	<span class="p">.</span><span class="n">release</span>              <span class="o">=</span> <span class="n">au8522_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">module_param</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="s">&quot;Enable verbose debug messages&quot;</span><span class="p">);</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Auvitek AU8522 QAM-B/ATSC Demodulator driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Steven Toth&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
