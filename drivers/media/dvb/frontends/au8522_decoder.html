<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › frontends › au8522_decoder.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>au8522_decoder.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Auvitek AU8522 QAM/8VSB demodulator driver and video decoder</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2009 Devin Heitmueller &lt;dheitmueller@linuxtv.org&gt;</span>
<span class="cm"> * Copyright (C) 2005-2008 Auvitek International, Ltd.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * As published by the Free Software Foundation; either version 2</span>
<span class="cm"> * of the License, or (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA</span>
<span class="cm"> * 02110-1301, USA.</span>
<span class="cm"> */</span>

<span class="cm">/* Developer notes:</span>
<span class="cm"> *</span>
<span class="cm"> * VBI support is not yet working</span>
<span class="cm"> * Enough is implemented here for CVBS and S-Video inputs, but the actual</span>
<span class="cm"> *  analog demodulator code isn&#39;t implemented (not needed for xc5000 since it</span>
<span class="cm"> *  has its own demodulator and outputs CVBS)</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/videodev2.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-common.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-chip-ident.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-device.h&gt;</span>
<span class="cp">#include &quot;au8522.h&quot;</span>
<span class="cp">#include &quot;au8522_priv.h&quot;</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Devin Heitmueller&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">au8522_analog_debug</span><span class="p">;</span>


<span class="n">module_param_named</span><span class="p">(</span><span class="n">analog_debug</span><span class="p">,</span> <span class="n">au8522_analog_debug</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>

<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">analog_debug</span><span class="p">,</span>
		 <span class="s">&quot;Analog debugging messages [0=Off (default) 1=On]&quot;</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">au8522_register_config</span> <span class="p">{</span>
	<span class="n">u16</span> <span class="n">reg_name</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reg_val</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>


<span class="cm">/* Video Decoder Filter Coefficients</span>
<span class="cm">   The values are as follows from left to right</span>
<span class="cm">   0=&quot;ATV RF&quot; 1=&quot;ATV RF13&quot; 2=&quot;CVBS&quot; 3=&quot;S-Video&quot; 4=&quot;PAL&quot; 5=CVBS13&quot; 6=&quot;SVideo13&quot;</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">au8522_register_config</span> <span class="n">filter_coef</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R410</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R411</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R412</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R413</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R414</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R415</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R416</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R417</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R418</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R419</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R41A</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R41B</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R41C</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R41D</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R41E</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R41F</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R420</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R421</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R422</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R423</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R424</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R425</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R426</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R427</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R428</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xd8</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0xd8</span><span class="p">,</span> <span class="mh">0xd8</span><span class="p">,</span> <span class="mh">0xd8</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R429</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">,</span> <span class="mh">0xfb</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R42A</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">,</span> <span class="mh">0xd5</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R42B</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R42C</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">AU8522_FILTER_COEF_R42D</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">}</span> <span class="p">},</span>

<span class="p">};</span>
<span class="cp">#define NUM_FILTER_COEF (sizeof(filter_coef)\</span>
<span class="cp">			 / sizeof(struct au8522_register_config))</span>


<span class="cm">/* Registers 0x060b through 0x0652 are the LP Filter coefficients</span>
<span class="cm">   The values are as follows from left to right</span>
<span class="cm">   0=&quot;SIF&quot; 1=&quot;ATVRF/ATVRF13&quot;</span>
<span class="cm">   Note: the &quot;ATVRF/ATVRF13&quot; mode has never been tested</span>
<span class="cm">*/</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">au8522_register_config</span> <span class="n">lpfilter_coef</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x060b</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x060c</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x060d</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x060e</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xea</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x060f</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xdd</span><span class="p">,</span> <span class="mh">0xdd</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0610</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0611</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0612</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0613</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0614</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0615</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0616</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0617</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xee</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0618</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0619</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x061a</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x061b</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x061c</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x061d</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x061e</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xa9</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x061f</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0620</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x42</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0621</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0622</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xd6</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0623</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0624</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0625</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0626</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0627</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x62</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0628</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0xf5</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0629</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x062a</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xd4</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x062b</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x062c</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x062d</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x062e</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0xea</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x062f</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0xd2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0630</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0631</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0xa9</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0632</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0633</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xf9</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0634</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0635</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0636</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0637</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0638</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0639</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x063a</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x45</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x063b</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xef</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x063c</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x063d</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x063e</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x063f</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0640</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xef</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0641</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0642</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xcc</span><span class="p">,</span> <span class="mh">0xd2</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0643</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0644</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0645</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0646</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0647</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0648</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0649</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x064a</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x064b</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x064c</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x064d</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x63</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x064e</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x064f</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0650</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0651</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0652</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">}</span> <span class="p">},</span>
<span class="p">};</span>
<span class="cp">#define NUM_LPFILTER_COEF (sizeof(lpfilter_coef)\</span>
<span class="cp">			   / sizeof(struct au8522_register_config))</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="nf">to_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">au8522_state</span><span class="p">,</span> <span class="n">sd</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setup_vbi</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aud_input</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* These are set to zero regardless of what mode we&#39;re in */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_CTRL_H_REG017H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_CTRL_L_REG018H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_TOTAL_BITS_REG019H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_TUNIT_H_REG01AH</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_TUNIT_L_REG01BH</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_THRESH1_REG01CH</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_FRAME_PAT2_REG01EH</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_FRAME_PAT1_REG01FH</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_FRAME_PAT0_REG020H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_FRAME_MASK2_REG021H</span><span class="p">,</span>
			<span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_FRAME_MASK1_REG022H</span><span class="p">,</span>
			<span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_USER_FRAME_MASK0_REG023H</span><span class="p">,</span>
			<span class="mh">0x00</span><span class="p">);</span>

	<span class="cm">/* Setup the VBI registers */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mh">0x60</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>

	<span class="cm">/* For some reason, every register is 0x40 except register 0x44</span>
<span class="cm">	   (confirmed via the HVR-950q USB capture) */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">);</span>

	<span class="cm">/* Enable VBI (we always do this regardless of whether the user is</span>
<span class="cm">	   viewing closed caption info) */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VBI_CTRL_H_REG017H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_VBI_CTRL_H_REG017H_CCON</span><span class="p">);</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setup_decoder_defaults</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="n">u8</span> <span class="n">input_mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">filter_coef_type</span><span class="p">;</span>

	<span class="cm">/* Provide reasonable defaults for picture tuning values */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_SHARPNESSREG009H</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_BRIGHTNESS_REG00AH</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">brightness</span> <span class="o">=</span> <span class="mh">0xed</span> <span class="o">-</span> <span class="mi">128</span><span class="p">;</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_CONTRAST_REG00BH</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">contrast</span> <span class="o">=</span> <span class="mh">0x79</span><span class="p">;</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_SATURATION_CB_REG00CH</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_SATURATION_CR_REG00DH</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">saturation</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_HUE_H_REG00EH</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_HUE_L_REG00FH</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">hue</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="cm">/* Other decoder registers */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_INT_MASK_REG010H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">input_mode</span> <span class="o">==</span> <span class="mh">0x23</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* S-Video input mapping */</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_VIDEO_MODE_REG011H</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* All other modes (CVBS/ATVRF etc.) */</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_VIDEO_MODE_REG011H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_PGA_REG012H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_PGA_REG012H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_MODE_REG015H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_MODE_REG015H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDED_DBG_MODE_REG060H</span><span class="p">,</span>
			<span class="n">AU8522_TVDED_DBG_MODE_REG060H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_FORMAT_CTRL1_REG061H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_FORMAT_CTRL1_REG061H_CVBS13</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_FORMAT_CTRL2_REG062H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_FORMAT_CTRL2_REG062H_CVBS13</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VCR_DET_LLIM_REG063H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_VCR_DET_LLIM_REG063H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_VCR_DET_HLIM_REG064H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_VCR_DET_HLIM_REG064H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_VDIF_THR1_REG065H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_VDIF_THR1_REG065H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_VDIF_THR2_REG066H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_VDIF_THR2_REG066H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_VDIF_THR3_REG067H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_VDIF_THR3_REG067H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_NOTCH_THR_REG068H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_NOTCH_THR_REG068H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_HDIF_THR1_REG069H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_HDIF_THR1_REG069H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_HDIF_THR2_REG06AH</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_HDIF_THR2_REG06AH_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_HDIF_THR3_REG06BH</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_HDIF_THR3_REG06BH_CVBS</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">input_mode</span> <span class="o">==</span> <span class="n">AU8522_INPUT_CONTROL_REG081H_SVIDEO_CH13</span> <span class="o">||</span>
	    <span class="n">input_mode</span> <span class="o">==</span> <span class="n">AU8522_INPUT_CONTROL_REG081H_SVIDEO_CH24</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_DCDIF_THR1_REG06CH</span><span class="p">,</span>
				<span class="n">AU8522_TVDEC_COMB_DCDIF_THR1_REG06CH_SVIDEO</span><span class="p">);</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_DCDIF_THR2_REG06DH</span><span class="p">,</span>
				<span class="n">AU8522_TVDEC_COMB_DCDIF_THR2_REG06DH_SVIDEO</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_DCDIF_THR1_REG06CH</span><span class="p">,</span>
				<span class="n">AU8522_TVDEC_COMB_DCDIF_THR1_REG06CH_CVBS</span><span class="p">);</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_DCDIF_THR2_REG06DH</span><span class="p">,</span>
				<span class="n">AU8522_TVDEC_COMB_DCDIF_THR2_REG06DH_CVBS</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_DCDIF_THR3_REG06EH</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_DCDIF_THR3_REG06EH_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_UV_SEP_THR_REG06FH</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_UV_SEP_THR_REG06FH_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_DC_THR1_NTSC_REG070H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_DC_THR1_NTSC_REG070H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG071H</span><span class="p">,</span> <span class="n">AU8522_REG071H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG072H</span><span class="p">,</span> <span class="n">AU8522_REG072H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_COMB_DC_THR2_NTSC_REG073H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_COMB_DC_THR2_NTSC_REG073H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG074H</span><span class="p">,</span> <span class="n">AU8522_REG074H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG075H</span><span class="p">,</span> <span class="n">AU8522_REG075H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_DCAGC_CTRL_REG077H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_DCAGC_CTRL_REG077H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_PIC_START_ADJ_REG078H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_PIC_START_ADJ_REG078H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_AGC_HIGH_LIMIT_REG079H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_AGC_HIGH_LIMIT_REG079H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_MACROVISION_SYNC_THR_REG07AH</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_MACROVISION_SYNC_THR_REG07AH_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_INTRP_CTRL_REG07BH</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_INTRP_CTRL_REG07BH_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_AGC_LOW_LIMIT_REG0E4H</span><span class="p">,</span>
			<span class="n">AU8522_TVDEC_AGC_LOW_LIMIT_REG0E4H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TOREGAAGC_REG0E5H</span><span class="p">,</span>
			<span class="n">AU8522_TOREGAAGC_REG0E5H_CVBS</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG016H</span><span class="p">,</span> <span class="n">AU8522_REG016H_CVBS</span><span class="p">);</span>

	<span class="n">setup_vbi</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">input_mode</span> <span class="o">==</span> <span class="n">AU8522_INPUT_CONTROL_REG081H_SVIDEO_CH13</span> <span class="o">||</span>
	    <span class="n">input_mode</span> <span class="o">==</span> <span class="n">AU8522_INPUT_CONTROL_REG081H_SVIDEO_CH24</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Despite what the table says, for the HVR-950q we still need</span>
<span class="cm">		   to be in CVBS mode for the S-Video input (reason unknown). */</span>
		<span class="cm">/* filter_coef_type = 3; */</span>
		<span class="n">filter_coef_type</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">filter_coef_type</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Load the Video Decoder Filter Coefficients */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_FILTER_COEF</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">filter_coef</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg_name</span><span class="p">,</span>
				<span class="n">filter_coef</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg_val</span><span class="p">[</span><span class="n">filter_coef_type</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="cm">/* It&#39;s not clear what these registers are for, but they are always</span>
<span class="cm">	   set to the same value regardless of what mode we&#39;re in */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG42EH</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG42FH</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG430H</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG431H</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG432H</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG433H</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG434H</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG435H</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG436H</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">au8522_setup_cvbs_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* here we&#39;re going to try the pre-programmed route */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_MODULE_CLOCK_CONTROL_REG0A3H</span><span class="p">,</span>
			<span class="n">AU8522_MODULE_CLOCK_CONTROL_REG0A3H_CVBS</span><span class="p">);</span>

	<span class="cm">/* PGA in automatic mode */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_PGA_CONTROL_REG082H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="cm">/* Enable clamping control */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_CLAMPING_CONTROL_REG083H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_INPUT_CONTROL_REG081H</span><span class="p">,</span>
			<span class="n">AU8522_INPUT_CONTROL_REG081H_CVBS_CH1</span><span class="p">);</span>

	<span class="n">setup_decoder_defaults</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_INPUT_CONTROL_REG081H_CVBS_CH1</span><span class="p">);</span>

	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span>
			<span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H_CVBS</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">au8522_setup_cvbs_tuner_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* here we&#39;re going to try the pre-programmed route */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_MODULE_CLOCK_CONTROL_REG0A3H</span><span class="p">,</span>
			<span class="n">AU8522_MODULE_CLOCK_CONTROL_REG0A3H_CVBS</span><span class="p">);</span>

	<span class="cm">/* It&#39;s not clear why we have to have the PGA in automatic mode while</span>
<span class="cm">	   enabling clamp control, but it&#39;s what Windows does */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_PGA_CONTROL_REG082H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="cm">/* Enable clamping control */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_CLAMPING_CONTROL_REG083H</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">);</span>

	<span class="cm">/* Disable automatic PGA (since the CVBS is coming from the tuner) */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_PGA_CONTROL_REG082H</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>

	<span class="cm">/* Set input mode to CVBS on channel 4 with SIF audio input enabled */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_INPUT_CONTROL_REG081H</span><span class="p">,</span>
			<span class="n">AU8522_INPUT_CONTROL_REG081H_CVBS_CH4_SIF</span><span class="p">);</span>

	<span class="n">setup_decoder_defaults</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
			       <span class="n">AU8522_INPUT_CONTROL_REG081H_CVBS_CH4_SIF</span><span class="p">);</span>

	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span>
			<span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H_CVBS</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">au8522_setup_svideo_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_MODULE_CLOCK_CONTROL_REG0A3H</span><span class="p">,</span>
			<span class="n">AU8522_MODULE_CLOCK_CONTROL_REG0A3H_SVIDEO</span><span class="p">);</span>

	<span class="cm">/* Set input to Y on Channe1, C on Channel 3 */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_INPUT_CONTROL_REG081H</span><span class="p">,</span>
			<span class="n">AU8522_INPUT_CONTROL_REG081H_SVIDEO_CH13</span><span class="p">);</span>

	<span class="cm">/* PGA in automatic mode */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_PGA_CONTROL_REG082H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="cm">/* Enable clamping control */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_CLAMPING_CONTROL_REG083H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="n">setup_decoder_defaults</span><span class="p">(</span><span class="n">state</span><span class="p">,</span>
			       <span class="n">AU8522_INPUT_CONTROL_REG081H_SVIDEO_CH13</span><span class="p">);</span>

	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span>
			<span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H_CVBS</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* ----------------------------------------------------------------------- */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">disable_audio_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_L_REG0F2H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_R_REG0F3H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_REG0F4H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_1_REG0A5H</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_I2S_CTRL_2_REG112H</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>

	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span>
			<span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H_SVIDEO</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* 0=disable, 1=SIF */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">set_audio_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">,</span> <span class="kt">int</span> <span class="n">aud_input</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* Note that this function needs to be used in conjunction with setting</span>
<span class="cm">	   the input routing via register 0x81 */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">aud_input</span> <span class="o">==</span> <span class="n">AU8522_AUDIO_NONE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">disable_audio_input</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">aud_input</span> <span class="o">!=</span> <span class="n">AU8522_AUDIO_SIF</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* The caller asked for a mode we don&#39;t currently support */</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Unsupported audio mode requested! mode=%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">aud_input</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Load the Audio Decoder Filter Coefficients */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NUM_LPFILTER_COEF</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">lpfilter_coef</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg_name</span><span class="p">,</span>
				<span class="n">lpfilter_coef</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg_val</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="p">}</span>

	<span class="cm">/* Setup audio */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_L_REG0F2H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_R_REG0F3H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_REG0F4H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_I2C_CONTROL_REG1_REG091H</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_I2C_CONTROL_REG0_REG090H</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span> <span class="mh">0x9d</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_L_REG0F2H</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_R_REG0F3H</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_REG0F4H</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">80</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_L_REG0F2H</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_VOLUME_R_REG0F3H</span><span class="p">,</span> <span class="mh">0x7F</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_REG0F9H</span><span class="p">,</span> <span class="n">AU8522_REG0F9H_AUDIO</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIO_MODE_REG0F1H</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">70</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_1_REG0A5H</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_AUDIOFREQ_REG606H</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_I2S_CTRL_2_REG112H</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* ----------------------------------------------------------------------- */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_s_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_control</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_BRIGHTNESS</span>:
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">brightness</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_BRIGHTNESS_REG00AH</span><span class="p">,</span>
				<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">-</span> <span class="mi">128</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_CONTRAST</span>:
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">contrast</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_CONTRAST_REG00BH</span><span class="p">,</span>
				<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_SATURATION</span>:
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">saturation</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_SATURATION_CB_REG00CH</span><span class="p">,</span>
				<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_SATURATION_CR_REG00DH</span><span class="p">,</span>
				<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_HUE</span>:
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">hue</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_HUE_H_REG00EH</span><span class="p">,</span>
				<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_TVDEC_HUE_L_REG00FH</span><span class="p">,</span>
				<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_VOLUME</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_BASS</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_TREBLE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_BALANCE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_MUTE</span>:
		<span class="cm">/* Not yet implemented */</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_g_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_control</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="cm">/* Note that we are using values cached in the state structure instead</span>
<span class="cm">	   of reading the registers due to issues with i2c reads not working</span>
<span class="cm">	   properly/consistently yet on the HVR-950q */</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_BRIGHTNESS</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">brightness</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_CONTRAST</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">contrast</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_SATURATION</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">saturation</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_HUE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">hue</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_VOLUME</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_BASS</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_TREBLE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_BALANCE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_AUDIO_MUTE</span>:
		<span class="cm">/* Not yet supported */</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* ----------------------------------------------------------------------- */</span>

<span class="cp">#ifdef CONFIG_VIDEO_ADV_DEBUG</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_g_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">v4l2_dbg_register</span> <span class="o">*</span><span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">v4l2_get_subdevdata</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">v4l2_chip_match_i2c_client</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">match</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capable</span><span class="p">(</span><span class="n">CAP_SYS_ADMIN</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>
	<span class="n">reg</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span> <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">reg</span><span class="o">-&gt;</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_s_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">v4l2_dbg_register</span> <span class="o">*</span><span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">v4l2_get_subdevdata</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">v4l2_chip_match_i2c_client</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reg</span><span class="o">-&gt;</span><span class="n">match</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capable</span><span class="p">(</span><span class="n">CAP_SYS_ADMIN</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">reg</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span> <span class="n">reg</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_s_stream</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">enable</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span>
				<span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span>
				<span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H_CVBS</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* This does not completely power down the device</span>
<span class="cm">		   (it only reduces it from around 140ma to 80ma) */</span>
		<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">AU8522_SYSTEM_MODULE_CONTROL_0_REG0A4H</span><span class="p">,</span>
				<span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_queryctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="o">*</span><span class="n">qc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">qc</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_CONTRAST</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
					    <span class="n">AU8522_TVDEC_CONTRAST_REG00BH_CVBS</span><span class="p">);</span>
	<span class="k">case</span> <span class="n">V4L2_CID_BRIGHTNESS</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">109</span><span class="p">);</span>
	<span class="k">case</span> <span class="n">V4L2_CID_SATURATION</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">);</span>
	<span class="k">case</span> <span class="n">V4L2_CID_HUE</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qc</span><span class="p">,</span> <span class="o">-</span><span class="mi">32768</span><span class="p">,</span> <span class="mi">32768</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">qc</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="n">state</span><span class="o">-&gt;</span><span class="n">operational_mode</span> <span class="o">=</span> <span class="n">AU8522_ANALOG_MODE</span><span class="p">;</span>

	<span class="cm">/* Clear out any state associated with the digital side of the</span>
<span class="cm">	   chip, so that when it gets powered back up it won&#39;t think</span>
<span class="cm">	   that it is already tuned */</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">current_frequency</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_s_video_routing</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
					<span class="n">u32</span> <span class="n">input</span><span class="p">,</span> <span class="n">u32</span> <span class="n">output</span><span class="p">,</span> <span class="n">u32</span> <span class="n">config</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="n">au8522_reset</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="cm">/* Jam open the i2c gate to the tuner.  We do this here to handle the</span>
<span class="cm">	   case where the user went into digital mode (causing the gate to be</span>
<span class="cm">	   closed), and then came back to analog mode */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x106</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">input</span> <span class="o">==</span> <span class="n">AU8522_COMPOSITE_CH1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">au8522_setup_cvbs_mode</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">input</span> <span class="o">==</span> <span class="n">AU8522_SVIDEO_CH13</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">au8522_setup_svideo_mode</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">input</span> <span class="o">==</span> <span class="n">AU8522_COMPOSITE_CH4_SIF</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">au8522_setup_cvbs_tuner_mode</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;au8522 mode not currently supported</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_s_audio_routing</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
					<span class="n">u32</span> <span class="n">input</span><span class="p">,</span> <span class="n">u32</span> <span class="n">output</span><span class="p">,</span> <span class="n">u32</span> <span class="n">config</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="n">set_audio_input</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">input</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_g_tuner</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_tuner</span> <span class="o">*</span><span class="n">vt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">lock_status</span><span class="p">;</span>

	<span class="cm">/* Interrogate the decoder to see if we are getting a real signal */</span>
	<span class="n">lock_status</span> <span class="o">=</span> <span class="n">au8522_readreg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">lock_status</span> <span class="o">==</span> <span class="mh">0xa2</span><span class="p">)</span>
		<span class="n">vt</span><span class="o">-&gt;</span><span class="n">signal</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">vt</span><span class="o">-&gt;</span><span class="n">signal</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>

	<span class="n">vt</span><span class="o">-&gt;</span><span class="n">capability</span> <span class="o">|=</span>
		<span class="n">V4L2_TUNER_CAP_STEREO</span> <span class="o">|</span> <span class="n">V4L2_TUNER_CAP_LANG1</span> <span class="o">|</span>
		<span class="n">V4L2_TUNER_CAP_LANG2</span> <span class="o">|</span> <span class="n">V4L2_TUNER_CAP_SAP</span><span class="p">;</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">V4L2_TUNER_SUB_MONO</span><span class="p">;</span>
	<span class="n">vt</span><span class="o">-&gt;</span><span class="n">rxsubchans</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">vt</span><span class="o">-&gt;</span><span class="n">audmode</span> <span class="o">=</span> <span class="n">V4L2_TUNER_MODE_STEREO</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_g_chip_ident</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">v4l2_dbg_chip_ident</span> <span class="o">*</span><span class="n">chip</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span> <span class="o">=</span> <span class="n">v4l2_get_subdevdata</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">v4l2_chip_ident_i2c_client</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">chip</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">rev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_log_status</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* FIXME: Add some status info here */</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* ----------------------------------------------------------------------- */</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_subdev_core_ops</span> <span class="n">au8522_core_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">log_status</span> <span class="o">=</span> <span class="n">au8522_log_status</span><span class="p">,</span>
	<span class="p">.</span><span class="n">g_chip_ident</span> <span class="o">=</span> <span class="n">au8522_g_chip_ident</span><span class="p">,</span>
	<span class="p">.</span><span class="n">g_ctrl</span> <span class="o">=</span> <span class="n">au8522_g_ctrl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">s_ctrl</span> <span class="o">=</span> <span class="n">au8522_s_ctrl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">queryctrl</span> <span class="o">=</span> <span class="n">au8522_queryctrl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">au8522_reset</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_VIDEO_ADV_DEBUG</span>
	<span class="p">.</span><span class="n">g_register</span> <span class="o">=</span> <span class="n">au8522_g_register</span><span class="p">,</span>
	<span class="p">.</span><span class="n">s_register</span> <span class="o">=</span> <span class="n">au8522_s_register</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_subdev_tuner_ops</span> <span class="n">au8522_tuner_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">g_tuner</span> <span class="o">=</span> <span class="n">au8522_g_tuner</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_subdev_audio_ops</span> <span class="n">au8522_audio_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">s_routing</span> <span class="o">=</span> <span class="n">au8522_s_audio_routing</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_subdev_video_ops</span> <span class="n">au8522_video_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">s_routing</span> <span class="o">=</span> <span class="n">au8522_s_video_routing</span><span class="p">,</span>
	<span class="p">.</span><span class="n">s_stream</span> <span class="o">=</span> <span class="n">au8522_s_stream</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_subdev_ops</span> <span class="n">au8522_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">au8522_core_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">au8522_tuner_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">au8522_audio_ops</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">au8522_video_ops</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* ----------------------------------------------------------------------- */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="o">*</span><span class="n">did</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">au8522_state</span> <span class="o">*</span><span class="n">state</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">instance</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">au8522_config</span> <span class="o">*</span><span class="n">demod_config</span><span class="p">;</span>

	<span class="cm">/* Check if the adapter supports the needed features */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">i2c_check_functionality</span><span class="p">(</span><span class="n">client</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">,</span>
				     <span class="n">I2C_FUNC_SMBUS_BYTE_DATA</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* allocate memory for the internal state */</span>
	<span class="n">instance</span> <span class="o">=</span> <span class="n">au8522_get_state</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="p">,</span> <span class="n">client</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">,</span> <span class="n">client</span><span class="o">-&gt;</span><span class="n">addr</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">instance</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;au8522_decoder allocation failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="cm">/* new demod instance */</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;au8522_decoder creating new instance...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="cm">/* existing demod instance */</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;au8522_decoder attach existing instance.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">demod_config</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">au8522_config</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">demod_config</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">instance</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">kfree</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">demod_config</span><span class="o">-&gt;</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x8e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">state</span><span class="o">-&gt;</span><span class="n">config</span> <span class="o">=</span> <span class="n">demod_config</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">i2c</span> <span class="o">=</span> <span class="n">client</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">;</span>

	<span class="n">sd</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">sd</span><span class="p">;</span>
	<span class="n">v4l2_i2c_subdev_init</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">client</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">au8522_ops</span><span class="p">);</span>

	<span class="n">state</span><span class="o">-&gt;</span><span class="n">c</span> <span class="o">=</span> <span class="n">client</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">vid_input</span> <span class="o">=</span> <span class="n">AU8522_COMPOSITE_CH1</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">aud_input</span> <span class="o">=</span> <span class="n">AU8522_AUDIO_NONE</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="mi">8522</span><span class="p">;</span>
	<span class="n">state</span><span class="o">-&gt;</span><span class="n">rev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Jam open the i2c gate to the tuner */</span>
	<span class="n">au8522_writereg</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="mh">0x106</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">au8522_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">client</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="n">i2c_get_clientdata</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
	<span class="n">v4l2_device_unregister_subdev</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="n">au8522_release_state</span><span class="p">(</span><span class="n">to_state</span><span class="p">(</span><span class="n">sd</span><span class="p">));</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_device_id</span> <span class="n">au8522_id</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s">&quot;au8522&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">au8522_id</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_driver</span> <span class="n">au8522_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">owner</span>	<span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>	<span class="o">=</span> <span class="s">&quot;au8522&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">au8522_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">au8522_remove</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span>	<span class="o">=</span> <span class="n">au8522_id</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">module_i2c_driver</span><span class="p">(</span><span class="n">au8522_driver</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
