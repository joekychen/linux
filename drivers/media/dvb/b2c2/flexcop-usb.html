<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › b2c2 › flexcop-usb.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>flexcop-usb.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Linux driver for digital TV devices equipped with B2C2 FlexcopII(b)/III</span>
<span class="cm"> * flexcop-usb.h - header file for the USB part</span>
<span class="cm"> * see flexcop.c for copyright information</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __FLEXCOP_USB_H_INCLUDED__</span>
<span class="cp">#define __FLEXCOP_USB_H_INCLUDED__</span>

<span class="cp">#include &lt;linux/usb.h&gt;</span>

<span class="cm">/* transfer parameters */</span>
<span class="cp">#define B2C2_USB_FRAMES_PER_ISO 4</span>
<span class="cp">#define B2C2_USB_NUM_ISO_URB 4</span>

<span class="cp">#define B2C2_USB_CTRL_PIPE_IN usb_rcvctrlpipe(fc_usb-&gt;udev, 0)</span>
<span class="cp">#define B2C2_USB_CTRL_PIPE_OUT usb_sndctrlpipe(fc_usb-&gt;udev, 0)</span>
<span class="cp">#define B2C2_USB_DATA_PIPE usb_rcvisocpipe(fc_usb-&gt;udev, 0x81)</span>

<span class="k">struct</span> <span class="n">flexcop_usb</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">udev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">uintf</span><span class="p">;</span>

	<span class="n">u8</span> <span class="o">*</span><span class="n">iso_buffer</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">buffer_size</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">dma_addr</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">urb</span> <span class="o">*</span><span class="n">iso_urb</span><span class="p">[</span><span class="n">B2C2_USB_NUM_ISO_URB</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">flexcop_device</span> <span class="o">*</span><span class="n">fc_dev</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">tmp_buffer</span><span class="p">[</span><span class="mi">1023</span><span class="o">+</span><span class="mi">190</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">tmp_buffer_length</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#if 0</span><span class="c"></span>
<span class="c">/* request types TODO What is its use?*/</span>
<span class="c">typedef enum {</span>

<span class="c">} flexcop_usb_request_type_t;</span>
<span class="cp">#endif</span>

<span class="cm">/* request */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">B2C2_USB_WRITE_V8_MEM</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">B2C2_USB_READ_V8_MEM</span>  <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">B2C2_USB_READ_REG</span>     <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">B2C2_USB_WRITE_REG</span>    <span class="o">=</span> <span class="mh">0x0A</span><span class="p">,</span>
	<span class="n">B2C2_USB_WRITEREGHI</span>   <span class="o">=</span> <span class="mh">0x0B</span><span class="p">,</span>
	<span class="n">B2C2_USB_FLASH_BLOCK</span>  <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">B2C2_USB_I2C_REQUEST</span>  <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="n">B2C2_USB_UTILITY</span>      <span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span>
<span class="p">}</span> <span class="n">flexcop_usb_request_t</span><span class="p">;</span>

<span class="cm">/* function definition for I2C_REQUEST */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">USB_FUNC_I2C_WRITE</span>       <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">USB_FUNC_I2C_MULTIWRITE</span>  <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">USB_FUNC_I2C_READ</span>        <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">USB_FUNC_I2C_REPEATWRITE</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">USB_FUNC_GET_DESCRIPTOR</span>  <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">USB_FUNC_I2C_REPEATREAD</span>  <span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="cm">/* DKT 020208 - add this to support special case of DiSEqC */</span>
	<span class="n">USB_FUNC_I2C_CHECKWRITE</span>  <span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>
	<span class="n">USB_FUNC_I2C_CHECKRESULT</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
<span class="p">}</span> <span class="n">flexcop_usb_i2c_function_t</span><span class="p">;</span>

<span class="cm">/* function definition for UTILITY request 0x12</span>
<span class="cm"> * DKT 020304 - new utility function */</span>
<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">UTILITY_SET_FILTER</span>          <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="n">UTILITY_DATA_ENABLE</span>         <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="n">UTILITY_FLEX_MULTIWRITE</span>     <span class="o">=</span> <span class="mh">0x03</span><span class="p">,</span>
	<span class="n">UTILITY_SET_BUFFER_SIZE</span>     <span class="o">=</span> <span class="mh">0x04</span><span class="p">,</span>
	<span class="n">UTILITY_FLEX_OPERATOR</span>       <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
	<span class="n">UTILITY_FLEX_RESET300_START</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="n">UTILITY_FLEX_RESET300_STOP</span>  <span class="o">=</span> <span class="mh">0x07</span><span class="p">,</span>
	<span class="n">UTILITY_FLEX_RESET300</span>       <span class="o">=</span> <span class="mh">0x08</span><span class="p">,</span>
	<span class="n">UTILITY_SET_ISO_SIZE</span>        <span class="o">=</span> <span class="mh">0x09</span><span class="p">,</span>
	<span class="n">UTILITY_DATA_RESET</span>          <span class="o">=</span> <span class="mh">0x0A</span><span class="p">,</span>
	<span class="n">UTILITY_GET_DATA_STATUS</span>     <span class="o">=</span> <span class="mh">0x10</span><span class="p">,</span>
	<span class="n">UTILITY_GET_V8_REG</span>          <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="cm">/* DKT 020326 - add function for v1.14 */</span>
	<span class="n">UTILITY_SRAM_WRITE</span>          <span class="o">=</span> <span class="mh">0x12</span><span class="p">,</span>
	<span class="n">UTILITY_SRAM_READ</span>           <span class="o">=</span> <span class="mh">0x13</span><span class="p">,</span>
	<span class="n">UTILITY_SRAM_TESTFILL</span>       <span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
	<span class="n">UTILITY_SRAM_TESTSET</span>        <span class="o">=</span> <span class="mh">0x15</span><span class="p">,</span>
	<span class="n">UTILITY_SRAM_TESTVERIFY</span>     <span class="o">=</span> <span class="mh">0x16</span><span class="p">,</span>
<span class="p">}</span> <span class="n">flexcop_usb_utility_function_t</span><span class="p">;</span>

<span class="cp">#define B2C2_WAIT_FOR_OPERATION_RW (1*HZ)</span>
<span class="cp">#define B2C2_WAIT_FOR_OPERATION_RDW (3*HZ)</span>
<span class="cp">#define B2C2_WAIT_FOR_OPERATION_WDW (1*HZ)</span>

<span class="cp">#define B2C2_WAIT_FOR_OPERATION_V8READ (3*HZ)</span>
<span class="cp">#define B2C2_WAIT_FOR_OPERATION_V8WRITE (3*HZ)</span>
<span class="cp">#define B2C2_WAIT_FOR_OPERATION_V8FLASH (3*HZ)</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">V8_MEMORY_PAGE_DVB_CI</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">,</span>
	<span class="n">V8_MEMORY_PAGE_DVB_DS</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
	<span class="n">V8_MEMORY_PAGE_MULTI2</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="n">V8_MEMORY_PAGE_FLASH</span>  <span class="o">=</span> <span class="mh">0x80</span>
<span class="p">}</span> <span class="n">flexcop_usb_mem_page_t</span><span class="p">;</span>

<span class="cp">#define V8_MEMORY_EXTENDED (1 &lt;&lt; 15)</span>
<span class="cp">#define USB_MEM_READ_MAX   32</span>
<span class="cp">#define USB_MEM_WRITE_MAX   1</span>
<span class="cp">#define USB_FLASH_MAX       8</span>
<span class="cp">#define V8_MEMORY_PAGE_SIZE 0x8000 </span><span class="cm">/* 32K */</span><span class="cp"></span>
<span class="cp">#define V8_MEMORY_PAGE_MASK 0x7FFF</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
