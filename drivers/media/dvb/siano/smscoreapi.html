<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › siano › smscoreapi.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>smscoreapi.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/****************************************************************</span>

<span class="cm">Siano Mobile Silicon, Inc.</span>
<span class="cm">MDTV receiver kernel modules.</span>
<span class="cm">Copyright (C) 2006-2008, Uri Shkolnik, Anatoly Greenblat</span>

<span class="cm">This program is free software: you can redistribute it and/or modify</span>
<span class="cm">it under the terms of the GNU General Public License as published by</span>
<span class="cm">the Free Software Foundation, either version 2 of the License, or</span>
<span class="cm">(at your option) any later version.</span>

<span class="cm"> This program is distributed in the hope that it will be useful,</span>
<span class="cm">but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm">MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm">GNU General Public License for more details.</span>

<span class="cm">You should have received a copy of the GNU General Public License</span>
<span class="cm">along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="cm">****************************************************************/</span>

<span class="cp">#ifndef __SMS_CORE_API_H__</span>
<span class="cp">#define __SMS_CORE_API_H__</span>

<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/scatterlist.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;linux/wait.h&gt;</span>
<span class="cp">#include &lt;linux/timer.h&gt;</span>

<span class="cp">#include &lt;asm/page.h&gt;</span>

<span class="cp">#include &quot;smsir.h&quot;</span>

<span class="cp">#define kmutex_init(_p_) mutex_init(_p_)</span>
<span class="cp">#define kmutex_lock(_p_) mutex_lock(_p_)</span>
<span class="cp">#define kmutex_trylock(_p_) mutex_trylock(_p_)</span>
<span class="cp">#define kmutex_unlock(_p_) mutex_unlock(_p_)</span>

<span class="cp">#ifndef min</span>
<span class="cp">#define min(a, b) (((a) &lt; (b)) ? (a) : (b))</span>
<span class="cp">#endif</span>

<span class="cp">#define SMS_PROTOCOL_MAX_RAOUNDTRIP_MS			(10000)</span>
<span class="cp">#define SMS_ALLOC_ALIGNMENT				128</span>
<span class="cp">#define SMS_DMA_ALIGNMENT				16</span>
<span class="cp">#define SMS_ALIGN_ADDRESS(addr) \</span>
<span class="cp">	((((uintptr_t)(addr)) + (SMS_DMA_ALIGNMENT-1)) &amp; ~(SMS_DMA_ALIGNMENT-1))</span>

<span class="cp">#define SMS_DEVICE_FAMILY2				1</span>
<span class="cp">#define SMS_ROM_NO_RESPONSE				2</span>
<span class="cp">#define SMS_DEVICE_NOT_READY				0x8000000</span>

<span class="k">enum</span> <span class="n">sms_device_type_st</span> <span class="p">{</span>
	<span class="n">SMS_STELLAR</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SMS_NOVA_A0</span><span class="p">,</span>
	<span class="n">SMS_NOVA_B0</span><span class="p">,</span>
	<span class="n">SMS_VEGA</span><span class="p">,</span>
	<span class="n">SMS_NUM_OF_DEVICE_TYPES</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">smscore_device_t</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">smscore_client_t</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">smscore_buffer_t</span><span class="p">;</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">hotplug_t</span><span class="p">)(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span>
			 <span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arrival</span><span class="p">);</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">setmode_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">detectmode_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">mode</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">sendrequest_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">loadfirmware_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">preload_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">postload_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">);</span>

<span class="k">typedef</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">onresponse_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">,</span> <span class="k">struct</span> <span class="n">smscore_buffer_t</span> <span class="o">*</span><span class="n">cb</span><span class="p">);</span>
<span class="k">typedef</span> <span class="kt">void</span> <span class="p">(</span><span class="o">*</span><span class="n">onremove_t</span><span class="p">)(</span><span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">smscore_buffer_t</span> <span class="p">{</span>
	<span class="cm">/* public members, once passed to clients can be changed freely */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">entry</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">offset</span><span class="p">;</span>

	<span class="cm">/* private members, read-only for clients */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">phys</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">offset_in_common</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">smsdevice_params_t</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span>	<span class="o">*</span><span class="n">device</span><span class="p">;</span>

	<span class="kt">int</span>				<span class="n">buffer_size</span><span class="p">;</span>
	<span class="kt">int</span>				<span class="n">num_buffers</span><span class="p">;</span>

	<span class="kt">char</span>			<span class="n">devpath</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>	<span class="n">flags</span><span class="p">;</span>

	<span class="n">setmode_t</span>		<span class="n">setmode_handler</span><span class="p">;</span>
	<span class="n">detectmode_t</span>	<span class="n">detectmode_handler</span><span class="p">;</span>
	<span class="n">sendrequest_t</span>	<span class="n">sendrequest_handler</span><span class="p">;</span>
	<span class="n">preload_t</span>		<span class="n">preload_handler</span><span class="p">;</span>
	<span class="n">postload_t</span>		<span class="n">postload_handler</span><span class="p">;</span>

	<span class="kt">void</span>			<span class="o">*</span><span class="n">context</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">sms_device_type_st</span> <span class="n">device_type</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">smsclient_params_t</span> <span class="p">{</span>
	<span class="kt">int</span>				<span class="n">initial_id</span><span class="p">;</span>
	<span class="kt">int</span>				<span class="n">data_type</span><span class="p">;</span>
	<span class="n">onresponse_t</span>	<span class="n">onresponse_handler</span><span class="p">;</span>
	<span class="n">onremove_t</span>		<span class="n">onremove_handler</span><span class="p">;</span>
	<span class="kt">void</span>			<span class="o">*</span><span class="n">context</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">entry</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">clients</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">subclients</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">clientslock</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">buffers</span><span class="p">;</span>
	<span class="n">spinlock_t</span> <span class="n">bufferslock</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">num_buffers</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">common_buffer</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">common_buffer_size</span><span class="p">;</span>
	<span class="n">dma_addr_t</span> <span class="n">common_buffer_phys</span><span class="p">;</span>

	<span class="kt">void</span> <span class="o">*</span><span class="n">context</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">device</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">devpath</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">device_flags</span><span class="p">;</span>

	<span class="n">setmode_t</span> <span class="n">setmode_handler</span><span class="p">;</span>
	<span class="n">detectmode_t</span> <span class="n">detectmode_handler</span><span class="p">;</span>
	<span class="n">sendrequest_t</span> <span class="n">sendrequest_handler</span><span class="p">;</span>
	<span class="n">preload_t</span> <span class="n">preload_handler</span><span class="p">;</span>
	<span class="n">postload_t</span> <span class="n">postload_handler</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">mode</span><span class="p">,</span> <span class="n">modes_supported</span><span class="p">;</span>

	<span class="cm">/* host &lt;--&gt; device messages */</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">version_ex_done</span><span class="p">,</span> <span class="n">data_download_done</span><span class="p">,</span> <span class="n">trigger_done</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">init_device_done</span><span class="p">,</span> <span class="n">reload_start_done</span><span class="p">,</span> <span class="n">resume_done</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">gpio_configuration_done</span><span class="p">,</span> <span class="n">gpio_set_level_done</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">completion</span> <span class="n">gpio_get_level_done</span><span class="p">,</span> <span class="n">ir_init_done</span><span class="p">;</span>

	<span class="cm">/* Buffer management */</span>
	<span class="n">wait_queue_head_t</span> <span class="n">buffer_mng_waitq</span><span class="p">;</span>

	<span class="cm">/* GPIO */</span>
	<span class="kt">int</span> <span class="n">gpio_get_res</span><span class="p">;</span>

	<span class="cm">/* Target hardware board */</span>
	<span class="kt">int</span> <span class="n">board_id</span><span class="p">;</span>

	<span class="cm">/* Firmware */</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">fw_buf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fw_buf_size</span><span class="p">;</span>

	<span class="cm">/* Infrared (IR) */</span>
	<span class="k">struct</span> <span class="n">ir_t</span> <span class="n">ir</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">led_state</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* GPIO definitions for antenna frequency domain control (SMS8021) */</span>
<span class="cp">#define SMS_ANTENNA_GPIO_0					1</span>
<span class="cp">#define SMS_ANTENNA_GPIO_1					0</span>

<span class="cp">#define BW_8_MHZ							0</span>
<span class="cp">#define BW_7_MHZ							1</span>
<span class="cp">#define BW_6_MHZ							2</span>
<span class="cp">#define BW_5_MHZ							3</span>
<span class="cp">#define BW_ISDBT_1SEG						4</span>
<span class="cp">#define BW_ISDBT_3SEG						5</span>

<span class="cp">#define MSG_HDR_FLAG_SPLIT_MSG				4</span>

<span class="cp">#define MAX_GPIO_PIN_NUMBER					31</span>

<span class="cp">#define HIF_TASK							11</span>
<span class="cp">#define SMS_HOST_LIB						150</span>
<span class="cp">#define DVBT_BDA_CONTROL_MSG_ID				201</span>

<span class="cp">#define SMS_MAX_PAYLOAD_SIZE				240</span>
<span class="cp">#define SMS_TUNE_TIMEOUT					500</span>

<span class="cp">#define MSG_SMS_GPIO_CONFIG_REQ				507</span>
<span class="cp">#define MSG_SMS_GPIO_CONFIG_RES				508</span>
<span class="cp">#define MSG_SMS_GPIO_SET_LEVEL_REQ			509</span>
<span class="cp">#define MSG_SMS_GPIO_SET_LEVEL_RES			510</span>
<span class="cp">#define MSG_SMS_GPIO_GET_LEVEL_REQ			511</span>
<span class="cp">#define MSG_SMS_GPIO_GET_LEVEL_RES			512</span>
<span class="cp">#define MSG_SMS_RF_TUNE_REQ					561</span>
<span class="cp">#define MSG_SMS_RF_TUNE_RES					562</span>
<span class="cp">#define MSG_SMS_INIT_DEVICE_REQ				578</span>
<span class="cp">#define MSG_SMS_INIT_DEVICE_RES				579</span>
<span class="cp">#define MSG_SMS_ADD_PID_FILTER_REQ			601</span>
<span class="cp">#define MSG_SMS_ADD_PID_FILTER_RES			602</span>
<span class="cp">#define MSG_SMS_REMOVE_PID_FILTER_REQ			603</span>
<span class="cp">#define MSG_SMS_REMOVE_PID_FILTER_RES			604</span>
<span class="cp">#define MSG_SMS_DAB_CHANNEL				607</span>
<span class="cp">#define MSG_SMS_GET_PID_FILTER_LIST_REQ			608</span>
<span class="cp">#define MSG_SMS_GET_PID_FILTER_LIST_RES			609</span>
<span class="cp">#define MSG_SMS_GET_STATISTICS_RES			616</span>
<span class="cp">#define MSG_SMS_GET_STATISTICS_REQ			615</span>
<span class="cp">#define MSG_SMS_HO_PER_SLICES_IND			630</span>
<span class="cp">#define MSG_SMS_SET_ANTENNA_CONFIG_REQ			651</span>
<span class="cp">#define MSG_SMS_SET_ANTENNA_CONFIG_RES			652</span>
<span class="cp">#define MSG_SMS_SLEEP_RESUME_COMP_IND			655</span>
<span class="cp">#define MSG_SMS_DATA_DOWNLOAD_REQ			660</span>
<span class="cp">#define MSG_SMS_DATA_DOWNLOAD_RES			661</span>
<span class="cp">#define MSG_SMS_SWDOWNLOAD_TRIGGER_REQ		664</span>
<span class="cp">#define MSG_SMS_SWDOWNLOAD_TRIGGER_RES		665</span>
<span class="cp">#define MSG_SMS_SWDOWNLOAD_BACKDOOR_REQ		666</span>
<span class="cp">#define MSG_SMS_SWDOWNLOAD_BACKDOOR_RES		667</span>
<span class="cp">#define MSG_SMS_GET_VERSION_EX_REQ			668</span>
<span class="cp">#define MSG_SMS_GET_VERSION_EX_RES			669</span>
<span class="cp">#define MSG_SMS_SET_CLOCK_OUTPUT_REQ		670</span>
<span class="cp">#define MSG_SMS_I2C_SET_FREQ_REQ			685</span>
<span class="cp">#define MSG_SMS_GENERIC_I2C_REQ				687</span>
<span class="cp">#define MSG_SMS_GENERIC_I2C_RES				688</span>
<span class="cp">#define MSG_SMS_DVBT_BDA_DATA				693</span>
<span class="cp">#define MSG_SW_RELOAD_REQ					697</span>
<span class="cp">#define MSG_SMS_DATA_MSG					699</span>
<span class="cp">#define MSG_SW_RELOAD_START_REQ				702</span>
<span class="cp">#define MSG_SW_RELOAD_START_RES				703</span>
<span class="cp">#define MSG_SW_RELOAD_EXEC_REQ				704</span>
<span class="cp">#define MSG_SW_RELOAD_EXEC_RES				705</span>
<span class="cp">#define MSG_SMS_SPI_INT_LINE_SET_REQ		710</span>
<span class="cp">#define MSG_SMS_GPIO_CONFIG_EX_REQ			712</span>
<span class="cp">#define MSG_SMS_GPIO_CONFIG_EX_RES			713</span>
<span class="cp">#define MSG_SMS_ISDBT_TUNE_REQ				776</span>
<span class="cp">#define MSG_SMS_ISDBT_TUNE_RES				777</span>
<span class="cp">#define MSG_SMS_TRANSMISSION_IND			782</span>
<span class="cp">#define MSG_SMS_START_IR_REQ				800</span>
<span class="cp">#define MSG_SMS_START_IR_RES				801</span>
<span class="cp">#define MSG_SMS_IR_SAMPLES_IND				802</span>
<span class="cp">#define MSG_SMS_SIGNAL_DETECTED_IND			827</span>
<span class="cp">#define MSG_SMS_NO_SIGNAL_IND				828</span>

<span class="cp">#define SMS_INIT_MSG_EX(ptr, type, src, dst, len) do { \</span>
<span class="cp">	(ptr)-&gt;msgType = type; (ptr)-&gt;msgSrcId = src; (ptr)-&gt;msgDstId = dst; \</span>
<span class="cp">	(ptr)-&gt;msgLength = len; (ptr)-&gt;msgFlags = 0; \</span>
<span class="cp">} while (0)</span>

<span class="cp">#define SMS_INIT_MSG(ptr, type, len) \</span>
<span class="cp">	SMS_INIT_MSG_EX(ptr, type, 0, HIF_TASK, len)</span>

<span class="k">enum</span> <span class="n">SMS_DVB3_EVENTS</span> <span class="p">{</span>
	<span class="n">DVB3_EVENT_INIT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">DVB3_EVENT_SLEEP</span><span class="p">,</span>
	<span class="n">DVB3_EVENT_HOTPLUG</span><span class="p">,</span>
	<span class="n">DVB3_EVENT_FE_LOCK</span><span class="p">,</span>
	<span class="n">DVB3_EVENT_FE_UNLOCK</span><span class="p">,</span>
	<span class="n">DVB3_EVENT_UNC_OK</span><span class="p">,</span>
	<span class="n">DVB3_EVENT_UNC_ERR</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">SMS_DEVICE_MODE</span> <span class="p">{</span>
	<span class="n">DEVICE_MODE_NONE</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_DVBT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_DVBH</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_DAB_TDMB</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_DAB_TDMB_DABIP</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_DVBT_BDA</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_ISDBT</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_ISDBT_BDA</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_CMMB</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_RAW_TUNER</span><span class="p">,</span>
	<span class="n">DEVICE_MODE_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SmsMsgHdr_ST</span> <span class="p">{</span>
	<span class="n">u16</span>	<span class="n">msgType</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">msgSrcId</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">msgDstId</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">msgLength</span><span class="p">;</span> <span class="cm">/* Length of entire message, including header */</span>
	<span class="n">u16</span>	<span class="n">msgFlags</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SmsMsgData_ST</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">SmsMsgHdr_ST</span> <span class="n">xMsgHeader</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">msgData</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SmsMsgData_ST2</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">SmsMsgHdr_ST</span> <span class="n">xMsgHeader</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">msgData</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SmsDataDownload_ST</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">SmsMsgHdr_ST</span>	<span class="n">xMsgHeader</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">MemAddr</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">Payload</span><span class="p">[</span><span class="n">SMS_MAX_PAYLOAD_SIZE</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SmsVersionRes_ST</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">SmsMsgHdr_ST</span>	<span class="n">xMsgHeader</span><span class="p">;</span>

	<span class="n">u16</span>		<span class="n">ChipModel</span><span class="p">;</span> <span class="cm">/* e.g. 0x1102 for SMS-1102 &quot;Nova&quot; */</span>
	<span class="n">u8</span>		<span class="n">Step</span><span class="p">;</span> <span class="cm">/* 0 - Step A */</span>
	<span class="n">u8</span>		<span class="n">MetalFix</span><span class="p">;</span> <span class="cm">/* 0 - Metal 0 */</span>

	<span class="cm">/* FirmwareId 0xFF if ROM, otherwise the</span>
<span class="cm">	 * value indicated by SMSHOSTLIB_DEVICE_MODES_E */</span>
	<span class="n">u8</span> <span class="n">FirmwareId</span><span class="p">;</span>
	<span class="cm">/* SupportedProtocols Bitwise OR combination of</span>
<span class="cm">					     * supported protocols */</span>
	<span class="n">u8</span> <span class="n">SupportedProtocols</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">VersionMajor</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">VersionMinor</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">VersionPatch</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">VersionFieldPatch</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">RomVersionMajor</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">RomVersionMinor</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">RomVersionPatch</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">RomVersionFieldPatch</span><span class="p">;</span>

	<span class="n">u8</span>		<span class="n">TextLabel</span><span class="p">[</span><span class="mi">34</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SmsFirmware_ST</span> <span class="p">{</span>
	<span class="n">u32</span>			<span class="n">CheckSum</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">Length</span><span class="p">;</span>
	<span class="n">u32</span>			<span class="n">StartAddress</span><span class="p">;</span>
	<span class="n">u8</span>			<span class="n">Payload</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Statistics information returned as response for</span>
<span class="cm"> * SmsHostApiGetStatistics_Req */</span>
<span class="k">struct</span> <span class="n">SMSHOSTLIB_STATISTICS_ST</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">Reserved</span><span class="p">;</span>		<span class="cm">/* Reserved */</span>

	<span class="cm">/* Common parameters */</span>
	<span class="n">u32</span> <span class="n">IsRfLocked</span><span class="p">;</span>		<span class="cm">/* 0 - not locked, 1 - locked */</span>
	<span class="n">u32</span> <span class="n">IsDemodLocked</span><span class="p">;</span>	<span class="cm">/* 0 - not locked, 1 - locked */</span>
	<span class="n">u32</span> <span class="n">IsExternalLNAOn</span><span class="p">;</span>	<span class="cm">/* 0 - external LNA off, 1 - external LNA on */</span>

	<span class="cm">/* Reception quality */</span>
	<span class="n">s32</span> <span class="n">SNR</span><span class="p">;</span>		<span class="cm">/* dB */</span>
	<span class="n">u32</span> <span class="n">BER</span><span class="p">;</span>		<span class="cm">/* Post Viterbi BER [1E-5] */</span>
	<span class="n">u32</span> <span class="n">FIB_CRC</span><span class="p">;</span>		<span class="cm">/* CRC errors percentage, valid only for DAB */</span>
	<span class="n">u32</span> <span class="n">TS_PER</span><span class="p">;</span>		<span class="cm">/* Transport stream PER,</span>
<span class="cm">	0xFFFFFFFF indicate N/A, valid only for DVB-T/H */</span>
	<span class="n">u32</span> <span class="n">MFER</span><span class="p">;</span>		<span class="cm">/* DVB-H frame error rate in percentage,</span>
<span class="cm">	0xFFFFFFFF indicate N/A, valid only for DVB-H */</span>
	<span class="n">s32</span> <span class="n">RSSI</span><span class="p">;</span>		<span class="cm">/* dBm */</span>
	<span class="n">s32</span> <span class="n">InBandPwr</span><span class="p">;</span>		<span class="cm">/* In band power in dBM */</span>
	<span class="n">s32</span> <span class="n">CarrierOffset</span><span class="p">;</span>	<span class="cm">/* Carrier Offset in bin/1024 */</span>

	<span class="cm">/* Transmission parameters */</span>
	<span class="n">u32</span> <span class="n">Frequency</span><span class="p">;</span>		<span class="cm">/* Frequency in Hz */</span>
	<span class="n">u32</span> <span class="n">Bandwidth</span><span class="p">;</span>		<span class="cm">/* Bandwidth in MHz, valid only for DVB-T/H */</span>
	<span class="n">u32</span> <span class="n">TransmissionMode</span><span class="p">;</span>	<span class="cm">/* Transmission Mode, for DAB modes 1-4,</span>
<span class="cm">	for DVB-T/H FFT mode carriers in Kilos */</span>
	<span class="n">u32</span> <span class="n">ModemState</span><span class="p">;</span>		<span class="cm">/* from SMSHOSTLIB_DVB_MODEM_STATE_ET,</span>
<span class="cm">	valid only for DVB-T/H */</span>
	<span class="n">u32</span> <span class="n">GuardInterval</span><span class="p">;</span>	<span class="cm">/* Guard Interval from</span>
<span class="cm">	SMSHOSTLIB_GUARD_INTERVALS_ET, 	valid only for DVB-T/H */</span>
	<span class="n">u32</span> <span class="n">CodeRate</span><span class="p">;</span>		<span class="cm">/* Code Rate from SMSHOSTLIB_CODE_RATE_ET,</span>
<span class="cm">	valid only for DVB-T/H */</span>
	<span class="n">u32</span> <span class="n">LPCodeRate</span><span class="p">;</span>		<span class="cm">/* Low Priority Code Rate from</span>
<span class="cm">	SMSHOSTLIB_CODE_RATE_ET, valid only for DVB-T/H */</span>
	<span class="n">u32</span> <span class="n">Hierarchy</span><span class="p">;</span>		<span class="cm">/* Hierarchy from SMSHOSTLIB_HIERARCHY_ET,</span>
<span class="cm">	valid only for DVB-T/H */</span>
	<span class="n">u32</span> <span class="n">Constellation</span><span class="p">;</span>	<span class="cm">/* Constellation from</span>
<span class="cm">	SMSHOSTLIB_CONSTELLATION_ET, valid only for DVB-T/H */</span>

	<span class="cm">/* Burst parameters, valid only for DVB-H */</span>
	<span class="n">u32</span> <span class="n">BurstSize</span><span class="p">;</span>		<span class="cm">/* Current burst size in bytes,</span>
<span class="cm">	valid only for DVB-H */</span>
	<span class="n">u32</span> <span class="n">BurstDuration</span><span class="p">;</span>	<span class="cm">/* Current burst duration in mSec,</span>
<span class="cm">	valid only for DVB-H */</span>
	<span class="n">u32</span> <span class="n">BurstCycleTime</span><span class="p">;</span>	<span class="cm">/* Current burst cycle time in mSec,</span>
<span class="cm">	valid only for DVB-H */</span>
	<span class="n">u32</span> <span class="n">CalculatedBurstCycleTime</span><span class="p">;</span><span class="cm">/* Current burst cycle time in mSec,</span>
<span class="cm">	as calculated by demodulator, valid only for DVB-H */</span>
	<span class="n">u32</span> <span class="n">NumOfRows</span><span class="p">;</span>		<span class="cm">/* Number of rows in MPE table,</span>
<span class="cm">	valid only for DVB-H */</span>
	<span class="n">u32</span> <span class="n">NumOfPaddCols</span><span class="p">;</span>	<span class="cm">/* Number of padding columns in MPE table,</span>
<span class="cm">	valid only for DVB-H */</span>
	<span class="n">u32</span> <span class="n">NumOfPunctCols</span><span class="p">;</span>	<span class="cm">/* Number of puncturing columns in MPE table,</span>
<span class="cm">	valid only for DVB-H */</span>
	<span class="n">u32</span> <span class="n">ErrorTSPackets</span><span class="p">;</span>	<span class="cm">/* Number of erroneous</span>
<span class="cm">	transport-stream packets */</span>
	<span class="n">u32</span> <span class="n">TotalTSPackets</span><span class="p">;</span>	<span class="cm">/* Total number of transport-stream packets */</span>
	<span class="n">u32</span> <span class="n">NumOfValidMpeTlbs</span><span class="p">;</span>	<span class="cm">/* Number of MPE tables which do not include</span>
<span class="cm">	errors after MPE RS decoding */</span>
	<span class="n">u32</span> <span class="n">NumOfInvalidMpeTlbs</span><span class="p">;</span><span class="cm">/* Number of MPE tables which include errors</span>
<span class="cm">	after MPE RS decoding */</span>
	<span class="n">u32</span> <span class="n">NumOfCorrectedMpeTlbs</span><span class="p">;</span><span class="cm">/* Number of MPE tables which were</span>
<span class="cm">	corrected by MPE RS decoding */</span>
	<span class="cm">/* Common params */</span>
	<span class="n">u32</span> <span class="n">BERErrorCount</span><span class="p">;</span>	<span class="cm">/* Number of errornous SYNC bits. */</span>
	<span class="n">u32</span> <span class="n">BERBitCount</span><span class="p">;</span>	<span class="cm">/* Total number of SYNC bits. */</span>

	<span class="cm">/* Interface information */</span>
	<span class="n">u32</span> <span class="n">SmsToHostTxErrors</span><span class="p">;</span>	<span class="cm">/* Total number of transmission errors. */</span>

	<span class="cm">/* DAB/T-DMB */</span>
	<span class="n">u32</span> <span class="n">PreBER</span><span class="p">;</span> 		<span class="cm">/* DAB/T-DMB only: Pre Viterbi BER [1E-5] */</span>

	<span class="cm">/* DVB-H TPS parameters */</span>
	<span class="n">u32</span> <span class="n">CellId</span><span class="p">;</span>		<span class="cm">/* TPS Cell ID in bits 15..0, bits 31..16 zero;</span>
<span class="cm">	 if set to 0xFFFFFFFF cell_id not yet recovered */</span>
	<span class="n">u32</span> <span class="n">DvbhSrvIndHP</span><span class="p">;</span>	<span class="cm">/* DVB-H service indication info, bit 1 -</span>
<span class="cm">	Time Slicing indicator, bit 0 - MPE-FEC indicator */</span>
	<span class="n">u32</span> <span class="n">DvbhSrvIndLP</span><span class="p">;</span>	<span class="cm">/* DVB-H service indication info, bit 1 -</span>
<span class="cm">	Time Slicing indicator, bit 0 - MPE-FEC indicator */</span>

	<span class="n">u32</span> <span class="n">NumMPEReceived</span><span class="p">;</span>	<span class="cm">/* DVB-H, Num MPE section received */</span>

	<span class="n">u32</span> <span class="n">ReservedFields</span><span class="p">[</span><span class="mi">10</span><span class="p">];</span>	<span class="cm">/* Reserved */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SmsMsgStatisticsInfo_ST</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">RequestResult</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">SMSHOSTLIB_STATISTICS_ST</span> <span class="n">Stat</span><span class="p">;</span>

	<span class="cm">/* Split the calc of the SNR in DAB */</span>
	<span class="n">u32</span> <span class="n">Signal</span><span class="p">;</span> <span class="cm">/* dB */</span>
	<span class="n">u32</span> <span class="n">Noise</span><span class="p">;</span> <span class="cm">/* dB */</span>

<span class="p">};</span>

<span class="k">struct</span> <span class="n">SMSHOSTLIB_ISDBT_LAYER_STAT_ST</span> <span class="p">{</span>
	<span class="cm">/* Per-layer information */</span>
	<span class="n">u32</span> <span class="n">CodeRate</span><span class="p">;</span> <span class="cm">/* Code Rate from SMSHOSTLIB_CODE_RATE_ET,</span>
<span class="cm">		       * 255 means layer does not exist */</span>
	<span class="n">u32</span> <span class="n">Constellation</span><span class="p">;</span> <span class="cm">/* Constellation from SMSHOSTLIB_CONSTELLATION_ET,</span>
<span class="cm">			    * 255 means layer does not exist */</span>
	<span class="n">u32</span> <span class="n">BER</span><span class="p">;</span> <span class="cm">/* Post Viterbi BER [1E-5], 0xFFFFFFFF indicate N/A */</span>
	<span class="n">u32</span> <span class="n">BERErrorCount</span><span class="p">;</span> <span class="cm">/* Post Viterbi Error Bits Count */</span>
	<span class="n">u32</span> <span class="n">BERBitCount</span><span class="p">;</span> <span class="cm">/* Post Viterbi Total Bits Count */</span>
	<span class="n">u32</span> <span class="n">PreBER</span><span class="p">;</span> <span class="cm">/* Pre Viterbi BER [1E-5], 0xFFFFFFFF indicate N/A */</span>
	<span class="n">u32</span> <span class="n">TS_PER</span><span class="p">;</span> <span class="cm">/* Transport stream PER [%], 0xFFFFFFFF indicate N/A */</span>
	<span class="n">u32</span> <span class="n">ErrorTSPackets</span><span class="p">;</span> <span class="cm">/* Number of erroneous transport-stream packets */</span>
	<span class="n">u32</span> <span class="n">TotalTSPackets</span><span class="p">;</span> <span class="cm">/* Total number of transport-stream packets */</span>
	<span class="n">u32</span> <span class="n">TILdepthI</span><span class="p">;</span> <span class="cm">/* Time interleaver depth I parameter,</span>
<span class="cm">			* 255 means layer does not exist */</span>
	<span class="n">u32</span> <span class="n">NumberOfSegments</span><span class="p">;</span> <span class="cm">/* Number of segments in layer A,</span>
<span class="cm">			       * 255 means layer does not exist */</span>
	<span class="n">u32</span> <span class="n">TMCCErrors</span><span class="p">;</span> <span class="cm">/* TMCC errors */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SMSHOSTLIB_STATISTICS_ISDBT_ST</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">StatisticsType</span><span class="p">;</span> <span class="cm">/* Enumerator identifying the type of the</span>
<span class="cm">				* structure.  Values are the same as</span>
<span class="cm">				* SMSHOSTLIB_DEVICE_MODES_E</span>
<span class="cm">				*</span>
<span class="cm">				* This field MUST always be first in any</span>
<span class="cm">				* statistics structure */</span>

	<span class="n">u32</span> <span class="n">FullSize</span><span class="p">;</span> <span class="cm">/* Total size of the structure returned by the modem.</span>
<span class="cm">		       * If the size requested by the host is smaller than</span>
<span class="cm">		       * FullSize, the struct will be truncated */</span>

	<span class="cm">/* Common parameters */</span>
	<span class="n">u32</span> <span class="n">IsRfLocked</span><span class="p">;</span> <span class="cm">/* 0 - not locked, 1 - locked */</span>
	<span class="n">u32</span> <span class="n">IsDemodLocked</span><span class="p">;</span> <span class="cm">/* 0 - not locked, 1 - locked */</span>
	<span class="n">u32</span> <span class="n">IsExternalLNAOn</span><span class="p">;</span> <span class="cm">/* 0 - external LNA off, 1 - external LNA on */</span>

	<span class="cm">/* Reception quality */</span>
	<span class="n">s32</span>  <span class="n">SNR</span><span class="p">;</span> <span class="cm">/* dB */</span>
	<span class="n">s32</span>  <span class="n">RSSI</span><span class="p">;</span> <span class="cm">/* dBm */</span>
	<span class="n">s32</span>  <span class="n">InBandPwr</span><span class="p">;</span> <span class="cm">/* In band power in dBM */</span>
	<span class="n">s32</span>  <span class="n">CarrierOffset</span><span class="p">;</span> <span class="cm">/* Carrier Offset in Hz */</span>

	<span class="cm">/* Transmission parameters */</span>
	<span class="n">u32</span> <span class="n">Frequency</span><span class="p">;</span> <span class="cm">/* Frequency in Hz */</span>
	<span class="n">u32</span> <span class="n">Bandwidth</span><span class="p">;</span> <span class="cm">/* Bandwidth in MHz */</span>
	<span class="n">u32</span> <span class="n">TransmissionMode</span><span class="p">;</span> <span class="cm">/* ISDB-T transmission mode */</span>
	<span class="n">u32</span> <span class="n">ModemState</span><span class="p">;</span> <span class="cm">/* 0 - Acquisition, 1 - Locked */</span>
	<span class="n">u32</span> <span class="n">GuardInterval</span><span class="p">;</span> <span class="cm">/* Guard Interval, 1 divided by value */</span>
	<span class="n">u32</span> <span class="n">SystemType</span><span class="p">;</span> <span class="cm">/* ISDB-T system type (ISDB-T / ISDB-Tsb) */</span>
	<span class="n">u32</span> <span class="n">PartialReception</span><span class="p">;</span> <span class="cm">/* TRUE - partial reception, FALSE otherwise */</span>
	<span class="n">u32</span> <span class="n">NumOfLayers</span><span class="p">;</span> <span class="cm">/* Number of ISDB-T layers in the network */</span>

	<span class="cm">/* Per-layer information */</span>
	<span class="cm">/* Layers A, B and C */</span>
	<span class="k">struct</span> <span class="n">SMSHOSTLIB_ISDBT_LAYER_STAT_ST</span>	<span class="n">LayerInfo</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="cm">/* Per-layer statistics, see SMSHOSTLIB_ISDBT_LAYER_STAT_ST */</span>

	<span class="cm">/* Interface information */</span>
	<span class="n">u32</span> <span class="n">SmsToHostTxErrors</span><span class="p">;</span> <span class="cm">/* Total number of transmission errors. */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">PID_STATISTICS_DATA_S</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">PID_BURST_S</span> <span class="p">{</span>
		<span class="n">u32</span> <span class="n">size</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">padding_cols</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">punct_cols</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">duration</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">cycle</span><span class="p">;</span>
		<span class="n">u32</span> <span class="n">calc_cycle</span><span class="p">;</span>
	<span class="p">}</span> <span class="n">burst</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">tot_tbl_cnt</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">invalid_tbl_cnt</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tot_cor_tbl</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">PID_DATA_S</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">pid</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">num_rows</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">PID_STATISTICS_DATA_S</span> <span class="n">pid_statistics</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define CORRECT_STAT_RSSI(_stat) ((_stat).RSSI *= -1)</span>
<span class="cp">#define CORRECT_STAT_BANDWIDTH(_stat) (_stat.Bandwidth = 8 - _stat.Bandwidth)</span>
<span class="cp">#define CORRECT_STAT_TRANSMISSON_MODE(_stat) \</span>
<span class="cp">	if (_stat.TransmissionMode == 0) \</span>
<span class="cp">		_stat.TransmissionMode = 2; \</span>
<span class="cp">	else if (_stat.TransmissionMode == 1) \</span>
<span class="cp">		_stat.TransmissionMode = 8; \</span>
<span class="cp">		else \</span>
<span class="cp">			_stat.TransmissionMode = 4;</span>

<span class="k">struct</span> <span class="n">TRANSMISSION_STATISTICS_S</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">Frequency</span><span class="p">;</span>		<span class="cm">/* Frequency in Hz */</span>
	<span class="n">u32</span> <span class="n">Bandwidth</span><span class="p">;</span>		<span class="cm">/* Bandwidth in MHz */</span>
	<span class="n">u32</span> <span class="n">TransmissionMode</span><span class="p">;</span>	<span class="cm">/* FFT mode carriers in Kilos */</span>
	<span class="n">u32</span> <span class="n">GuardInterval</span><span class="p">;</span>	<span class="cm">/* Guard Interval from</span>
<span class="cm">	SMSHOSTLIB_GUARD_INTERVALS_ET */</span>
	<span class="n">u32</span> <span class="n">CodeRate</span><span class="p">;</span>		<span class="cm">/* Code Rate from SMSHOSTLIB_CODE_RATE_ET */</span>
	<span class="n">u32</span> <span class="n">LPCodeRate</span><span class="p">;</span>		<span class="cm">/* Low Priority Code Rate from</span>
<span class="cm">	SMSHOSTLIB_CODE_RATE_ET */</span>
	<span class="n">u32</span> <span class="n">Hierarchy</span><span class="p">;</span>		<span class="cm">/* Hierarchy from SMSHOSTLIB_HIERARCHY_ET */</span>
	<span class="n">u32</span> <span class="n">Constellation</span><span class="p">;</span>	<span class="cm">/* Constellation from</span>
<span class="cm">	SMSHOSTLIB_CONSTELLATION_ET */</span>

	<span class="cm">/* DVB-H TPS parameters */</span>
	<span class="n">u32</span> <span class="n">CellId</span><span class="p">;</span>		<span class="cm">/* TPS Cell ID in bits 15..0, bits 31..16 zero;</span>
<span class="cm">	 if set to 0xFFFFFFFF cell_id not yet recovered */</span>
	<span class="n">u32</span> <span class="n">DvbhSrvIndHP</span><span class="p">;</span>	<span class="cm">/* DVB-H service indication info, bit 1 -</span>
<span class="cm">	 Time Slicing indicator, bit 0 - MPE-FEC indicator */</span>
	<span class="n">u32</span> <span class="n">DvbhSrvIndLP</span><span class="p">;</span>	<span class="cm">/* DVB-H service indication info, bit 1 -</span>
<span class="cm">	 Time Slicing indicator, bit 0 - MPE-FEC indicator */</span>
	<span class="n">u32</span> <span class="n">IsDemodLocked</span><span class="p">;</span>	<span class="cm">/* 0 - not locked, 1 - locked */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">RECEPTION_STATISTICS_S</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">IsRfLocked</span><span class="p">;</span>		<span class="cm">/* 0 - not locked, 1 - locked */</span>
	<span class="n">u32</span> <span class="n">IsDemodLocked</span><span class="p">;</span>	<span class="cm">/* 0 - not locked, 1 - locked */</span>
	<span class="n">u32</span> <span class="n">IsExternalLNAOn</span><span class="p">;</span>	<span class="cm">/* 0 - external LNA off, 1 - external LNA on */</span>

	<span class="n">u32</span> <span class="n">ModemState</span><span class="p">;</span>		<span class="cm">/* from SMSHOSTLIB_DVB_MODEM_STATE_ET */</span>
	<span class="n">s32</span> <span class="n">SNR</span><span class="p">;</span>		<span class="cm">/* dB */</span>
	<span class="n">u32</span> <span class="n">BER</span><span class="p">;</span>		<span class="cm">/* Post Viterbi BER [1E-5] */</span>
	<span class="n">u32</span> <span class="n">BERErrorCount</span><span class="p">;</span>	<span class="cm">/* Number of erronous SYNC bits. */</span>
	<span class="n">u32</span> <span class="n">BERBitCount</span><span class="p">;</span>	<span class="cm">/* Total number of SYNC bits. */</span>
	<span class="n">u32</span> <span class="n">TS_PER</span><span class="p">;</span>		<span class="cm">/* Transport stream PER,</span>
<span class="cm">	0xFFFFFFFF indicate N/A */</span>
	<span class="n">u32</span> <span class="n">MFER</span><span class="p">;</span>		<span class="cm">/* DVB-H frame error rate in percentage,</span>
<span class="cm">	0xFFFFFFFF indicate N/A, valid only for DVB-H */</span>
	<span class="n">s32</span> <span class="n">RSSI</span><span class="p">;</span>		<span class="cm">/* dBm */</span>
	<span class="n">s32</span> <span class="n">InBandPwr</span><span class="p">;</span>		<span class="cm">/* In band power in dBM */</span>
	<span class="n">s32</span> <span class="n">CarrierOffset</span><span class="p">;</span>	<span class="cm">/* Carrier Offset in bin/1024 */</span>
	<span class="n">u32</span> <span class="n">ErrorTSPackets</span><span class="p">;</span>	<span class="cm">/* Number of erroneous</span>
<span class="cm">	transport-stream packets */</span>
	<span class="n">u32</span> <span class="n">TotalTSPackets</span><span class="p">;</span>	<span class="cm">/* Total number of transport-stream packets */</span>

	<span class="n">s32</span> <span class="n">MRC_SNR</span><span class="p">;</span>		<span class="cm">/* dB */</span>
	<span class="n">s32</span> <span class="n">MRC_RSSI</span><span class="p">;</span>		<span class="cm">/* dBm */</span>
	<span class="n">s32</span> <span class="n">MRC_InBandPwr</span><span class="p">;</span>	<span class="cm">/* In band power in dBM */</span>
<span class="p">};</span>


<span class="cm">/* Statistics information returned as response for</span>
<span class="cm"> * SmsHostApiGetStatisticsEx_Req for DVB applications, SMS1100 and up */</span>
<span class="k">struct</span> <span class="n">SMSHOSTLIB_STATISTICS_DVB_S</span> <span class="p">{</span>
	<span class="cm">/* Reception */</span>
	<span class="k">struct</span> <span class="n">RECEPTION_STATISTICS_S</span> <span class="n">ReceptionData</span><span class="p">;</span>

	<span class="cm">/* Transmission parameters */</span>
	<span class="k">struct</span> <span class="n">TRANSMISSION_STATISTICS_S</span> <span class="n">TransmissionData</span><span class="p">;</span>

	<span class="cm">/* Burst parameters, valid only for DVB-H */</span>
<span class="cp">#define	SRVM_MAX_PID_FILTERS 8</span>
	<span class="k">struct</span> <span class="n">PID_DATA_S</span> <span class="n">PidData</span><span class="p">[</span><span class="n">SRVM_MAX_PID_FILTERS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SRVM_SIGNAL_STATUS_S</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">result</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">snr</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tsPackets</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">etsPackets</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">constellation</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">hpCode</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tpsSrvIndLP</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">tpsSrvIndHP</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">cellId</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">reason</span><span class="p">;</span>

	<span class="n">s32</span> <span class="n">inBandPower</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">requestId</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SMSHOSTLIB_I2C_REQ_ST</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">DeviceAddress</span><span class="p">;</span> <span class="cm">/* I2c device address */</span>
	<span class="n">u32</span>	<span class="n">WriteCount</span><span class="p">;</span> <span class="cm">/* number of bytes to write */</span>
	<span class="n">u32</span>	<span class="n">ReadCount</span><span class="p">;</span> <span class="cm">/* number of bytes to read */</span>
	<span class="n">u8</span>	<span class="n">Data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">SMSHOSTLIB_I2C_RES_ST</span> <span class="p">{</span>
	<span class="n">u32</span>	<span class="n">Status</span><span class="p">;</span> <span class="cm">/* non-zero value in case of failure */</span>
	<span class="n">u32</span>	<span class="n">ReadCount</span><span class="p">;</span> <span class="cm">/* number of bytes read */</span>
	<span class="n">u8</span>	<span class="n">Data</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>


<span class="k">struct</span> <span class="n">smscore_config_gpio</span> <span class="p">{</span>
<span class="cp">#define SMS_GPIO_DIRECTION_INPUT  0</span>
<span class="cp">#define SMS_GPIO_DIRECTION_OUTPUT 1</span>
	<span class="n">u8</span> <span class="n">direction</span><span class="p">;</span>

<span class="cp">#define SMS_GPIO_PULLUPDOWN_NONE     0</span>
<span class="cp">#define SMS_GPIO_PULLUPDOWN_PULLDOWN 1</span>
<span class="cp">#define SMS_GPIO_PULLUPDOWN_PULLUP   2</span>
<span class="cp">#define SMS_GPIO_PULLUPDOWN_KEEPER   3</span>
	<span class="n">u8</span> <span class="n">pullupdown</span><span class="p">;</span>

<span class="cp">#define SMS_GPIO_INPUTCHARACTERISTICS_NORMAL  0</span>
<span class="cp">#define SMS_GPIO_INPUTCHARACTERISTICS_SCHMITT 1</span>
	<span class="n">u8</span> <span class="n">inputcharacteristics</span><span class="p">;</span>

<span class="cp">#define SMS_GPIO_OUTPUTSLEWRATE_FAST 0</span>
<span class="cp">#define SMS_GPIO_OUTPUTSLEWRATE_SLOW 1</span>
	<span class="n">u8</span> <span class="n">outputslewrate</span><span class="p">;</span>

<span class="cp">#define SMS_GPIO_OUTPUTDRIVING_4mA  0</span>
<span class="cp">#define SMS_GPIO_OUTPUTDRIVING_8mA  1</span>
<span class="cp">#define SMS_GPIO_OUTPUTDRIVING_12mA 2</span>
<span class="cp">#define SMS_GPIO_OUTPUTDRIVING_16mA 3</span>
	<span class="n">u8</span> <span class="n">outputdriving</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">smscore_gpio_config</span> <span class="p">{</span>
<span class="cp">#define SMS_GPIO_DIRECTION_INPUT  0</span>
<span class="cp">#define SMS_GPIO_DIRECTION_OUTPUT 1</span>
	<span class="n">u8</span> <span class="n">Direction</span><span class="p">;</span>

<span class="cp">#define SMS_GPIO_PULL_UP_DOWN_NONE     0</span>
<span class="cp">#define SMS_GPIO_PULL_UP_DOWN_PULLDOWN 1</span>
<span class="cp">#define SMS_GPIO_PULL_UP_DOWN_PULLUP   2</span>
<span class="cp">#define SMS_GPIO_PULL_UP_DOWN_KEEPER   3</span>
	<span class="n">u8</span> <span class="n">PullUpDown</span><span class="p">;</span>

<span class="cp">#define SMS_GPIO_INPUT_CHARACTERISTICS_NORMAL  0</span>
<span class="cp">#define SMS_GPIO_INPUT_CHARACTERISTICS_SCHMITT 1</span>
	<span class="n">u8</span> <span class="n">InputCharacteristics</span><span class="p">;</span>

<span class="cp">#define SMS_GPIO_OUTPUT_SLEW_RATE_SLOW		1 </span><span class="cm">/* 10xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_SLEW_RATE_FAST		0 </span><span class="cm">/* 10xx */</span><span class="cp"></span>


<span class="cp">#define SMS_GPIO_OUTPUT_SLEW_RATE_0_45_V_NS	0 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_SLEW_RATE_0_9_V_NS	1 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_SLEW_RATE_1_7_V_NS	2 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_SLEW_RATE_3_3_V_NS	3 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
	<span class="n">u8</span> <span class="n">OutputSlewRate</span><span class="p">;</span>

<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_S_4mA		0 </span><span class="cm">/* 10xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_S_8mA		1 </span><span class="cm">/* 10xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_S_12mA		2 </span><span class="cm">/* 10xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_S_16mA		3 </span><span class="cm">/* 10xx */</span><span class="cp"></span>

<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_1_5mA		0 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_2_8mA		1 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_4mA		2 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_7mA		3 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_10mA		4 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_11mA		5 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_14mA		6 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
<span class="cp">#define SMS_GPIO_OUTPUT_DRIVING_16mA		7 </span><span class="cm">/* 11xx */</span><span class="cp"></span>
	<span class="n">u8</span> <span class="n">OutputDriving</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">smscore_registry_setmode</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">devpath</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_registry_getmode</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">devpath</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_register_hotplug</span><span class="p">(</span><span class="n">hotplug_t</span> <span class="n">hotplug</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">smscore_unregister_hotplug</span><span class="p">(</span><span class="n">hotplug_t</span> <span class="n">hotplug</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_register_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">smsdevice_params_t</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">**</span><span class="n">coredev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">smscore_unregister_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_start_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_load_firmware</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span>
				 <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">,</span>
				 <span class="n">loadfirmware_t</span> <span class="n">loadfirmware_handler</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_set_device_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_get_device_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_register_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">smsclient_params_t</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
				    <span class="k">struct</span> <span class="n">smscore_client_t</span> <span class="o">**</span><span class="n">client</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">smscore_unregister_client</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_client_t</span> <span class="o">*</span><span class="n">client</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">smsclient_sendrequest</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_client_t</span> <span class="o">*</span><span class="n">client</span><span class="p">,</span>
				 <span class="kt">void</span> <span class="o">*</span><span class="n">buffer</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">size</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">smscore_onresponse</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">smscore_buffer_t</span> <span class="o">*</span><span class="n">cb</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_get_common_buffer_size</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_map_common_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_get_fw_filename</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span>
				   <span class="kt">int</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">filename</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_send_fw_file</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span>
				<span class="n">u8</span> <span class="o">*</span><span class="n">ufwbuf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">);</span>

<span class="k">extern</span>
<span class="k">struct</span> <span class="n">smscore_buffer_t</span> <span class="o">*</span><span class="n">smscore_getbuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">smscore_putbuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">smscore_buffer_t</span> <span class="o">*</span><span class="n">cb</span><span class="p">);</span>

<span class="cm">/* old GPIO management */</span>
<span class="kt">int</span> <span class="n">smscore_configure_gpio</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">pin</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">smscore_config_gpio</span> <span class="o">*</span><span class="n">pinconfig</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">smscore_set_gpio</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">pin</span><span class="p">,</span> <span class="kt">int</span> <span class="n">level</span><span class="p">);</span>

<span class="cm">/* new GPIO management */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_gpio_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">PinNum</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">smscore_gpio_config</span> <span class="o">*</span><span class="n">pGpioConfig</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_gpio_set_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">PinNum</span><span class="p">,</span>
		<span class="n">u8</span> <span class="n">NewLevel</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">smscore_gpio_get_level</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">coredev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">PinNum</span><span class="p">,</span>
		<span class="n">u8</span> <span class="o">*</span><span class="n">level</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">smscore_set_board_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="kt">int</span> <span class="n">id</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">smscore_get_board_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">smscore_led_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">smscore_device_t</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="kt">int</span> <span class="n">led</span><span class="p">);</span>


<span class="cm">/* ------------------------------------------------------------------------ */</span>

<span class="cp">#define DBG_INFO 1</span>
<span class="cp">#define DBG_ADV  2</span>

<span class="cp">#define sms_printk(kern, fmt, arg...) \</span>
<span class="cp">	printk(kern &quot;%s: &quot; fmt &quot;\n&quot;, __func__, ##arg)</span>

<span class="cp">#define dprintk(kern, lvl, fmt, arg...) do {\</span>
<span class="cp">	if (sms_dbg &amp; lvl) \</span>
<span class="cp">		sms_printk(kern, fmt, ##arg); } while (0)</span>

<span class="cp">#define sms_log(fmt, arg...) sms_printk(KERN_INFO, fmt, ##arg)</span>
<span class="cp">#define sms_err(fmt, arg...) \</span>
<span class="cp">	sms_printk(KERN_ERR, &quot;line: %d: &quot; fmt, __LINE__, ##arg)</span>
<span class="cp">#define sms_warn(fmt, arg...)  sms_printk(KERN_WARNING, fmt, ##arg)</span>
<span class="cp">#define sms_info(fmt, arg...) \</span>
<span class="cp">	dprintk(KERN_INFO, DBG_INFO, fmt, ##arg)</span>
<span class="cp">#define sms_debug(fmt, arg...) \</span>
<span class="cp">	dprintk(KERN_DEBUG, DBG_ADV, fmt, ##arg)</span>


<span class="cp">#endif </span><span class="cm">/* __SMS_CORE_API_H__ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
