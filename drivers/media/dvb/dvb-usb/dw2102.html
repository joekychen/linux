<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › dvb-usb › dw2102.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>dw2102.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* DVB USB framework compliant Linux driver for the</span>
<span class="cm"> *	DVBWorld DVB-S 2101, 2102, DVB-S2 2104, DVB-C 3101,</span>
<span class="cm"> *	TeVii S600, S630, S650, S660, S480,</span>
<span class="cm"> *	Prof 1100, 7500,</span>
<span class="cm"> *	Geniatech SU3000 Cards</span>
<span class="cm"> * Copyright (C) 2008-2011 Igor M. Liplianin (liplianin@me.by)</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> *	under the terms of the GNU General Public License as published by the</span>
<span class="cm"> *	Free Software Foundation, version 2.</span>
<span class="cm"> *</span>
<span class="cm"> * see Documentation/dvb/README.dvb-usb for more information</span>
<span class="cm"> */</span>
<span class="cp">#include &quot;dw2102.h&quot;</span>
<span class="cp">#include &quot;si21xx.h&quot;</span>
<span class="cp">#include &quot;stv0299.h&quot;</span>
<span class="cp">#include &quot;z0194a.h&quot;</span>
<span class="cp">#include &quot;stv0288.h&quot;</span>
<span class="cp">#include &quot;stb6000.h&quot;</span>
<span class="cp">#include &quot;eds1547.h&quot;</span>
<span class="cp">#include &quot;cx24116.h&quot;</span>
<span class="cp">#include &quot;tda1002x.h&quot;</span>
<span class="cp">#include &quot;mt312.h&quot;</span>
<span class="cp">#include &quot;zl10039.h&quot;</span>
<span class="cp">#include &quot;ds3000.h&quot;</span>
<span class="cp">#include &quot;stv0900.h&quot;</span>
<span class="cp">#include &quot;stv6110.h&quot;</span>
<span class="cp">#include &quot;stb6100.h&quot;</span>
<span class="cp">#include &quot;stb6100_proc.h&quot;</span>

<span class="cp">#ifndef USB_PID_DW2102</span>
<span class="cp">#define USB_PID_DW2102 0x2102</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_DW2104</span>
<span class="cp">#define USB_PID_DW2104 0x2104</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_DW3101</span>
<span class="cp">#define USB_PID_DW3101 0x3101</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_CINERGY_S</span>
<span class="cp">#define USB_PID_CINERGY_S 0x0064</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_TEVII_S630</span>
<span class="cp">#define USB_PID_TEVII_S630 0xd630</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_TEVII_S650</span>
<span class="cp">#define USB_PID_TEVII_S650 0xd650</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_TEVII_S660</span>
<span class="cp">#define USB_PID_TEVII_S660 0xd660</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_TEVII_S480_1</span>
<span class="cp">#define USB_PID_TEVII_S480_1 0xd481</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_TEVII_S480_2</span>
<span class="cp">#define USB_PID_TEVII_S480_2 0xd482</span>
<span class="cp">#endif</span>

<span class="cp">#ifndef USB_PID_PROF_1100</span>
<span class="cp">#define USB_PID_PROF_1100 0xb012</span>
<span class="cp">#endif</span>

<span class="cp">#define DW210X_READ_MSG 0</span>
<span class="cp">#define DW210X_WRITE_MSG 1</span>

<span class="cp">#define REG_1F_SYMBOLRATE_BYTE0 0x1f</span>
<span class="cp">#define REG_20_SYMBOLRATE_BYTE1 0x20</span>
<span class="cp">#define REG_21_SYMBOLRATE_BYTE2 0x21</span>
<span class="cm">/* on my own*/</span>
<span class="cp">#define DW2102_VOLTAGE_CTRL (0x1800)</span>
<span class="cp">#define SU3000_STREAM_CTRL (0x1900)</span>
<span class="cp">#define DW2102_RC_QUERY (0x1a00)</span>
<span class="cp">#define DW2102_LED_CTRL (0x1b00)</span>

<span class="cp">#define	err_str &quot;did not find the firmware file. (%s) &quot; \</span>
<span class="cp">		&quot;Please see linux/Documentation/dvb/ for more details &quot; \</span>
<span class="cp">		&quot;on firmware-problems.&quot;</span>

<span class="k">struct</span> <span class="n">rc_map_dvb_usb_table_table</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">rc_map_table</span> <span class="o">*</span><span class="n">rc_keys</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc_keys_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">su3000_state</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">initialized</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">s6x0_state</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">old_set_voltage</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="n">fe_sec_voltage_t</span> <span class="n">v</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* debug */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">dvb_usb_dw2102_debug</span><span class="p">;</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="n">dvb_usb_dw2102_debug</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="s">&quot;set debugging level (1=info 2=xfer 4=rc(or-able)).&quot;</span>
						<span class="n">DVB_USB_DEBUG_STATUS</span><span class="p">);</span>

<span class="cm">/* keymaps */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">ir_keymap</span><span class="p">;</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">keymap</span><span class="p">,</span> <span class="n">ir_keymap</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">keymap</span><span class="p">,</span> <span class="s">&quot;set keymap 0=default 1=dvbworld 2=tevii 3=tbs  ...&quot;</span>
			<span class="s">&quot; 256=none&quot;</span><span class="p">);</span>

<span class="cm">/* demod probe */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">demod_probe</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">demod</span><span class="p">,</span> <span class="n">demod_probe</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">demod</span><span class="p">,</span> <span class="s">&quot;demod to probe (1=cx24116 2=stv0903+stv6110 &quot;</span>
			<span class="s">&quot;4=stv0903+stb6100(or-able)).&quot;</span><span class="p">);</span>

<span class="n">DVB_DEFINE_MOD_OPT_ADAPTER_NR</span><span class="p">(</span><span class="n">adapter_nr</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw210x_op_rw</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">request</span><span class="p">,</span> <span class="n">u16</span> <span class="n">value</span><span class="p">,</span>
			<span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span> <span class="n">data</span><span class="p">,</span> <span class="n">u16</span> <span class="n">len</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">u8buf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pipe</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">==</span> <span class="n">DW210X_READ_MSG</span><span class="p">)</span> <span class="o">?</span>
				<span class="n">usb_rcvctrlpipe</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">:</span> <span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">request_type</span> <span class="o">=</span> <span class="p">(</span><span class="n">flags</span> <span class="o">==</span> <span class="n">DW210X_READ_MSG</span><span class="p">)</span> <span class="o">?</span> <span class="n">USB_DIR_IN</span> <span class="o">:</span> <span class="n">USB_DIR_OUT</span><span class="p">;</span>

	<span class="n">u8buf</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">len</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">u8buf</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">==</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">)</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">u8buf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">pipe</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">request_type</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span><span class="p">,</span>
				<span class="n">value</span><span class="p">,</span> <span class="n">index</span> <span class="p">,</span> <span class="n">u8buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="mi">2000</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">flags</span> <span class="o">==</span> <span class="n">DW210X_READ_MSG</span><span class="p">)</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">u8buf</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">u8buf</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* I2C */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2102_i2c_transfer</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[],</span>
		<span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">i2c_get_adapdata</span><span class="p">(</span><span class="n">adap</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">buf6</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
	<span class="n">u16</span> <span class="n">value</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">d</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mutex_lock_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="cm">/* read stv0299 register */</span>
		<span class="n">value</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="cm">/* register */</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="n">value</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">buf6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x68</span>:
			<span class="cm">/* write to stv0299 register */</span>
			<span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2a</span><span class="p">;</span>
			<span class="n">buf6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">buf6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">buf6</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mh">0x60</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">flags</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* write to tuner pll */</span>
				<span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">;</span>
				<span class="n">buf6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
				<span class="n">buf6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">;</span>
				<span class="n">buf6</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="n">buf6</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
				<span class="n">buf6</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
				<span class="n">buf6</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">buf6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/* read from tuner */</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">buf6</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
				<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="p">(</span><span class="n">DW2102_RC_QUERY</span><span class="p">)</span>:
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">buf6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf6</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="p">(</span><span class="n">DW2102_VOLTAGE_CTRL</span><span class="p">)</span>:
			<span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
			<span class="n">buf6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">buf6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2102_serit_i2c_transfer</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span>
						<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">i2c_get_adapdata</span><span class="p">(</span><span class="n">adap</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">buf6</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">d</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mutex_lock_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="cm">/* read si2109 register by number */</span>
		<span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">buf6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
		<span class="n">buf6</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">buf6</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
		<span class="cm">/* read si2109 register */</span>
		<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">buf6</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf6</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x68</span>:
			<span class="cm">/* write to si2109 register */</span>
			<span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">buf6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">buf6</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">buf6</span><span class="p">,</span>
					<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span><span class="p">(</span><span class="n">DW2102_RC_QUERY</span><span class="p">)</span>:
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">buf6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">buf6</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span><span class="p">(</span><span class="n">DW2102_VOLTAGE_CTRL</span><span class="p">)</span>:
			<span class="n">buf6</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
			<span class="n">buf6</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">buf6</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2102_earda_i2c_transfer</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">i2c_get_adapdata</span><span class="p">(</span><span class="n">adap</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">d</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mutex_lock_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">2</span>: <span class="p">{</span>
		<span class="cm">/* read */</span>
		<span class="cm">/* first write first register number */</span>
		<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
		<span class="cm">/* second read registers */</span>
		<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0xd1</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">ibuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">ibuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x68</span>: <span class="p">{</span>
			<span class="cm">/* write to register */</span>
			<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">obuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">case</span> <span class="mh">0x61</span>: <span class="p">{</span>
			<span class="cm">/* write to tuner */</span>
			<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">obuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">case</span><span class="p">(</span><span class="n">DW2102_RC_QUERY</span><span class="p">)</span>: <span class="p">{</span>
			<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">ibuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">ibuf</span> <span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">case</span><span class="p">(</span><span class="n">DW2102_VOLTAGE_CTRL</span><span class="p">)</span>: <span class="p">{</span>
			<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2104_i2c_transfer</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[],</span> <span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">i2c_get_adapdata</span><span class="p">(</span><span class="n">adap</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">d</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mutex_lock_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span><span class="p">(</span><span class="n">DW2102_RC_QUERY</span><span class="p">)</span>: <span class="p">{</span>
			<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">ibuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">ibuf</span> <span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">case</span><span class="p">(</span><span class="n">DW2102_VOLTAGE_CTRL</span><span class="p">)</span>: <span class="p">{</span>
			<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x30</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="cm">/*case 0x55: cx24116</span>
<span class="cm">		case 0x6a: stv0903</span>
<span class="cm">		case 0x68: ds3000, stv0903</span>
<span class="cm">		case 0x60: ts2020, stv6110, stb6100 */</span>
		<span class="nl">default:</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">flags</span> <span class="o">==</span> <span class="n">I2C_M_RD</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* read registers */</span>
				<span class="n">u8</span>  <span class="n">ibuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span>
						<span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">ibuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
						<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">ibuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
			<span class="n">mdelay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(((</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xb0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
						<span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">==</span> <span class="mh">0x68</span><span class="p">))</span> <span class="o">||</span>
						<span class="p">((</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xf7</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
						<span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">==</span> <span class="mh">0x55</span><span class="p">)))</span> <span class="p">{</span>
				<span class="cm">/* write firmware */</span>
				<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">19</span><span class="p">];</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">15</span> <span class="o">?</span> <span class="mi">17</span> <span class="o">:</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="n">len</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">do</span> <span class="p">{</span>
					<span class="n">memcpy</span><span class="p">(</span><span class="n">obuf</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
							<span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="o">?</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">len</span><span class="p">));</span>
					<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">obuf</span><span class="p">,</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="o">?</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">len</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
						<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
					<span class="n">i</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
					<span class="n">len</span> <span class="o">-=</span> <span class="mi">16</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* write registers */</span>
				<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="n">obuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
						<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="p">}</span>

	<span class="p">}</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw3101_i2c_transfer</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[],</span>
								<span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">i2c_get_adapdata</span><span class="p">(</span><span class="n">adap</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">d</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mutex_lock_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">2</span>: <span class="p">{</span>
		<span class="cm">/* read */</span>
		<span class="cm">/* first write first register number */</span>
		<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
		<span class="cm">/* second read registers */</span>
		<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0x19</span> <span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
				<span class="n">ibuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">ibuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x60</span>:
		<span class="k">case</span> <span class="mh">0x0c</span>: <span class="p">{</span>
			<span class="cm">/* write to register */</span>
			<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">obuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">case</span><span class="p">(</span><span class="n">DW2102_RC_QUERY</span><span class="p">)</span>: <span class="p">{</span>
			<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">ibuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">ibuf</span> <span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="p">}</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">deb_xfer</span><span class="p">(</span><span class="s">&quot;%02x:%02x: %s &quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">addr</span><span class="p">,</span>
				<span class="n">msg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&quot;&gt;&gt;&gt;&quot;</span> <span class="o">:</span> <span class="s">&quot;&lt;&lt;&lt;&quot;</span><span class="p">);</span>
		<span class="n">debug_dump</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">,</span> <span class="n">deb_xfer</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">s6x0_i2c_transfer</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[],</span>
								<span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">i2c_get_adapdata</span><span class="p">(</span><span class="n">adap</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">udev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">d</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="n">udev</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mutex_lock_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">num</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="p">(</span><span class="n">DW2102_RC_QUERY</span><span class="p">)</span>: <span class="p">{</span>
			<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">ibuf</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">ibuf</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">case</span> <span class="p">(</span><span class="n">DW2102_VOLTAGE_CTRL</span><span class="p">)</span>: <span class="p">{</span>
			<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span><span class="cm">/* off-on */</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span><span class="cm">/* 13v-18v */</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">case</span> <span class="p">(</span><span class="n">DW2102_LED_CTRL</span><span class="p">)</span>: <span class="p">{</span>
			<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="cm">/*case 0x55: cx24116</span>
<span class="cm">		case 0x6a: stv0903</span>
<span class="cm">		case 0x68: ds3000, stv0903</span>
<span class="cm">		case 0x60: ts2020, stv6110, stb6100</span>
<span class="cm">		case 0xa0: eeprom */</span>
		<span class="nl">default:</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">flags</span> <span class="o">==</span> <span class="n">I2C_M_RD</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* read registers */</span>
				<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">];</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">ibuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">,</span>
						<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">ibuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xb0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
						<span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">==</span> <span class="mh">0x68</span><span class="p">))</span> <span class="p">{</span>
				<span class="cm">/* write firmware */</span>
				<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">19</span><span class="p">];</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="o">?</span>
						<span class="mi">18</span> <span class="o">:</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
				<span class="n">len</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">do</span> <span class="p">{</span>
					<span class="n">memcpy</span><span class="p">(</span><span class="n">obuf</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
							<span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="o">?</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">len</span><span class="p">));</span>
					<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">obuf</span><span class="p">,</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">16</span> <span class="o">?</span> <span class="mi">16</span> <span class="o">:</span> <span class="n">len</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
						<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
					<span class="n">i</span> <span class="o">+=</span> <span class="mi">16</span><span class="p">;</span>
					<span class="n">len</span> <span class="o">-=</span> <span class="mi">16</span><span class="p">;</span>
				<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">num</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
				<span class="cm">/* write register addr before read */</span>
				<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="n">obuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span>
						<span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idProduct</span> <span class="o">==</span>
						<span class="mh">0x7500</span> <span class="o">?</span> <span class="mh">0x92</span> <span class="o">:</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
						<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* write registers */</span>
				<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">addr</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
				<span class="n">memcpy</span><span class="p">(</span><span class="n">obuf</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
						<span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="n">j</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
						<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">su3000_i2c_transfer</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span> <span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[],</span>
								<span class="kt">int</span> <span class="n">num</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span> <span class="n">i2c_get_adapdata</span><span class="p">(</span><span class="n">adap</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="mh">0x40</span><span class="p">],</span> <span class="n">ibuf</span><span class="p">[</span><span class="mh">0x40</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">d</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mutex_lock_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EAGAIN</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">1</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SU3000_STREAM_CTRL</span>:
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mh">0x36</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ibuf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">err</span><span class="p">(</span><span class="s">&quot;i2c transfer failed.&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">DW2102_RC_QUERY</span>:
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ibuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">err</span><span class="p">(</span><span class="s">&quot;i2c transfer failed.&quot;</span><span class="p">);</span>
			<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="cm">/* always i2c write*/</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span><span class="p">;</span>
			<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>

			<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">obuf</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">(</span><span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span>
						<span class="n">ibuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">err</span><span class="p">(</span><span class="s">&quot;i2c transfer failed.&quot;</span><span class="p">);</span>

		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
		<span class="cm">/* always i2c read */</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">;</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">addr</span><span class="p">;</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">obuf</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">4</span><span class="p">,</span>
					<span class="n">ibuf</span><span class="p">,</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">err</span><span class="p">(</span><span class="s">&quot;i2c transfer failed.&quot;</span><span class="p">);</span>

		<span class="n">memcpy</span><span class="p">(</span><span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">buf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ibuf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">warn</span><span class="p">(</span><span class="s">&quot;more than 2 i2c messages at a time is not handled yet.&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_mutex</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">num</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">dw210x_i2c_func</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">I2C_FUNC_I2C</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_algorithm</span> <span class="n">dw2102_i2c_algo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">master_xfer</span> <span class="o">=</span> <span class="n">dw2102_i2c_transfer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">functionality</span> <span class="o">=</span> <span class="n">dw210x_i2c_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_algorithm</span> <span class="n">dw2102_serit_i2c_algo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">master_xfer</span> <span class="o">=</span> <span class="n">dw2102_serit_i2c_transfer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">functionality</span> <span class="o">=</span> <span class="n">dw210x_i2c_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_algorithm</span> <span class="n">dw2102_earda_i2c_algo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">master_xfer</span> <span class="o">=</span> <span class="n">dw2102_earda_i2c_transfer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">functionality</span> <span class="o">=</span> <span class="n">dw210x_i2c_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_algorithm</span> <span class="n">dw2104_i2c_algo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">master_xfer</span> <span class="o">=</span> <span class="n">dw2104_i2c_transfer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">functionality</span> <span class="o">=</span> <span class="n">dw210x_i2c_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_algorithm</span> <span class="n">dw3101_i2c_algo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">master_xfer</span> <span class="o">=</span> <span class="n">dw3101_i2c_transfer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">functionality</span> <span class="o">=</span> <span class="n">dw210x_i2c_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_algorithm</span> <span class="n">s6x0_i2c_algo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">master_xfer</span> <span class="o">=</span> <span class="n">s6x0_i2c_transfer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">functionality</span> <span class="o">=</span> <span class="n">dw210x_i2c_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">i2c_algorithm</span> <span class="n">su3000_i2c_algo</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">master_xfer</span> <span class="o">=</span> <span class="n">su3000_i2c_transfer</span><span class="p">,</span>
	<span class="p">.</span><span class="n">functionality</span> <span class="o">=</span> <span class="n">dw210x_i2c_func</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw210x_read_mac_address</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mac</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
	<span class="n">u8</span> <span class="n">eeprom</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">eepromline</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0xb6</span><span class="p">,</span> <span class="mh">0xa0</span> <span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">ibuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_READ_MSG</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="p">(</span><span class="s">&quot;read eeprom failed.&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">eepromline</span><span class="p">[</span><span class="n">i</span><span class="o">%</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">eeprom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">16</span><span class="p">)</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">deb_xfer</span><span class="p">(</span><span class="s">&quot;%02x: &quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">15</span><span class="p">);</span>
			<span class="n">debug_dump</span><span class="p">(</span><span class="n">eepromline</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">deb_xfer</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">eeprom</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">s6x0_read_mac_address</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mac</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">},</span> <span class="n">obuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="n">u8</span> <span class="n">eeprom</span><span class="p">[</span><span class="mi">256</span><span class="p">],</span> <span class="n">eepromline</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0xa0</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">obuf</span><span class="p">,</span>
			<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0xa0</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">I2C_M_RD</span><span class="p">,</span>
			<span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">,</span>
			<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">}</span>
	<span class="p">};</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">s6x0_i2c_transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="p">(</span><span class="s">&quot;read eeprom failed.&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">eepromline</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">eeprom</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">i</span> <span class="o">%</span> <span class="mi">16</span><span class="p">)</span> <span class="o">==</span> <span class="mi">15</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">deb_xfer</span><span class="p">(</span><span class="s">&quot;%02x: &quot;</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">15</span><span class="p">);</span>
			<span class="n">debug_dump</span><span class="p">(</span><span class="n">eepromline</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="n">deb_xfer</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="n">eeprom</span> <span class="o">+</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">su3000_streaming_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="n">command_start</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">};</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="n">command_stop</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">};</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">SU3000_STREAM_CTRL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">onoff</span> <span class="o">?</span> <span class="n">command_start</span> <span class="o">:</span> <span class="n">command_stop</span><span class="p">,</span>
		<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="p">};</span>

	<span class="n">i2c_transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">su3000_power_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">su3000_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">su3000_state</span> <span class="o">*</span><span class="p">)</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">obuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0xde</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>

	<span class="n">info</span><span class="p">(</span><span class="s">&quot;%s: %d, initialized %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">initialized</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">initialized</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">state</span><span class="o">-&gt;</span><span class="n">initialized</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="cm">/* reset board */</span>
		<span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">su3000_read_mac_address</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mac</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">obuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">};</span>
	<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x51</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">obuf</span><span class="p">,</span>
			<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x51</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">I2C_M_RD</span><span class="p">,</span>
			<span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">,</span>
			<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">}</span>
	<span class="p">};</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">6</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xf0</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i2c_transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">mac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ibuf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

		<span class="n">debug_dump</span><span class="p">(</span><span class="n">mac</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="n">printk</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">su3000_identify_state</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">udev</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="o">*</span><span class="n">props</span><span class="p">,</span>
				 <span class="k">struct</span> <span class="n">dvb_usb_device_description</span> <span class="o">**</span><span class="n">desc</span><span class="p">,</span>
				 <span class="kt">int</span> <span class="o">*</span><span class="n">cold</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">info</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>

	<span class="o">*</span><span class="n">cold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw210x_set_voltage</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">fe_sec_voltage_t</span> <span class="n">voltage</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="n">command_13v</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">};</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="n">command_18v</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">};</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="n">command_off</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">};</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">DW2102_VOLTAGE_CTRL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">command_off</span><span class="p">,</span>
		<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">udev_adap</span> <span class="o">=</span>
		<span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="p">)(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">voltage</span> <span class="o">==</span> <span class="n">SEC_VOLTAGE_18</span><span class="p">)</span>
		<span class="n">msg</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">command_18v</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">voltage</span> <span class="o">==</span> <span class="n">SEC_VOLTAGE_13</span><span class="p">)</span>
		<span class="n">msg</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">command_13v</span><span class="p">;</span>

	<span class="n">i2c_transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">udev_adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">s660_set_voltage</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">fe_sec_voltage_t</span> <span class="n">voltage</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span> <span class="o">=</span>
		<span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="p">)(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">s6x0_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">s6x0_state</span> <span class="o">*</span><span class="p">)</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="n">dw210x_set_voltage</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">voltage</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">old_set_voltage</span><span class="p">)</span>
		<span class="n">st</span><span class="o">-&gt;</span><span class="n">old_set_voltage</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">voltage</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dw210x_led_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">offon</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="n">led_off</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="k">static</span> <span class="n">u8</span> <span class="n">led_on</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">1</span> <span class="p">};</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">DW2102_LED_CTRL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">led_off</span><span class="p">,</span>
		<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">udev_adap</span> <span class="o">=</span>
		<span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="p">)(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">offon</span><span class="p">)</span>
		<span class="n">msg</span><span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">led_on</span><span class="p">;</span>
	<span class="n">i2c_transfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">udev_adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv0299_config</span> <span class="n">sharp_z0194a_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x68</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inittab</span> <span class="o">=</span> <span class="n">sharp_z0194a_inittab</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mclk</span> <span class="o">=</span> <span class="mi">88000000UL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">invert</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">skip_reinit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">lock_output</span> <span class="o">=</span> <span class="n">STV0299_LOCKOUTPUT_1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">volt13_op0_op1</span> <span class="o">=</span> <span class="n">STV0299_VOLT13_OP1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_delay_ms</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_symbol_rate</span> <span class="o">=</span> <span class="n">sharp_z0194a_set_symbol_rate</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">cx24116_config</span> <span class="n">dw2104_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x55</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpg_clk_pos_pol</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">si21xx_config</span> <span class="n">serit_sp1511lhb_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x68</span><span class="p">,</span>
	<span class="p">.</span><span class="n">min_delay_ms</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>

<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda10023_config</span> <span class="n">dw3101_tda10023_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x0c</span><span class="p">,</span>
	<span class="p">.</span><span class="n">invert</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mt312_config</span> <span class="n">zl313_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ds3000_config</span> <span class="n">dw2104_ds3000_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x68</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv0900_config</span> <span class="n">dw2104a_stv0900_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x6a</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">xtal</span> <span class="o">=</span> <span class="mi">27000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkmode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="cm">/* 0-CLKI, 2-XTALI, else AUTO */</span>
	<span class="p">.</span><span class="n">diseqc_mode</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="cm">/* 2/3 PWM */</span>
	<span class="p">.</span><span class="n">tun1_maddress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="cm">/* 0x60 */</span>
	<span class="p">.</span><span class="n">tun1_adc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="cm">/* 2 Vpp */</span>
	<span class="p">.</span><span class="n">path1_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stb6100_config</span> <span class="n">dw2104a_stb6100_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">tuner_address</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="p">.</span><span class="n">refclock</span> <span class="o">=</span> <span class="mi">27000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv0900_config</span> <span class="n">dw2104_stv0900_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x68</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">xtal</span> <span class="o">=</span> <span class="mi">8000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkmode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">diseqc_mode</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tun1_maddress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tun1_adc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="cm">/* 1 Vpp */</span>
	<span class="p">.</span><span class="n">path1_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv6110_config</span> <span class="n">dw2104_stv6110_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mclk</span> <span class="o">=</span> <span class="mi">16000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv0900_config</span> <span class="n">prof_7500_stv0900_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x6a</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">xtal</span> <span class="o">=</span> <span class="mi">27000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkmode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="cm">/* 0-CLKI, 2-XTALI, else AUTO */</span>
	<span class="p">.</span><span class="n">diseqc_mode</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="cm">/* 2/3 PWM */</span>
	<span class="p">.</span><span class="n">tun1_maddress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="cm">/* 0x60 */</span>
	<span class="p">.</span><span class="n">tun1_adc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="cm">/* 2 Vpp */</span>
	<span class="p">.</span><span class="n">path1_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tun1_type</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_lock_led</span> <span class="o">=</span> <span class="n">dw210x_led_ctrl</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ds3000_config</span> <span class="n">su3000_ds3000_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x68</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ci_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2104_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_tuner_ops</span> <span class="o">*</span><span class="n">tuner_ops</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">demod_probe</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0900_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw2104a_stv0900_config</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">stb6100_attach</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">dw2104a_stb6100_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tuner_ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">;</span>
				<span class="n">tuner_ops</span><span class="o">-&gt;</span><span class="n">set_frequency</span> <span class="o">=</span> <span class="n">stb6100_set_freq</span><span class="p">;</span>
				<span class="n">tuner_ops</span><span class="o">-&gt;</span><span class="n">get_frequency</span> <span class="o">=</span> <span class="n">stb6100_get_freq</span><span class="p">;</span>
				<span class="n">tuner_ops</span><span class="o">-&gt;</span><span class="n">set_bandwidth</span> <span class="o">=</span> <span class="n">stb6100_set_bandw</span><span class="p">;</span>
				<span class="n">tuner_ops</span><span class="o">-&gt;</span><span class="n">get_bandwidth</span> <span class="o">=</span> <span class="n">stb6100_get_bandw</span><span class="p">;</span>
				<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>
				<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached STV0900+STB6100!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">demod_probe</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0900_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw2104_stv0900_config</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv6110_attach</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">dw2104_stv6110_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>
				<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached STV0900+STV6110A!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">demod_probe</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">cx24116_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw2104_config</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>
			<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached cx24116!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">ds3000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw2104_ds3000_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>
		<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached DS3000!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">dw2102_properties</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">dw2104_properties</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">s6x0_properties</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2102_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dw2102_properties</span><span class="p">.</span><span class="n">i2c_algo</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">dw2102_serit_i2c_algo</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*dw2102_properties.adapter-&gt;tuner_attach = NULL;*/</span>
		<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">si21xx_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">serit_sp1511lhb_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>
			<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached si21xx!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dw2102_properties</span><span class="p">.</span><span class="n">i2c_algo</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">dw2102_earda_i2c_algo</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0288_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">earda_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">stb6000_attach</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>
				<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached stv0288!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dw2102_properties</span><span class="p">.</span><span class="n">i2c_algo</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">dw2102_i2c_algo</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*dw2102_properties.adapter-&gt;tuner_attach = dw2102_tuner_attach;*/</span>
		<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0299_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sharp_z0194a_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>
			<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached stv0299!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw3101_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda10023_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw3101_tda10023_config</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached tda10023!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">zl100313_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt312_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">zl313_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">zl10039_attach</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>
			<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached zl100313+zl10039!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stv0288_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">obuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>

	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0288_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">earda_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stb6000_attach</span><span class="p">,</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>

	<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>

	<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached stv0288+stb6000!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ds3000_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">s6x0_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">s6x0_state</span> <span class="o">*</span><span class="p">)</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">obuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>

	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">ds3000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw2104_ds3000_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">old_set_voltage</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span><span class="p">;</span>
	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">s660_set_voltage</span><span class="p">;</span>

	<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>

	<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached ds3000+ds2020!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">prof_7500_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">obuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">};</span>

	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0900_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">prof_7500_stv0900_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">dw210x_set_voltage</span><span class="p">;</span>

	<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">,</span> <span class="mh">0x8a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>

	<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached STV0900+STB6100A!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">su3000_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">obuf</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xe</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="n">u8</span> <span class="n">ibuf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ibuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;command 0x0e transfer failed.&quot;</span><span class="p">);</span>

	<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xe</span><span class="p">;</span>
	<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x83</span><span class="p">;</span>
	<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ibuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;command 0x0e transfer failed.&quot;</span><span class="p">);</span>

	<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xe</span><span class="p">;</span>
	<span class="n">obuf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x83</span><span class="p">;</span>
	<span class="n">obuf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">ibuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;command 0x0e transfer failed.&quot;</span><span class="p">);</span>

	<span class="n">obuf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x51</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_usb_generic_rw</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">obuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ibuf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;command 0x51 transfer failed.&quot;</span><span class="p">);</span>

	<span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">ds3000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">su3000_ds3000_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="n">info</span><span class="p">(</span><span class="s">&quot;Attached DS3000!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2102_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dvb_attach</span><span class="p">(</span><span class="n">dvb_pll_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="n">DVB_PLL_OPERA1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw3101_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dvb_attach</span><span class="p">(</span><span class="n">dvb_pll_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="n">DVB_PLL_TUA6034</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">rc_map_table</span> <span class="n">rc_map_dw210x_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0xf80a</span><span class="p">,</span> <span class="n">KEY_POWER2</span> <span class="p">},</span>		<span class="cm">/*power*/</span>
	<span class="p">{</span> <span class="mh">0xf80c</span><span class="p">,</span> <span class="n">KEY_MUTE</span> <span class="p">},</span>		<span class="cm">/*mute*/</span>
	<span class="p">{</span> <span class="mh">0xf811</span><span class="p">,</span> <span class="n">KEY_1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf812</span><span class="p">,</span> <span class="n">KEY_2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf813</span><span class="p">,</span> <span class="n">KEY_3</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf814</span><span class="p">,</span> <span class="n">KEY_4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf815</span><span class="p">,</span> <span class="n">KEY_5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf816</span><span class="p">,</span> <span class="n">KEY_6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf817</span><span class="p">,</span> <span class="n">KEY_7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf818</span><span class="p">,</span> <span class="n">KEY_8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf819</span><span class="p">,</span> <span class="n">KEY_9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf810</span><span class="p">,</span> <span class="n">KEY_0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf81c</span><span class="p">,</span> <span class="n">KEY_CHANNELUP</span> <span class="p">},</span>	<span class="cm">/*ch+*/</span>
	<span class="p">{</span> <span class="mh">0xf80f</span><span class="p">,</span> <span class="n">KEY_CHANNELDOWN</span> <span class="p">},</span>	<span class="cm">/*ch-*/</span>
	<span class="p">{</span> <span class="mh">0xf81a</span><span class="p">,</span> <span class="n">KEY_VOLUMEUP</span> <span class="p">},</span>	<span class="cm">/*vol+*/</span>
	<span class="p">{</span> <span class="mh">0xf80e</span><span class="p">,</span> <span class="n">KEY_VOLUMEDOWN</span> <span class="p">},</span>	<span class="cm">/*vol-*/</span>
	<span class="p">{</span> <span class="mh">0xf804</span><span class="p">,</span> <span class="n">KEY_RECORD</span> <span class="p">},</span>		<span class="cm">/*rec*/</span>
	<span class="p">{</span> <span class="mh">0xf809</span><span class="p">,</span> <span class="n">KEY_FAVORITES</span> <span class="p">},</span>	<span class="cm">/*fav*/</span>
	<span class="p">{</span> <span class="mh">0xf808</span><span class="p">,</span> <span class="n">KEY_REWIND</span> <span class="p">},</span>		<span class="cm">/*rewind*/</span>
	<span class="p">{</span> <span class="mh">0xf807</span><span class="p">,</span> <span class="n">KEY_FASTFORWARD</span> <span class="p">},</span>	<span class="cm">/*fast*/</span>
	<span class="p">{</span> <span class="mh">0xf80b</span><span class="p">,</span> <span class="n">KEY_PAUSE</span> <span class="p">},</span>		<span class="cm">/*pause*/</span>
	<span class="p">{</span> <span class="mh">0xf802</span><span class="p">,</span> <span class="n">KEY_ESC</span> <span class="p">},</span>		<span class="cm">/*cancel*/</span>
	<span class="p">{</span> <span class="mh">0xf803</span><span class="p">,</span> <span class="n">KEY_TAB</span> <span class="p">},</span>		<span class="cm">/*tab*/</span>
	<span class="p">{</span> <span class="mh">0xf800</span><span class="p">,</span> <span class="n">KEY_UP</span> <span class="p">},</span>		<span class="cm">/*up*/</span>
	<span class="p">{</span> <span class="mh">0xf81f</span><span class="p">,</span> <span class="n">KEY_OK</span> <span class="p">},</span>		<span class="cm">/*ok*/</span>
	<span class="p">{</span> <span class="mh">0xf801</span><span class="p">,</span> <span class="n">KEY_DOWN</span> <span class="p">},</span>		<span class="cm">/*down*/</span>
	<span class="p">{</span> <span class="mh">0xf805</span><span class="p">,</span> <span class="n">KEY_CAMERA</span> <span class="p">},</span>		<span class="cm">/*cap*/</span>
	<span class="p">{</span> <span class="mh">0xf806</span><span class="p">,</span> <span class="n">KEY_STOP</span> <span class="p">},</span>		<span class="cm">/*stop*/</span>
	<span class="p">{</span> <span class="mh">0xf840</span><span class="p">,</span> <span class="n">KEY_ZOOM</span> <span class="p">},</span>		<span class="cm">/*full*/</span>
	<span class="p">{</span> <span class="mh">0xf81e</span><span class="p">,</span> <span class="n">KEY_TV</span> <span class="p">},</span>		<span class="cm">/*tvmode*/</span>
	<span class="p">{</span> <span class="mh">0xf81b</span><span class="p">,</span> <span class="n">KEY_LAST</span> <span class="p">},</span>		<span class="cm">/*recall*/</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">rc_map_table</span> <span class="n">rc_map_tevii_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0xf80a</span><span class="p">,</span> <span class="n">KEY_POWER</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf80c</span><span class="p">,</span> <span class="n">KEY_MUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf811</span><span class="p">,</span> <span class="n">KEY_1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf812</span><span class="p">,</span> <span class="n">KEY_2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf813</span><span class="p">,</span> <span class="n">KEY_3</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf814</span><span class="p">,</span> <span class="n">KEY_4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf815</span><span class="p">,</span> <span class="n">KEY_5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf816</span><span class="p">,</span> <span class="n">KEY_6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf817</span><span class="p">,</span> <span class="n">KEY_7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf818</span><span class="p">,</span> <span class="n">KEY_8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf819</span><span class="p">,</span> <span class="n">KEY_9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf810</span><span class="p">,</span> <span class="n">KEY_0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf81c</span><span class="p">,</span> <span class="n">KEY_MENU</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf80f</span><span class="p">,</span> <span class="n">KEY_VOLUMEDOWN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf81a</span><span class="p">,</span> <span class="n">KEY_LAST</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf80e</span><span class="p">,</span> <span class="n">KEY_OPEN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf804</span><span class="p">,</span> <span class="n">KEY_RECORD</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf809</span><span class="p">,</span> <span class="n">KEY_VOLUMEUP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf808</span><span class="p">,</span> <span class="n">KEY_CHANNELUP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf807</span><span class="p">,</span> <span class="n">KEY_PVR</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf80b</span><span class="p">,</span> <span class="n">KEY_TIME</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf802</span><span class="p">,</span> <span class="n">KEY_RIGHT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf803</span><span class="p">,</span> <span class="n">KEY_LEFT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf800</span><span class="p">,</span> <span class="n">KEY_UP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf81f</span><span class="p">,</span> <span class="n">KEY_OK</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf801</span><span class="p">,</span> <span class="n">KEY_DOWN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf805</span><span class="p">,</span> <span class="n">KEY_TUNER</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf806</span><span class="p">,</span> <span class="n">KEY_CHANNELDOWN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf840</span><span class="p">,</span> <span class="n">KEY_PLAYPAUSE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf81e</span><span class="p">,</span> <span class="n">KEY_REWIND</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf81b</span><span class="p">,</span> <span class="n">KEY_FAVORITES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf81d</span><span class="p">,</span> <span class="n">KEY_BACK</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf84d</span><span class="p">,</span> <span class="n">KEY_FASTFORWARD</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf844</span><span class="p">,</span> <span class="n">KEY_EPG</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf84c</span><span class="p">,</span> <span class="n">KEY_INFO</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf841</span><span class="p">,</span> <span class="n">KEY_AB</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf843</span><span class="p">,</span> <span class="n">KEY_AUDIO</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf845</span><span class="p">,</span> <span class="n">KEY_SUBTITLE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf84a</span><span class="p">,</span> <span class="n">KEY_LIST</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf846</span><span class="p">,</span> <span class="n">KEY_F1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf847</span><span class="p">,</span> <span class="n">KEY_F2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf85e</span><span class="p">,</span> <span class="n">KEY_F3</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf85c</span><span class="p">,</span> <span class="n">KEY_F4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf852</span><span class="p">,</span> <span class="n">KEY_F5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf85a</span><span class="p">,</span> <span class="n">KEY_F6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf856</span><span class="p">,</span> <span class="n">KEY_MODE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf858</span><span class="p">,</span> <span class="n">KEY_SWITCHVIDEOMODE</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">rc_map_table</span> <span class="n">rc_map_tbs_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0xf884</span><span class="p">,</span> <span class="n">KEY_POWER</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf894</span><span class="p">,</span> <span class="n">KEY_MUTE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf887</span><span class="p">,</span> <span class="n">KEY_1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf886</span><span class="p">,</span> <span class="n">KEY_2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf885</span><span class="p">,</span> <span class="n">KEY_3</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf88b</span><span class="p">,</span> <span class="n">KEY_4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf88a</span><span class="p">,</span> <span class="n">KEY_5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf889</span><span class="p">,</span> <span class="n">KEY_6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf88f</span><span class="p">,</span> <span class="n">KEY_7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf88e</span><span class="p">,</span> <span class="n">KEY_8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf88d</span><span class="p">,</span> <span class="n">KEY_9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf892</span><span class="p">,</span> <span class="n">KEY_0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf896</span><span class="p">,</span> <span class="n">KEY_CHANNELUP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf891</span><span class="p">,</span> <span class="n">KEY_CHANNELDOWN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf893</span><span class="p">,</span> <span class="n">KEY_VOLUMEUP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf88c</span><span class="p">,</span> <span class="n">KEY_VOLUMEDOWN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf883</span><span class="p">,</span> <span class="n">KEY_RECORD</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf898</span><span class="p">,</span> <span class="n">KEY_PAUSE</span>  <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf899</span><span class="p">,</span> <span class="n">KEY_OK</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf89a</span><span class="p">,</span> <span class="n">KEY_SHUFFLE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf881</span><span class="p">,</span> <span class="n">KEY_UP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf890</span><span class="p">,</span> <span class="n">KEY_LEFT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf882</span><span class="p">,</span> <span class="n">KEY_RIGHT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf888</span><span class="p">,</span> <span class="n">KEY_DOWN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf895</span><span class="p">,</span> <span class="n">KEY_FAVORITES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf897</span><span class="p">,</span> <span class="n">KEY_SUBTITLE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf89d</span><span class="p">,</span> <span class="n">KEY_ZOOM</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf89f</span><span class="p">,</span> <span class="n">KEY_EXIT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf89e</span><span class="p">,</span> <span class="n">KEY_MENU</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf89c</span><span class="p">,</span> <span class="n">KEY_EPG</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf880</span><span class="p">,</span> <span class="n">KEY_PREVIOUS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf89b</span><span class="p">,</span> <span class="n">KEY_MODE</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">rc_map_table</span> <span class="n">rc_map_su3000_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x25</span><span class="p">,</span> <span class="n">KEY_POWER</span> <span class="p">},</span>	<span class="cm">/* right-bottom Red */</span>
	<span class="p">{</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="n">KEY_MUTE</span> <span class="p">},</span>	<span class="cm">/* -/-- */</span>
	<span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="n">KEY_1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">KEY_2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x03</span><span class="p">,</span> <span class="n">KEY_3</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x04</span><span class="p">,</span> <span class="n">KEY_4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x05</span><span class="p">,</span> <span class="n">KEY_5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x06</span><span class="p">,</span> <span class="n">KEY_6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x07</span><span class="p">,</span> <span class="n">KEY_7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x08</span><span class="p">,</span> <span class="n">KEY_8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x09</span><span class="p">,</span> <span class="n">KEY_9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="n">KEY_0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="n">KEY_UP</span> <span class="p">},</span>	<span class="cm">/* CH+ */</span>
	<span class="p">{</span> <span class="mh">0x21</span><span class="p">,</span> <span class="n">KEY_DOWN</span> <span class="p">},</span>	<span class="cm">/* CH+ */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">KEY_VOLUMEUP</span> <span class="p">},</span>	<span class="cm">/* Brightness Up */</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="n">KEY_VOLUMEDOWN</span> <span class="p">},</span><span class="cm">/* Brightness Down */</span>
	<span class="p">{</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="n">KEY_RECORD</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">KEY_PLAY</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="n">KEY_PAUSE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="n">KEY_STOP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x27</span><span class="p">,</span> <span class="n">KEY_FASTFORWARD</span> <span class="p">},</span><span class="cm">/* &gt;&gt; */</span>
	<span class="p">{</span> <span class="mh">0x26</span><span class="p">,</span> <span class="n">KEY_REWIND</span> <span class="p">},</span>	<span class="cm">/* &lt;&lt; */</span>
	<span class="p">{</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="n">KEY_OK</span> <span class="p">},</span>	<span class="cm">/* Mute */</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">KEY_LEFT</span> <span class="p">},</span>	<span class="cm">/* VOL- */</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">KEY_RIGHT</span> <span class="p">},</span>	<span class="cm">/* VOL+ */</span>
	<span class="p">{</span> <span class="mh">0x29</span><span class="p">,</span> <span class="n">KEY_BACK</span> <span class="p">},</span>	<span class="cm">/* button under 9 */</span>
	<span class="p">{</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="n">KEY_MENU</span> <span class="p">},</span>	<span class="cm">/* TTX */</span>
	<span class="p">{</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="n">KEY_EPG</span> <span class="p">},</span>	<span class="cm">/* EPG */</span>
	<span class="p">{</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="n">KEY_RED</span> <span class="p">},</span>	<span class="cm">/* OSD */</span>
	<span class="p">{</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="n">KEY_GREEN</span> <span class="p">},</span>	<span class="cm">/* Window */</span>
	<span class="p">{</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="n">KEY_YELLOW</span> <span class="p">},</span>	<span class="cm">/* button under &lt;&lt; */</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="n">KEY_BLUE</span> <span class="p">},</span>	<span class="cm">/* bottom yellow button */</span>
	<span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">KEY_AUDIO</span> <span class="p">},</span>	<span class="cm">/* Snapshot */</span>
	<span class="p">{</span> <span class="mh">0x38</span><span class="p">,</span> <span class="n">KEY_TV</span> <span class="p">},</span>	<span class="cm">/* TV/Radio */</span>
	<span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="n">KEY_ESC</span> <span class="p">}</span>	<span class="cm">/* upper Red button */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">rc_map_dvb_usb_table_table</span> <span class="n">keys_tables</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">rc_map_dw210x_table</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_dw210x_table</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">rc_map_tevii_table</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_tevii_table</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">rc_map_tbs_table</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_tbs_table</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">rc_map_su3000_table</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_su3000_table</span><span class="p">)</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2102_rc_query</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">event</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">rc_map_table</span> <span class="o">*</span><span class="n">keymap</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">props</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span><span class="p">.</span><span class="n">rc_map_table</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">keymap_size</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">props</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span><span class="p">.</span><span class="n">rc_map_size</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">DW2102_RC_QUERY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">I2C_M_RD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">key</span><span class="p">,</span>
		<span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">2</span>
	<span class="p">};</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="cm">/* override keymap */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">ir_keymap</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">ir_keymap</span> <span class="o">&lt;=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">keys_tables</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">keymap</span> <span class="o">=</span> <span class="n">keys_tables</span><span class="p">[</span><span class="n">ir_keymap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">rc_keys</span> <span class="p">;</span>
		<span class="n">keymap_size</span> <span class="o">=</span> <span class="n">keys_tables</span><span class="p">[</span><span class="n">ir_keymap</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">rc_keys_size</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ir_keymap</span> <span class="o">&gt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">keys_tables</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* none */</span>

	<span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">REMOTE_NO_KEY_PRESSED</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">props</span><span class="p">.</span><span class="n">i2c_algo</span><span class="o">-&gt;</span><span class="n">master_xfer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">keymap_size</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">rc5_data</span><span class="p">(</span><span class="o">&amp;</span><span class="n">keymap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="n">msg</span><span class="p">.</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
				<span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">REMOTE_KEY_PRESSED</span><span class="p">;</span>
				<span class="o">*</span><span class="n">event</span> <span class="o">=</span> <span class="n">keymap</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">keycode</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>

		<span class="p">}</span>

		<span class="k">if</span> <span class="p">((</span><span class="o">*</span><span class="n">state</span><span class="p">)</span> <span class="o">==</span> <span class="n">REMOTE_KEY_PRESSED</span><span class="p">)</span>
			<span class="n">deb_rc</span><span class="p">(</span><span class="s">&quot;%s: found rc key: %x, %x, event: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">__func__</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="o">*</span><span class="n">event</span><span class="p">));</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0xff</span><span class="p">)</span>
			<span class="n">deb_rc</span><span class="p">(</span><span class="s">&quot;%s: unknown rc key: %x, %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">__func__</span><span class="p">,</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="n">dw2102_table_entry</span> <span class="p">{</span>
	<span class="n">CYPRESS_DW2102</span><span class="p">,</span>
	<span class="n">CYPRESS_DW2101</span><span class="p">,</span>
	<span class="n">CYPRESS_DW2104</span><span class="p">,</span>
	<span class="n">TEVII_S650</span><span class="p">,</span>
	<span class="n">TERRATEC_CINERGY_S</span><span class="p">,</span>
	<span class="n">CYPRESS_DW3101</span><span class="p">,</span>
	<span class="n">TEVII_S630</span><span class="p">,</span>
	<span class="n">PROF_1100</span><span class="p">,</span>
	<span class="n">TEVII_S660</span><span class="p">,</span>
	<span class="n">PROF_7500</span><span class="p">,</span>
	<span class="n">GENIATECH_SU3000</span><span class="p">,</span>
	<span class="n">TERRATEC_CINERGY_S2</span><span class="p">,</span>
	<span class="n">TEVII_S480_1</span><span class="p">,</span>
	<span class="n">TEVII_S480_2</span><span class="p">,</span>
	<span class="n">X3M_SPC1400HD</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="n">dw2102_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">CYPRESS_DW2102</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_CYPRESS</span><span class="p">,</span> <span class="n">USB_PID_DW2102</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">CYPRESS_DW2101</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_CYPRESS</span><span class="p">,</span> <span class="mh">0x2101</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">CYPRESS_DW2104</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_CYPRESS</span><span class="p">,</span> <span class="n">USB_PID_DW2104</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">TEVII_S650</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x9022</span><span class="p">,</span> <span class="n">USB_PID_TEVII_S650</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">TERRATEC_CINERGY_S</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span> <span class="n">USB_PID_CINERGY_S</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">CYPRESS_DW3101</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_CYPRESS</span><span class="p">,</span> <span class="n">USB_PID_DW3101</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">TEVII_S630</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x9022</span><span class="p">,</span> <span class="n">USB_PID_TEVII_S630</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">PROF_1100</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x3011</span><span class="p">,</span> <span class="n">USB_PID_PROF_1100</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">TEVII_S660</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x9022</span><span class="p">,</span> <span class="n">USB_PID_TEVII_S660</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">PROF_7500</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x3034</span><span class="p">,</span> <span class="mh">0x7500</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">GENIATECH_SU3000</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x1f4d</span><span class="p">,</span> <span class="mh">0x3000</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">TERRATEC_CINERGY_S2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span> <span class="mh">0x00a8</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">TEVII_S480_1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x9022</span><span class="p">,</span> <span class="n">USB_PID_TEVII_S480_1</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">TEVII_S480_2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x9022</span><span class="p">,</span> <span class="n">USB_PID_TEVII_S480_2</span><span class="p">)},</span>
	<span class="p">[</span><span class="n">X3M_SPC1400HD</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x1f4d</span><span class="p">,</span> <span class="mh">0x3100</span><span class="p">)},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">usb</span><span class="p">,</span> <span class="n">dw2102_table</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2102_load_firmware</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">frmwr</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reset</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">reset16</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">fw</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">fw_2101</span> <span class="o">=</span> <span class="s">&quot;dvb-usb-dw2101.fw&quot;</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idProduct</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x2101</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">request_firmware</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fw</span><span class="p">,</span> <span class="n">fw_2101</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="p">(</span><span class="n">err_str</span><span class="p">,</span> <span class="n">fw_2101</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">fw</span> <span class="o">=</span> <span class="n">frmwr</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">info</span><span class="p">(</span><span class="s">&quot;start downloading DW210X firmware&quot;</span><span class="p">);</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="n">fw</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="n">reset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="cm">/*stop the CPU*/</span>
	<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0x7f92</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
	<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xe600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">fw</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mh">0x40</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">u8</span> <span class="o">*</span><span class="p">)</span> <span class="n">p</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">b</span> <span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span>
					<span class="n">DW210X_WRITE_MSG</span><span class="p">)</span> <span class="o">!=</span> <span class="mh">0x40</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">err</span><span class="p">(</span><span class="s">&quot;error while transferring firmware&quot;</span><span class="p">);</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="cm">/* restart the CPU */</span>
		<span class="n">reset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">||</span> <span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0x7f92</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
					<span class="n">DW210X_WRITE_MSG</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="p">(</span><span class="s">&quot;could not restart the USB controller CPU.&quot;</span><span class="p">);</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">||</span> <span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xe600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
					<span class="n">DW210X_WRITE_MSG</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="p">(</span><span class="s">&quot;could not restart the USB controller CPU.&quot;</span><span class="p">);</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="cm">/* init registers */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idProduct</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">USB_PID_TEVII_S650</span>:
			<span class="n">dw2104_properties</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span><span class="p">.</span><span class="n">rc_map_table</span> <span class="o">=</span> <span class="n">rc_map_tevii_table</span><span class="p">;</span>
			<span class="n">dw2104_properties</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span><span class="p">.</span><span class="n">rc_map_size</span> <span class="o">=</span>
					<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_tevii_table</span><span class="p">);</span>
		<span class="k">case</span> <span class="n">USB_PID_DW2104</span>:
			<span class="n">reset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
					<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="cm">/* break omitted intentionally */</span>
		<span class="k">case</span> <span class="n">USB_PID_DW3101</span>:
			<span class="n">reset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0x0040</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">USB_PID_CINERGY_S</span>:
		<span class="k">case</span> <span class="n">USB_PID_DW2102</span>:
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xbf</span><span class="p">,</span> <span class="mh">0x0040</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
					<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
					<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="cm">/* check STV0299 frontend  */</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
					<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xa1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x80</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">dw2102_properties</span><span class="p">.</span><span class="n">i2c_algo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dw2102_i2c_algo</span><span class="p">;</span>
				<span class="n">dw2102_properties</span><span class="p">.</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">tuner_attach</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dw2102_tuner_attach</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* check STV0288 frontend  */</span>
				<span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xd0</span><span class="p">;</span>
				<span class="n">reset16</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="n">reset16</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span>
						<span class="n">DW210X_WRITE_MSG</span><span class="p">);</span>
				<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span>
						<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">reset16</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x11</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">dw2102_properties</span><span class="p">.</span><span class="n">i2c_algo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dw2102_earda_i2c_algo</span><span class="p">;</span>
					<span class="k">break</span><span class="p">;</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="k">case</span> <span class="mh">0x2101</span>:
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xbc</span><span class="p">,</span> <span class="mh">0x0030</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
					<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span>
					<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">7</span><span class="p">,</span>
					<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="n">dw210x_op_rw</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">reset16</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span>
					<span class="n">DW210X_READ_MSG</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">dw2102_properties</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_IS_AN_I2C_ADAPTER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">usb_ctrl</span> <span class="o">=</span> <span class="n">DEVICE_SPECIFIC</span><span class="p">,</span>
	<span class="p">.</span><span class="n">firmware</span> <span class="o">=</span> <span class="s">&quot;dvb-usb-dw2102.fw&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">no_reconnect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">i2c_algo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dw2102_serit_i2c_algo</span><span class="p">,</span>

	<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rc_map_table</span> <span class="o">=</span> <span class="n">rc_map_dw210x_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_map_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_dw210x_table</span><span class="p">),</span>
		<span class="p">.</span><span class="n">rc_interval</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_query</span> <span class="o">=</span> <span class="n">dw2102_rc_query</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">.</span><span class="n">generic_bulk_ctrl_endpoint</span> <span class="o">=</span> <span class="mh">0x81</span><span class="p">,</span>
	<span class="cm">/* parameter for the MPEG2-data transfer */</span>
	<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">download_firmware</span> <span class="o">=</span> <span class="n">dw2102_load_firmware</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_mac_address</span> <span class="o">=</span> <span class="n">dw210x_read_mac_address</span><span class="p">,</span>
	<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span>
		<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
			<span class="p">.</span><span class="n">frontend_attach</span> <span class="o">=</span> <span class="n">dw2102_frontend_attach</span><span class="p">,</span>
			<span class="p">.</span><span class="n">stream</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">USB_BULK</span><span class="p">,</span>
				<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
				<span class="p">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="mh">0x82</span><span class="p">,</span>
				<span class="p">.</span><span class="n">u</span> <span class="o">=</span> <span class="p">{</span>
					<span class="p">.</span><span class="n">bulk</span> <span class="o">=</span> <span class="p">{</span>
						<span class="p">.</span><span class="n">buffersize</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">},</span>
		<span class="p">}},</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="s">&quot;DVBWorld DVB-S 2102 USB2.0&quot;</span><span class="p">,</span>
			<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">CYPRESS_DW2102</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
			<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
		<span class="p">},</span>
		<span class="p">{</span><span class="s">&quot;DVBWorld DVB-S 2101 USB2.0&quot;</span><span class="p">,</span>
			<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">CYPRESS_DW2101</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
			<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
		<span class="p">},</span>
		<span class="p">{</span><span class="s">&quot;TerraTec Cinergy S USB&quot;</span><span class="p">,</span>
			<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">TERRATEC_CINERGY_S</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
			<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">dw2104_properties</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_IS_AN_I2C_ADAPTER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">usb_ctrl</span> <span class="o">=</span> <span class="n">DEVICE_SPECIFIC</span><span class="p">,</span>
	<span class="p">.</span><span class="n">firmware</span> <span class="o">=</span> <span class="s">&quot;dvb-usb-dw2104.fw&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">no_reconnect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">i2c_algo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dw2104_i2c_algo</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rc_map_table</span> <span class="o">=</span> <span class="n">rc_map_dw210x_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_map_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_dw210x_table</span><span class="p">),</span>
		<span class="p">.</span><span class="n">rc_interval</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_query</span> <span class="o">=</span> <span class="n">dw2102_rc_query</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">.</span><span class="n">generic_bulk_ctrl_endpoint</span> <span class="o">=</span> <span class="mh">0x81</span><span class="p">,</span>
	<span class="cm">/* parameter for the MPEG2-data transfer */</span>
	<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">download_firmware</span> <span class="o">=</span> <span class="n">dw2102_load_firmware</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_mac_address</span> <span class="o">=</span> <span class="n">dw210x_read_mac_address</span><span class="p">,</span>
	<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span>
		<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
			<span class="p">.</span><span class="n">frontend_attach</span> <span class="o">=</span> <span class="n">dw2104_frontend_attach</span><span class="p">,</span>
			<span class="p">.</span><span class="n">stream</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">USB_BULK</span><span class="p">,</span>
				<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
				<span class="p">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="mh">0x82</span><span class="p">,</span>
				<span class="p">.</span><span class="n">u</span> <span class="o">=</span> <span class="p">{</span>
					<span class="p">.</span><span class="n">bulk</span> <span class="o">=</span> <span class="p">{</span>
						<span class="p">.</span><span class="n">buffersize</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">},</span>
		<span class="p">}},</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;DVBWorld DW2104 USB2.0&quot;</span><span class="p">,</span>
			<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">CYPRESS_DW2104</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
			<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
		<span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;TeVii S650 USB2.0&quot;</span><span class="p">,</span>
			<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">TEVII_S650</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
			<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">dw3101_properties</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_IS_AN_I2C_ADAPTER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">usb_ctrl</span> <span class="o">=</span> <span class="n">DEVICE_SPECIFIC</span><span class="p">,</span>
	<span class="p">.</span><span class="n">firmware</span> <span class="o">=</span> <span class="s">&quot;dvb-usb-dw3101.fw&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">no_reconnect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">i2c_algo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dw3101_i2c_algo</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rc_map_table</span> <span class="o">=</span> <span class="n">rc_map_dw210x_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_map_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_dw210x_table</span><span class="p">),</span>
		<span class="p">.</span><span class="n">rc_interval</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_query</span> <span class="o">=</span> <span class="n">dw2102_rc_query</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">.</span><span class="n">generic_bulk_ctrl_endpoint</span> <span class="o">=</span> <span class="mh">0x81</span><span class="p">,</span>
	<span class="cm">/* parameter for the MPEG2-data transfer */</span>
	<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">download_firmware</span> <span class="o">=</span> <span class="n">dw2102_load_firmware</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_mac_address</span> <span class="o">=</span> <span class="n">dw210x_read_mac_address</span><span class="p">,</span>
	<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span>
		<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
			<span class="p">.</span><span class="n">frontend_attach</span> <span class="o">=</span> <span class="n">dw3101_frontend_attach</span><span class="p">,</span>
			<span class="p">.</span><span class="n">tuner_attach</span> <span class="o">=</span> <span class="n">dw3101_tuner_attach</span><span class="p">,</span>
			<span class="p">.</span><span class="n">stream</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">USB_BULK</span><span class="p">,</span>
				<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
				<span class="p">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="mh">0x82</span><span class="p">,</span>
				<span class="p">.</span><span class="n">u</span> <span class="o">=</span> <span class="p">{</span>
					<span class="p">.</span><span class="n">bulk</span> <span class="o">=</span> <span class="p">{</span>
						<span class="p">.</span><span class="n">buffersize</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">},</span>
		<span class="p">}},</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;DVBWorld DVB-C 3101 USB2.0&quot;</span><span class="p">,</span>
			<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">CYPRESS_DW3101</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
			<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">s6x0_properties</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_IS_AN_I2C_ADAPTER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">usb_ctrl</span> <span class="o">=</span> <span class="n">DEVICE_SPECIFIC</span><span class="p">,</span>
	<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">s6x0_state</span><span class="p">),</span>
	<span class="p">.</span><span class="n">firmware</span> <span class="o">=</span> <span class="s">&quot;dvb-usb-s630.fw&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">no_reconnect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">i2c_algo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">s6x0_i2c_algo</span><span class="p">,</span>
	<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rc_map_table</span> <span class="o">=</span> <span class="n">rc_map_tevii_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_map_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_tevii_table</span><span class="p">),</span>
		<span class="p">.</span><span class="n">rc_interval</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_query</span> <span class="o">=</span> <span class="n">dw2102_rc_query</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">.</span><span class="n">generic_bulk_ctrl_endpoint</span> <span class="o">=</span> <span class="mh">0x81</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">download_firmware</span> <span class="o">=</span> <span class="n">dw2102_load_firmware</span><span class="p">,</span>
	<span class="p">.</span><span class="n">read_mac_address</span> <span class="o">=</span> <span class="n">s6x0_read_mac_address</span><span class="p">,</span>
	<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span>
		<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
			<span class="p">.</span><span class="n">frontend_attach</span> <span class="o">=</span> <span class="n">zl100313_frontend_attach</span><span class="p">,</span>
			<span class="p">.</span><span class="n">stream</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">USB_BULK</span><span class="p">,</span>
				<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
				<span class="p">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="mh">0x82</span><span class="p">,</span>
				<span class="p">.</span><span class="n">u</span> <span class="o">=</span> <span class="p">{</span>
					<span class="p">.</span><span class="n">bulk</span> <span class="o">=</span> <span class="p">{</span>
						<span class="p">.</span><span class="n">buffersize</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">},</span>
		<span class="p">}},</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="s">&quot;TeVii S630 USB&quot;</span><span class="p">,</span>
			<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">TEVII_S630</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
			<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="o">*</span><span class="n">p1100</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_description</span> <span class="n">d1100</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Prof 1100 USB &quot;</span><span class="p">,</span>
	<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">PROF_1100</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
	<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="o">*</span><span class="n">s660</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_description</span> <span class="n">d660</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;TeVii S660 USB&quot;</span><span class="p">,</span>
	<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">TEVII_S660</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
	<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_description</span> <span class="n">d480_1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;TeVii S480.1 USB&quot;</span><span class="p">,</span>
	<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">TEVII_S480_1</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
	<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_description</span> <span class="n">d480_2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;TeVii S480.2 USB&quot;</span><span class="p">,</span>
	<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">TEVII_S480_2</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
	<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="o">*</span><span class="n">p7500</span><span class="p">;</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_description</span> <span class="n">d7500</span> <span class="o">=</span> <span class="p">{</span>
	<span class="s">&quot;Prof 7500 USB DVB-S2&quot;</span><span class="p">,</span>
	<span class="p">{</span><span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">PROF_7500</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
	<span class="p">{</span><span class="nb">NULL</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">su3000_properties</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_IS_AN_I2C_ADAPTER</span><span class="p">,</span>
	<span class="p">.</span><span class="n">usb_ctrl</span> <span class="o">=</span> <span class="n">DEVICE_SPECIFIC</span><span class="p">,</span>
	<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">su3000_state</span><span class="p">),</span>
	<span class="p">.</span><span class="n">power_ctrl</span> <span class="o">=</span> <span class="n">su3000_power_ctrl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">identify_state</span>	<span class="o">=</span> <span class="n">su3000_identify_state</span><span class="p">,</span>
	<span class="p">.</span><span class="n">i2c_algo</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">su3000_i2c_algo</span><span class="p">,</span>

	<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">rc_map_table</span> <span class="o">=</span> <span class="n">rc_map_su3000_table</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_map_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_su3000_table</span><span class="p">),</span>
		<span class="p">.</span><span class="n">rc_interval</span> <span class="o">=</span> <span class="mi">150</span><span class="p">,</span>
		<span class="p">.</span><span class="n">rc_query</span> <span class="o">=</span> <span class="n">dw2102_rc_query</span><span class="p">,</span>
	<span class="p">},</span>

	<span class="p">.</span><span class="n">read_mac_address</span> <span class="o">=</span> <span class="n">su3000_read_mac_address</span><span class="p">,</span>

	<span class="p">.</span><span class="n">generic_bulk_ctrl_endpoint</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>

	<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span>
		<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
			<span class="p">.</span><span class="n">streaming_ctrl</span>   <span class="o">=</span> <span class="n">su3000_streaming_ctrl</span><span class="p">,</span>
			<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">su3000_frontend_attach</span><span class="p">,</span>
			<span class="p">.</span><span class="n">stream</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">USB_BULK</span><span class="p">,</span>
				<span class="p">.</span><span class="n">count</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
				<span class="p">.</span><span class="n">endpoint</span> <span class="o">=</span> <span class="mh">0x82</span><span class="p">,</span>
				<span class="p">.</span><span class="n">u</span> <span class="o">=</span> <span class="p">{</span>
					<span class="p">.</span><span class="n">bulk</span> <span class="o">=</span> <span class="p">{</span>
						<span class="p">.</span><span class="n">buffersize</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}},</span>
		<span class="p">}</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="s">&quot;SU3000HD DVB-S USB2.0&quot;</span><span class="p">,</span>
			<span class="p">{</span> <span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">GENIATECH_SU3000</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
		<span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;Terratec Cinergy S2 USB HD&quot;</span><span class="p">,</span>
			<span class="p">{</span> <span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">TERRATEC_CINERGY_S2</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
		<span class="p">},</span>
		<span class="p">{</span> <span class="s">&quot;X3M TV SPC1400HD PCI&quot;</span><span class="p">,</span>
			<span class="p">{</span> <span class="o">&amp;</span><span class="n">dw2102_table</span><span class="p">[</span><span class="n">X3M_SPC1400HD</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dw2102_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">intf</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">p1100</span> <span class="o">=</span> <span class="n">kmemdup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s6x0_properties</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device_properties</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p1100</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="cm">/* copy default structure */</span>
	<span class="cm">/* fill only different fields */</span>
	<span class="n">p1100</span><span class="o">-&gt;</span><span class="n">firmware</span> <span class="o">=</span> <span class="s">&quot;dvb-usb-p1100.fw&quot;</span><span class="p">;</span>
	<span class="n">p1100</span><span class="o">-&gt;</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d1100</span><span class="p">;</span>
	<span class="n">p1100</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span><span class="p">.</span><span class="n">rc_map_table</span> <span class="o">=</span> <span class="n">rc_map_tbs_table</span><span class="p">;</span>
	<span class="n">p1100</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span><span class="p">.</span><span class="n">rc_map_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_tbs_table</span><span class="p">);</span>
	<span class="n">p1100</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">frontend_attach</span> <span class="o">=</span> <span class="n">stv0288_frontend_attach</span><span class="p">;</span>

	<span class="n">s660</span> <span class="o">=</span> <span class="n">kmemdup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s6x0_properties</span><span class="p">,</span>
		       <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device_properties</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">s660</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">p1100</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">s660</span><span class="o">-&gt;</span><span class="n">firmware</span> <span class="o">=</span> <span class="s">&quot;dvb-usb-s660.fw&quot;</span><span class="p">;</span>
	<span class="n">s660</span><span class="o">-&gt;</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">s660</span><span class="o">-&gt;</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d660</span><span class="p">;</span>
	<span class="n">s660</span><span class="o">-&gt;</span><span class="n">devices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">d480_1</span><span class="p">;</span>
	<span class="n">s660</span><span class="o">-&gt;</span><span class="n">devices</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">d480_2</span><span class="p">;</span>
	<span class="n">s660</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">frontend_attach</span> <span class="o">=</span> <span class="n">ds3000_frontend_attach</span><span class="p">;</span>

	<span class="n">p7500</span> <span class="o">=</span> <span class="n">kmemdup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s6x0_properties</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device_properties</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">p7500</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">p1100</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">s660</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">p7500</span><span class="o">-&gt;</span><span class="n">firmware</span> <span class="o">=</span> <span class="s">&quot;dvb-usb-p7500.fw&quot;</span><span class="p">;</span>
	<span class="n">p7500</span><span class="o">-&gt;</span><span class="n">devices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">d7500</span><span class="p">;</span>
	<span class="n">p7500</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span><span class="p">.</span><span class="n">rc_map_table</span> <span class="o">=</span> <span class="n">rc_map_tbs_table</span><span class="p">;</span>
	<span class="n">p7500</span><span class="o">-&gt;</span><span class="n">rc</span><span class="p">.</span><span class="n">legacy</span><span class="p">.</span><span class="n">rc_map_size</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rc_map_tbs_table</span><span class="p">);</span>
	<span class="n">p7500</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">frontend_attach</span> <span class="o">=</span> <span class="n">prof_7500_frontend_attach</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">dvb_usb_device_init</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw2102_properties</span><span class="p">,</span>
			<span class="n">THIS_MODULE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">)</span> <span class="o">||</span>
	    <span class="mi">0</span> <span class="o">==</span> <span class="n">dvb_usb_device_init</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw2104_properties</span><span class="p">,</span>
			<span class="n">THIS_MODULE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">)</span> <span class="o">||</span>
	    <span class="mi">0</span> <span class="o">==</span> <span class="n">dvb_usb_device_init</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dw3101_properties</span><span class="p">,</span>
			<span class="n">THIS_MODULE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">)</span> <span class="o">||</span>
	    <span class="mi">0</span> <span class="o">==</span> <span class="n">dvb_usb_device_init</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">s6x0_properties</span><span class="p">,</span>
			<span class="n">THIS_MODULE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">)</span> <span class="o">||</span>
	    <span class="mi">0</span> <span class="o">==</span> <span class="n">dvb_usb_device_init</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="n">p1100</span><span class="p">,</span>
			<span class="n">THIS_MODULE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">)</span> <span class="o">||</span>
	    <span class="mi">0</span> <span class="o">==</span> <span class="n">dvb_usb_device_init</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="n">s660</span><span class="p">,</span>
			<span class="n">THIS_MODULE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">)</span> <span class="o">||</span>
	    <span class="mi">0</span> <span class="o">==</span> <span class="n">dvb_usb_device_init</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="n">p7500</span><span class="p">,</span>
			<span class="n">THIS_MODULE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">)</span> <span class="o">||</span>
	    <span class="mi">0</span> <span class="o">==</span> <span class="n">dvb_usb_device_init</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">su3000_properties</span><span class="p">,</span>
				     <span class="n">THIS_MODULE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usb_driver</span> <span class="n">dw2102_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;dw2102&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">dw2102_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disconnect</span> <span class="o">=</span> <span class="n">dvb_usb_device_exit</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">dw2102_table</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">module_usb_driver</span><span class="p">(</span><span class="n">dw2102_driver</span><span class="p">);</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Igor M. Liplianin (c) liplianin@me.by&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Driver for DVBWorld DVB-S 2101, 2102, DVB-S2 2104,&quot;</span>
				<span class="s">&quot; DVB-C 3101 USB2.0,&quot;</span>
				<span class="s">&quot; TeVii S600, S630, S650, S660, S480,&quot;</span>
				<span class="s">&quot; Prof 1100, 7500 USB2.0,&quot;</span>
				<span class="s">&quot; Geniatech SU3000 devices&quot;</span><span class="p">);</span>
<span class="n">MODULE_VERSION</span><span class="p">(</span><span class="s">&quot;0.1&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
