<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › dvb › dvb-usb › dib0700_devices.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>dib0700_devices.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* Linux driver for devices based on the DiBcom DiB0700 USB bridge</span>
<span class="cm"> *</span>
<span class="cm"> *	This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> *	under the terms of the GNU General Public License as published by the Free</span>
<span class="cm"> *	Software Foundation, version 2.</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2005-9 DiBcom, SA et al</span>
<span class="cm"> */</span>
<span class="cp">#include &quot;dib0700.h&quot;</span>

<span class="cp">#include &quot;dib3000mc.h&quot;</span>
<span class="cp">#include &quot;dib7000m.h&quot;</span>
<span class="cp">#include &quot;dib7000p.h&quot;</span>
<span class="cp">#include &quot;dib8000.h&quot;</span>
<span class="cp">#include &quot;dib9000.h&quot;</span>
<span class="cp">#include &quot;mt2060.h&quot;</span>
<span class="cp">#include &quot;mt2266.h&quot;</span>
<span class="cp">#include &quot;tuner-xc2028.h&quot;</span>
<span class="cp">#include &quot;xc5000.h&quot;</span>
<span class="cp">#include &quot;xc4000.h&quot;</span>
<span class="cp">#include &quot;s5h1411.h&quot;</span>
<span class="cp">#include &quot;dib0070.h&quot;</span>
<span class="cp">#include &quot;dib0090.h&quot;</span>
<span class="cp">#include &quot;lgdt3305.h&quot;</span>
<span class="cp">#include &quot;mxl5007t.h&quot;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">force_lna_activation</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">force_lna_activation</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">force_lna_activation</span><span class="p">,</span> <span class="s">&quot;force the activation of Low-Noise-Amplifyer(s) (LNA), &quot;</span>
		<span class="s">&quot;if applicable for the device (default: 0=automatic/off).&quot;</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="p">{</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">set_param_save</span><span class="p">)</span> <span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="p">);</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">firmware</span> <span class="o">*</span><span class="n">frontend_firmware</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Hauppauge Nova-T 500 (aka Bristol)</span>
<span class="cm"> *  has a LNA on GPIO0 which is enabled by setting 1 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">mt2060_config</span> <span class="n">bristol_mt2060_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_out</span>   <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">bristol_dib3000p_mt2060_agc_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">band_caps</span> <span class="o">=</span> <span class="n">BAND_VHF</span> <span class="o">|</span> <span class="n">BAND_UHF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">setup</span>     <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

	<span class="p">.</span><span class="n">agc1_max</span> <span class="o">=</span> <span class="mi">42598</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_min</span> <span class="o">=</span> <span class="mi">17694</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_max</span> <span class="o">=</span> <span class="mi">45875</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc1_pt1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_pt2</span> <span class="o">=</span> <span class="mi">59</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc1_slope1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_slope2</span> <span class="o">=</span> <span class="mi">69</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc2_pt1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_pt2</span> <span class="o">=</span> <span class="mi">59</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc2_slope1</span> <span class="o">=</span> <span class="mi">111</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_slope2</span> <span class="o">=</span> <span class="mi">28</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib3000mc_config</span> <span class="n">bristol_dib3000mc_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>	<span class="p">.</span><span class="n">agc</span>          <span class="o">=</span> <span class="o">&amp;</span><span class="n">bristol_dib3000p_mt2060_agc_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_time</span>     <span class="o">=</span> <span class="mh">0x196</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ln_adc_level</span> <span class="o">=</span> <span class="mh">0x1cc7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>	<span class="p">.</span><span class="n">agc</span>          <span class="o">=</span> <span class="o">&amp;</span><span class="n">bristol_dib3000p_mt2060_agc_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">max_time</span>     <span class="o">=</span> <span class="mh">0x196</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ln_adc_level</span> <span class="o">=</span> <span class="mh">0x1cc7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bristol_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">force_lna_activation</span><span class="p">)</span>
			<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">dib3000mc_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">DEFAULT_DIB3000P_I2C_ADDRESS</span><span class="p">,</span> <span class="n">bristol_dib3000mc_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">mt2060_if1</span><span class="p">[</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1220</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib3000mc_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
		<span class="p">(</span><span class="mi">10</span> <span class="o">+</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bristol_dib3000mc_config</span><span class="p">[</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">]))</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">eeprom_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">,</span><span class="n">u8</span> <span class="n">adrs</span><span class="p">,</span><span class="n">u8</span> <span class="o">*</span><span class="n">pval</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x50</span><span class="p">,</span> <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>        <span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adrs</span><span class="p">,</span> <span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x50</span><span class="p">,</span> <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">I2C_M_RD</span><span class="p">,</span> <span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">pval</span><span class="p">,</span>  <span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">},</span>
	<span class="p">};</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i2c_transfer</span><span class="p">(</span><span class="n">adap</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="n">EREMOTEIO</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">bristol_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">prim_i2c</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib3000mc_get_tuner_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">s8</span> <span class="n">a</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">if1</span><span class="o">=</span><span class="mi">1220</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idVendor</span>  <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idProduct</span> <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_PID_HAUPPAUGE_NOVA_T_500_2</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">eeprom_read</span><span class="p">(</span><span class="n">prim_i2c</span><span class="p">,</span><span class="mh">0x59</span> <span class="o">+</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span><span class="o">&amp;</span><span class="n">a</span><span class="p">))</span> <span class="n">if1</span><span class="o">=</span><span class="mi">1220</span><span class="o">+</span><span class="n">a</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt2060_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
			  <span class="o">&amp;</span><span class="n">bristol_mt2060_config</span><span class="p">[</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">],</span> <span class="n">if1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>
			  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* STK7700D: Pinnacle/Terratec/Hauppauge Dual DVB-T Diversity */</span>

<span class="cm">/* MT226x */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">stk7700d_7000p_mt2266_agc_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">BAND_UHF</span><span class="p">,</span>

		<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=1, P_agc_inv_pwm1=1, P_agc_inv_pwm2=1,</span>
<span class="cm">		* P_agc_inh_dc_rv_est=0, P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=2, P_agc_write=0 */</span>
		<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
	    <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

		<span class="mi">1130</span><span class="p">,</span>
		<span class="mi">21</span><span class="p">,</span>

		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">118</span><span class="p">,</span>

		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">3530</span><span class="p">,</span>
		<span class="mi">1</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span>

		<span class="mi">65535</span><span class="p">,</span>
		<span class="mi">33770</span><span class="p">,</span>
		<span class="mi">65535</span><span class="p">,</span>
		<span class="mi">23592</span><span class="p">,</span>

		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">62</span><span class="p">,</span>
		<span class="mi">255</span><span class="p">,</span>
		<span class="mi">64</span><span class="p">,</span>
		<span class="mi">64</span><span class="p">,</span>
		<span class="mi">132</span><span class="p">,</span>
		<span class="mi">192</span><span class="p">,</span>
		<span class="mi">80</span><span class="p">,</span>
		<span class="mi">80</span><span class="p">,</span>

		<span class="mi">17</span><span class="p">,</span>
		<span class="mi">27</span><span class="p">,</span>
		<span class="mi">23</span><span class="p">,</span>
		<span class="mi">51</span><span class="p">,</span>

		<span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="n">BAND_VHF</span> <span class="o">|</span> <span class="n">BAND_LBAND</span><span class="p">,</span>

		<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=1, P_agc_inv_pwm1=1, P_agc_inv_pwm2=1,</span>
<span class="cm">		* P_agc_inh_dc_rv_est=0, P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=2, P_agc_write=0 */</span>
		<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
	    <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

		<span class="mi">2372</span><span class="p">,</span>
		<span class="mi">21</span><span class="p">,</span>

		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">118</span><span class="p">,</span>

		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">3530</span><span class="p">,</span>
		<span class="mi">1</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span>

		<span class="mi">65535</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">65535</span><span class="p">,</span>
		<span class="mi">23592</span><span class="p">,</span>

		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">128</span><span class="p">,</span>
		<span class="mi">128</span><span class="p">,</span>
		<span class="mi">128</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span>
		<span class="mi">128</span><span class="p">,</span>
		<span class="mi">253</span><span class="p">,</span>
		<span class="mi">81</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span>

		<span class="mi">17</span><span class="p">,</span>
		<span class="mi">27</span><span class="p">,</span>
		<span class="mi">23</span><span class="p">,</span>
		<span class="mi">51</span><span class="p">,</span>

		<span class="mi">1</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">stk7700d_mt2266_pll_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">60000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">524</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">20452225</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">stk7700d_dib7000p_mt2266_config</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="n">stk7700d_7000p_mt2266_agc_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700d_mt2266_pll_config</span><span class="p">,</span>

		<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="n">stk7700d_7000p_mt2266_agc_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700d_mt2266_pll_config</span><span class="p">,</span>

		<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mt2266_config</span> <span class="n">stk7700d_mt2266_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x60</span>
	<span class="p">},</span>
	<span class="p">{</span>	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x60</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700P2_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
					     <span class="n">stk7700d_dib7000p_mt2266_config</span><span class="p">)</span>
		    <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span>
		<span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
			   <span class="mh">0x80</span> <span class="o">+</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span>
			   <span class="o">&amp;</span><span class="n">stk7700d_dib7000p_mt2266_config</span><span class="p">[</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">]);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700d_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
					     <span class="n">stk7700d_dib7000p_mt2266_config</span><span class="p">)</span>
		    <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span>
		<span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
			   <span class="mh">0x80</span> <span class="o">+</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span>
			   <span class="o">&amp;</span><span class="n">stk7700d_dib7000p_mt2266_config</span><span class="p">[</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">]);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700d_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span><span class="p">;</span>
	<span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7000p_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt2266_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">stk7700d_mt2266_config</span><span class="p">[</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* STK7700-PH: Digital/Analog Hybrid Tuner, e.h. Cinergy HT USB HE */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">xc3028_agc_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">BAND_VHF</span> <span class="o">|</span> <span class="n">BAND_UHF</span><span class="p">,</span>       <span class="cm">/* band_caps */</span>

	<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=0,</span>
<span class="cm">	 * P_agc_inv_pwm1=0, P_agc_inv_pwm2=0, P_agc_inh_dc_rv_est=0,</span>
<span class="cm">	 * P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=2, P_agc_write=0 */</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="cm">/* setup */</span>

	<span class="mi">712</span><span class="p">,</span>	<span class="cm">/* inv_gain */</span>
	<span class="mi">21</span><span class="p">,</span>	<span class="cm">/* time_stabiliz */</span>

	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* alpha_level */</span>
	<span class="mi">118</span><span class="p">,</span>	<span class="cm">/* thlock */</span>

	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* wbd_inv */</span>
	<span class="mi">2867</span><span class="p">,</span>	<span class="cm">/* wbd_ref */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* wbd_sel */</span>
	<span class="mi">2</span><span class="p">,</span>	<span class="cm">/* wbd_alpha */</span>

	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_max */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_min */</span>
	<span class="mi">39718</span><span class="p">,</span>	<span class="cm">/* agc2_max */</span>
	<span class="mi">9930</span><span class="p">,</span>	<span class="cm">/* agc2_min */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_pt1 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_pt2 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_pt3 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_slope1 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_slope2 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc2_pt1 */</span>
	<span class="mi">128</span><span class="p">,</span>	<span class="cm">/* agc2_pt2 */</span>
	<span class="mi">29</span><span class="p">,</span>	<span class="cm">/* agc2_slope1 */</span>
	<span class="mi">29</span><span class="p">,</span>	<span class="cm">/* agc2_slope2 */</span>

	<span class="mi">17</span><span class="p">,</span>	<span class="cm">/* alpha_mant */</span>
	<span class="mi">27</span><span class="p">,</span>	<span class="cm">/* alpha_exp */</span>
	<span class="mi">23</span><span class="p">,</span>	<span class="cm">/* beta_mant */</span>
	<span class="mi">51</span><span class="p">,</span>	<span class="cm">/* beta_exp */</span>

	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* perform_agc_softsplit */</span>
<span class="p">};</span>

<span class="cm">/* PLL Configuration for COFDM BW_MHz = 8.00 with external clock = 30.00 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">xc3028_bw_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">60000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span> <span class="cm">/* internal, sampling */</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* pll_cfg: prediv, ratio, range, reset, bypass */</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* misc: refdiv, bypclk_div, IO_CLK_en_core, ADClkSrc,</span>
<span class="cm">			  modulo */</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">524</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="cm">/* sad_cfg: refsel, sel, freq_15k */</span>
	<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="mi">5816102</span><span class="p">,</span> <span class="cm">/* ifreq = 5.200000 MHz */</span>
	<span class="mi">20452225</span><span class="p">,</span> <span class="cm">/* timf */</span>
	<span class="mi">30000000</span><span class="p">,</span> <span class="cm">/* xtal_hz */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">stk7700ph_dib7700_xc3028_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">xc3028_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">xc3028_bw_config</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700ph_xc3028_callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component</span><span class="p">,</span>
				     <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">XC2028_TUNER_RESET</span>:
		<span class="cm">/* Send the tuner in then out of reset */</span>
		<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">XC2028_RESET_CLK</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: unknown command %d, arg %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
			<span class="n">command</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc2028_ctrl</span> <span class="n">stk7700ph_xc3028_ctrl</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">fname</span> <span class="o">=</span> <span class="n">XC2028_DEFAULT_FIRMWARE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod</span> <span class="o">=</span> <span class="n">XC3028_FE_DIBCOM52</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc2028_config</span> <span class="n">stk7700ph_xc3028_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_addr</span> <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ctrl</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700ph_xc3028_ctrl</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700ph_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_device_descriptor</span> <span class="o">*</span><span class="n">desc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">desc</span><span class="o">-&gt;</span><span class="n">idVendor</span>  <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">desc</span><span class="o">-&gt;</span><span class="n">idProduct</span> <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_PID_PINNACLE_EXPRESSCARD_320CX</span><span class="p">))</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
				     <span class="o">&amp;</span><span class="n">stk7700ph_dib7700_xc3028_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">stk7700ph_dib7700_xc3028_config</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700ph_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span><span class="p">;</span>

	<span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7000p_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span>
		<span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">stk7700ph_xc3028_config</span><span class="p">.</span><span class="n">i2c_adap</span> <span class="o">=</span> <span class="n">tun_i2c</span><span class="p">;</span>

	<span class="cm">/* FIXME: generalize &amp; move to common area */</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">callback</span> <span class="o">=</span> <span class="n">stk7700ph_xc3028_callback</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc2028_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stk7700ph_xc3028_config</span><span class="p">)</span>
		<span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define DEFAULT_RC_INTERVAL 50</span>

<span class="k">static</span> <span class="n">u8</span> <span class="n">rc_request</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">REQUEST_POLL_RC</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>

<span class="cm">/* Number of keypresses to ignore before start repeating */</span>
<span class="cp">#define RC_REPEAT_DELAY 6</span>

<span class="cm">/*</span>
<span class="cm"> * This function is used only when firmware is &lt; 1.20 version. Newer</span>
<span class="cm"> * firmwares use bulk mode, with functions implemented at dib0700_core,</span>
<span class="cm"> * at dib0700_rc_urb_completion()</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib0700_rc_query_old_firmware</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">keycode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">toggle</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">fw_version</span> <span class="o">&gt;=</span> <span class="mh">0x10200</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* For 1.20 firmware , We need to keep the RC polling</span>
<span class="cm">		   callback so we can reuse the input device setup in</span>
<span class="cm">		   dvb-usb-remote.c.  However, the actual work is being done</span>
<span class="cm">		   in the bulk URB completion handler. */</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">i</span> <span class="o">=</span> <span class="n">dib0700_ctrl_rd</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">rc_request</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;RC Query Failed&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* losing half of KEY_0 events from Philipps rc5 remotes.. */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* info(&quot;%d: %2X %2X %2X %2X&quot;,dvb_usb_dib0700_ir_proto,(int)key[3-2],(int)key[3-3],(int)key[3-1],(int)key[3]);  */</span>

	<span class="n">dib0700_rc_setup</span><span class="p">(</span><span class="n">d</span><span class="p">);</span> <span class="cm">/* reset ir sensor data to prevent false events */</span>

	<span class="n">d</span><span class="o">-&gt;</span><span class="n">last_event</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">props</span><span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">protocol</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">RC_TYPE_NEC</span>:
		<span class="cm">/* NEC protocol sends repeat code as 0 0 0 FF */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">))</span>
			<span class="n">keycode</span> <span class="o">=</span> <span class="n">d</span><span class="o">-&gt;</span><span class="n">last_event</span><span class="p">;</span>
		<span class="k">else</span> <span class="p">{</span>
			<span class="n">keycode</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="p">];</span>
			<span class="n">d</span><span class="o">-&gt;</span><span class="n">last_event</span> <span class="o">=</span> <span class="n">keycode</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">rc_keydown</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">rc_dev</span><span class="p">,</span> <span class="n">keycode</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="cm">/* RC-5 protocol changes toggle bit on new keypress */</span>
		<span class="n">keycode</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">3</span><span class="p">];</span>
		<span class="n">toggle</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
		<span class="n">rc_keydown</span><span class="p">(</span><span class="n">d</span><span class="o">-&gt;</span><span class="n">rc_dev</span><span class="p">,</span> <span class="n">keycode</span><span class="p">,</span> <span class="n">toggle</span><span class="p">);</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* STK7700P: Hauppauge Nova-T Stick, AVerMedia Volar */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">stk7700p_7000m_mt2060_agc_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">BAND_UHF</span> <span class="o">|</span> <span class="n">BAND_VHF</span><span class="p">,</span>

	<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=5, P_agc_inv_pwm1=0, P_agc_inv_pwm2=0,</span>
<span class="cm">	 * P_agc_inh_dc_rv_est=0, P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=2, P_agc_write=0 */</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
	<span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

	<span class="mi">712</span><span class="p">,</span>
	<span class="mi">41</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">118</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">4095</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>

	<span class="mi">42598</span><span class="p">,</span>
	<span class="mi">17694</span><span class="p">,</span>
	<span class="mi">45875</span><span class="p">,</span>
	<span class="mi">2621</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">76</span><span class="p">,</span>
	<span class="mi">139</span><span class="p">,</span>
	<span class="mi">52</span><span class="p">,</span>
	<span class="mi">59</span><span class="p">,</span>
	<span class="mi">107</span><span class="p">,</span>
	<span class="mi">172</span><span class="p">,</span>
	<span class="mi">57</span><span class="p">,</span>
	<span class="mi">70</span><span class="p">,</span>

	<span class="mi">21</span><span class="p">,</span>
	<span class="mi">25</span><span class="p">,</span>
	<span class="mi">28</span><span class="p">,</span>
	<span class="mi">48</span><span class="p">,</span>

	<span class="mi">1</span><span class="p">,</span>
	<span class="p">{</span>  <span class="mi">0</span><span class="p">,</span>
	   <span class="mi">107</span><span class="p">,</span>
	   <span class="mi">51800</span><span class="p">,</span>
	   <span class="mi">24700</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">stk7700p_7000p_mt2060_agc_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">BAND_UHF</span> <span class="o">|</span> <span class="n">BAND_VHF</span><span class="p">,</span>

	<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=5, P_agc_inv_pwm1=0, P_agc_inv_pwm2=0,</span>
<span class="cm">	 * P_agc_inh_dc_rv_est=0, P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=2, P_agc_write=0 */</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
	<span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

	<span class="mi">712</span><span class="p">,</span>
	<span class="mi">41</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">118</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">4095</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>

	<span class="mi">42598</span><span class="p">,</span>
	<span class="mi">16384</span><span class="p">,</span>
	<span class="mi">42598</span><span class="p">,</span>
	    <span class="mi">0</span><span class="p">,</span>

	  <span class="mi">0</span><span class="p">,</span>
	<span class="mi">137</span><span class="p">,</span>
	<span class="mi">255</span><span class="p">,</span>

	  <span class="mi">0</span><span class="p">,</span>
	<span class="mi">255</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>

	 <span class="mi">0</span><span class="p">,</span>
	<span class="mi">41</span><span class="p">,</span>

	<span class="mi">15</span><span class="p">,</span>
	<span class="mi">25</span><span class="p">,</span>

	<span class="mi">28</span><span class="p">,</span>
	<span class="mi">48</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">stk7700p_pll_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">60000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">524</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
	<span class="mi">60258167</span><span class="p">,</span>
	<span class="mi">20452225</span><span class="p">,</span>
	<span class="mi">30000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000m_config</span> <span class="n">stk7700p_dib7000m_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">dvbt_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">quartz_direct</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700p_7000m_mt2060_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700p_pll_config</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">stk7700p_dib7000p_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700p_7000p_mt2060_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700p_pll_config</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700p_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="cm">/* unless there is no real power management in DVB - we leave the device on GPIO6 */</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>  <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">mt2060_if1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1220</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000pc_detection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stk7700p_dib7000p_config</span><span class="p">);</span>
		<span class="n">st</span><span class="o">-&gt;</span><span class="n">is_dib7000pc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000m_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stk7700p_dib7000m_config</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mt2060_config</span> <span class="n">stk7700p_mt2060_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x60</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700p_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">prim_i2c</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">a</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">if1</span><span class="o">=</span><span class="mi">1220</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idVendor</span>  <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idProduct</span> <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_PID_HAUPPAUGE_NOVA_T_STICK</span><span class="p">))</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">eeprom_read</span><span class="p">(</span><span class="n">prim_i2c</span><span class="p">,</span><span class="mh">0x58</span><span class="p">,</span><span class="o">&amp;</span><span class="n">a</span><span class="p">))</span> <span class="n">if1</span><span class="o">=</span><span class="mi">1220</span><span class="o">+</span><span class="n">a</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">is_dib7000pc</span><span class="p">)</span>
		<span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7000p_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7000m_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt2060_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stk7700p_mt2060_config</span><span class="p">,</span>
		<span class="n">if1</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* DIB7070 generic */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">dib7070_agc_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">BAND_UHF</span> <span class="o">|</span> <span class="n">BAND_VHF</span> <span class="o">|</span> <span class="n">BAND_LBAND</span> <span class="o">|</span> <span class="n">BAND_SBAND</span><span class="p">,</span>
	<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=5, P_agc_inv_pwm1=0, P_agc_inv_pwm2=0,</span>
<span class="cm">	 * P_agc_inh_dc_rv_est=0, P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5, P_agc_write=0 */</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
	<span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

	<span class="mi">600</span><span class="p">,</span>
	<span class="mi">10</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">118</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">3530</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span>
	<span class="mi">5</span><span class="p">,</span>

	<span class="mi">65535</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span>

	<span class="mi">65535</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">40</span><span class="p">,</span>
	<span class="mi">183</span><span class="p">,</span>
	<span class="mi">206</span><span class="p">,</span>
	<span class="mi">255</span><span class="p">,</span>
	<span class="mi">72</span><span class="p">,</span>
	<span class="mi">152</span><span class="p">,</span>
	<span class="mi">88</span><span class="p">,</span>
	<span class="mi">90</span><span class="p">,</span>

	<span class="mi">17</span><span class="p">,</span>
	<span class="mi">27</span><span class="p">,</span>
	<span class="mi">23</span><span class="p">,</span>
	<span class="mi">51</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7070_tuner_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;reset: %d&quot;</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">!</span><span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7070_tuner_sleep</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;sleep: %d&quot;</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0070_config</span> <span class="n">dib7070p_dib0070_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="n">DEFAULT_DIB0070_I2C_ADDRESS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib7070_tuner_reset</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib7070_tuner_sleep</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_pad_drive</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">charge_pump</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="n">DEFAULT_DIB0070_I2C_ADDRESS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib7070_tuner_reset</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib7070_tuner_sleep</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">charge_pump</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0070_config</span> <span class="n">dib7770p_dib0070_config</span> <span class="o">=</span> <span class="p">{</span>
	 <span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="n">DEFAULT_DIB0070_I2C_ADDRESS</span><span class="p">,</span>
	 <span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib7070_tuner_reset</span><span class="p">,</span>
	 <span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib7070_tuner_sleep</span><span class="p">,</span>
	 <span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
	 <span class="p">.</span><span class="n">clock_pad_drive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	 <span class="p">.</span><span class="n">flip_chip</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	 <span class="p">.</span><span class="n">charge_pump</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7070_set_param_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">offset</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">band</span> <span class="o">=</span> <span class="n">BAND_OF_FREQUENCY</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">frequency</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">band</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">BAND_VHF</span>: <span class="n">offset</span> <span class="o">=</span> <span class="mi">950</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">BAND_UHF</span>:
		<span class="nl">default:</span> <span class="n">offset</span> <span class="o">=</span> <span class="mi">550</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;WBD for DiB7000P: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">dib0070_wbd_offset</span><span class="p">(</span><span class="n">fe</span><span class="p">));</span>
	<span class="n">dib7000p_set_wbd_ref</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">dib0070_wbd_offset</span><span class="p">(</span><span class="n">fe</span><span class="p">));</span>
	<span class="k">return</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">set_param_save</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7770_set_param_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	 <span class="n">u16</span> <span class="n">offset</span><span class="p">;</span>
	 <span class="n">u8</span> <span class="n">band</span> <span class="o">=</span> <span class="n">BAND_OF_FREQUENCY</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">frequency</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
	 <span class="k">switch</span> <span class="p">(</span><span class="n">band</span><span class="p">)</span> <span class="p">{</span>
	 <span class="k">case</span> <span class="n">BAND_VHF</span>:
		  <span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		  <span class="n">offset</span> <span class="o">=</span> <span class="mi">850</span><span class="p">;</span>
		  <span class="k">break</span><span class="p">;</span>
	 <span class="k">case</span> <span class="n">BAND_UHF</span>:
	 <span class="nl">default:</span>
		  <span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		  <span class="n">offset</span> <span class="o">=</span> <span class="mi">250</span><span class="p">;</span>
		  <span class="k">break</span><span class="p">;</span>
	 <span class="p">}</span>
	 <span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;WBD for DiB7000P: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">dib0070_wbd_offset</span><span class="p">(</span><span class="n">fe</span><span class="p">));</span>
	 <span class="n">dib7000p_set_wbd_ref</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">dib0070_wbd_offset</span><span class="p">(</span><span class="n">fe</span><span class="p">));</span>
	 <span class="k">return</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">set_param_save</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7770p_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	 <span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	 <span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7000p_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span>
			 <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	 <span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0070_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">dib7770p_dib0070_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		 <span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	 <span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	 <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib7770_set_param_override</span><span class="p">;</span>
	 <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7070p_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7000p_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0070_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib7070p_dib0070_config</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0070_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib7070p_dib0070_config</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib7070_set_param_override</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700p_pid_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span>
		<span class="n">u16</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">is_dib7000pc</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">dib7000p_pid_filter</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">dib7000m_pid_filter</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7700p_pid_filter_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adapter</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">st</span><span class="o">-&gt;</span><span class="n">is_dib7000pc</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">dib7000p_pid_filter_ctrl</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">dib7000m_pid_filter_ctrl</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk70x0p_pid_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib7000p_pid_filter</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk70x0p_pid_filter_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib7000p_pid_filter_ctrl</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">dib7070_bw_config_12_mhz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">60000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">524</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">20452225</span><span class="p">,</span>
	<span class="mi">12000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">dib7070p_dib7000p_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7070_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7070_bw_config_12_mhz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">spur_protect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* STK7070P */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7070p_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_device_descriptor</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">idVendor</span>  <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">p</span><span class="o">-&gt;</span><span class="n">idProduct</span> <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_PID_PINNACLE_PCTV72E</span><span class="p">))</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
				     <span class="o">&amp;</span><span class="n">dib7070p_dib7000p_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">dib7070p_dib7000p_config</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* STK7770P */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">dib7770p_dib7000p_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7070_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7070_bw_config_12_mhz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">spur_protect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_current_mirror</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable_sample_and_hold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7770p_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_device_descriptor</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">idVendor</span>  <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">p</span><span class="o">-&gt;</span><span class="n">idProduct</span> <span class="o">==</span> <span class="n">cpu_to_le16</span><span class="p">(</span><span class="n">USB_PID_PINNACLE_PCTV72E</span><span class="p">))</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
				     <span class="o">&amp;</span><span class="n">dib7770p_dib7000p_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
		<span class="o">&amp;</span><span class="n">dib7770p_dib7000p_config</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* DIB807x generic */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">dib807x_agc_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">BAND_VHF</span><span class="p">,</span>
		<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0,</span>
<span class="cm">		 * P_agc_freq_pwm_div=1, P_agc_inv_pwm1=0,</span>
<span class="cm">		 * P_agc_inv_pwm2=0,P_agc_inh_dc_rv_est=0,</span>
<span class="cm">		 * P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5,</span>
<span class="cm">		 * P_agc_write=0 */</span>
		<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="cm">/* setup*/</span>

		<span class="mi">600</span><span class="p">,</span> <span class="cm">/* inv_gain*/</span>
		<span class="mi">10</span><span class="p">,</span>  <span class="cm">/* time_stabiliz*/</span>

		<span class="mi">0</span><span class="p">,</span>  <span class="cm">/* alpha_level*/</span>
		<span class="mi">118</span><span class="p">,</span>  <span class="cm">/* thlock*/</span>

		<span class="mi">0</span><span class="p">,</span>     <span class="cm">/* wbd_inv*/</span>
		<span class="mi">3530</span><span class="p">,</span>  <span class="cm">/* wbd_ref*/</span>
		<span class="mi">1</span><span class="p">,</span>     <span class="cm">/* wbd_sel*/</span>
		<span class="mi">5</span><span class="p">,</span>     <span class="cm">/* wbd_alpha*/</span>

		<span class="mi">65535</span><span class="p">,</span>  <span class="cm">/* agc1_max*/</span>
		<span class="mi">0</span><span class="p">,</span>  <span class="cm">/* agc1_min*/</span>

		<span class="mi">65535</span><span class="p">,</span>  <span class="cm">/* agc2_max*/</span>
		<span class="mi">0</span><span class="p">,</span>      <span class="cm">/* agc2_min*/</span>

		<span class="mi">0</span><span class="p">,</span>      <span class="cm">/* agc1_pt1*/</span>
		<span class="mi">40</span><span class="p">,</span>     <span class="cm">/* agc1_pt2*/</span>
		<span class="mi">183</span><span class="p">,</span>    <span class="cm">/* agc1_pt3*/</span>
		<span class="mi">206</span><span class="p">,</span>    <span class="cm">/* agc1_slope1*/</span>
		<span class="mi">255</span><span class="p">,</span>    <span class="cm">/* agc1_slope2*/</span>
		<span class="mi">72</span><span class="p">,</span>     <span class="cm">/* agc2_pt1*/</span>
		<span class="mi">152</span><span class="p">,</span>    <span class="cm">/* agc2_pt2*/</span>
		<span class="mi">88</span><span class="p">,</span>     <span class="cm">/* agc2_slope1*/</span>
		<span class="mi">90</span><span class="p">,</span>     <span class="cm">/* agc2_slope2*/</span>

		<span class="mi">17</span><span class="p">,</span>  <span class="cm">/* alpha_mant*/</span>
		<span class="mi">27</span><span class="p">,</span>  <span class="cm">/* alpha_exp*/</span>
		<span class="mi">23</span><span class="p">,</span>  <span class="cm">/* beta_mant*/</span>
		<span class="mi">51</span><span class="p">,</span>  <span class="cm">/* beta_exp*/</span>

		<span class="mi">0</span><span class="p">,</span>  <span class="cm">/* perform_agc_softsplit*/</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="n">BAND_UHF</span><span class="p">,</span>
		<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0,</span>
<span class="cm">		 * P_agc_freq_pwm_div=1, P_agc_inv_pwm1=0,</span>
<span class="cm">		 * P_agc_inv_pwm2=0, P_agc_inh_dc_rv_est=0,</span>
<span class="cm">		 * P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5,</span>
<span class="cm">		 * P_agc_write=0 */</span>
		<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="cm">/* setup */</span>

		<span class="mi">600</span><span class="p">,</span> <span class="cm">/* inv_gain*/</span>
		<span class="mi">10</span><span class="p">,</span>  <span class="cm">/* time_stabiliz*/</span>

		<span class="mi">0</span><span class="p">,</span>  <span class="cm">/* alpha_level*/</span>
		<span class="mi">118</span><span class="p">,</span>  <span class="cm">/* thlock*/</span>

		<span class="mi">0</span><span class="p">,</span>     <span class="cm">/* wbd_inv*/</span>
		<span class="mi">3530</span><span class="p">,</span>  <span class="cm">/* wbd_ref*/</span>
		<span class="mi">1</span><span class="p">,</span>     <span class="cm">/* wbd_sel*/</span>
		<span class="mi">5</span><span class="p">,</span>     <span class="cm">/* wbd_alpha*/</span>

		<span class="mi">65535</span><span class="p">,</span>  <span class="cm">/* agc1_max*/</span>
		<span class="mi">0</span><span class="p">,</span>  <span class="cm">/* agc1_min*/</span>

		<span class="mi">65535</span><span class="p">,</span>  <span class="cm">/* agc2_max*/</span>
		<span class="mi">0</span><span class="p">,</span>      <span class="cm">/* agc2_min*/</span>

		<span class="mi">0</span><span class="p">,</span>      <span class="cm">/* agc1_pt1*/</span>
		<span class="mi">40</span><span class="p">,</span>     <span class="cm">/* agc1_pt2*/</span>
		<span class="mi">183</span><span class="p">,</span>    <span class="cm">/* agc1_pt3*/</span>
		<span class="mi">206</span><span class="p">,</span>    <span class="cm">/* agc1_slope1*/</span>
		<span class="mi">255</span><span class="p">,</span>    <span class="cm">/* agc1_slope2*/</span>
		<span class="mi">72</span><span class="p">,</span>     <span class="cm">/* agc2_pt1*/</span>
		<span class="mi">152</span><span class="p">,</span>    <span class="cm">/* agc2_pt2*/</span>
		<span class="mi">88</span><span class="p">,</span>     <span class="cm">/* agc2_slope1*/</span>
		<span class="mi">90</span><span class="p">,</span>     <span class="cm">/* agc2_slope2*/</span>

		<span class="mi">17</span><span class="p">,</span>  <span class="cm">/* alpha_mant*/</span>
		<span class="mi">27</span><span class="p">,</span>  <span class="cm">/* alpha_exp*/</span>
		<span class="mi">23</span><span class="p">,</span>  <span class="cm">/* beta_mant*/</span>
		<span class="mi">51</span><span class="p">,</span>  <span class="cm">/* beta_exp*/</span>

		<span class="mi">0</span><span class="p">,</span>  <span class="cm">/* perform_agc_softsplit*/</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">dib807x_bw_config_12_mhz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">60000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span> <span class="cm">/* internal, sampling*/</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* pll_cfg: prediv, ratio, range, reset, bypass*/</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="cm">/* misc: refdiv, bypclk_div, IO_CLK_en_core,</span>
<span class="cm">			  ADClkSrc, modulo */</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">599</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="cm">/* sad_cfg: refsel, sel, freq_15k*/</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* ifreq = 0.000000 MHz*/</span>
	<span class="mi">18179755</span><span class="p">,</span> <span class="cm">/* timf*/</span>
	<span class="mi">12000000</span><span class="p">,</span> <span class="cm">/* xtal_hz*/</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib8000_config</span> <span class="n">dib807x_dib8000_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="n">dib807x_agc_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib807x_bw_config_12_mhz</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

		<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">div_cfg</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc_control</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib0070_ctrl_agc_filter</span><span class="p">,</span>
		<span class="p">.</span><span class="n">output_mode</span> <span class="o">=</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">drives</span> <span class="o">=</span> <span class="mh">0x2d98</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="n">dib807x_agc_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib807x_bw_config_12_mhz</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

		<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc_control</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib0070_ctrl_agc_filter</span><span class="p">,</span>
		<span class="p">.</span><span class="n">output_mode</span> <span class="o">=</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">drives</span> <span class="o">=</span> <span class="mh">0x2d98</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib80xx_tuner_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib8000_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">!</span><span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib80xx_tuner_sleep</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib8000_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dib0070_wbd_gain_cfg</span> <span class="n">dib8070_wbd_gain_cfg</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span> <span class="mi">240</span><span class="p">,</span>      <span class="mi">7</span><span class="p">},</span>
    <span class="p">{</span> <span class="mh">0xffff</span><span class="p">,</span>   <span class="mi">6</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0070_config</span> <span class="n">dib807x_dib0070_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="n">DEFAULT_DIB0070_I2C_ADDRESS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib80xx_tuner_reset</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib80xx_tuner_sleep</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_pad_drive</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vga_filter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">force_crystal_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_third_order_filter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">charge_pump</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_gain</span> <span class="o">=</span> <span class="n">dib8070_wbd_gain_cfg</span><span class="p">,</span>
		<span class="p">.</span><span class="n">osc_buffer_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="n">DEFAULT_DIB0070_I2C_ADDRESS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib80xx_tuner_reset</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib80xx_tuner_sleep</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clock_pad_drive</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vga_filter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">force_crystal_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_third_order_filter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">charge_pump</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_gain</span> <span class="o">=</span> <span class="n">dib8070_wbd_gain_cfg</span><span class="p">,</span>
		<span class="p">.</span><span class="n">osc_buffer_state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib807x_set_param_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">dib0070_wbd_offset</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="n">u8</span> <span class="n">band</span> <span class="o">=</span> <span class="n">BAND_OF_FREQUENCY</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">frequency</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">band</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BAND_VHF</span>:
		<span class="n">offset</span> <span class="o">+=</span> <span class="mi">750</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BAND_UHF</span>:  <span class="cm">/* fall-thru wanted */</span>
	<span class="nl">default:</span>
		<span class="n">offset</span> <span class="o">+=</span> <span class="mi">250</span><span class="p">;</span> <span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;WBD for DiB8000: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
	<span class="n">dib8000_set_wbd_ref</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">set_param_save</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib807x_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib8000_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span>
			<span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0070_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">dib807x_dib0070_config</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0070_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">dib807x_dib0070_config</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib807x_set_param_override</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk80xx_pid_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span>
	<span class="n">u16</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib8000_pid_filter</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk80xx_pid_filter_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span>
		<span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib8000_pid_filter_ctrl</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* STK807x */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk807x_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib8000_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
				<span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib8000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">dib807x_dib8000_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* STK807xPVR */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk807xpvr_frontend_attach0</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* initialize IC 0 */</span>
	<span class="n">dib8000_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib8000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">dib807x_dib8000_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk807xpvr_frontend_attach1</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* initialize IC 1 */</span>
	<span class="n">dib8000_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib8000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">dib807x_dib8000_config</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* STK8096GP */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">dib8090_agc_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
	<span class="n">BAND_UHF</span> <span class="o">|</span> <span class="n">BAND_VHF</span> <span class="o">|</span> <span class="n">BAND_LBAND</span> <span class="o">|</span> <span class="n">BAND_SBAND</span><span class="p">,</span>
	<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=1,</span>
<span class="cm">	 * P_agc_inv_pwm1=0, P_agc_inv_pwm2=0, P_agc_inh_dc_rv_est=0,</span>
<span class="cm">	 * P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5, P_agc_write=0 */</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
	<span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

	<span class="mi">787</span><span class="p">,</span>
	<span class="mi">10</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">118</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">3530</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span>
	<span class="mi">5</span><span class="p">,</span>

	<span class="mi">65535</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>

	<span class="mi">65535</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">32</span><span class="p">,</span>
	<span class="mi">114</span><span class="p">,</span>
	<span class="mi">143</span><span class="p">,</span>
	<span class="mi">144</span><span class="p">,</span>
	<span class="mi">114</span><span class="p">,</span>
	<span class="mi">227</span><span class="p">,</span>
	<span class="mi">116</span><span class="p">,</span>
	<span class="mi">117</span><span class="p">,</span>

	<span class="mi">28</span><span class="p">,</span>
	<span class="mi">26</span><span class="p">,</span>
	<span class="mi">31</span><span class="p">,</span>
	<span class="mi">51</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
	<span class="n">BAND_CBAND</span><span class="p">,</span>
	<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=1,</span>
<span class="cm">	 * P_agc_inv_pwm1=0, P_agc_inv_pwm2=0, P_agc_inh_dc_rv_est=0,</span>
<span class="cm">	 * P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5, P_agc_write=0 */</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span>
	<span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

	<span class="mi">787</span><span class="p">,</span>
	<span class="mi">10</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">118</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">3530</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span>
	<span class="mi">5</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>

	<span class="mi">65535</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="mi">32</span><span class="p">,</span>
	<span class="mi">114</span><span class="p">,</span>
	<span class="mi">143</span><span class="p">,</span>
	<span class="mi">144</span><span class="p">,</span>
	<span class="mi">114</span><span class="p">,</span>
	<span class="mi">227</span><span class="p">,</span>
	<span class="mi">116</span><span class="p">,</span>
	<span class="mi">117</span><span class="p">,</span>

	<span class="mi">28</span><span class="p">,</span>
	<span class="mi">26</span><span class="p">,</span>
	<span class="mi">31</span><span class="p">,</span>
	<span class="mi">51</span><span class="p">,</span>

	<span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">dib8090_pll_config_12mhz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">54000</span><span class="p">,</span> <span class="mi">13500</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">599</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">20199727</span><span class="p">,</span>
	<span class="mi">12000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib8090_get_adc_power</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib8000_get_adc_power</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib8000_config</span> <span class="n">dib809x_dib8000_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="n">dib8090_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_control</span> <span class="o">=</span> <span class="n">dib0090_dcc_freq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib8090_pll_config_12mhz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">div_cfg</span> <span class="o">=</span> <span class="mh">0x31</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span> <span class="o">=</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">drives</span> <span class="o">=</span> <span class="mh">0x2d98</span><span class="p">,</span>
	<span class="p">.</span><span class="n">diversity_delay</span> <span class="o">=</span> <span class="mi">48</span><span class="p">,</span>
	<span class="p">.</span><span class="n">refclksel</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="n">dib8090_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_control</span> <span class="o">=</span> <span class="n">dib0090_dcc_freq</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pll</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib8090_pll_config_12mhz</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">div_cfg</span> <span class="o">=</span> <span class="mh">0x31</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span> <span class="o">=</span> <span class="n">OUTMODE_DIVERSITY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">drives</span> <span class="o">=</span> <span class="mh">0x2d08</span><span class="p">,</span>
	<span class="p">.</span><span class="n">diversity_delay</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">refclksel</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0090_wbd_slope</span> <span class="n">dib8090_wbd_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* max freq ; cold slope ; cold offset ; warm slope ; warm offset ; wbd gain */</span>
	<span class="p">{</span> <span class="mi">120</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">500</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="cm">/* CBAND */</span>
	<span class="p">{</span> <span class="mi">170</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>   <span class="mi">450</span><span class="p">,</span> <span class="mi">4</span> <span class="p">},</span> <span class="cm">/* CBAND */</span>
	<span class="p">{</span> <span class="mi">380</span><span class="p">,</span>    <span class="mi">48</span><span class="p">,</span> <span class="mi">373</span><span class="p">,</span> <span class="mi">28</span><span class="p">,</span>   <span class="mi">259</span><span class="p">,</span> <span class="mi">6</span> <span class="p">},</span> <span class="cm">/* VHF */</span>
	<span class="p">{</span> <span class="mi">860</span><span class="p">,</span>    <span class="mi">34</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span>   <span class="mi">616</span><span class="p">,</span> <span class="mi">6</span> <span class="p">},</span> <span class="cm">/* high UHF */</span>
	<span class="p">{</span> <span class="mh">0xFFFF</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span>   <span class="mi">616</span><span class="p">,</span> <span class="mi">6</span> <span class="p">},</span> <span class="cm">/* default */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0090_config</span> <span class="n">dib809x_dib0090_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib80xx_tuner_reset</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib80xx_tuner_sleep</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="n">DEFAULT_DIB0090_I2C_ADDRESS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_adc_power</span> <span class="o">=</span> <span class="n">dib8090_get_adc_power</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">63</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">143</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd</span> <span class="o">=</span> <span class="n">dib8090_wbd_table</span><span class="p">,</span>
	<span class="p">.</span><span class="n">fref_clock_ratio</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib8096_set_param_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">band</span> <span class="o">=</span> <span class="n">BAND_OF_FREQUENCY</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">frequency</span><span class="o">/</span><span class="mi">1000</span><span class="p">);</span>
	<span class="n">u16</span> <span class="n">target</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">frontend_tune_state</span> <span class="n">tune_state</span> <span class="o">=</span> <span class="n">CT_SHUTDOWN</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ltgain</span><span class="p">,</span> <span class="n">rf_gain_limit</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">set_param_save</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="n">dib0090_get_wbd_target</span><span class="p">(</span><span class="n">fe</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">*</span> <span class="mi">18</span> <span class="o">/</span> <span class="mi">33</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">dib8000_set_wbd_ref</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">band</span> <span class="o">==</span> <span class="n">BAND_CBAND</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;tuning in CBAND - soft-AGC startup</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">dib0090_set_tune_state</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">CT_AGC_START</span><span class="p">);</span>
		<span class="k">do</span> <span class="p">{</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">dib0090_gain_control</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
			<span class="n">msleep</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>
			<span class="n">tune_state</span> <span class="o">=</span> <span class="n">dib0090_get_tune_state</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">tune_state</span> <span class="o">==</span> <span class="n">CT_AGC_STEP_0</span><span class="p">)</span>
				<span class="n">dib8000_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">tune_state</span> <span class="o">==</span> <span class="n">CT_AGC_STEP_1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dib0090_get_current_gain</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">rf_gain_limit</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ltgain</span><span class="p">);</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">rf_gain_limit</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
					<span class="n">dib8000_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">tune_state</span> <span class="o">&lt;</span> <span class="n">CT_AGC_STOP</span><span class="p">);</span>
		<span class="n">dib0090_pwm_gain_reset</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
		<span class="n">dib8000_pwm_agc_reset</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
		<span class="n">dib8000_set_tune_state</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">CT_DEMOD_START</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;not tuning in CBAND - standard AGC startup</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">dib0090_pwm_gain_reset</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib809x_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib8000_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib809x_dib0090_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib8096_set_param_override</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk809x_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib8000_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib8000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib809x_dib8000_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">nim8096md_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe_slave</span>  <span class="o">=</span> <span class="n">dib8000_get_slave_frontend</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fe_slave</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib8000_get_i2c_master</span><span class="p">(</span><span class="n">fe_slave</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">fe_slave</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib809x_dib0090_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="n">fe_slave</span><span class="o">-&gt;</span><span class="n">dvb</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">;</span>
		<span class="n">fe_slave</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib8096_set_param_override</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib8000_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib809x_dib0090_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib8096_set_param_override</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">nim8096md_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe_slave</span><span class="p">;</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib8000_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib8000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib809x_dib8000_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">fe_slave</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib8000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib809x_dib8000_config</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">dib8000_set_slave_frontend</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">fe_slave</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">fe_slave</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* TFE8096P */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">dib8096p_agc_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">band_caps</span>		<span class="o">=</span> <span class="n">BAND_UHF</span><span class="p">,</span>
		<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0,</span>
<span class="cm">		   P_agc_freq_pwm_div=1, P_agc_inv_pwm1=0,</span>
<span class="cm">		   P_agc_inv_pwm2=0, P_agc_inh_dc_rv_est=0,</span>
<span class="cm">		   P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5,</span>
<span class="cm">		   P_agc_write=0 */</span>
		<span class="p">.</span><span class="n">setup</span>			<span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span>
			<span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span>
			<span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

		<span class="p">.</span><span class="n">inv_gain</span>		<span class="o">=</span> <span class="mi">684</span><span class="p">,</span>
		<span class="p">.</span><span class="n">time_stabiliz</span>	<span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

		<span class="p">.</span><span class="n">alpha_level</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">thlock</span>			<span class="o">=</span> <span class="mi">118</span><span class="p">,</span>

		<span class="p">.</span><span class="n">wbd_inv</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_ref</span>		<span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_sel</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_alpha</span>		<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc1_max</span>		<span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_min</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc2_max</span>		<span class="o">=</span> <span class="mi">32767</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_min</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc1_pt1</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_pt2</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_pt3</span>		<span class="o">=</span> <span class="mi">105</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_slope1</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_slope2</span>	<span class="o">=</span> <span class="mi">156</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_pt1</span>		<span class="o">=</span> <span class="mi">105</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_pt2</span>		<span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_slope1</span>	<span class="o">=</span> <span class="mi">54</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_slope2</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">alpha_mant</span>		<span class="o">=</span> <span class="mi">28</span><span class="p">,</span>
		<span class="p">.</span><span class="n">alpha_exp</span>		<span class="o">=</span> <span class="mi">26</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beta_mant</span>		<span class="o">=</span> <span class="mi">31</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beta_exp</span>		<span class="o">=</span> <span class="mi">51</span><span class="p">,</span>

		<span class="p">.</span><span class="n">perform_agc_softsplit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span> <span class="p">,</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">band_caps</span>		<span class="o">=</span> <span class="n">BAND_FM</span> <span class="o">|</span> <span class="n">BAND_VHF</span> <span class="o">|</span> <span class="n">BAND_CBAND</span><span class="p">,</span>
		<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0,</span>
<span class="cm">		   P_agc_freq_pwm_div=1, P_agc_inv_pwm1=0,</span>
<span class="cm">		   P_agc_inv_pwm2=0, P_agc_inh_dc_rv_est=0,</span>
<span class="cm">		   P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5,</span>
<span class="cm">		   P_agc_write=0 */</span>
		<span class="p">.</span><span class="n">setup</span>			<span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span>
			<span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span>
			<span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

		<span class="p">.</span><span class="n">inv_gain</span>		<span class="o">=</span> <span class="mi">732</span><span class="p">,</span>
		<span class="p">.</span><span class="n">time_stabiliz</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

		<span class="p">.</span><span class="n">alpha_level</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">thlock</span>			<span class="o">=</span> <span class="mi">118</span><span class="p">,</span>

		<span class="p">.</span><span class="n">wbd_inv</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_ref</span>		<span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_sel</span>		<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_alpha</span>		<span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc1_max</span>		<span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_min</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc2_max</span>		<span class="o">=</span> <span class="mi">32767</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_min</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc1_pt1</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_pt2</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_pt3</span>		<span class="o">=</span> <span class="mi">98</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_slope1</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_slope2</span>	<span class="o">=</span> <span class="mi">167</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_pt1</span>		<span class="o">=</span> <span class="mi">98</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_pt2</span>		<span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_slope1</span>	<span class="o">=</span> <span class="mi">52</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_slope2</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">alpha_mant</span>		<span class="o">=</span> <span class="mi">28</span><span class="p">,</span>
		<span class="p">.</span><span class="n">alpha_exp</span>		<span class="o">=</span> <span class="mi">26</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beta_mant</span>		<span class="o">=</span> <span class="mi">31</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beta_exp</span>		<span class="o">=</span> <span class="mi">51</span><span class="p">,</span>

		<span class="p">.</span><span class="n">perform_agc_softsplit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">dib8096p_clock_config_12_mhz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">108000</span><span class="p">,</span> <span class="mi">13500</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">524</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">20199729</span><span class="p">,</span>
	<span class="mi">12000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib8000_config</span> <span class="n">tfe8096p_dib8000_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hostbus_diversity</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">update_lna</span>					<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span>						<span class="o">=</span> <span class="n">dib8096p_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pll</span>						<span class="o">=</span> <span class="o">&amp;</span><span class="n">dib8096p_clock_config_12_mhz</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span>					<span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span>					<span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span>				<span class="o">=</span> <span class="n">DIB8000_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_control</span>				<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">diversity_delay</span>			<span class="o">=</span> <span class="mi">48</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>				<span class="o">=</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enMpegOutput</span>				<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0090_wbd_slope</span> <span class="n">dib8096p_wbd_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">380</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">860</span><span class="p">,</span> <span class="mi">51</span><span class="p">,</span> <span class="mi">866</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1700</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2600</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xFFFF</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dib0090_config</span> <span class="n">tfe8096p_dib0090_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span>			<span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span>			<span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span>			<span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span>					<span class="o">=</span> <span class="n">dib8096p_tuner_sleep</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sleep</span>					<span class="o">=</span> <span class="n">dib8096p_tuner_sleep</span><span class="p">,</span>

	<span class="p">.</span><span class="n">freq_offset_khz_uhf</span>	<span class="o">=</span> <span class="o">-</span><span class="mi">143</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freq_offset_khz_vhf</span>	<span class="o">=</span> <span class="o">-</span><span class="mi">143</span><span class="p">,</span>

	<span class="p">.</span><span class="n">get_adc_power</span>			<span class="o">=</span> <span class="n">dib8090_get_adc_power</span><span class="p">,</span>

	<span class="p">.</span><span class="n">clkouttobamse</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">analog_output</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">wbd_vhf_offset</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd_cband_offset</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_pwm_agc</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkoutdrive</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">fref_clock_ratio</span>		<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">wbd</span>					<span class="o">=</span> <span class="n">dib8096p_wbd_table</span><span class="p">,</span>

	<span class="p">.</span><span class="n">ls_cfg_pad_drv</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_tx_drv</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">low_if</span>					<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">in_soc</span>					<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">force_cband_input</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dibx090p_adc</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">freq</span><span class="p">;</span>			<span class="cm">/* RF freq MHz */</span>
	<span class="n">u32</span> <span class="n">timf</span><span class="p">;</span>			<span class="cm">/* New Timf */</span>
	<span class="n">u32</span> <span class="n">pll_loopdiv</span><span class="p">;</span>	<span class="cm">/* New prediv */</span>
	<span class="n">u32</span> <span class="n">pll_prediv</span><span class="p">;</span>		<span class="cm">/* New loopdiv */</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">dibx090p_adc</span> <span class="n">dib8090p_adc_tab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">17043521</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">},</span> <span class="cm">/* 64 MHz */</span>
	<span class="p">{</span><span class="mi">878000</span><span class="p">,</span> <span class="mi">20199729</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">},</span> <span class="cm">/* 60 MHz */</span>
	<span class="p">{</span><span class="mh">0xffffffff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">},</span> <span class="cm">/* 60 MHz */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib8096p_agc_startup</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">pll</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">target</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">better_sampling_freq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dibx090p_adc</span> <span class="o">*</span><span class="n">adc_table</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib8090p_adc_tab</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">set_param_save</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pll</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span><span class="p">));</span>

	<span class="n">dib0090_pwm_gain_reset</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="cm">/* dib0090_get_wbd_target is returning any possible</span>
<span class="cm">	   temperature compensated wbd-target */</span>
	<span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="n">dib0090_get_wbd_target</span><span class="p">(</span><span class="n">fe</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span>  <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">dib8000_set_wbd_ref</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>


	<span class="k">while</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">frequency</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">&gt;</span> <span class="n">adc_table</span><span class="o">-&gt;</span><span class="n">freq</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">better_sampling_freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">adc_table</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">adc_table</span><span class="o">-&gt;</span><span class="n">freq</span> <span class="o">!=</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">better_sampling_freq</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pll</span><span class="p">.</span><span class="n">pll_ratio</span>  <span class="o">=</span> <span class="n">adc_table</span><span class="o">-&gt;</span><span class="n">pll_loopdiv</span><span class="p">;</span>
		<span class="n">pll</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="n">adc_table</span><span class="o">-&gt;</span><span class="n">pll_prediv</span><span class="p">;</span>
		<span class="n">dib8000_update_pll</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pll</span><span class="p">);</span>
		<span class="n">dib8000_ctrl_timf</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">DEMOD_TIMF_SET</span><span class="p">,</span> <span class="n">adc_table</span><span class="o">-&gt;</span><span class="n">timf</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe8096p_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib8000_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib8000_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe8096p_dib8000_config</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe8096p_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib8096p_get_i2c_tuner</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">tfe8096p_dib0090_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">dib8000_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib8096p_agc_startup</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* STK9090M */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib90x0_pid_filter</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="n">pid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib9000_fw_pid_filter</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib90x0_pid_filter_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adapter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib9000_fw_pid_filter_ctrl</span><span class="p">(</span><span class="n">adapter</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib90x0_tuner_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib9000_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">!</span><span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib90x0_tuner_sleep</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="kt">int</span> <span class="n">onoff</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dib9000_set_gpio</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">onoff</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib01x0_pmu_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">u8</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">wb</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0xc</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="mh">0xc</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">};</span>
	<span class="n">u8</span> <span class="n">rb</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">i2c_msg</span> <span class="n">msg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">wb</span><span class="p">,</span> <span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
		<span class="p">{.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">I2C_M_RD</span><span class="p">,</span> <span class="p">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">rb</span><span class="p">,</span> <span class="p">.</span><span class="n">len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">};</span>
	<span class="n">u8</span> <span class="n">index_data</span><span class="p">;</span>

	<span class="n">dibx000_i2c_set_speed</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="mi">250</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i2c_transfer</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">rb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">|</span> <span class="n">rb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
			<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;Found DiB0170 rev1: This version of DiB0170 is not supported any longer.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;Found DiB0170 rev2&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;Found DiB0190 rev2&quot;</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
			<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;DiB01x0 not found&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">index_data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index_data</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">index_data</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">wb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">wb</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_data</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_data</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">wb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_data</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
			<span class="n">wb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_data</span><span class="p">])</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
			<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">i2c_transfer</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
			<span class="n">wb</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">|=</span> <span class="n">rb</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">wb</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">|=</span> <span class="n">rb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="n">wb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_data</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xff</span><span class="p">;</span>
		<span class="n">wb</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">index_data</span><span class="p">])</span><span class="o">&amp;</span><span class="mh">0xff</span><span class="p">;</span>
		<span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">len</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i2c_transfer</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib9000_config</span> <span class="n">stk9090m_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span> <span class="o">=</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vcxo_timer</span> <span class="o">=</span> <span class="mi">279620</span><span class="p">,</span>
	<span class="p">.</span><span class="n">timing_frequency</span> <span class="o">=</span> <span class="mi">20452225</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_clock_khz</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">xtal_clock_khz</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_drives</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span><span class="p">),</span>
	<span class="p">.</span><span class="n">subband</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">2</span><span class="p">,</span>
		<span class="p">{</span>
			<span class="p">{</span> <span class="mi">240</span><span class="p">,</span> <span class="p">{</span> <span class="n">BOARD_GPIO_COMPONENT_DEMOD</span><span class="p">,</span> <span class="n">BOARD_GPIO_FUNCTION_SUBBAND_GPIO</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0008</span> <span class="p">}</span> <span class="p">},</span> <span class="cm">/* GPIO 3 to 1 for VHF */</span>
			<span class="p">{</span> <span class="mi">890</span><span class="p">,</span> <span class="p">{</span> <span class="n">BOARD_GPIO_COMPONENT_DEMOD</span><span class="p">,</span> <span class="n">BOARD_GPIO_FUNCTION_SUBBAND_GPIO</span><span class="p">,</span> <span class="mh">0x0008</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span> <span class="p">}</span> <span class="p">},</span> <span class="cm">/* GPIO 3 to 0 for UHF */</span>
			<span class="p">{</span> <span class="mi">0</span> <span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">.</span><span class="n">gpio_function</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="p">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">BOARD_GPIO_COMPONENT_DEMOD</span><span class="p">,</span> <span class="p">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">BOARD_GPIO_FUNCTION_COMPONENT_ON</span><span class="p">,</span> <span class="p">.</span><span class="n">mask</span> <span class="o">=</span> <span class="mh">0x10</span> <span class="o">|</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x21</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x10</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span> <span class="p">},</span>
		<span class="p">{</span> <span class="p">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">BOARD_GPIO_COMPONENT_DEMOD</span><span class="p">,</span> <span class="p">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">BOARD_GPIO_FUNCTION_COMPONENT_OFF</span><span class="p">,</span> <span class="p">.</span><span class="n">mask</span> <span class="o">=</span> <span class="mh">0x10</span> <span class="o">|</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x21</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">|</span> <span class="mh">0x21</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib9000_config</span> <span class="n">nim9090md_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">output_mode</span> <span class="o">=</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vcxo_timer</span> <span class="o">=</span> <span class="mi">279620</span><span class="p">,</span>
		<span class="p">.</span><span class="n">timing_frequency</span> <span class="o">=</span> <span class="mi">20452225</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_clock_khz</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal_clock_khz</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">if_drives</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span><span class="p">),</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">output_mode</span> <span class="o">=</span> <span class="n">OUTMODE_DIVERSITY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vcxo_timer</span> <span class="o">=</span> <span class="mi">279620</span><span class="p">,</span>
		<span class="p">.</span><span class="n">timing_frequency</span> <span class="o">=</span> <span class="mi">20452225</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_clock_khz</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal_clock_khz</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">if_drives</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">6</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span><span class="p">),</span>
		<span class="p">.</span><span class="n">subband</span> <span class="o">=</span> <span class="p">{</span>
			<span class="mi">2</span><span class="p">,</span>
			<span class="p">{</span>
				<span class="p">{</span> <span class="mi">240</span><span class="p">,</span> <span class="p">{</span> <span class="n">BOARD_GPIO_COMPONENT_DEMOD</span><span class="p">,</span> <span class="n">BOARD_GPIO_FUNCTION_SUBBAND_GPIO</span><span class="p">,</span> <span class="mh">0x0006</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0006</span> <span class="p">}</span> <span class="p">},</span> <span class="cm">/* GPIO 1 and 2 to 1 for VHF */</span>
				<span class="p">{</span> <span class="mi">890</span><span class="p">,</span> <span class="p">{</span> <span class="n">BOARD_GPIO_COMPONENT_DEMOD</span><span class="p">,</span> <span class="n">BOARD_GPIO_FUNCTION_SUBBAND_GPIO</span><span class="p">,</span> <span class="mh">0x0006</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="mh">0x0000</span> <span class="p">}</span> <span class="p">},</span> <span class="cm">/* GPIO 1 and 2 to 0 for UHF */</span>
				<span class="p">{</span> <span class="mi">0</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio_function</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span> <span class="p">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">BOARD_GPIO_COMPONENT_DEMOD</span><span class="p">,</span> <span class="p">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">BOARD_GPIO_FUNCTION_COMPONENT_ON</span><span class="p">,</span> <span class="p">.</span><span class="n">mask</span> <span class="o">=</span> <span class="mh">0x10</span> <span class="o">|</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x21</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="mh">0x10</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x1</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x20</span> <span class="p">},</span>
			<span class="p">{</span> <span class="p">.</span><span class="n">component</span> <span class="o">=</span> <span class="n">BOARD_GPIO_COMPONENT_DEMOD</span><span class="p">,</span> <span class="p">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">BOARD_GPIO_FUNCTION_COMPONENT_OFF</span><span class="p">,</span> <span class="p">.</span><span class="n">mask</span> <span class="o">=</span> <span class="mh">0x10</span> <span class="o">|</span> <span class="mh">0x21</span><span class="p">,</span> <span class="p">.</span><span class="n">direction</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mh">0x21</span><span class="p">,</span> <span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">|</span> <span class="mh">0x21</span> <span class="p">},</span>
		<span class="p">},</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0090_config</span> <span class="n">dib9090_dib0090_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib90x0_tuner_reset</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib90x0_tuner_sleep</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0090_config</span> <span class="n">nim9090md_dib0090_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib90x0_tuner_reset</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib90x0_tuner_sleep</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib90x0_tuner_reset</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib90x0_tuner_sleep</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk9090m_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fw_version</span><span class="p">;</span>

	<span class="cm">/* Make use of the new i2c functions from FW 1.20 */</span>
	<span class="n">dib0700_get_version</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fw_version</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fw_version</span> <span class="o">&gt;=</span> <span class="mh">0x10200</span><span class="p">)</span>
		<span class="n">st</span><span class="o">-&gt;</span><span class="n">fw_use_new_i2c_api</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">dib0700_set_i2c_speed</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">340</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">dib9000_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">request_firmware</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="p">,</span> <span class="s">&quot;dib9090.fw&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;%s: Upload failed. (file not found?)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;%s: firmware read %Zu bytes.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">stk9090m_config</span><span class="p">.</span><span class="n">microcode_B_fe_size</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
	<span class="n">stk9090m_config</span><span class="p">.</span><span class="n">microcode_B_fe_buffer</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib9000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stk9090m_config</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib9090_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c</span> <span class="o">=</span> <span class="n">dib9000_get_tuner_interface</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>
	<span class="n">u16</span> <span class="n">data_dib190</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">1</span><span class="p">,</span> <span class="mh">0x1374</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">,</span> <span class="mh">0x01a2</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span> <span class="mh">0x00ef</span><span class="p">,</span>
		<span class="mi">8</span><span class="p">,</span> <span class="mh">0x0486</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_fw_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dib9090_dib0090_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="n">i2c</span> <span class="o">=</span> <span class="n">dib9000_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_GPIO_1_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dib01x0_pmu_update</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">data_dib190</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="n">dib0700_set_i2c_speed</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dib9000_firmware_post_pll_init</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="n">release_firmware</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">nim9090md_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe_slave</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fw_version</span><span class="p">;</span>

	<span class="cm">/* Make use of the new i2c functions from FW 1.20 */</span>
	<span class="n">dib0700_get_version</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">fw_version</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fw_version</span> <span class="o">&gt;=</span> <span class="mh">0x10200</span><span class="p">)</span>
		<span class="n">st</span><span class="o">-&gt;</span><span class="n">fw_use_new_i2c_api</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">dib0700_set_i2c_speed</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">340</span><span class="p">);</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">request_firmware</span><span class="p">(</span><span class="o">&amp;</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="p">,</span> <span class="s">&quot;dib9090.fw&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;%s: Upload failed. (file not found?)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;%s: firmware read %Zu bytes.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">nim9090md_config</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">microcode_B_fe_size</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
	<span class="n">nim9090md_config</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">microcode_B_fe_buffer</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>
	<span class="n">nim9090md_config</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">microcode_B_fe_size</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
	<span class="n">nim9090md_config</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">microcode_B_fe_buffer</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">;</span>

	<span class="n">dib9000_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib9000_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nim9090md_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">i2c</span> <span class="o">=</span> <span class="n">dib9000_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_GPIO_3_4</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">dib9000_i2c_enumeration</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">);</span>

	<span class="n">fe_slave</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib9000_attach</span><span class="p">,</span> <span class="n">i2c</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nim9090md_config</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">dib9000_set_slave_frontend</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">fe_slave</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">fe_slave</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">nim9090md_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe_slave</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">data_dib190</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">1</span><span class="p">,</span> <span class="mh">0x5374</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">,</span> <span class="mh">0x01ae</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">,</span>
		<span class="mi">0</span><span class="p">,</span> <span class="mh">0x00ef</span><span class="p">,</span>
		<span class="mi">8</span><span class="p">,</span> <span class="mh">0x0406</span><span class="p">,</span>
	<span class="p">};</span>
	<span class="n">i2c</span> <span class="o">=</span> <span class="n">dib9000_get_tuner_interface</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_fw_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nim9090md_dib0090_config</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="n">i2c</span> <span class="o">=</span> <span class="n">dib9000_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_GPIO_1_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dib01x0_pmu_update</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="n">data_dib190</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">dib0700_set_i2c_speed</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dib9000_firmware_post_pll_init</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">fe_slave</span> <span class="o">=</span> <span class="n">dib9000_get_slave_frontend</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fe_slave</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2c</span> <span class="o">=</span> <span class="n">dib9000_get_component_bus_interface</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>
		<span class="n">dib9000_set_i2c_adapter</span><span class="p">(</span><span class="n">fe_slave</span><span class="p">,</span> <span class="n">i2c</span><span class="p">);</span>

		<span class="n">i2c</span> <span class="o">=</span> <span class="n">dib9000_get_tuner_interface</span><span class="p">(</span><span class="n">fe_slave</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_fw_register</span><span class="p">,</span> <span class="n">fe_slave</span><span class="p">,</span> <span class="n">i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nim9090md_dib0090_config</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="n">fe_slave</span><span class="o">-&gt;</span><span class="n">dvb</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">;</span>
		<span class="n">dib9000_fw_set_component_bus_speed</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1500</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dib9000_firmware_post_pll_init</span><span class="p">(</span><span class="n">fe_slave</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">release_firmware</span><span class="p">(</span><span class="n">state</span><span class="o">-&gt;</span><span class="n">frontend_firmware</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* NIM7090 */</span>
<span class="k">struct</span> <span class="n">dib7090p_best_adc</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">timf</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pll_loopdiv</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pll_prediv</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7090p_get_best_sampling</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span> <span class="p">,</span> <span class="k">struct</span> <span class="n">dib7090p_best_adc</span> <span class="o">*</span><span class="n">adc</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">spur</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">prediv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">loopdiv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">min_prediv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">max_prediv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">u16</span> <span class="n">xtal</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcp_min</span> <span class="o">=</span> <span class="mi">1900</span><span class="p">;</span>  <span class="cm">/* PLL Minimum Frequency comparator KHz */</span>
	<span class="n">u32</span> <span class="n">fcp_max</span> <span class="o">=</span> <span class="mi">20000</span><span class="p">;</span> <span class="cm">/* PLL Maximum Frequency comparator KHz */</span>
	<span class="n">u32</span> <span class="n">fdem_max</span> <span class="o">=</span> <span class="mi">76000</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fdem_min</span> <span class="o">=</span> <span class="mi">69500</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">fcp</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">fdem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">harmonic_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">adc</span><span class="o">-&gt;</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="n">loopdiv</span><span class="p">;</span>
	<span class="n">adc</span><span class="o">-&gt;</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="n">prediv</span><span class="p">;</span>
	<span class="n">adc</span><span class="o">-&gt;</span><span class="n">timf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;bandwidth = %d fdem_min =%d&quot;</span><span class="p">,</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">bandwidth_hz</span><span class="p">,</span> <span class="n">fdem_min</span><span class="p">);</span>

	<span class="cm">/* Find Min and Max prediv */</span>
	<span class="k">while</span> <span class="p">((</span><span class="n">xtal</span><span class="o">/</span><span class="n">max_prediv</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">fcp_min</span><span class="p">)</span>
		<span class="n">max_prediv</span><span class="o">++</span><span class="p">;</span>

	<span class="n">max_prediv</span><span class="o">--</span><span class="p">;</span>
	<span class="n">min_prediv</span> <span class="o">=</span> <span class="n">max_prediv</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">((</span><span class="n">xtal</span><span class="o">/</span><span class="n">min_prediv</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">fcp_max</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">min_prediv</span><span class="o">--</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">min_prediv</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;MIN prediv = %d : MAX prediv = %d&quot;</span><span class="p">,</span> <span class="n">min_prediv</span><span class="p">,</span> <span class="n">max_prediv</span><span class="p">);</span>

	<span class="n">min_prediv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">prediv</span> <span class="o">=</span> <span class="n">min_prediv</span> <span class="p">;</span> <span class="n">prediv</span> <span class="o">&lt;</span> <span class="n">max_prediv</span><span class="p">;</span> <span class="n">prediv</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">fcp</span> <span class="o">=</span> <span class="n">xtal</span> <span class="o">/</span> <span class="n">prediv</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fcp</span> <span class="o">&gt;</span> <span class="n">fcp_min</span> <span class="o">&amp;&amp;</span> <span class="n">fcp</span> <span class="o">&lt;</span> <span class="n">fcp_max</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">loopdiv</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">loopdiv</span> <span class="o">&lt;</span> <span class="mi">64</span> <span class="p">;</span> <span class="n">loopdiv</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">fdem</span> <span class="o">=</span> <span class="p">((</span><span class="n">xtal</span><span class="o">/</span><span class="n">prediv</span><span class="p">)</span> <span class="o">*</span> <span class="n">loopdiv</span><span class="p">);</span>
				<span class="n">fs</span>   <span class="o">=</span> <span class="n">fdem</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>
				<span class="cm">/* test min/max system restrictions */</span>

				<span class="k">if</span> <span class="p">((</span><span class="n">fdem</span> <span class="o">&gt;=</span> <span class="n">fdem_min</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">fdem</span> <span class="o">&lt;=</span> <span class="n">fdem_max</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">fs</span> <span class="o">&gt;=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">bandwidth_hz</span><span class="o">/</span><span class="mi">1000</span><span class="p">))</span> <span class="p">{</span>
					<span class="n">spur</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
					<span class="cm">/* test fs harmonics positions */</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">harmonic_id</span> <span class="o">=</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">frequency</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span> <span class="p">;</span>  <span class="n">harmonic_id</span> <span class="o">&lt;=</span> <span class="p">((</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">frequency</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="n">fs</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">;</span> <span class="n">harmonic_id</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
						<span class="k">if</span> <span class="p">(((</span><span class="n">fs</span><span class="o">*</span><span class="n">harmonic_id</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="p">((</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">frequency</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">bandwidth_hz</span><span class="o">/</span><span class="mi">2000</span><span class="p">)))</span> <span class="o">&amp;&amp;</span>  <span class="p">((</span><span class="n">fs</span><span class="o">*</span><span class="n">harmonic_id</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">((</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">frequency</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">bandwidth_hz</span><span class="o">/</span><span class="mi">2000</span><span class="p">))))</span> <span class="p">{</span>
							<span class="n">spur</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
							<span class="k">break</span><span class="p">;</span>
						<span class="p">}</span>
					<span class="p">}</span>

					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spur</span><span class="p">)</span> <span class="p">{</span>
						<span class="n">adc</span><span class="o">-&gt;</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="n">loopdiv</span><span class="p">;</span>
						<span class="n">adc</span><span class="o">-&gt;</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="n">prediv</span><span class="p">;</span>
						<span class="n">adc</span><span class="o">-&gt;</span><span class="n">timf</span> <span class="o">=</span> <span class="mi">2396745143UL</span><span class="o">/</span><span class="n">fdem</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">);</span>
						<span class="n">adc</span><span class="o">-&gt;</span><span class="n">timf</span> <span class="o">+=</span> <span class="p">((</span><span class="mi">2396745143UL</span><span class="o">%</span><span class="n">fdem</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span><span class="o">/</span><span class="n">fdem</span><span class="p">;</span>
						<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;loopdiv=%i prediv=%i timf=%i&quot;</span><span class="p">,</span> <span class="n">loopdiv</span><span class="p">,</span> <span class="n">prediv</span><span class="p">,</span> <span class="n">adc</span><span class="o">-&gt;</span><span class="n">timf</span><span class="p">);</span>
						<span class="k">break</span><span class="p">;</span>
					<span class="p">}</span>
				<span class="p">}</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">spur</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>


	<span class="k">if</span> <span class="p">(</span><span class="n">adc</span><span class="o">-&gt;</span><span class="n">pll_loopdiv</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">adc</span><span class="o">-&gt;</span><span class="n">pll_prediv</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7090_agc_startup</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">pll</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">target</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib7090p_best_adc</span> <span class="n">adc</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">set_param_save</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pll</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span><span class="p">));</span>
	<span class="n">dib0090_pwm_gain_reset</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="n">target</span> <span class="o">=</span> <span class="p">(</span><span class="n">dib0090_get_wbd_target</span><span class="p">(</span><span class="n">fe</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="n">dib7000p_set_wbd_ref</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7090p_get_best_sampling</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pll</span><span class="p">.</span><span class="n">pll_ratio</span>  <span class="o">=</span> <span class="n">adc</span><span class="p">.</span><span class="n">pll_loopdiv</span><span class="p">;</span>
		<span class="n">pll</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="n">adc</span><span class="p">.</span><span class="n">pll_prediv</span><span class="p">;</span>

		<span class="n">dib7000p_update_pll</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pll</span><span class="p">);</span>
		<span class="n">dib7000p_ctrl_timf</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">DEMOD_TIMF_SET</span><span class="p">,</span> <span class="n">adc</span><span class="p">.</span><span class="n">timf</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7090_agc_restart</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">u8</span> <span class="n">restart</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;AGC restart callback: %d&quot;</span><span class="p">,</span> <span class="n">restart</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">restart</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/* before AGC startup */</span>
		<span class="n">dib0090_set_dc_servo</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib7090e_update_lna</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">u16</span> <span class="n">agc_global</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">agc1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">agc2</span><span class="p">,</span> <span class="n">wbd</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wbd_target</span><span class="p">,</span> <span class="n">wbd_offset</span><span class="p">,</span> <span class="n">threshold_agc1</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">wbd_delta</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">.</span><span class="n">frequency</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">400000000</span><span class="p">)</span>
		<span class="n">threshold_agc1</span> <span class="o">=</span> <span class="mi">25000</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">threshold_agc1</span> <span class="o">=</span> <span class="mi">30000</span><span class="p">;</span>

	<span class="n">wbd_target</span> <span class="o">=</span> <span class="p">(</span><span class="n">dib0090_get_wbd_target</span><span class="p">(</span><span class="n">fe</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
	<span class="n">wbd_offset</span> <span class="o">=</span> <span class="n">dib0090_get_wbd_offset</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
	<span class="n">dib7000p_get_agc_values</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">agc1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">agc2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">wbd</span><span class="p">);</span>
	<span class="n">wbd_delta</span> <span class="o">=</span> <span class="p">(</span><span class="n">s16</span><span class="p">)</span><span class="n">wbd</span> <span class="o">-</span> <span class="p">(((</span><span class="n">s16</span><span class="p">)</span><span class="n">wbd_offset</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span> <span class="p">;</span>

	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;update lna, agc_global=%d agc1=%d agc2=%d&quot;</span><span class="p">,</span>
			<span class="n">agc_global</span><span class="p">,</span> <span class="n">agc1</span><span class="p">,</span> <span class="n">agc2</span><span class="p">);</span>
	<span class="n">deb_info</span><span class="p">(</span><span class="s">&quot;update lna, wbd=%d wbd target=%d wbd offset=%d wbd delta=%d&quot;</span><span class="p">,</span>
			<span class="n">wbd</span><span class="p">,</span> <span class="n">wbd_target</span><span class="p">,</span> <span class="n">wbd_offset</span><span class="p">,</span> <span class="n">wbd_delta</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">agc1</span> <span class="o">&lt;</span> <span class="n">threshold_agc1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">wbd_delta</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dib0090_set_switch</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0090_set_vga</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">dib0090_update_rframp_7090</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">dib0090_update_tuning_table_7090</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dib0090_set_vga</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0090_update_rframp_7090</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0090_update_tuning_table_7090</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">dib0090_set_switch</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0090_wbd_slope</span> <span class="n">dib7090_wbd_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">380</span><span class="p">,</span>   <span class="mi">81</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span>  <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">860</span><span class="p">,</span>   <span class="mi">51</span><span class="p">,</span> <span class="mi">866</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span>  <span class="mi">375</span><span class="p">,</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1700</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2600</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xFFFF</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib0090_wbd_slope</span> <span class="n">dib7090e_wbd_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mi">380</span><span class="p">,</span>   <span class="mi">81</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">540</span><span class="p">,</span>	<span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">700</span><span class="p">,</span>   <span class="mi">51</span><span class="p">,</span> <span class="mi">866</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span>  <span class="mi">320</span><span class="p">,</span>	<span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span> <span class="mi">860</span><span class="p">,</span>   <span class="mi">48</span><span class="p">,</span> <span class="mi">666</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>  <span class="mi">330</span><span class="p">,</span>	<span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1700</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2600</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">100</span><span class="p">,</span> <span class="mi">6</span><span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xFFFF</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>	<span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">dib7090_agc_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">band_caps</span>      <span class="o">=</span> <span class="n">BAND_UHF</span><span class="p">,</span>
		<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=1, P_agc_inv_pwm1=0, P_agc_inv_pwm2=0,</span>
<span class="cm">		* P_agc_inh_dc_rv_est=0, P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5, P_agc_write=0 */</span>
		<span class="p">.</span><span class="n">setup</span>          <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

		<span class="p">.</span><span class="n">inv_gain</span>       <span class="o">=</span> <span class="mi">687</span><span class="p">,</span>
		<span class="p">.</span><span class="n">time_stabiliz</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

		<span class="p">.</span><span class="n">alpha_level</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">thlock</span>         <span class="o">=</span> <span class="mi">118</span><span class="p">,</span>

		<span class="p">.</span><span class="n">wbd_inv</span>        <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_ref</span>        <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_sel</span>        <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_alpha</span>      <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc1_max</span>       <span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_min</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc2_max</span>       <span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_min</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc1_pt1</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_pt2</span>       <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_pt3</span>       <span class="o">=</span> <span class="mi">114</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_slope1</span>    <span class="o">=</span> <span class="mi">143</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_slope2</span>    <span class="o">=</span> <span class="mi">144</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_pt1</span>       <span class="o">=</span> <span class="mi">114</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_pt2</span>       <span class="o">=</span> <span class="mi">227</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_slope1</span>    <span class="o">=</span> <span class="mi">116</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_slope2</span>    <span class="o">=</span> <span class="mi">117</span><span class="p">,</span>

		<span class="p">.</span><span class="n">alpha_mant</span>     <span class="o">=</span> <span class="mi">18</span><span class="p">,</span>
		<span class="p">.</span><span class="n">alpha_exp</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beta_mant</span>      <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beta_exp</span>       <span class="o">=</span> <span class="mi">59</span><span class="p">,</span>

		<span class="p">.</span><span class="n">perform_agc_softsplit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span> <span class="p">,</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">band_caps</span>      <span class="o">=</span> <span class="n">BAND_FM</span> <span class="o">|</span> <span class="n">BAND_VHF</span> <span class="o">|</span> <span class="n">BAND_CBAND</span><span class="p">,</span>
		<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=1, P_agc_inv_pwm1=0, P_agc_inv_pwm2=0,</span>
<span class="cm">		* P_agc_inh_dc_rv_est=0, P_agc_time_est=3, P_agc_freeze=0, P_agc_nb_est=5, P_agc_write=0 */</span>
		<span class="p">.</span><span class="n">setup</span>          <span class="o">=</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">5</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>

		<span class="p">.</span><span class="n">inv_gain</span>       <span class="o">=</span> <span class="mi">732</span><span class="p">,</span>
		<span class="p">.</span><span class="n">time_stabiliz</span>  <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>

		<span class="p">.</span><span class="n">alpha_level</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">thlock</span>         <span class="o">=</span> <span class="mi">118</span><span class="p">,</span>

		<span class="p">.</span><span class="n">wbd_inv</span>        <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_ref</span>        <span class="o">=</span> <span class="mi">1200</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_sel</span>        <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_alpha</span>      <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc1_max</span>       <span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_min</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc2_max</span>       <span class="o">=</span> <span class="mi">65535</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_min</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc1_pt1</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_pt2</span>       <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_pt3</span>       <span class="o">=</span> <span class="mi">98</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_slope1</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc1_slope2</span>    <span class="o">=</span> <span class="mi">167</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_pt1</span>       <span class="o">=</span> <span class="mi">98</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_pt2</span>       <span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_slope1</span>    <span class="o">=</span> <span class="mi">104</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc2_slope2</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">alpha_mant</span>     <span class="o">=</span> <span class="mi">18</span><span class="p">,</span>
		<span class="p">.</span><span class="n">alpha_exp</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beta_mant</span>      <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
		<span class="p">.</span><span class="n">beta_exp</span>       <span class="o">=</span> <span class="mi">59</span><span class="p">,</span>

		<span class="p">.</span><span class="n">perform_agc_softsplit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">dib7090_clock_config_12_mhz</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">60000</span><span class="p">,</span> <span class="mi">15000</span><span class="p">,</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">524</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="mi">0</span><span class="p">,</span>
	<span class="mi">20452225</span><span class="p">,</span>
	<span class="mi">15000000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">nim7090_dib7000p_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hostbus_diversity</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">update_lna</span>					<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span>						<span class="o">=</span> <span class="n">dib7090_agc_config</span><span class="p">,</span>

	<span class="p">.</span><span class="n">bw</span>							<span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7090_clock_config_12_mhz</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span>				<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">pwm_freq_div</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_control</span>				<span class="o">=</span> <span class="n">dib7090_agc_restart</span><span class="p">,</span>

	<span class="p">.</span><span class="n">spur_protect</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable_sample_and_hold</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_current_mirror</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">diversity_delay</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">output_mode</span>				<span class="o">=</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enMpegOutput</span>				<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">tfe7090pvr_dib7000p_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hostbus_diversity</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_is_baseband</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">update_lna</span>					<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_config_count</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc</span>						<span class="o">=</span> <span class="n">dib7090_agc_config</span><span class="p">,</span>

		<span class="p">.</span><span class="n">bw</span>							<span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7090_clock_config_12_mhz</span><span class="p">,</span>

		<span class="p">.</span><span class="n">gpio_dir</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_val</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_pwm_pos</span>				<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

		<span class="p">.</span><span class="n">pwm_freq_div</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_control</span>				<span class="o">=</span> <span class="n">dib7090_agc_restart</span><span class="p">,</span>

		<span class="p">.</span><span class="n">spur_protect</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">disable_sample_and_hold</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_current_mirror</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">diversity_delay</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">output_mode</span>				<span class="o">=</span> <span class="n">OUTMODE_MPEG2_PAR_GATED_CLK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_i2c_addr</span>			<span class="o">=</span> <span class="mh">0x90</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enMpegOutput</span>				<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">hostbus_diversity</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_is_baseband</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">update_lna</span>					<span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_config_count</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc</span>						<span class="o">=</span> <span class="n">dib7090_agc_config</span><span class="p">,</span>

		<span class="p">.</span><span class="n">bw</span>							<span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7090_clock_config_12_mhz</span><span class="p">,</span>

		<span class="p">.</span><span class="n">gpio_dir</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_val</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_pwm_pos</span>				<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

		<span class="p">.</span><span class="n">pwm_freq_div</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_control</span>				<span class="o">=</span> <span class="n">dib7090_agc_restart</span><span class="p">,</span>

		<span class="p">.</span><span class="n">spur_protect</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">disable_sample_and_hold</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enable_current_mirror</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">diversity_delay</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">output_mode</span>				<span class="o">=</span> <span class="n">OUTMODE_MPEG2_PAR_GATED_CLK</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_i2c_addr</span>			<span class="o">=</span> <span class="mh">0x92</span><span class="p">,</span>
		<span class="p">.</span><span class="n">enMpegOutput</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">tfe7090e_dib7000p_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hostbus_diversity</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">update_lna</span>					<span class="o">=</span> <span class="n">dib7090e_update_lna</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span>						<span class="o">=</span> <span class="n">dib7090_agc_config</span><span class="p">,</span>

	<span class="p">.</span><span class="n">bw</span>							<span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7090_clock_config_12_mhz</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span>				<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">pwm_freq_div</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_control</span>				<span class="o">=</span> <span class="n">dib7090_agc_restart</span><span class="p">,</span>

	<span class="p">.</span><span class="n">spur_protect</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable_sample_and_hold</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_current_mirror</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">diversity_delay</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">output_mode</span>				<span class="o">=</span> <span class="n">OUTMODE_MPEG2_FIFO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enMpegOutput</span>				<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dib0090_config</span> <span class="n">nim7090_dib0090_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>

	<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">get_adc_power</span> <span class="o">=</span> <span class="n">dib7090_get_adc_power</span><span class="p">,</span>

	<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">wbd_vhf_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd_cband_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">fref_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">wbd</span> <span class="o">=</span> <span class="n">dib7090_wbd_table</span><span class="p">,</span>

	<span class="p">.</span><span class="n">ls_cfg_pad_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_tx_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">low_if</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">in_soc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dib0090_config</span> <span class="n">tfe7090e_dib0090_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>

	<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">get_adc_power</span> <span class="o">=</span> <span class="n">dib7090_get_adc_power</span><span class="p">,</span>

	<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">wbd_vhf_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd_cband_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">fref_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">wbd</span> <span class="o">=</span> <span class="n">dib7090e_wbd_table</span><span class="p">,</span>

	<span class="p">.</span><span class="n">ls_cfg_pad_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_tx_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">low_if</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">in_soc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">force_cband_input</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">is_dib7090e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">tfe7790e_dib7000p_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hostbus_diversity</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span>			<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">update_lna</span>					<span class="o">=</span> <span class="n">dib7090e_update_lna</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span>			<span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span>						<span class="o">=</span> <span class="n">dib7090_agc_config</span><span class="p">,</span>

	<span class="p">.</span><span class="n">bw</span>							<span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7090_clock_config_12_mhz</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span>					<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span>				<span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">pwm_freq_div</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_control</span>				<span class="o">=</span> <span class="n">dib7090_agc_restart</span><span class="p">,</span>

	<span class="p">.</span><span class="n">spur_protect</span>				<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable_sample_and_hold</span>	<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enable_current_mirror</span>		<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">diversity_delay</span>			<span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">output_mode</span>				<span class="o">=</span> <span class="n">OUTMODE_MPEG2_PAR_GATED_CLK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">enMpegOutput</span>				<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dib0090_config</span> <span class="n">tfe7790e_dib0090_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>

	<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">get_adc_power</span> <span class="o">=</span> <span class="n">dib7090_get_adc_power</span><span class="p">,</span>

	<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">wbd_vhf_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd_cband_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">fref_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">wbd</span> <span class="o">=</span> <span class="n">dib7090e_wbd_table</span><span class="p">,</span>

	<span class="p">.</span><span class="n">ls_cfg_pad_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">data_tx_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">low_if</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">in_soc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">force_cband_input</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">is_dib7090e</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">force_crystal_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">dib0090_config</span> <span class="n">tfe7090pvr_dib0090_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>

		<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span>

		<span class="p">.</span><span class="n">get_adc_power</span> <span class="o">=</span> <span class="n">dib7090_get_adc_power</span><span class="p">,</span>

		<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">wbd_vhf_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_cband_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">fref_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">wbd</span> <span class="o">=</span> <span class="n">dib7090_wbd_table</span><span class="p">,</span>

		<span class="p">.</span><span class="n">ls_cfg_pad_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">data_tx_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">low_if</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">in_soc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">clock_khz</span> <span class="o">=</span> <span class="mi">12000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_bypass</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_range</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_prediv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_loopdiv</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">adc_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">pll_int_loop_filt</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">reset</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">dib7090_tuner_sleep</span><span class="p">,</span>

		<span class="p">.</span><span class="n">freq_offset_khz_uhf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">50</span><span class="p">,</span>
		<span class="p">.</span><span class="n">freq_offset_khz_vhf</span> <span class="o">=</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span>

		<span class="p">.</span><span class="n">get_adc_power</span> <span class="o">=</span> <span class="n">dib7090_get_adc_power</span><span class="p">,</span>

		<span class="p">.</span><span class="n">clkouttobamse</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">analog_output</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">wbd_vhf_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">wbd_cband_offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">use_pwm_agc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clkoutdrive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">fref_clock_ratio</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

		<span class="p">.</span><span class="n">wbd</span> <span class="o">=</span> <span class="n">dib7090_wbd_table</span><span class="p">,</span>

		<span class="p">.</span><span class="n">ls_cfg_pad_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">data_tx_drv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">low_if</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">in_soc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">nim7090_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nim7090_dib7000p_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nim7090_dib7000p_config</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">nim7090_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7090_get_i2c_tuner</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nim7090_dib0090_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib7090_agc_startup</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe7090pvr_frontend0_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="cm">/* The TFE7090 requires the dib0700 to not be in master mode */</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">disable_streaming_master_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* initialize IC 0 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7090pvr_dib7000p_config</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">dib0700_set_i2c_speed</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">340</span><span class="p">);</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7090pvr_dib7000p_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">dib7090_slave_reset</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe7090pvr_frontend1_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">i2c</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;the master dib7090 has to be initialized first&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span> <span class="cm">/* the master device has not been initialized */</span>
	<span class="p">}</span>

	<span class="n">i2c</span> <span class="o">=</span> <span class="n">dib7000p_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">adapter</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">DIBX000_I2C_INTERFACE_GPIO_6_7</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="n">i2c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7090pvr_dib7000p_config</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="n">i2c</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7090pvr_dib7000p_config</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">dib0700_set_i2c_speed</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe7090pvr_tuner0_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7090_get_i2c_tuner</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7090pvr_dib0090_config</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib7090_agc_startup</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe7090pvr_tuner1_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7090_get_i2c_tuner</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7090pvr_dib0090_config</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib7090_agc_startup</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe7090e_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="mi">1</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7090e_dib7000p_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
			<span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7090e_dib7000p_config</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe7790e_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="cm">/* The TFE7790E requires the dib0700 to not be in master mode */</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">disable_streaming_master_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="mi">1</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7790e_dib7000p_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
			<span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tfe7790e_dib7000p_config</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span>  <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe7790e_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span>
		<span class="n">dib7090_get_i2c_tuner</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">tfe7790e_dib0090_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib7090_agc_startup</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tfe7090e_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_adapter_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span> <span class="o">=</span>
		<span class="n">dib7090_get_i2c_tuner</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib0090_register</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">tfe7090e_dib0090_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">set_param_save</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_params</span> <span class="o">=</span> <span class="n">dib7090_agc_startup</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* STK7070PD */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">stk7070pd_dib7000p_config</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7070_agc_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7070_bw_config_12_mhz</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">spur_protect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

		<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7070_agc_config</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">dib7070_bw_config_12_mhz</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">spur_protect</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

		<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

		<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">stk7070pd_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7070pd_frontend_attach0</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">stk7070pd_init</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
				     <span class="n">stk7070pd_dib7000p_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		    <span class="n">__func__</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stk7070pd_dib7000p_config</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stk7070pd_frontend_attach1</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">stk7070pd_dib7000p_config</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">novatd_read_status_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span>
		<span class="n">fe_status_t</span> <span class="o">*</span><span class="n">stat</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">read_status</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="n">stat</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">GPIO1</span> <span class="o">:</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span>
				<span class="o">!!</span><span class="p">(</span><span class="o">*</span><span class="n">stat</span> <span class="o">&amp;</span> <span class="n">FE_HAS_LOCK</span><span class="p">));</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">novatd_sleep_override</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span><span class="o">*</span> <span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="cm">/* turn off LED */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">GPIO1</span> <span class="o">:</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">state</span><span class="o">-&gt;</span><span class="n">sleep</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * novatd_frontend_attach - Nova-TD specific attach</span>
<span class="cm"> *</span>
<span class="cm"> * Nova-TD has GPIO0, 1 and 2 for LEDs. So do not fiddle with them except for</span>
<span class="cm"> * information purposes.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">novatd_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">stk7070pd_init</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

		<span class="cm">/* turn the power LED on, the other two off (just in case) */</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO1</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO2</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">dib7000p_i2c_enumeration</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span>
					     <span class="n">stk7070pd_dib7000p_config</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">err</span><span class="p">(</span><span class="s">&quot;%s: dib7000p_i2c_enumeration failed.  Cannot continue</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			    <span class="n">__func__</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
			<span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="mh">0x80</span> <span class="o">:</span> <span class="mh">0x82</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">stk7070pd_dib7000p_config</span><span class="p">[</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">]);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">read_status</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">read_status</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">read_status</span> <span class="o">=</span> <span class="n">novatd_read_status_override</span><span class="p">;</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">sleep</span><span class="p">;</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">sleep</span> <span class="o">=</span> <span class="n">novatd_sleep_override</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* S5H1411 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1411_config</span> <span class="n">pinnacle_801e_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1411_PARALLEL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1411_GPIO_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1411_MPEGTIMING_NONCONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if</span>        <span class="o">=</span> <span class="n">S5H1411_IF_44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsb_if</span>        <span class="o">=</span> <span class="n">S5H1411_IF_44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1411_INVERSION_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1411_DEMODLOCKING</span>
<span class="p">};</span>

<span class="cm">/* Pinnacle PCTV HD Pro 801e GPIOs map:</span>
<span class="cm">   GPIO0  - currently unknown</span>
<span class="cm">   GPIO1  - xc5000 tuner reset</span>
<span class="cm">   GPIO2  - CX25843 sleep</span>
<span class="cm">   GPIO3  - currently unknown</span>
<span class="cm">   GPIO4  - currently unknown</span>
<span class="cm">   GPIO6  - currently unknown</span>
<span class="cm">   GPIO7  - currently unknown</span>
<span class="cm">   GPIO9  - currently unknown</span>
<span class="cm">   GPIO10 - CX25843 reset</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">s5h1411_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="cm">/* Make use of the new i2c functions from FW 1.20 */</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">fw_use_new_i2c_api</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* The s5h1411 requires the dib0700 to not be in master mode */</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">disable_streaming_master_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* All msleep values taken from Windows USB trace */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO3</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO0</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO9</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO4</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO7</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO2</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>

	<span class="cm">/* Put the CX25843 to sleep for now since we&#39;re in digital mode */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO2</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* GPIOs are initialized, do the attach */</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1411_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pinnacle_801e_config</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib0700_xc5000_tuner_callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component</span><span class="p">,</span>
					 <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">command</span> <span class="o">==</span> <span class="n">XC5000_TUNER_RESET</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Reset the tuner */</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO1</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO1</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;xc5000: unknown tuner callback command: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc5000_config</span> <span class="n">s5h1411_xc5000_tunerconfig</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span>      <span class="o">=</span> <span class="mh">0x64</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_khz</span>           <span class="o">=</span> <span class="mi">5380</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">xc5000_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* FIXME: generalize &amp; move to common area */</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dib0700_xc5000_tuner_callback</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc5000_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
			  <span class="o">&amp;</span><span class="n">s5h1411_xc5000_tunerconfig</span><span class="p">)</span>
		<span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dib0700_xc4000_tuner_callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component</span><span class="p">,</span>
					 <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span> <span class="o">=</span> <span class="n">priv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">command</span> <span class="o">==</span> <span class="n">XC4000_TUNER_RESET</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Reset the tuner */</span>
		<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">dib7000p_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">err</span><span class="p">(</span><span class="s">&quot;xc4000: unknown tuner callback command: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">command</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">stk7700p_7000p_xc4000_agc_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">band_caps</span> <span class="o">=</span> <span class="n">BAND_UHF</span> <span class="o">|</span> <span class="n">BAND_VHF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">setup</span> <span class="o">=</span> <span class="mh">0x64</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inv_gain</span> <span class="o">=</span> <span class="mh">0x02c8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">time_stabiliz</span> <span class="o">=</span> <span class="mh">0x15</span><span class="p">,</span>
	<span class="p">.</span><span class="n">alpha_level</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">thlock</span> <span class="o">=</span> <span class="mh">0x76</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd_inv</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd_ref</span> <span class="o">=</span> <span class="mh">0x0b33</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd_sel</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">wbd_alpha</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_max</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_min</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_max</span> <span class="o">=</span> <span class="mh">0x9b26</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_min</span> <span class="o">=</span> <span class="mh">0x26ca</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_pt1</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_pt2</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_pt3</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_slope1</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc1_slope2</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_pt1</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_pt2</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_slope1</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc2_slope2</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">,</span>
	<span class="p">.</span><span class="n">alpha_mant</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">,</span>
	<span class="p">.</span><span class="n">alpha_exp</span> <span class="o">=</span> <span class="mh">0x1b</span><span class="p">,</span>
	<span class="p">.</span><span class="n">beta_mant</span> <span class="o">=</span> <span class="mh">0x17</span><span class="p">,</span>
	<span class="p">.</span><span class="n">beta_exp</span> <span class="o">=</span> <span class="mh">0x33</span><span class="p">,</span>
	<span class="p">.</span><span class="n">perform_agc_softsplit</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">stk7700p_xc4000_pll_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">60000</span><span class="p">,</span> <span class="mi">30000</span><span class="p">,</span>	<span class="cm">/* internal, sampling */</span>
	<span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* pll_cfg: prediv, ratio, range, reset, bypass */</span>
	<span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>	<span class="cm">/* misc: refdiv, bypclk_div, IO_CLK_en_core, */</span>
			<span class="cm">/* ADClkSrc, modulo */</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="mi">524</span><span class="p">,</span>	<span class="cm">/* sad_cfg: refsel, sel, freq_15k */</span>
	<span class="mi">39370534</span><span class="p">,</span>	<span class="cm">/* ifreq */</span>
	<span class="mi">20452225</span><span class="p">,</span>	<span class="cm">/* timf */</span>
	<span class="mi">30000000</span>	<span class="cm">/* xtal */</span>
<span class="p">};</span>

<span class="cm">/* FIXME: none of these inputs are validated yet */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">pctv_340e_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700p_7000p_xc4000_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">stk7700p_xc4000_pll_config</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000M_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* PCTV 340e GPIOs map:</span>
<span class="cm">   dib0700:</span>
<span class="cm">   GPIO2  - CX25843 sleep</span>
<span class="cm">   GPIO3  - CS5340 reset</span>
<span class="cm">   GPIO5  - IRD</span>
<span class="cm">   GPIO6  - Power Supply</span>
<span class="cm">   GPIO8  - LNA (1=off 0=on)</span>
<span class="cm">   GPIO10 - CX25843 reset</span>
<span class="cm">   dib7000:</span>
<span class="cm">   GPIO8  - xc4000 reset</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">pctv340e_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="cm">/* Power Supply on */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span> <span class="cm">/* Allow power supply to settle before probing */</span>

	<span class="cm">/* cx25843 reset */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="cm">/* cx25843 datasheet say 350us required */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* LNA off for now */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO8</span><span class="p">,</span>  <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* Put the CX25843 to sleep for now since we&#39;re in digital mode */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO2</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="cm">/* FIXME: not verified yet */</span>
	<span class="n">dib0700_ctrl_clock</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dib7000pc_detection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Demodulator not found for some reason? */</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">pctv_340e_config</span><span class="p">);</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">is_dib7000pc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc4000_config</span> <span class="n">dib7000p_xc4000_tunerconfig</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span>	  <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
	<span class="p">.</span><span class="n">default_pm</span>	  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dvb_amplitude</span>	  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_smoothedcvbs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_khz</span>		  <span class="o">=</span> <span class="mi">5400</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">xc4000_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span> <span class="o">*</span><span class="n">tun_i2c</span><span class="p">;</span>

	<span class="cm">/* The xc4000 is not on the main i2c bus */</span>
	<span class="n">tun_i2c</span> <span class="o">=</span> <span class="n">dib7000p_get_i2c_master</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span>
					  <span class="n">DIBX000_I2C_INTERFACE_TUNER</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tun_i2c</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Could not reach tuner i2c bus</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Setup the reset callback */</span>
	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">callback</span> <span class="o">=</span> <span class="n">dib0700_xc4000_tuner_callback</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc4000_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span> <span class="n">tun_i2c</span><span class="p">,</span>
			  <span class="o">&amp;</span><span class="n">dib7000p_xc4000_tunerconfig</span><span class="p">)</span>
		<span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lgdt3305_config</span> <span class="n">hcw_lgdt3305_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_addr</span>           <span class="o">=</span> <span class="mh">0x0e</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_mode</span>          <span class="o">=</span> <span class="n">LGDT3305_MPEG_PARALLEL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tpclk_edge</span>         <span class="o">=</span> <span class="n">LGDT3305_TPCLK_FALLING_EDGE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tpvalid_polarity</span>   <span class="o">=</span> <span class="n">LGDT3305_TP_VALID_LOW</span><span class="p">,</span>
	<span class="p">.</span><span class="n">deny_i2c_rptr</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">spectral_inversion</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if_khz</span>         <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsb_if_khz</span>         <span class="o">=</span> <span class="mi">6000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">usref_8vsb</span>         <span class="o">=</span> <span class="mh">0x0500</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mxl5007t_config</span> <span class="n">hcw_mxl5007t_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">xtal_freq_hz</span> <span class="o">=</span> <span class="n">MxL_XTAL_25_MHZ</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_freq_hz</span> <span class="o">=</span> <span class="n">MxL_IF_6_MHZ</span><span class="p">,</span>
	<span class="p">.</span><span class="n">invert_if</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* TIGER-ATSC map:</span>
<span class="cm">   GPIO0  - LNA_CTR  (H: LNA power enabled, L: LNA power disabled)</span>
<span class="cm">   GPIO1  - ANT_SEL  (H: VPA, L: MCX)</span>
<span class="cm">   GPIO4  - SCL2</span>
<span class="cm">   GPIO6  - EN_TUNER</span>
<span class="cm">   GPIO7  - SDA2</span>
<span class="cm">   GPIO10 - DEM_RST</span>

<span class="cm">   MXL is behind LG&#39;s i2c repeater.  LG is on SCL2/SDA2 gpios on the DIB</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">lgdt3305_frontend_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dib0700_state</span> <span class="o">*</span><span class="n">st</span> <span class="o">=</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>

	<span class="cm">/* Make use of the new i2c functions from FW 1.20 */</span>
	<span class="n">st</span><span class="o">-&gt;</span><span class="n">fw_use_new_i2c_api</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">st</span><span class="o">-&gt;</span><span class="n">disable_streaming_master_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* fe power enable */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO6</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>

	<span class="cm">/* demod reset */</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
	<span class="n">dib0700_set_gpio</span><span class="p">(</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO10</span><span class="p">,</span> <span class="n">GPIO_OUT</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>

	<span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">lgdt3305_attach</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">hcw_lgdt3305_config</span><span class="p">,</span>
			      <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">mxl5007t_tuner_attach</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_usb_adapter</span> <span class="o">*</span><span class="n">adap</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">mxl5007t_attach</span><span class="p">,</span> <span class="n">adap</span><span class="o">-&gt;</span><span class="n">fe_adap</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">fe</span><span class="p">,</span>
			  <span class="o">&amp;</span><span class="n">adap</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">,</span>
			  <span class="o">&amp;</span><span class="n">hcw_mxl5007t_config</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">?</span> <span class="o">-</span><span class="n">ENODEV</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="cm">/* DVB-USB and USB stuff follows */</span>
<span class="k">struct</span> <span class="n">usb_device_id</span> <span class="n">dib0700_usb_id_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* 0 */</span>	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_STK7700P</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_STK7700P_PC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_NOVA_T_500</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_NOVA_T_500_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_NOVA_T_STICK</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 5 */</span>	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_AVERMEDIA</span><span class="p">,</span> <span class="n">USB_PID_AVERMEDIA_VOLAR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_COMPRO</span><span class="p">,</span>    <span class="n">USB_PID_COMPRO_VIDEOMATE_U500</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_UNIWILL</span><span class="p">,</span>   <span class="n">USB_PID_UNIWILL_STK7700P</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_LEADTEK</span><span class="p">,</span>   <span class="n">USB_PID_WINFAST_DTV_DONGLE_STK7700P</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_NOVA_T_STICK_2</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 10 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_AVERMEDIA</span><span class="p">,</span> <span class="n">USB_PID_AVERMEDIA_VOLAR_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>  <span class="n">USB_PID_PINNACLE_PCTV2000E</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>
			<span class="n">USB_PID_TERRATEC_CINERGY_DT_XS_DIVERSITY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_NOVA_TD_STICK</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_STK7700D</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 15 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_STK7070P</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>  <span class="n">USB_PID_PINNACLE_PCTV_DVB_T_FLASH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_STK7070PD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>
			<span class="n">USB_PID_PINNACLE_PCTV_DUAL_DIVERSITY_DVB_T</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_COMPRO</span><span class="p">,</span>    <span class="n">USB_PID_COMPRO_VIDEOMATE_U500_PC</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 20 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_AVERMEDIA</span><span class="p">,</span> <span class="n">USB_PID_AVERMEDIA_EXPRESS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_GIGABYTE</span><span class="p">,</span>  <span class="n">USB_PID_GIGABYTE_U7000</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_ULTIMA_ELECTRONIC</span><span class="p">,</span> <span class="n">USB_PID_ARTEC_T14BR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_ASUS</span><span class="p">,</span>      <span class="n">USB_PID_ASUS_U3000</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_ASUS</span><span class="p">,</span>      <span class="n">USB_PID_ASUS_U3100</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 25 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_NOVA_T_STICK_3</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_MYTV_T</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>  <span class="n">USB_PID_TERRATEC_CINERGY_HT_USB_XE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>	<span class="n">USB_PID_PINNACLE_EXPRESSCARD_320CX</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>	<span class="n">USB_PID_PINNACLE_PCTV72E</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 30 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>	<span class="n">USB_PID_PINNACLE_PCTV73E</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_YUAN</span><span class="p">,</span>	<span class="n">USB_PID_YUAN_EC372S</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>	<span class="n">USB_PID_TERRATEC_CINERGY_HT_EXPRESS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>	<span class="n">USB_PID_TERRATEC_CINERGY_T_XXS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_LEADTEK</span><span class="p">,</span>   <span class="n">USB_PID_WINFAST_DTV_DONGLE_STK7700P_2</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 35 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_NOVA_TD_STICK_52009</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_NOVA_T_500_3</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_GIGABYTE</span><span class="p">,</span>  <span class="n">USB_PID_GIGABYTE_U8000</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_YUAN</span><span class="p">,</span>      <span class="n">USB_PID_YUAN_STK7700PH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_ASUS</span><span class="p">,</span>	<span class="n">USB_PID_ASUS_U3000H</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 40 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>  <span class="n">USB_PID_PINNACLE_PCTV801E</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>  <span class="n">USB_PID_PINNACLE_PCTV801E_SE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>	<span class="n">USB_PID_TERRATEC_CINERGY_T_EXPRESS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>
			<span class="n">USB_PID_TERRATEC_CINERGY_DT_XS_DIVERSITY_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_SONY</span><span class="p">,</span>	<span class="n">USB_PID_SONY_PLAYTV</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 45 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_YUAN</span><span class="p">,</span>      <span class="n">USB_PID_YUAN_PD378S</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_TIGER_ATSC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_HAUPPAUGE</span><span class="p">,</span> <span class="n">USB_PID_HAUPPAUGE_TIGER_ATSC_B210</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_YUAN</span><span class="p">,</span>	<span class="n">USB_PID_YUAN_MC770</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_ELGATO</span><span class="p">,</span>	<span class="n">USB_PID_ELGATO_EYETV_DTT</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 50 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_ELGATO</span><span class="p">,</span>	<span class="n">USB_PID_ELGATO_EYETV_DTT_Dlx</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_LEADTEK</span><span class="p">,</span>   <span class="n">USB_PID_WINFAST_DTV_DONGLE_H</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>	<span class="n">USB_PID_TERRATEC_T3</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>	<span class="n">USB_PID_TERRATEC_T5</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_YUAN</span><span class="p">,</span>      <span class="n">USB_PID_YUAN_STK7700D</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 55 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_YUAN</span><span class="p">,</span>	<span class="n">USB_PID_YUAN_STK7700D_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>	<span class="n">USB_PID_PINNACLE_PCTV73A</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PCTV</span><span class="p">,</span>	<span class="n">USB_PID_PINNACLE_PCTV73ESE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PCTV</span><span class="p">,</span>	<span class="n">USB_PID_PINNACLE_PCTV282E</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>	<span class="n">USB_PID_DIBCOM_STK7770P</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 60 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TERRATEC</span><span class="p">,</span>	<span class="n">USB_PID_TERRATEC_CINERGY_T_XXS_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_STK807XPVR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_STK807XP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE_VER</span><span class="p">(</span><span class="n">USB_VID_PIXELVIEW</span><span class="p">,</span> <span class="n">USB_PID_PIXELVIEW_SBTVD</span><span class="p">,</span> <span class="mh">0x000</span><span class="p">,</span> <span class="mh">0x3f00</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_EVOLUTEPC</span><span class="p">,</span> <span class="n">USB_PID_TVWAY_PLUS</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 65 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>	<span class="n">USB_PID_PINNACLE_PCTV73ESE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>	<span class="n">USB_PID_PINNACLE_PCTV282E</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_STK8096GP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_ELGATO</span><span class="p">,</span>    <span class="n">USB_PID_ELGATO_EYETV_DIVERSITY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_NIM9090M</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 70 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_NIM8096MD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_NIM9090MD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_NIM7090</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_TFE7090PVR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_TECHNISAT</span><span class="p">,</span> <span class="n">USB_PID_TECHNISAT_AIRSTAR_TELESTICK_2</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 75 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_MEDION</span><span class="p">,</span>    <span class="n">USB_PID_CREATIX_CTX1921</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>  <span class="n">USB_PID_PINNACLE_PCTV340E</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_PINNACLE</span><span class="p">,</span>  <span class="n">USB_PID_PINNACLE_PCTV340E_SE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_TFE7090E</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_TFE7790E</span><span class="p">)</span> <span class="p">},</span>
<span class="cm">/* 80 */</span><span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_DIBCOM</span><span class="p">,</span>    <span class="n">USB_PID_DIBCOM_TFE8096P</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="n">USB_VID_ELGATO</span><span class="p">,</span>	<span class="n">USB_PID_ELGATO_EYETV_DTT_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mi">0</span> <span class="p">}</span>		<span class="cm">/* Terminating entry */</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">usb</span><span class="p">,</span> <span class="n">dib0700_usb_id_table</span><span class="p">);</span>

<span class="cp">#define DIB0700_DEFAULT_DEVICE_PROPERTIES \</span>
<span class="cp">	.caps              = DVB_USB_IS_AN_I2C_ADAPTER, \</span>
<span class="cp">	.usb_ctrl          = DEVICE_SPECIFIC, \</span>
<span class="cp">	.firmware          = &quot;dvb-usb-dib0700-1.20.fw&quot;, \</span>
<span class="cp">	.download_firmware = dib0700_download_firmware, \</span>
<span class="cp">	.no_reconnect      = 1, \</span>
<span class="cp">	.size_of_priv      = sizeof(struct dib0700_state), \</span>
<span class="cp">	.i2c_algo          = &amp;dib0700_i2c_algo, \</span>
<span class="cp">	.identify_state    = dib0700_identify_state</span>

<span class="cp">#define DIB0700_DEFAULT_STREAMING_CONFIG(ep) \</span>
<span class="cp">	.streaming_ctrl   = dib0700_streaming_ctrl, \</span>
<span class="cp">	.stream = { \</span>
<span class="cp">		.type = USB_BULK, \</span>
<span class="cp">		.count = 4, \</span>
<span class="cp">		.endpoint = ep, \</span>
<span class="cp">		.u = { \</span>
<span class="cp">			.bulk = { \</span>
<span class="cp">				.buffersize = 39480, \</span>
<span class="cp">			} \</span>
<span class="cp">		} \</span>
<span class="cp">	}</span>

<span class="k">struct</span> <span class="n">dvb_usb_device_properties</span> <span class="n">dib0700_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk7700p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk7700p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7700p_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">stk7700p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK7700P reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge Nova-T Stick&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;AVerMedia AVerTV DVB-T Volar&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Compro Videomate U500&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">19</span><span class="p">]</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Uniwill STK7700P based (Hama and others)&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Leadtek Winfast DTV Dongle (STK7700P based)&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">34</span><span class="p">]</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;AVerMedia AVerTV DVB-T Express&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Gigabyte U7000&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">21</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">}</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">bristol_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">bristol_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">bristol_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">bristol_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>
			<span class="p">}},</span>
			<span class="p">}</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge Nova-T 500 Dual DVB-T&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span> <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7700d_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">stk7700d_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7700d_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">stk7700d_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>
			<span class="p">}},</span>
			<span class="p">}</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV 2000e&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Terratec Cinergy DT XS Diversity&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge Nova-TD Stick/Elgato Eye-TV Diversity&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">13</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK7700D reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">14</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;YUAN High-Tech DiBcom STK7700D&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">55</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>

		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span> <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7700P2_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">stk7700d_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;ASUS My Cinema U3000 Mini DVBT Tuner&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">23</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Yuan EC372S&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">31</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Terratec Cinergy T Express&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">42</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">}</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span> <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7070p_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7070p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span>     <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK7070P reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV DVB-T Flash Stick&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">16</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Artec T14BR DVB-T&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">22</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;ASUS My Cinema U3100 Mini DVBT Tuner&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">24</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge Nova-T Stick&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">25</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge Nova-T MyTV.t&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">26</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV 72e&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">29</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV 73e&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Elgato EyeTV DTT&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">49</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Yuan PD378S&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">45</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Elgato EyeTV Dtt Dlx PD378S&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Elgato EyeTV DTT rev. 2&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">81</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7070p_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7070p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span>     <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV 73A&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">56</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV 73e SE&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">57</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">65</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV 282e&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">58</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">66</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">novatd_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7070p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span>     <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">novatd_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7070p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span>     <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">}</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge Nova-TD Stick (52009)&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">35</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span> <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7070pd_frontend_attach0</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7070p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span>     <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7070pd_frontend_attach1</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7070p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span>     <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">}</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK7070PD reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">17</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV Dual DVB-T Diversity Stick&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">18</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge Nova-TD-500 (84xxx)&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>  <span class="s">&quot;Terratec Cinergy DT USB XS Diversity/ T5&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">43</span><span class="p">],</span>
					<span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">53</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>  <span class="s">&quot;Sony PlayTV&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">44</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span> <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7070pd_frontend_attach0</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7070p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span>     <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7070pd_frontend_attach1</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7070p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span>     <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">}</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Elgato EyeTV Diversity&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">68</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_NEC_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7700ph_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">stk7700ph_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span>
						<span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Terratec Cinergy HT USB XE&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">27</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle Expresscard 320cx&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">28</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Terratec Cinergy HT Express&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">32</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Gigabyte U8000-RH&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">37</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;YUAN High-Tech STK7700PH&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">38</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Asus My Cinema-U3000Hybrid&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">39</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;YUAN High-Tech MC770&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">48</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Leadtek WinFast DTV Dongle H&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">51</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;YUAN High-Tech STK7700D&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">54</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">s5h1411_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">xc5000_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span>
						<span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV HD Pro USB Stick&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">40</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV HD USB Stick&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">41</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">lgdt3305_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">mxl5007t_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span>
						<span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge ATSC MiniCard (B200)&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">46</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Hauppauge ATSC MiniCard (B210)&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">47</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>

		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span>       <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span>  <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk7770p_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib7770p_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK7770P reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">59</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Terratec Cinergy T USB XXS (HD)/ T3&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">33</span><span class="p">],</span>
					<span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">52</span><span class="p">],</span>
					<span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">60</span><span class="p">],</span> <span class="nb">NULL</span><span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;TechniSat AirStar TeleStick 2&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">74</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Medion CTX1921 DVB-T USB&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">75</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk807x_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib807x_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK807xP reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">62</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Prolink Pixelview SBTVD&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">63</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;EvolutePC TVWay+&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">64</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_NEC_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk807xpvr_frontend_attach0</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib807x_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span> <span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk807xpvr_frontend_attach1</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib807x_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK807xPVR reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">61</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
					<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk809x_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib809x_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK8096GP reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">67</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
					<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">dib90x0_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">dib90x0_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">stk9090m_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">dib9090_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom STK9090M reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">69</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
					<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">nim8096md_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">nim8096md_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom NIM8096MD reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">70</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
					<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">dib90x0_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">dib90x0_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">nim9090md_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">nim9090md_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom NIM9090MD reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
					<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">nim7090_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">nim7090_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom NIM7090 reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">72</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
					<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">tfe7090pvr_frontend0_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">tfe7090pvr_tuner0_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
					<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
				<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">tfe7090pvr_frontend1_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">tfe7090pvr_tuner1_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom TFE7090PVR reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">73</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
			<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
				<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">pctv340e_frontend_attach</span><span class="p">,</span>
				<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">xc4000_tuner_attach</span><span class="p">,</span>

				<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
			<span class="p">}},</span>
				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span>
						<span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV 340e HD Pro USB Stick&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">76</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
			<span class="p">{</span>   <span class="s">&quot;Pinnacle PCTV Hybrid Stick Solo&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
				<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
				<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
					<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
						<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
					<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">tfe7090e_frontend_attach</span><span class="p">,</span>
					<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">tfe7090e_tuner_attach</span><span class="p">,</span>

					<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>
				<span class="p">}</span> <span class="p">},</span>

				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom TFE7090E reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">78</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
				<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
				<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
					<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
						<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk70x0p_pid_filter_ctrl</span><span class="p">,</span>
					<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">tfe7790e_frontend_attach</span><span class="p">,</span>
					<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">tfe7790e_tuner_attach</span><span class="p">,</span>

					<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x03</span><span class="p">),</span>
				<span class="p">}</span> <span class="p">},</span>

				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom TFE7790E reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span> <span class="p">{</span> <span class="n">DIB0700_DEFAULT_DEVICE_PROPERTIES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_adapters</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>
				<span class="p">.</span><span class="n">num_frontends</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
				<span class="p">.</span><span class="n">fe</span> <span class="o">=</span> <span class="p">{{</span>
					<span class="p">.</span><span class="n">caps</span>  <span class="o">=</span> <span class="n">DVB_USB_ADAP_HAS_PID_FILTER</span> <span class="o">|</span>
						<span class="n">DVB_USB_ADAP_PID_FILTER_CAN_BE_TURNED_OFF</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter</span><span class="p">,</span>
					<span class="p">.</span><span class="n">pid_filter_ctrl</span> <span class="o">=</span> <span class="n">stk80xx_pid_filter_ctrl</span><span class="p">,</span>
					<span class="p">.</span><span class="n">frontend_attach</span>  <span class="o">=</span> <span class="n">tfe8096p_frontend_attach</span><span class="p">,</span>
					<span class="p">.</span><span class="n">tuner_attach</span>     <span class="o">=</span> <span class="n">tfe8096p_tuner_attach</span><span class="p">,</span>

					<span class="n">DIB0700_DEFAULT_STREAMING_CONFIG</span><span class="p">(</span><span class="mh">0x02</span><span class="p">),</span>

				<span class="p">}</span> <span class="p">},</span>

				<span class="p">.</span><span class="n">size_of_priv</span> <span class="o">=</span>
					<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">dib0700_adapter_state</span><span class="p">),</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">num_device_descs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">devices</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span>   <span class="s">&quot;DiBcom TFE8096P reference design&quot;</span><span class="p">,</span>
				<span class="p">{</span> <span class="o">&amp;</span><span class="n">dib0700_usb_id_table</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="nb">NULL</span> <span class="p">},</span>
				<span class="p">{</span> <span class="nb">NULL</span> <span class="p">},</span>
			<span class="p">},</span>
		<span class="p">},</span>

		<span class="p">.</span><span class="n">rc</span><span class="p">.</span><span class="n">core</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">rc_interval</span>      <span class="o">=</span> <span class="n">DEFAULT_RC_INTERVAL</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_codes</span>         <span class="o">=</span> <span class="n">RC_MAP_DIB0700_RC5_TABLE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">module_name</span>	  <span class="o">=</span> <span class="s">&quot;dib0700&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">rc_query</span>         <span class="o">=</span> <span class="n">dib0700_rc_query_old_firmware</span><span class="p">,</span>
			<span class="p">.</span><span class="n">allowed_protos</span>   <span class="o">=</span> <span class="n">RC_TYPE_RC5</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_RC6</span> <span class="o">|</span>
					    <span class="n">RC_TYPE_NEC</span><span class="p">,</span>
			<span class="p">.</span><span class="n">change_protocol</span>  <span class="o">=</span> <span class="n">dib0700_change_protocol</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">dib0700_device_count</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">dib0700_devices</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
