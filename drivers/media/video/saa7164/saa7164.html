<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › saa7164 › saa7164.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>saa7164.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  Driver for the NXP SAA7164 PCIe bridge</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 2010 Steven Toth &lt;stoth@kernellabs.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm">	Driver architecture</span>
<span class="cm">	*******************</span>

<span class="cm">	saa7164_core.c/buffer.c/cards.c/i2c.c/dvb.c</span>
<span class="cm">		|	: Standard Linux driver framework for creating</span>
<span class="cm">		|	: exposing and managing interfaces to the rest</span>
<span class="cm">		|	: of the kernel or userland. Also uses _fw.c to load</span>
<span class="cm">		|	: firmware direct into the PCIe bus, bypassing layers.</span>
<span class="cm">		V</span>
<span class="cm">	saa7164_api..()	: Translate kernel specific functions/features</span>
<span class="cm">		|	: into command buffers.</span>
<span class="cm">		V</span>
<span class="cm">	saa7164_cmd..()	: Manages the flow of command packets on/off,</span>
<span class="cm">		|	: the bus. Deal with bus errors, timeouts etc.</span>
<span class="cm">		V</span>
<span class="cm">	saa7164_bus..() : Manage a read/write memory ring buffer in the</span>
<span class="cm">		|	: PCIe Address space.</span>
<span class="cm">		|</span>
<span class="cm">		|		saa7164_fw...()	: Load any frimware</span>
<span class="cm">		|			|	: direct into the device</span>
<span class="cm">		V			V</span>
<span class="cm">	&lt;- ----------------- PCIe address space -------------------- -&gt;</span>
<span class="cm">*/</span>

<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c-algo-bit.h&gt;</span>
<span class="cp">#include &lt;linux/kdev_t.h&gt;</span>
<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;linux/crc32.h&gt;</span>
<span class="cp">#include &lt;linux/kthread.h&gt;</span>
<span class="cp">#include &lt;linux/freezer.h&gt;</span>

<span class="cp">#include &lt;media/tuner.h&gt;</span>
<span class="cp">#include &lt;media/tveeprom.h&gt;</span>
<span class="cp">#include &lt;media/videobuf-dma-sg.h&gt;</span>
<span class="cp">#include &lt;media/videobuf-dvb.h&gt;</span>
<span class="cp">#include &lt;dvb_demux.h&gt;</span>
<span class="cp">#include &lt;dvb_frontend.h&gt;</span>
<span class="cp">#include &lt;dvb_net.h&gt;</span>
<span class="cp">#include &lt;dvbdev.h&gt;</span>
<span class="cp">#include &lt;dmxdev.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-common.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-ioctl.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-chip-ident.h&gt;</span>

<span class="cp">#include &quot;saa7164-reg.h&quot;</span>
<span class="cp">#include &quot;saa7164-types.h&quot;</span>

<span class="cp">#define SAA7164_MAXBOARDS 8</span>

<span class="cp">#define UNSET (-1U)</span>
<span class="cp">#define SAA7164_BOARD_NOAUTO			UNSET</span>
<span class="cp">#define SAA7164_BOARD_UNKNOWN			0</span>
<span class="cp">#define SAA7164_BOARD_UNKNOWN_REV2		1</span>
<span class="cp">#define SAA7164_BOARD_UNKNOWN_REV3		2</span>
<span class="cp">#define SAA7164_BOARD_HAUPPAUGE_HVR2250		3</span>
<span class="cp">#define SAA7164_BOARD_HAUPPAUGE_HVR2200		4</span>
<span class="cp">#define SAA7164_BOARD_HAUPPAUGE_HVR2200_2	5</span>
<span class="cp">#define SAA7164_BOARD_HAUPPAUGE_HVR2200_3	6</span>
<span class="cp">#define SAA7164_BOARD_HAUPPAUGE_HVR2250_2	7</span>
<span class="cp">#define SAA7164_BOARD_HAUPPAUGE_HVR2250_3	8</span>
<span class="cp">#define SAA7164_BOARD_HAUPPAUGE_HVR2200_4	9</span>
<span class="cp">#define SAA7164_BOARD_HAUPPAUGE_HVR2200_5	10</span>

<span class="cp">#define SAA7164_MAX_UNITS		8</span>
<span class="cp">#define SAA7164_TS_NUMBER_OF_LINES	312</span>
<span class="cp">#define SAA7164_PS_NUMBER_OF_LINES	256</span>
<span class="cp">#define SAA7164_PT_ENTRIES		16 </span><span class="cm">/* (312 * 188) / 4096 */</span><span class="cp"></span>
<span class="cp">#define SAA7164_MAX_ENCODER_BUFFERS	64 </span><span class="cm">/* max 5secs of latency at 6Mbps */</span><span class="cp"></span>
<span class="cp">#define SAA7164_MAX_VBI_BUFFERS		64</span>

<span class="cm">/* Port related defines */</span>
<span class="cp">#define SAA7164_PORT_TS1	(0)</span>
<span class="cp">#define SAA7164_PORT_TS2	(SAA7164_PORT_TS1 + 1)</span>
<span class="cp">#define SAA7164_PORT_ENC1	(SAA7164_PORT_TS2 + 1)</span>
<span class="cp">#define SAA7164_PORT_ENC2	(SAA7164_PORT_ENC1 + 1)</span>
<span class="cp">#define SAA7164_PORT_VBI1	(SAA7164_PORT_ENC2 + 1)</span>
<span class="cp">#define SAA7164_PORT_VBI2	(SAA7164_PORT_VBI1 + 1)</span>
<span class="cp">#define SAA7164_MAX_PORTS	(SAA7164_PORT_VBI2 + 1)</span>

<span class="cp">#define DBGLVL_FW    4</span>
<span class="cp">#define DBGLVL_DVB   8</span>
<span class="cp">#define DBGLVL_I2C  16</span>
<span class="cp">#define DBGLVL_API  32</span>
<span class="cp">#define DBGLVL_CMD  64</span>
<span class="cp">#define DBGLVL_BUS 128</span>
<span class="cp">#define DBGLVL_IRQ 256</span>
<span class="cp">#define DBGLVL_BUF 512</span>
<span class="cp">#define DBGLVL_ENC 1024</span>
<span class="cp">#define DBGLVL_VBI 2048</span>
<span class="cp">#define DBGLVL_THR 4096</span>
<span class="cp">#define DBGLVL_CPU 8192</span>

<span class="cp">#define SAA7164_NORMS \</span>
<span class="cp">	(V4L2_STD_NTSC_M |  V4L2_STD_NTSC_M_JP |  V4L2_STD_NTSC_443)</span>

<span class="k">enum</span> <span class="n">port_t</span> <span class="p">{</span>
	<span class="n">SAA7164_MPEG_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SAA7164_MPEG_DVB</span><span class="p">,</span>
	<span class="n">SAA7164_MPEG_ENCODER</span><span class="p">,</span>
	<span class="n">SAA7164_MPEG_VBI</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">saa7164_i2c_bus_nr</span> <span class="p">{</span>
	<span class="n">SAA7164_I2C_BUS_0</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SAA7164_I2C_BUS_1</span><span class="p">,</span>
	<span class="n">SAA7164_I2C_BUS_2</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">saa7164_buffer_flags</span> <span class="p">{</span>
	<span class="n">SAA7164_BUFFER_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SAA7164_BUFFER_FREE</span><span class="p">,</span>
	<span class="n">SAA7164_BUFFER_BUSY</span><span class="p">,</span>
	<span class="n">SAA7164_BUFFER_FULL</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">saa7164_unit_type</span> <span class="p">{</span>
	<span class="n">SAA7164_UNIT_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">SAA7164_UNIT_DIGITAL_DEMODULATOR</span><span class="p">,</span>
	<span class="n">SAA7164_UNIT_ANALOG_DEMODULATOR</span><span class="p">,</span>
	<span class="n">SAA7164_UNIT_TUNER</span><span class="p">,</span>
	<span class="n">SAA7164_UNIT_EEPROM</span><span class="p">,</span>
	<span class="n">SAA7164_UNIT_ZILOG_IRBLASTER</span><span class="p">,</span>
	<span class="n">SAA7164_UNIT_ENCODER</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* The PCIe bridge doesn&#39;t grant direct access to i2c.</span>
<span class="cm"> * Instead, you address i2c devices using a uniqely</span>
<span class="cm"> * allocated &#39;unitid&#39; value via a messaging API. This</span>
<span class="cm"> * is a problem. The kernel and existing demod/tuner</span>
<span class="cm"> * drivers expect to talk &#39;i2c&#39;, so we have to maintain</span>
<span class="cm"> * a translation layer, and a series of functions to</span>
<span class="cm"> * convert i2c bus + device address into a unit id.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">saa7164_unit</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">saa7164_unit_type</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">id</span><span class="p">;</span>
	<span class="kt">char</span>	<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">saa7164_i2c_bus_nr</span> <span class="n">i2c_bus_nr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">i2c_bus_addr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">i2c_reg_len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_board</span> <span class="p">{</span>
	<span class="kt">char</span>	<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">port_t</span> <span class="n">porta</span><span class="p">,</span> <span class="n">portb</span><span class="p">,</span> <span class="n">portc</span><span class="p">,</span>
		<span class="n">portd</span><span class="p">,</span> <span class="n">porte</span><span class="p">,</span> <span class="n">portf</span><span class="p">;</span>
	<span class="k">enum</span> <span class="p">{</span>
		<span class="n">SAA7164_CHIP_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">SAA7164_CHIP_REV2</span><span class="p">,</span>
		<span class="n">SAA7164_CHIP_REV3</span><span class="p">,</span>
	<span class="p">}</span> <span class="n">chiprev</span><span class="p">;</span>
	<span class="k">struct</span>	<span class="n">saa7164_unit</span> <span class="n">unit</span><span class="p">[</span><span class="n">SAA7164_MAX_UNITS</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_subid</span> <span class="p">{</span>
	<span class="n">u16</span>     <span class="n">subvendor</span><span class="p">;</span>
	<span class="n">u16</span>     <span class="n">subdevice</span><span class="p">;</span>
	<span class="n">u32</span>     <span class="n">card</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_encoder_fh</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">v4l_reading</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_vbi_fh</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">v4l_reading</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_histogram_bucket</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">count</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">update_time</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_histogram</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">saa7164_histogram_bucket</span> <span class="n">counter1</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_user_buffer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

	<span class="cm">/* Attributes */</span>
	<span class="n">u8</span>  <span class="o">*</span><span class="n">data</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pos</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">actual_size</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">crc</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_fw_status</span> <span class="p">{</span>

	<span class="cm">/* RISC Core details */</span>
	<span class="n">u32</span>	<span class="n">status</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">mode</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">spec</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">inst</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">cpuload</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">remainheap</span><span class="p">;</span>

	<span class="cm">/* Firmware version */</span>
	<span class="n">u32</span>	<span class="n">version</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">major</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">sub</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">rel</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">buildnr</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_dvb</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_adapter</span> <span class="n">adapter</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">frontend</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_demux</span> <span class="n">demux</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmxdev</span> <span class="n">dmxdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmx_frontend</span> <span class="n">fe_hw</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dmx_frontend</span> <span class="n">fe_mem</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">dvb_net</span> <span class="n">net</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">feeding</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">saa7164_dev</span>		<span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="k">enum</span> <span class="n">saa7164_i2c_bus_nr</span>		<span class="n">nr</span><span class="p">;</span>

	<span class="cm">/* I2C I/O */</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span>		<span class="n">i2c_adap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_algo_bit_data</span>	<span class="n">i2c_algo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_client</span>		<span class="n">i2c_client</span><span class="p">;</span>
	<span class="n">u32</span>				<span class="n">i2c_rc</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_ctrl</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="n">v</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_tvnorm</span> <span class="p">{</span>
	<span class="kt">char</span>		<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">v4l2_std_id</span>	<span class="n">id</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_encoder_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">saa7164_tvnorm</span> <span class="n">encodernorm</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">height</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">is_50hz</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bitrate</span><span class="p">;</span> <span class="cm">/* bps */</span>
	<span class="n">u32</span> <span class="n">bitrate_peak</span><span class="p">;</span> <span class="cm">/* bps */</span>
	<span class="n">u32</span> <span class="n">bitrate_mode</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">stream_type</span><span class="p">;</span> <span class="cm">/* V4L2_MPEG_STREAM_TYPE_MPEG2_TS */</span>

	<span class="n">u32</span> <span class="n">audio_sampling_freq</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ctl_mute</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ctl_aspect</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">refdist</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gop_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_vbi_params</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">saa7164_tvnorm</span> <span class="n">encodernorm</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">height</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">is_50hz</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bitrate</span><span class="p">;</span> <span class="cm">/* bps */</span>
	<span class="n">u32</span> <span class="n">bitrate_peak</span><span class="p">;</span> <span class="cm">/* bps */</span>
	<span class="n">u32</span> <span class="n">bitrate_mode</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">stream_type</span><span class="p">;</span> <span class="cm">/* V4L2_MPEG_STREAM_TYPE_MPEG2_TS */</span>

	<span class="n">u32</span> <span class="n">audio_sampling_freq</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ctl_mute</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ctl_aspect</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">refdist</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gop_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_port</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">saa7164_buffer</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>

	<span class="cm">/* Note of which h/w buffer list index position we occupy */</span>
	<span class="kt">int</span> <span class="n">idx</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">;</span>

	<span class="cm">/* Hardware Specific */</span>
	<span class="cm">/* PCI Memory allocations */</span>
	<span class="k">enum</span> <span class="n">saa7164_buffer_flags</span> <span class="n">flags</span><span class="p">;</span> <span class="cm">/* Free, Busy, Full */</span>

	<span class="cm">/* A block of page align PCI memory */</span>
	<span class="n">u32</span> <span class="n">pci_size</span><span class="p">;</span>	<span class="cm">/* PCI allocation size in bytes */</span>
	<span class="n">u64</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">cpu</span><span class="p">;</span>	<span class="cm">/* Virtual address */</span>
	<span class="n">dma_addr_t</span> <span class="n">dma</span><span class="p">;</span>	<span class="cm">/* Physical address */</span>
	<span class="n">u32</span> <span class="n">crc</span><span class="p">;</span>	<span class="cm">/* Checksum for the entire buffer data */</span>

	<span class="cm">/* A page table that splits the block into a number of entries */</span>
	<span class="n">u32</span> <span class="n">pt_size</span><span class="p">;</span>		<span class="cm">/* PCI allocation size in bytes */</span>
	<span class="n">u64</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">pt_cpu</span><span class="p">;</span>		<span class="cm">/* Virtual address */</span>
	<span class="n">dma_addr_t</span> <span class="n">pt_dma</span><span class="p">;</span>	<span class="cm">/* Physical address */</span>

	<span class="cm">/* Encoder fops */</span>
	<span class="n">u32</span> <span class="n">pos</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">actual_size</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_port</span> <span class="p">{</span>

	<span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">port_t</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nr</span><span class="p">;</span>

	<span class="cm">/* --- Generic port attributes --- */</span>

	<span class="cm">/* HW stream parameters */</span>
	<span class="k">struct</span> <span class="n">tmHWStreamParameters</span> <span class="n">hw_streamingparams</span><span class="p">;</span>

	<span class="cm">/* DMA configuration values, is seeded during initialization */</span>
	<span class="k">struct</span> <span class="n">tmComResDMATermDescrHeader</span> <span class="n">hwcfg</span><span class="p">;</span>

	<span class="cm">/* hardware specific registers */</span>
	<span class="n">u32</span> <span class="n">bufcounter</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">pitch</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bufsize</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bufoffset</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bufptr32l</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">bufptr32h</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">bufptr64</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">numpte</span><span class="p">;</span>	<span class="cm">/* Number of entries in array, only valid in head */</span>

	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">dmaqueue_lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">saa7164_buffer</span> <span class="n">dmaqueue</span><span class="p">;</span>

	<span class="n">u64</span> <span class="n">last_irq_msecs</span><span class="p">,</span> <span class="n">last_svc_msecs</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">last_irq_msecs_diff</span><span class="p">,</span> <span class="n">last_svc_msecs_diff</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">last_svc_wp</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">last_svc_rp</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">last_irq_svc_msecs_diff</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">last_read_msecs</span><span class="p">,</span> <span class="n">last_read_msecs_diff</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">last_poll_msecs</span><span class="p">,</span> <span class="n">last_poll_msecs_diff</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">saa7164_histogram</span> <span class="n">irq_interval</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">saa7164_histogram</span> <span class="n">svc_interval</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">saa7164_histogram</span> <span class="n">irq_svc_interval</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">saa7164_histogram</span> <span class="n">read_interval</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">saa7164_histogram</span> <span class="n">poll_interval</span><span class="p">;</span>

	<span class="cm">/* --- DVB Transport Specific --- */</span>
	<span class="k">struct</span> <span class="n">saa7164_dvb</span> <span class="n">dvb</span><span class="p">;</span>

	<span class="cm">/* --- Encoder/V4L related attributes --- */</span>
	<span class="cm">/* Encoder */</span>
	<span class="cm">/* Defaults established in saa7164-encoder.c */</span>
	<span class="k">struct</span> <span class="n">saa7164_tvnorm</span> <span class="n">encodernorm</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">height</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">freq</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ts_packet_size</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">ts_packet_count</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mux_input</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">encoder_profile</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">video_format</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">audio_format</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">video_resolution</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ctl_brightness</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ctl_contrast</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ctl_hue</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ctl_saturation</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">ctl_sharpness</span><span class="p">;</span>
	<span class="n">s8</span> <span class="n">ctl_volume</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">tmComResAFeatureDescrHeader</span> <span class="n">audfeat</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tmComResEncoderDescrHeader</span> <span class="n">encunit</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tmComResProcDescrHeader</span> <span class="n">vidproc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tmComResExtDevDescrHeader</span> <span class="n">ifunit</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tmComResTunerDescrHeader</span> <span class="n">tunerunit</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">workenc</span><span class="p">;</span>

	<span class="cm">/* V4L Encoder Video */</span>
	<span class="k">struct</span> <span class="n">saa7164_encoder_params</span> <span class="n">encoder_params</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span> <span class="o">*</span><span class="n">v4l_device</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">v4l_reader_count</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">saa7164_buffer</span> <span class="n">list_buf_used</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">saa7164_buffer</span> <span class="n">list_buf_free</span><span class="p">;</span>
	<span class="n">wait_queue_head_t</span> <span class="n">wait_read</span><span class="p">;</span>

	<span class="cm">/* V4L VBI */</span>
	<span class="k">struct</span> <span class="n">tmComResVBIFormatDescrHeader</span> <span class="n">vbi_fmt_ntsc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">saa7164_vbi_params</span> <span class="n">vbi_params</span><span class="p">;</span>

	<span class="cm">/* Debug */</span>
	<span class="n">u32</span> <span class="n">sync_errors</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">v_cc_errors</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">a_cc_errors</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">last_v_cc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">last_a_cc</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">done_first_interrupt</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>	<span class="n">devlist</span><span class="p">;</span>
	<span class="n">atomic_t</span>		<span class="n">refcount</span><span class="p">;</span>

	<span class="cm">/* pci stuff */</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>	<span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>	<span class="n">pci_rev</span><span class="p">,</span> <span class="n">pci_lat</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">pci_bus</span><span class="p">,</span> <span class="n">pci_slot</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">lmmio</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">bmmio</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">lmmio2</span><span class="p">;</span>
	<span class="n">u8</span>		<span class="n">__iomem</span> <span class="o">*</span><span class="n">bmmio2</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">pci_irqmask</span><span class="p">;</span>

	<span class="cm">/* board details */</span>
	<span class="kt">int</span>	<span class="n">nr</span><span class="p">;</span>
	<span class="kt">int</span>	<span class="n">hwrevision</span><span class="p">;</span>
	<span class="n">u32</span>	<span class="n">board</span><span class="p">;</span>
	<span class="kt">char</span>	<span class="n">name</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>

	<span class="cm">/* firmware status */</span>
	<span class="k">struct</span> <span class="n">saa7164_fw_status</span>	<span class="n">fw_status</span><span class="p">;</span>
	<span class="n">u32</span>				<span class="n">firmwareloaded</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">tmComResHWDescr</span>		<span class="n">hwdesc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tmComResInterfaceDescr</span>	<span class="n">intfdesc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tmComResBusDescr</span>		<span class="n">busdesc</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">tmComResBusInfo</span>		<span class="n">bus</span><span class="p">;</span>

	<span class="cm">/* Interrupt status and ack registers */</span>
	<span class="n">u32</span> <span class="n">int_status</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">int_ack</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">cmd</span>			<span class="n">cmds</span><span class="p">[</span><span class="n">SAA_CMD_MAX_MSG_UNITS</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">mutex</span>			<span class="n">lock</span><span class="p">;</span>

	<span class="cm">/* I2c related */</span>
	<span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="n">i2c_bus</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="cm">/* Transport related */</span>
	<span class="k">struct</span> <span class="n">saa7164_port</span> <span class="n">ports</span><span class="p">[</span><span class="n">SAA7164_MAX_PORTS</span><span class="p">];</span>

	<span class="cm">/* Deferred command/api interrupts handling */</span>
	<span class="k">struct</span> <span class="n">work_struct</span> <span class="n">workcmd</span><span class="p">;</span>

	<span class="cm">/* A kernel thread to monitor the firmware log, used</span>
<span class="cm">	 * only in debug mode.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">task_struct</span> <span class="o">*</span><span class="n">kthread</span><span class="p">;</span>

<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">list_head</span> <span class="n">saa7164_devlist</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">waitsecs</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">encoder_buffers</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">vbi_buffers</span><span class="p">;</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-core.c                                              */</span>
<span class="kt">void</span> <span class="n">saa7164_dumpregs</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">addr</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">saa7164_dumphex16</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">saa7164_getfirmwarestatus</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="n">u32</span> <span class="n">saa7164_getcurrentfirmwareversion</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">saa7164_histogram_update</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_histogram</span> <span class="o">*</span><span class="n">hg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-fw.c                                                */</span>
<span class="kt">int</span> <span class="n">saa7164_downloadfirmware</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-i2c.c                                               */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_i2c_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_i2c_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">saa7164_call_i2c_clients</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">arg</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-bus.c                                               */</span>
<span class="kt">int</span> <span class="n">saa7164_bus_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">saa7164_bus_dump</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_bus_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">tmComResInfo</span><span class="o">*</span> <span class="n">msg</span><span class="p">,</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_bus_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">tmComResInfo</span><span class="o">*</span> <span class="n">msg</span><span class="p">,</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">peekonly</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-cmd.c                                               */</span>
<span class="kt">int</span> <span class="n">saa7164_cmd_send</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="n">u8</span> <span class="n">id</span><span class="p">,</span> <span class="k">enum</span> <span class="n">tmComResCmd</span> <span class="n">command</span><span class="p">,</span> <span class="n">u16</span> <span class="n">controlselector</span><span class="p">,</span>
	<span class="n">u16</span> <span class="n">size</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">saa7164_cmd_signal</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">seqno</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_irq_dequeue</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-api.c                                               */</span>
<span class="kt">int</span> <span class="n">saa7164_api_get_fw_version</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">version</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_enum_subdevs</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_i2c_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reglen</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">reg</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">datalen</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_i2c_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">datalen</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_dif_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span> <span class="n">u8</span> <span class="n">addr</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">datalen</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_read_eeprom</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">buflen</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_gpiobit</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">unitid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pin</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_clear_gpiobit</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">unitid</span><span class="p">,</span> <span class="n">u8</span> <span class="n">pin</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_transition_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_initialize_dif</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_configure_dif</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">std</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_encoder</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_get_encoder</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_aspect_ratio</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_usercontrol</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u8</span> <span class="n">ctl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_get_usercontrol</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u8</span> <span class="n">ctl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_videomux</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_audio_mute</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mute</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_audio_volume</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">s8</span> <span class="n">level</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_audio_std</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_audio_detection</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">autodetect</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_get_videomux</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_vbi_format</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_set_debug</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">level</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_collect_debug</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">saa7164_api_get_load_info</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">tmFwInfoStruct</span> <span class="o">*</span><span class="n">i</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-cards.c                                             */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">saa7164_board</span> <span class="n">saa7164_boards</span><span class="p">[];</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">saa7164_bcount</span><span class="p">;</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">saa7164_subid</span> <span class="n">saa7164_subids</span><span class="p">[];</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">saa7164_idcount</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">saa7164_card_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">saa7164_gpio_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">saa7164_card_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_i2caddr_to_reglen</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_i2caddr_to_unitid</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">,</span> <span class="kt">int</span> <span class="n">addr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">char</span> <span class="o">*</span><span class="n">saa7164_unitid_name</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">unitid</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-dvb.c                                               */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_dvb_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_dvb_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-buffer.c                                            */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">saa7164_buffer</span> <span class="o">*</span><span class="n">saa7164_buffer_alloc</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_buffer_dealloc</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">saa7164_buffer_display</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_buffer_activate</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_buffer_cfg_port</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">saa7164_user_buffer</span> <span class="o">*</span><span class="n">saa7164_buffer_alloc_user</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">saa7164_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">len</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">saa7164_buffer_dealloc_user</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_user_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">saa7164_buffer_zero_offsets</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-encoder.c                                            */</span>
<span class="kt">int</span> <span class="n">saa7164_encoder_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">saa7164_encoder_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* saa7164-vbi.c                                            */</span>
<span class="kt">int</span> <span class="n">saa7164_vbi_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">saa7164_vbi_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">saa7164_port</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">crc_checking</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">saa_debug</span><span class="p">;</span>
<span class="cp">#define dprintk(level, fmt, arg...)\</span>
<span class="cp">	do { if (saa_debug &amp; level)\</span>
<span class="cp">		printk(KERN_DEBUG &quot;%s: &quot; fmt, dev-&gt;name, ## arg);\</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define log_warn(fmt, arg...)\</span>
<span class="cp">	do { \</span>
<span class="cp">		printk(KERN_WARNING &quot;%s: &quot; fmt, dev-&gt;name, ## arg);\</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define saa7164_readl(reg) readl(dev-&gt;lmmio + ((reg) &gt;&gt; 2))</span>
<span class="cp">#define saa7164_writel(reg, value) writel((value), dev-&gt;lmmio + ((reg) &gt;&gt; 2))</span>

<span class="cp">#define saa7164_readb(reg)             readl(dev-&gt;bmmio + (reg))</span>
<span class="cp">#define saa7164_writeb(reg, value)     writel((value), dev-&gt;bmmio + (reg))</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
