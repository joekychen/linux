<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › cx88 › cx88.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>cx88.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *</span>
<span class="cm"> * v4l2 device driver for cx2388x based TV cards</span>
<span class="cm"> *</span>
<span class="cm"> * (c) 2003,04 Gerd Knorr &lt;kraxel@bytesex.org&gt; [SUSE Labs]</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c-algo-bit.h&gt;</span>
<span class="cp">#include &lt;linux/videodev2.h&gt;</span>
<span class="cp">#include &lt;linux/kdev_t.h&gt;</span>

<span class="cp">#include &lt;media/v4l2-device.h&gt;</span>
<span class="cp">#include &lt;media/tuner.h&gt;</span>
<span class="cp">#include &lt;media/tveeprom.h&gt;</span>
<span class="cp">#include &lt;media/videobuf-dma-sg.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-chip-ident.h&gt;</span>
<span class="cp">#include &lt;media/cx2341x.h&gt;</span>
<span class="cp">#include &lt;media/videobuf-dvb.h&gt;</span>
<span class="cp">#include &lt;media/ir-kbd-i2c.h&gt;</span>
<span class="cp">#include &lt;media/wm8775.h&gt;</span>

<span class="cp">#include &quot;btcx-risc.h&quot;</span>
<span class="cp">#include &quot;cx88-reg.h&quot;</span>
<span class="cp">#include &quot;tuner-xc2028.h&quot;</span>

<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cp">#define CX88_VERSION &quot;0.0.9&quot;</span>

<span class="cp">#define UNSET (-1U)</span>

<span class="cp">#define CX88_MAXBOARDS 8</span>

<span class="cm">/* Max number of inputs by card */</span>
<span class="cp">#define MAX_CX88_INPUT 8</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* defines and enums                                           */</span>

<span class="cm">/* Currently unsupported by the driver: PAL/H, NTSC/Kr, SECAM/LC */</span>
<span class="cp">#define CX88_NORMS (V4L2_STD_ALL 		\</span>
<span class="cp">		    &amp; ~V4L2_STD_PAL_H		\</span>
<span class="cp">		    &amp; ~V4L2_STD_NTSC_M_KR	\</span>
<span class="cp">		    &amp; ~V4L2_STD_SECAM_LC)</span>

<span class="cp">#define FORMAT_FLAGS_PACKED       0x01</span>
<span class="cp">#define FORMAT_FLAGS_PLANAR       0x02</span>

<span class="cp">#define VBI_LINE_COUNT              17</span>
<span class="cp">#define VBI_LINE_LENGTH           2048</span>

<span class="cp">#define AUD_RDS_LINES		     4</span>

<span class="cm">/* need &quot;shadow&quot; registers for some write-only ones ... */</span>
<span class="cp">#define SHADOW_AUD_VOL_CTL           1</span>
<span class="cp">#define SHADOW_AUD_BAL_CTL           2</span>
<span class="cp">#define SHADOW_MAX                   3</span>

<span class="cm">/* FM Radio deemphasis type */</span>
<span class="k">enum</span> <span class="n">cx88_deemph_type</span> <span class="p">{</span>
	<span class="n">FM_NO_DEEMPH</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">FM_DEEMPH_50</span><span class="p">,</span>
	<span class="n">FM_DEEMPH_75</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">cx88_board_type</span> <span class="p">{</span>
	<span class="n">CX88_BOARD_NONE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">CX88_MPEG_DVB</span><span class="p">,</span>
	<span class="n">CX88_MPEG_BLACKBIRD</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">cx8802_board_access</span> <span class="p">{</span>
	<span class="n">CX8802_DRVCTL_SHARED</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">CX8802_DRVCTL_EXCLUSIVE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* tv norms                                                    */</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="kr">inline</span> <span class="nf">norm_maxw</span><span class="p">(</span><span class="n">v4l2_std_id</span> <span class="n">norm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">V4L2_STD_MN</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">V4L2_STD_PAL_Nc</span><span class="p">))</span> <span class="o">?</span> <span class="mi">720</span> <span class="o">:</span> <span class="mi">768</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="kr">inline</span> <span class="nf">norm_maxh</span><span class="p">(</span><span class="n">v4l2_std_id</span> <span class="n">norm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&amp;</span> <span class="n">V4L2_STD_625_50</span><span class="p">)</span> <span class="o">?</span> <span class="mi">576</span> <span class="o">:</span> <span class="mi">480</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* static data                                                 */</span>

<span class="k">struct</span> <span class="n">cx8800_fmt</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span>  <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u32</span>   <span class="n">fourcc</span><span class="p">;</span>          <span class="cm">/* v4l2 format id */</span>
	<span class="kt">int</span>   <span class="n">depth</span><span class="p">;</span>
	<span class="kt">int</span>   <span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span>   <span class="n">cxformat</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx88_ctrl</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">v4l2_queryctrl</span>  <span class="n">v</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">off</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">reg</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">sreg</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">mask</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">shift</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* SRAM memory management data (see cx88-core.c)               */</span>

<span class="cp">#define SRAM_CH21 0   </span><span class="cm">/* video */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH22 1</span>
<span class="cp">#define SRAM_CH23 2</span>
<span class="cp">#define SRAM_CH24 3   </span><span class="cm">/* vbi   */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH25 4   </span><span class="cm">/* audio */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH26 5</span>
<span class="cp">#define SRAM_CH28 6   </span><span class="cm">/* mpeg */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH27 7   </span><span class="cm">/* audio rds */</span><span class="cp"></span>
<span class="cm">/* more */</span>

<span class="k">struct</span> <span class="n">sram_channel</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">cmds_start</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">ctrl_start</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">cdt</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">fifo_start</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">fifo_size</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">ptr1_reg</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">ptr2_reg</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">cnt1_reg</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">cnt2_reg</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sram_channel</span> <span class="k">const</span> <span class="n">cx88_sram_channels</span><span class="p">[];</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* card configuration                                          */</span>

<span class="cp">#define CX88_BOARD_NOAUTO               UNSET</span>
<span class="cp">#define CX88_BOARD_UNKNOWN                  0</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE                1</span>
<span class="cp">#define CX88_BOARD_GDI                      2</span>
<span class="cp">#define CX88_BOARD_PIXELVIEW                3</span>
<span class="cp">#define CX88_BOARD_ATI_WONDER_PRO           4</span>
<span class="cp">#define CX88_BOARD_WINFAST2000XP_EXPERT     5</span>
<span class="cp">#define CX88_BOARD_AVERTV_STUDIO_303        6</span>
<span class="cp">#define CX88_BOARD_MSI_TVANYWHERE_MASTER    7</span>
<span class="cp">#define CX88_BOARD_WINFAST_DV2000           8</span>
<span class="cp">#define CX88_BOARD_LEADTEK_PVR2000          9</span>
<span class="cp">#define CX88_BOARD_IODATA_GVVCP3PCI        10</span>
<span class="cp">#define CX88_BOARD_PROLINK_PLAYTVPVR       11</span>
<span class="cp">#define CX88_BOARD_ASUS_PVR_416            12</span>
<span class="cp">#define CX88_BOARD_MSI_TVANYWHERE          13</span>
<span class="cp">#define CX88_BOARD_KWORLD_DVB_T            14</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T1 15</span>
<span class="cp">#define CX88_BOARD_KWORLD_LTV883           16</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_Q  17</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_DVB_T1        18</span>
<span class="cp">#define CX88_BOARD_CONEXANT_DVB_T1         19</span>
<span class="cp">#define CX88_BOARD_PROVIDEO_PV259          20</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PLUS 21</span>
<span class="cp">#define CX88_BOARD_PCHDTV_HD3000           22</span>
<span class="cp">#define CX88_BOARD_DNTV_LIVE_DVB_T         23</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_ROSLYN        24</span>
<span class="cp">#define CX88_BOARD_DIGITALLOGIC_MEC        25</span>
<span class="cp">#define CX88_BOARD_IODATA_GVBCTV7E         26</span>
<span class="cp">#define CX88_BOARD_PIXELVIEW_PLAYTV_ULTRA_PRO 27</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_3_GOLD_T  28</span>
<span class="cp">#define CX88_BOARD_ADSTECH_DVB_T_PCI          29</span>
<span class="cp">#define CX88_BOARD_TERRATEC_CINERGY_1400_DVB_T1  30</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_5_GOLD 31</span>
<span class="cp">#define CX88_BOARD_AVERMEDIA_ULTRATV_MC_550 32</span>
<span class="cp">#define CX88_BOARD_KWORLD_VSTREAM_EXPERT_DVD 33</span>
<span class="cp">#define CX88_BOARD_ATI_HDTVWONDER          34</span>
<span class="cp">#define CX88_BOARD_WINFAST_DTV1000         35</span>
<span class="cp">#define CX88_BOARD_AVERTV_303              36</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_NOVASPLUS_S1  37</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_NOVASE2_S1    38</span>
<span class="cp">#define CX88_BOARD_KWORLD_DVBS_100         39</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_HVR1100       40</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_HVR1100LP     41</span>
<span class="cp">#define CX88_BOARD_DNTV_LIVE_DVB_T_PRO     42</span>
<span class="cp">#define CX88_BOARD_KWORLD_DVB_T_CX22702    43</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL 44</span>
<span class="cp">#define CX88_BOARD_KWORLD_HARDWARE_MPEG_TV_XPERT 45</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_HYBRID 46</span>
<span class="cp">#define CX88_BOARD_PCHDTV_HD5500           47</span>
<span class="cp">#define CX88_BOARD_KWORLD_MCE200_DELUXE    48</span>
<span class="cp">#define CX88_BOARD_PIXELVIEW_PLAYTV_P7000  49</span>
<span class="cp">#define CX88_BOARD_NPGTECH_REALTV_TOP10FM  50</span>
<span class="cp">#define CX88_BOARD_WINFAST_DTV2000H        51</span>
<span class="cp">#define CX88_BOARD_GENIATECH_DVBS          52</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_HVR3000       53</span>
<span class="cp">#define CX88_BOARD_NORWOOD_MICRO           54</span>
<span class="cp">#define CX88_BOARD_TE_DTV_250_OEM_SWANN    55</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_HVR1300       56</span>
<span class="cp">#define CX88_BOARD_ADSTECH_PTV_390         57</span>
<span class="cp">#define CX88_BOARD_PINNACLE_PCTV_HD_800i   58</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_5_PCI_NANO 59</span>
<span class="cp">#define CX88_BOARD_PINNACLE_HYBRID_PCTV    60</span>
<span class="cp">#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL 61</span>
<span class="cp">#define CX88_BOARD_POWERCOLOR_REAL_ANGEL   62</span>
<span class="cp">#define CX88_BOARD_GENIATECH_X8000_MT      63</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_DVB_T_PRO 64</span>
<span class="cp">#define CX88_BOARD_DVICO_FUSIONHDTV_7_GOLD 65</span>
<span class="cp">#define CX88_BOARD_PROLINK_PV_8000GT       66</span>
<span class="cp">#define CX88_BOARD_KWORLD_ATSC_120         67</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_HVR4000       68</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_HVR4000LITE   69</span>
<span class="cp">#define CX88_BOARD_TEVII_S460              70</span>
<span class="cp">#define CX88_BOARD_OMICOM_SS4_PCI          71</span>
<span class="cp">#define CX88_BOARD_TBS_8920                72</span>
<span class="cp">#define CX88_BOARD_TEVII_S420              73</span>
<span class="cp">#define CX88_BOARD_PROLINK_PV_GLOBAL_XTREME 74</span>
<span class="cp">#define CX88_BOARD_PROF_7300               75</span>
<span class="cp">#define CX88_BOARD_SATTRADE_ST4200         76</span>
<span class="cp">#define CX88_BOARD_TBS_8910                77</span>
<span class="cp">#define CX88_BOARD_PROF_6200               78</span>
<span class="cp">#define CX88_BOARD_TERRATEC_CINERGY_HT_PCI_MKII 79</span>
<span class="cp">#define CX88_BOARD_HAUPPAUGE_IRONLY        80</span>
<span class="cp">#define CX88_BOARD_WINFAST_DTV1800H        81</span>
<span class="cp">#define CX88_BOARD_WINFAST_DTV2000H_J      82</span>
<span class="cp">#define CX88_BOARD_PROF_7301               83</span>
<span class="cp">#define CX88_BOARD_SAMSUNG_SMT_7020        84</span>
<span class="cp">#define CX88_BOARD_TWINHAN_VP1027_DVBS     85</span>
<span class="cp">#define CX88_BOARD_TEVII_S464              86</span>
<span class="cp">#define CX88_BOARD_WINFAST_DTV2000H_PLUS   87</span>
<span class="cp">#define CX88_BOARD_WINFAST_DTV1800H_XC4000 88</span>
<span class="cp">#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F36 89</span>
<span class="cp">#define CX88_BOARD_WINFAST_TV2000_XP_GLOBAL_6F43 90</span>

<span class="k">enum</span> <span class="n">cx88_itype</span> <span class="p">{</span>
	<span class="n">CX88_VMUX_COMPOSITE1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">CX88_VMUX_COMPOSITE2</span><span class="p">,</span>
	<span class="n">CX88_VMUX_COMPOSITE3</span><span class="p">,</span>
	<span class="n">CX88_VMUX_COMPOSITE4</span><span class="p">,</span>
	<span class="n">CX88_VMUX_SVIDEO</span><span class="p">,</span>
	<span class="n">CX88_VMUX_TELEVISION</span><span class="p">,</span>
	<span class="n">CX88_VMUX_CABLE</span><span class="p">,</span>
	<span class="n">CX88_VMUX_DVB</span><span class="p">,</span>
	<span class="n">CX88_VMUX_DEBUG</span><span class="p">,</span>
	<span class="n">CX88_RADIO</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx88_input</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">cx88_itype</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">gpio0</span><span class="p">,</span> <span class="n">gpio1</span><span class="p">,</span> <span class="n">gpio2</span><span class="p">,</span> <span class="n">gpio3</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">vmux</span><span class="o">:</span><span class="mi">2</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">audioroute</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx88_board</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span>              <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">tuner_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">radio_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">tuner_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">radio_addr</span><span class="p">;</span>
	<span class="kt">int</span>                     <span class="n">tda9887_conf</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx88_input</span>       <span class="n">input</span><span class="p">[</span><span class="n">MAX_CX88_INPUT</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">cx88_input</span>       <span class="n">radio</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">cx88_board_type</span>    <span class="n">mpeg</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>            <span class="n">audio_chip</span><span class="p">;</span>
	<span class="kt">int</span>			<span class="n">num_frontends</span><span class="p">;</span>

	<span class="cm">/* Used for I2S devices */</span>
	<span class="kt">int</span>			<span class="n">i2sinputcntl</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx88_subid</span> <span class="p">{</span>
	<span class="n">u16</span>     <span class="n">subvendor</span><span class="p">;</span>
	<span class="n">u16</span>     <span class="n">subdevice</span><span class="p">;</span>
	<span class="n">u32</span>     <span class="n">card</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">cx88_tvaudio</span> <span class="p">{</span>
	<span class="n">WW_NONE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">WW_BTSC</span><span class="p">,</span>
	<span class="n">WW_BG</span><span class="p">,</span>
	<span class="n">WW_DK</span><span class="p">,</span>
	<span class="n">WW_I</span><span class="p">,</span>
	<span class="n">WW_L</span><span class="p">,</span>
	<span class="n">WW_EIAJ</span><span class="p">,</span>
	<span class="n">WW_I2SPT</span><span class="p">,</span>
	<span class="n">WW_FM</span><span class="p">,</span>
	<span class="n">WW_I2SADC</span><span class="p">,</span>
	<span class="n">WW_M</span>
<span class="p">};</span>

<span class="cp">#define INPUT(nr) (core-&gt;board.input[nr])</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* device / file handle status                                 */</span>

<span class="cp">#define RESOURCE_OVERLAY       1</span>
<span class="cp">#define RESOURCE_VIDEO         2</span>
<span class="cp">#define RESOURCE_VBI           4</span>

<span class="cp">#define BUFFER_TIMEOUT     msecs_to_jiffies(2000)</span>

<span class="cm">/* buffer for one video frame */</span>
<span class="k">struct</span> <span class="n">cx88_buffer</span> <span class="p">{</span>
	<span class="cm">/* common v4l buffer stuff -- must be first */</span>
	<span class="k">struct</span> <span class="n">videobuf_buffer</span> <span class="n">vb</span><span class="p">;</span>

	<span class="cm">/* cx88 specific */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>           <span class="n">bpl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">btcx_riscmem</span>    <span class="n">risc</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">cx8800_fmt</span> <span class="o">*</span><span class="n">fmt</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx88_dmaqueue</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>       <span class="n">active</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>       <span class="n">queued</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>      <span class="n">timeout</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">btcx_riscmem</span>    <span class="n">stopper</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx88_core</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>           <span class="n">devlist</span><span class="p">;</span>
	<span class="n">atomic_t</span>                   <span class="n">refcount</span><span class="p">;</span>

	<span class="cm">/* board name */</span>
	<span class="kt">int</span>                        <span class="n">nr</span><span class="p">;</span>
	<span class="kt">char</span>                       <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

	<span class="cm">/* pci stuff */</span>
	<span class="kt">int</span>                        <span class="n">pci_bus</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">pci_slot</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">__iomem</span> <span class="o">*</span><span class="n">lmmio</span><span class="p">;</span>
	<span class="n">u8</span>                         <span class="n">__iomem</span> <span class="o">*</span><span class="n">bmmio</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">shadow</span><span class="p">[</span><span class="n">SHADOW_MAX</span><span class="p">];</span>
	<span class="kt">int</span>                        <span class="n">pci_irqmask</span><span class="p">;</span>

	<span class="cm">/* i2c i/o */</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span>         <span class="n">i2c_adap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_algo_bit_data</span>   <span class="n">i2c_algo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_client</span>          <span class="n">i2c_client</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">i2c_state</span><span class="p">,</span> <span class="n">i2c_rc</span><span class="p">;</span>

	<span class="cm">/* config info -- analog */</span>
	<span class="k">struct</span> <span class="n">v4l2_device</span> 	   <span class="n">v4l2_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_client</span> 	   <span class="o">*</span><span class="n">i2c_rtc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">boardnr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx88_board</span>	   <span class="n">board</span><span class="p">;</span>

	<span class="cm">/* Supported V4L _STD_ tuner formats */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">tuner_formats</span><span class="p">;</span>

	<span class="cm">/* config info -- dvb */</span>
<span class="cp">#if defined(CONFIG_VIDEO_CX88_DVB) || defined(CONFIG_VIDEO_CX88_DVB_MODULE)</span>
	<span class="kt">int</span> 			   <span class="p">(</span><span class="o">*</span><span class="n">prev_set_voltage</span><span class="p">)(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="n">fe_sec_voltage_t</span> <span class="n">voltage</span><span class="p">);</span>
<span class="cp">#endif</span>
	<span class="kt">void</span>			   <span class="p">(</span><span class="o">*</span><span class="n">gate_ctrl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cx88_core</span>  <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="kt">int</span> <span class="n">open</span><span class="p">);</span>

	<span class="cm">/* state info */</span>
	<span class="k">struct</span> <span class="n">task_struct</span>         <span class="o">*</span><span class="n">kthread</span><span class="p">;</span>
	<span class="n">v4l2_std_id</span>                <span class="n">tvnorm</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">cx88_tvaudio</span>          <span class="n">tvaudio</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">audiomode_manual</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">audiomode_current</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">input</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">last_analog_input</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">astat</span><span class="p">;</span>
	<span class="n">u32</span>			   <span class="n">use_nicam</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		   <span class="n">last_change</span><span class="p">;</span>

	<span class="cm">/* IR remote control state */</span>
	<span class="k">struct</span> <span class="n">cx88_IR</span>             <span class="o">*</span><span class="n">ir</span><span class="p">;</span>

	<span class="cm">/* I2C remote data */</span>
	<span class="k">struct</span> <span class="n">IR_i2c_init_data</span>    <span class="n">init_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">wm8775_platform_data</span> <span class="n">wm8775_data</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">mutex</span>               <span class="n">lock</span><span class="p">;</span>
	<span class="cm">/* various v4l controls */</span>
	<span class="n">u32</span>                        <span class="n">freq</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">users</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">mpeg_users</span><span class="p">;</span>

	<span class="cm">/* cx88-video needs to access cx8802 for hybrid tuner pll access. */</span>
	<span class="k">struct</span> <span class="n">cx8802_dev</span>          <span class="o">*</span><span class="n">dvbdev</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">cx88_board_type</span>       <span class="n">active_type_id</span><span class="p">;</span>
	<span class="kt">int</span>			   <span class="n">active_ref</span><span class="p">;</span>
	<span class="kt">int</span>			   <span class="n">active_fe_id</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="nf">to_core</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_device</span> <span class="o">*</span><span class="n">v4l2_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cx88_core</span><span class="p">,</span> <span class="n">v4l2_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define WM8775_GID	(1 &lt;&lt; 0)</span>

<span class="cp">#define call_hw(core, grpid, o, f, args...) \</span>
<span class="cp">	do {							\</span>
<span class="cp">		if (!core-&gt;i2c_rc) {				\</span>
<span class="cp">			if (core-&gt;gate_ctrl)			\</span>
<span class="cp">				core-&gt;gate_ctrl(core, 1);	\</span>
<span class="cp">			v4l2_device_call_all(&amp;core-&gt;v4l2_dev, grpid, o, f, ##args); \</span>
<span class="cp">			if (core-&gt;gate_ctrl)			\</span>
<span class="cp">				core-&gt;gate_ctrl(core, 0);	\</span>
<span class="cp">		}						\</span>
<span class="cp">	} while (0)</span>

<span class="cp">#define call_all(core, o, f, args...) call_hw(core, 0, o, f, ##args)</span>

<span class="k">struct</span> <span class="n">cx8800_dev</span><span class="p">;</span>
<span class="k">struct</span> <span class="n">cx8802_dev</span><span class="p">;</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* function 0: video stuff                                     */</span>

<span class="k">struct</span> <span class="n">cx8800_fh</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx8800_dev</span>          <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">v4l2_buf_type</span>         <span class="n">type</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">radio</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">resources</span><span class="p">;</span>

	<span class="cm">/* video overlay */</span>
	<span class="k">struct</span> <span class="n">v4l2_window</span>         <span class="n">win</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_clip</span>           <span class="o">*</span><span class="n">clips</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">nclips</span><span class="p">;</span>

	<span class="cm">/* video capture */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">cx8800_fmt</span>    <span class="o">*</span><span class="n">fmt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">width</span><span class="p">,</span><span class="n">height</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">videobuf_queue</span>      <span class="n">vidq</span><span class="p">;</span>

	<span class="cm">/* vbi capture */</span>
	<span class="k">struct</span> <span class="n">videobuf_queue</span>      <span class="n">vbiq</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx8800_suspend_state</span> <span class="p">{</span>
	<span class="kt">int</span>                        <span class="n">disabled</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx8800_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx88_core</span>           <span class="o">*</span><span class="n">core</span><span class="p">;</span>
	<span class="n">spinlock_t</span>                 <span class="n">slock</span><span class="p">;</span>

	<span class="cm">/* various device info */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">resources</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span>        <span class="o">*</span><span class="n">video_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span>        <span class="o">*</span><span class="n">vbi_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span>        <span class="o">*</span><span class="n">radio_dev</span><span class="p">;</span>

	<span class="cm">/* pci i/o */</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>             <span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>              <span class="n">pci_rev</span><span class="p">,</span><span class="n">pci_lat</span><span class="p">;</span>


	<span class="cm">/* capture queues */</span>
	<span class="k">struct</span> <span class="n">cx88_dmaqueue</span>       <span class="n">vidq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx88_dmaqueue</span>       <span class="n">vbiq</span><span class="p">;</span>

	<span class="cm">/* various v4l controls */</span>

	<span class="cm">/* other global state info */</span>
	<span class="k">struct</span> <span class="n">cx8800_suspend_state</span> <span class="n">state</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* function 1: audio/alsa stuff                                */</span>
<span class="cm">/* =============&gt; moved to cx88-alsa.c &lt;====================== */</span>


<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* function 2: mpeg stuff                                      */</span>

<span class="k">struct</span> <span class="n">cx8802_fh</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx8802_dev</span>          <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">videobuf_queue</span>      <span class="n">mpegq</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx8802_suspend_state</span> <span class="p">{</span>
	<span class="kt">int</span>                        <span class="n">disabled</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">;</span>

	<span class="cm">/* List of drivers attached to device */</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">drvlist</span><span class="p">;</span>

	<span class="cm">/* Type of driver and access required */</span>
	<span class="k">enum</span> <span class="n">cx88_board_type</span> <span class="n">type_id</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">cx8802_board_access</span> <span class="n">hw_access</span><span class="p">;</span>

	<span class="cm">/* MPEG 8802 internal only */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">suspend</span><span class="p">)(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci_dev</span><span class="p">,</span> <span class="n">pm_message_t</span> <span class="n">state</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">resume</span><span class="p">)(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci_dev</span><span class="p">);</span>

	<span class="cm">/* Callers to the following functions must hold core-&gt;lock */</span>

	<span class="cm">/* MPEG 8802 -&gt; mini driver - Driver probe and configuration */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">probe</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">remove</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>

	<span class="cm">/* MPEG 8802 -&gt; mini driver - Access for hardware control */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">advise_acquire</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">advise_release</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>

	<span class="cm">/* MPEG 8802 &lt;- mini driver - Access for hardware control */</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">request_acquire</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>
	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">request_release</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx8802_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx88_core</span>           <span class="o">*</span><span class="n">core</span><span class="p">;</span>
	<span class="n">spinlock_t</span>                 <span class="n">slock</span><span class="p">;</span>

	<span class="cm">/* pci i/o */</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>             <span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>              <span class="n">pci_rev</span><span class="p">,</span><span class="n">pci_lat</span><span class="p">;</span>

	<span class="cm">/* dma queues */</span>
	<span class="k">struct</span> <span class="n">cx88_dmaqueue</span>       <span class="n">mpegq</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">ts_packet_size</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">ts_packet_count</span><span class="p">;</span>

	<span class="cm">/* other global state info */</span>
	<span class="k">struct</span> <span class="n">cx8802_suspend_state</span> <span class="n">state</span><span class="p">;</span>

	<span class="cm">/* for blackbird only */</span>
	<span class="k">struct</span> <span class="n">list_head</span>           <span class="n">devlist</span><span class="p">;</span>
<span class="cp">#if defined(CONFIG_VIDEO_CX88_BLACKBIRD) || \</span>
<span class="cp">    defined(CONFIG_VIDEO_CX88_BLACKBIRD_MODULE)</span>
	<span class="k">struct</span> <span class="n">video_device</span>        <span class="o">*</span><span class="n">mpeg_dev</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">mailbox</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">width</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">height</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>              <span class="n">mpeg_active</span><span class="p">;</span> <span class="cm">/* nonzero if mpeg encoder is active */</span>

	<span class="cm">/* mpeg params */</span>
	<span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="n">params</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_VIDEO_CX88_DVB) || defined(CONFIG_VIDEO_CX88_DVB_MODULE)</span>
	<span class="cm">/* for dvb only */</span>
	<span class="k">struct</span> <span class="n">videobuf_dvb_frontends</span> <span class="n">frontends</span><span class="p">;</span>
<span class="cp">#endif</span>

<span class="cp">#if defined(CONFIG_VIDEO_CX88_VP3054) || \</span>
<span class="cp">    defined(CONFIG_VIDEO_CX88_VP3054_MODULE)</span>
	<span class="cm">/* For VP3045 secondary I2C bus support */</span>
	<span class="k">struct</span> <span class="n">vp3054_i2c_state</span>	   <span class="o">*</span><span class="n">vp3054</span><span class="p">;</span>
<span class="cp">#endif</span>
	<span class="cm">/* for switching modulation types */</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>              <span class="n">ts_gen_cntrl</span><span class="p">;</span>

	<span class="cm">/* List of attached drivers; must hold core-&gt;lock to access */</span>
	<span class="k">struct</span> <span class="n">list_head</span>	   <span class="n">drvlist</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">work_struct</span>	   <span class="n">request_module_wk</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* ----------------------------------------------------------- */</span>

<span class="cp">#define cx_read(reg)             readl(core-&gt;lmmio + ((reg)&gt;&gt;2))</span>
<span class="cp">#define cx_write(reg,value)      writel((value), core-&gt;lmmio + ((reg)&gt;&gt;2))</span>
<span class="cp">#define cx_writeb(reg,value)     writeb((value), core-&gt;bmmio + (reg))</span>

<span class="cp">#define cx_andor(reg,mask,value) \</span>
<span class="cp">  writel((readl(core-&gt;lmmio+((reg)&gt;&gt;2)) &amp; ~(mask)) |\</span>
<span class="cp">  ((value) &amp; (mask)), core-&gt;lmmio+((reg)&gt;&gt;2))</span>
<span class="cp">#define cx_set(reg,bit)          cx_andor((reg),(bit),(bit))</span>
<span class="cp">#define cx_clear(reg,bit)        cx_andor((reg),(bit),0)</span>

<span class="cp">#define cx_wait(d) { if (need_resched()) schedule(); else udelay(d); }</span>

<span class="cm">/* shadow registers */</span>
<span class="cp">#define cx_sread(sreg)		    (core-&gt;shadow[sreg])</span>
<span class="cp">#define cx_swrite(sreg,reg,value) \</span>
<span class="cp">  (core-&gt;shadow[sreg] = value, \</span>
<span class="cp">   writel(core-&gt;shadow[sreg], core-&gt;lmmio + ((reg)&gt;&gt;2)))</span>
<span class="cp">#define cx_sandor(sreg,reg,mask,value) \</span>
<span class="cp">  (core-&gt;shadow[sreg] = (core-&gt;shadow[sreg] &amp; ~(mask)) | ((value) &amp; (mask)), \</span>
<span class="cp">   writel(core-&gt;shadow[sreg], core-&gt;lmmio + ((reg)&gt;&gt;2)))</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-core.c                                                 */</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx88_print_irqbits</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">tag</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">strings</span><span class="p">[],</span>
			       <span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="n">u32</span> <span class="n">bits</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_core_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="n">u32</span> <span class="n">status</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx88_wakeup</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">cx88_dmaqueue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx88_shutdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_reset</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span>
<span class="n">cx88_risc_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span> <span class="k">struct</span> <span class="n">btcx_riscmem</span> <span class="o">*</span><span class="n">risc</span><span class="p">,</span>
		 <span class="k">struct</span> <span class="n">scatterlist</span> <span class="o">*</span><span class="n">sglist</span><span class="p">,</span>
		 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">top_offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bottom_offset</span><span class="p">,</span>
		 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpl</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">padding</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lines</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>
<span class="n">cx88_risc_databuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span> <span class="k">struct</span> <span class="n">btcx_riscmem</span> <span class="o">*</span><span class="n">risc</span><span class="p">,</span>
		     <span class="k">struct</span> <span class="n">scatterlist</span> <span class="o">*</span><span class="n">sglist</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpl</span><span class="p">,</span>
		     <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lines</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lpi</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>
<span class="n">cx88_risc_stopper</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span> <span class="k">struct</span> <span class="n">btcx_riscmem</span> <span class="o">*</span><span class="n">risc</span><span class="p">,</span>
		  <span class="n">u32</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span>
<span class="n">cx88_free_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">videobuf_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cx88_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx88_risc_disasm</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">btcx_riscmem</span> <span class="o">*</span><span class="n">risc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_sram_channel_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span>
				   <span class="k">const</span> <span class="k">struct</span> <span class="n">sram_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpl</span><span class="p">,</span> <span class="n">u32</span> <span class="n">risc</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx88_sram_channel_dump</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span>
				   <span class="k">const</span> <span class="k">struct</span> <span class="n">sram_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_set_scale</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span>
			  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="k">enum</span> <span class="n">v4l2_field</span> <span class="n">field</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_set_tvnorm</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="n">v4l2_std_id</span> <span class="n">norm</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">video_device</span> <span class="o">*</span><span class="n">cx88_vdev_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span>
					   <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span>
					   <span class="k">const</span> <span class="k">struct</span> <span class="n">video_device</span> <span class="o">*</span><span class="n">template_</span><span class="p">,</span>
					   <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">cx88_core</span><span class="o">*</span> <span class="n">cx88_core_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx88_core_put</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_start_audio_dma</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_stop_audio_dma</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>


<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-vbi.c                                                  */</span>

<span class="cm">/* Can be used as g_vbi_fmt, try_vbi_fmt and s_vbi_fmt */</span>
<span class="kt">int</span> <span class="n">cx8800_vbi_fmt</span> <span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">v4l2_format</span> <span class="o">*</span><span class="n">f</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm">int cx8800_start_vbi_dma(struct cx8800_dev    *dev,</span>
<span class="cm">			 struct cx88_dmaqueue *q,</span>
<span class="cm">			 struct cx88_buffer   *buf);</span>
<span class="cm">*/</span>
<span class="kt">int</span> <span class="n">cx8800_stop_vbi_dma</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx8800_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx8800_restart_vbi_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx8800_dev</span>    <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">cx88_dmaqueue</span> <span class="o">*</span><span class="n">q</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">cx8800_vbi_timeout</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">);</span>

<span class="k">extern</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">videobuf_queue_ops</span> <span class="n">cx8800_vbi_qops</span><span class="p">;</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-i2c.c                                                  */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_i2c_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">);</span>


<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-cards.c                                                */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_tuner_callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component</span><span class="p">,</span> <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx88_get_resources</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">cx88_core_create</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nr</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx88_setup_xc3028</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="k">struct</span> <span class="n">xc2028_ctrl</span> <span class="o">*</span><span class="n">ctl</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-tvaudio.c                                              */</span>

<span class="kt">void</span> <span class="n">cx88_set_tvaudio</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">cx88_newstation</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">cx88_get_stereo</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_tuner</span> <span class="o">*</span><span class="n">t</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">cx88_set_stereo</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mode</span><span class="p">,</span> <span class="kt">int</span> <span class="n">manual</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx88_audio_thread</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">data</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">cx8802_register_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx8802_unregister_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">);</span>

<span class="cm">/* Caller must hold core-&gt;lock */</span>
<span class="k">struct</span> <span class="n">cx8802_driver</span> <span class="o">*</span> <span class="n">cx8802_get_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx8802_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">enum</span> <span class="n">cx88_board_type</span> <span class="n">btype</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-dsp.c                                                  */</span>

<span class="n">s32</span> <span class="n">cx88_dsp_detect_stereo_sap</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-input.c                                                */</span>

<span class="kt">int</span> <span class="n">cx88_ir_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx88_ir_fini</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">cx88_ir_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx88_ir_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">cx88_ir_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx88_i2c_init_ir</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-mpeg.c                                                 */</span>

<span class="kt">int</span> <span class="n">cx8802_buf_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">videobuf_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span><span class="k">struct</span> <span class="n">cx8802_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">cx88_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="k">enum</span> <span class="n">v4l2_field</span> <span class="n">field</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">cx8802_buf_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx8802_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cx88_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="kt">void</span> <span class="n">cx8802_cancel_buffers</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx8802_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx88-video.c*/</span>
<span class="k">extern</span> <span class="k">const</span> <span class="n">u32</span> <span class="n">cx88_user_ctrls</span><span class="p">[];</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx8800_ctrl_query</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="o">*</span><span class="n">qctrl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx88_enum_input</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span>  <span class="o">*</span><span class="n">core</span><span class="p">,</span><span class="k">struct</span> <span class="n">v4l2_input</span> <span class="o">*</span><span class="n">i</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx88_set_freq</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span>  <span class="o">*</span><span class="n">core</span><span class="p">,</span><span class="k">struct</span> <span class="n">v4l2_frequency</span> <span class="o">*</span><span class="n">f</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx88_get_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_control</span> <span class="o">*</span><span class="n">ctl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx88_set_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_control</span> <span class="o">*</span><span class="n">ctl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx88_video_mux</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx88_core</span> <span class="o">*</span><span class="n">core</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">input</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
