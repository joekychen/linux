<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › tm6000 › tm6000-cards.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>tm6000-cards.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  tm6000-cards.c - driver for TM5600/TM6000/TM6010 USB video capture devices</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (C) 2006-2007 Mauro Carvalho Chehab &lt;mchehab@infradead.org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation version 2</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/usb.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-common.h&gt;</span>
<span class="cp">#include &lt;media/tuner.h&gt;</span>
<span class="cp">#include &lt;media/tvaudio.h&gt;</span>
<span class="cp">#include &lt;media/i2c-addr.h&gt;</span>
<span class="cp">#include &lt;media/rc-map.h&gt;</span>

<span class="cp">#include &quot;tm6000.h&quot;</span>
<span class="cp">#include &quot;tm6000-regs.h&quot;</span>
<span class="cp">#include &quot;tuner-xc2028.h&quot;</span>
<span class="cp">#include &quot;xc5000.h&quot;</span>

<span class="cp">#define TM6000_BOARD_UNKNOWN			0</span>
<span class="cp">#define TM5600_BOARD_GENERIC			1</span>
<span class="cp">#define TM6000_BOARD_GENERIC			2</span>
<span class="cp">#define TM6010_BOARD_GENERIC			3</span>
<span class="cp">#define TM5600_BOARD_10MOONS_UT821		4</span>
<span class="cp">#define TM5600_BOARD_10MOONS_UT330		5</span>
<span class="cp">#define TM6000_BOARD_ADSTECH_DUAL_TV		6</span>
<span class="cp">#define TM6000_BOARD_FREECOM_AND_SIMILAR	7</span>
<span class="cp">#define TM6000_BOARD_ADSTECH_MINI_DUAL_TV	8</span>
<span class="cp">#define TM6010_BOARD_HAUPPAUGE_900H		9</span>
<span class="cp">#define TM6010_BOARD_BEHOLD_WANDER		10</span>
<span class="cp">#define TM6010_BOARD_BEHOLD_VOYAGER		11</span>
<span class="cp">#define TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE	12</span>
<span class="cp">#define TM6010_BOARD_TWINHAN_TU501		13</span>
<span class="cp">#define TM6010_BOARD_BEHOLD_WANDER_LITE		14</span>
<span class="cp">#define TM6010_BOARD_BEHOLD_VOYAGER_LITE	15</span>
<span class="cp">#define TM5600_BOARD_TERRATEC_GRABSTER		16</span>

<span class="cp">#define is_generic(model) ((model == TM6000_BOARD_UNKNOWN) || \</span>
<span class="cp">			   (model == TM5600_BOARD_GENERIC) || \</span>
<span class="cp">			   (model == TM6000_BOARD_GENERIC) || \</span>
<span class="cp">			   (model == TM6010_BOARD_GENERIC))</span>

<span class="cp">#define TM6000_MAXBOARDS        16</span>
<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">card</span><span class="p">[]</span>     <span class="o">=</span> <span class="p">{[</span><span class="mi">0</span> <span class="p">...</span> <span class="p">(</span><span class="n">TM6000_MAXBOARDS</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">UNSET</span> <span class="p">};</span>

<span class="n">module_param_array</span><span class="p">(</span><span class="n">card</span><span class="p">,</span>  <span class="kt">int</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mo">0444</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">tm6000_devused</span><span class="p">;</span>


<span class="k">struct</span> <span class="n">tm6000_board</span> <span class="p">{</span>
	<span class="kt">char</span>            <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">char</span>		<span class="n">eename</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>		<span class="cm">/* EEPROM name */</span>
	<span class="kt">unsigned</span>	<span class="n">eename_size</span><span class="p">;</span>		<span class="cm">/* size of EEPROM name */</span>
	<span class="kt">unsigned</span>	<span class="n">eename_pos</span><span class="p">;</span>		<span class="cm">/* Position where it appears at ROM */</span>

	<span class="k">struct</span> <span class="n">tm6000_capabilities</span> <span class="n">caps</span><span class="p">;</span>

	<span class="k">enum</span>		<span class="n">tm6000_devtype</span> <span class="n">type</span><span class="p">;</span>	<span class="cm">/* variant of the chipset */</span>
	<span class="kt">int</span>             <span class="n">tuner_type</span><span class="p">;</span>     <span class="cm">/* type of the tuner */</span>
	<span class="kt">int</span>             <span class="n">tuner_addr</span><span class="p">;</span>     <span class="cm">/* tuner address */</span>
	<span class="kt">int</span>             <span class="n">demod_addr</span><span class="p">;</span>     <span class="cm">/* demodulator address */</span>

	<span class="k">struct</span> <span class="n">tm6000_gpio</span> <span class="n">gpio</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">tm6000_input</span>	<span class="n">vinput</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">tm6000_input</span>	<span class="n">rinput</span><span class="p">;</span>

	<span class="kt">char</span>		<span class="o">*</span><span class="n">ir_codes</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tm6000_board</span> <span class="n">tm6000_boards</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">TM6000_BOARD_UNKNOWN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Unknown tm6000 video grabber&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6000_GPIO_1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM5600_BOARD_GENERIC</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Generic tm5600 board&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM5600</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6000_GPIO_1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6000_BOARD_GENERIC</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Generic tm6000 board&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6000_GPIO_1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6010_BOARD_GENERIC</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Generic tm6010 board&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM6010</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_addr</span>   <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">tuner_on</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_3</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_on</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_4</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_7</span><span class="p">,</span>
			<span class="p">.</span><span class="n">dvb_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_5</span><span class="p">,</span>
			<span class="p">.</span><span class="n">ir</span>		<span class="o">=</span> <span class="n">TM6010_GPIO_0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM5600_BOARD_10MOONS_UT821</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;10Moons UT 821&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span>
		<span class="p">.</span><span class="n">eename</span>       <span class="o">=</span> <span class="p">{</span> <span class="sc">&#39;1&#39;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="p">,</span> <span class="sc">&#39;M&#39;</span><span class="p">,</span> <span class="sc">&#39;O&#39;</span><span class="p">,</span> <span class="sc">&#39;O&#39;</span><span class="p">,</span> <span class="sc">&#39;N&#39;</span><span class="p">,</span> <span class="sc">&#39;S&#39;</span><span class="p">,</span> <span class="sc">&#39;5&#39;</span><span class="p">,</span> <span class="sc">&#39;6&#39;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x5b</span><span class="p">},</span>
		<span class="p">.</span><span class="n">eename_size</span>  <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>
		<span class="p">.</span><span class="n">eename_pos</span>   <span class="o">=</span> <span class="mh">0x14</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM5600</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6000_GPIO_1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM5600_BOARD_10MOONS_UT330</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;10Moons UT 330&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_PHILIPS_FQ1216AME_MK4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc8</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>      <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6000_BOARD_ADSTECH_DUAL_TV</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;ADSTECH Dual TV USB&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc8</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_tda9874</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6000_BOARD_FREECOM_AND_SIMILAR</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Freecom Hybrid Stick / Moka DVB-T Receiver Dual&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span> <span class="cm">/* has a XC3028 */</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_addr</span>   <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6000_GPIO_4</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6000_BOARD_ADSTECH_MINI_DUAL_TV</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;ADSTECH Mini Dual TV USB&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span> <span class="cm">/* has a XC3028 */</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc8</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_addr</span>   <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>   <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6000_GPIO_4</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6010_BOARD_HAUPPAUGE_900H</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Hauppauge WinTV HVR-900H / WinTV USB2-Stick&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">eename</span>       <span class="o">=</span> <span class="p">{</span> <span class="sc">&#39;H&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;V&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;R&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;9&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;0&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sc">&#39;H&#39;</span><span class="p">,</span> <span class="mi">0</span> <span class="p">},</span>
		<span class="p">.</span><span class="n">eename_size</span>  <span class="o">=</span> <span class="mi">14</span><span class="p">,</span>
		<span class="p">.</span><span class="n">eename_pos</span>   <span class="o">=</span> <span class="mh">0x42</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span> <span class="cm">/* has a XC3028 */</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_addr</span>   <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM6010</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ir_codes</span> <span class="o">=</span> <span class="n">RC_MAP_HAUPPAUGE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">tuner_on</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_3</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_on</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_4</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_7</span><span class="p">,</span>
			<span class="p">.</span><span class="n">dvb_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_5</span><span class="p">,</span>
			<span class="p">.</span><span class="n">ir</span>		<span class="o">=</span> <span class="n">TM6010_GPIO_0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6010_BOARD_BEHOLD_WANDER</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Beholder Wander DVB-T/TV/FM USB2.0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC5000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_addr</span>   <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM6010</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>        <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_radio</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_6</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">rinput</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_RADIO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6010_BOARD_BEHOLD_VOYAGER</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Beholder Voyager TV/FM USB2.0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC5000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM6010</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>        <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_radio</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_6</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">rinput</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_RADIO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Terratec Cinergy Hybrid XE / Cinergy Hybrid-Stick&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span> <span class="cm">/* has a XC3028 */</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_addr</span>   <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM6010</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_radio</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">tuner_on</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_3</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_on</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_4</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_7</span><span class="p">,</span>
			<span class="p">.</span><span class="n">dvb_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_5</span><span class="p">,</span>
			<span class="p">.</span><span class="n">ir</span>		<span class="o">=</span> <span class="n">TM6010_GPIO_0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">ir_codes</span> <span class="o">=</span> <span class="n">RC_MAP_NEC_TERRATEC_CINERGY_XS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">rinput</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">TM6000_INPUT_RADIO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span> <span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM5600_BOARD_TERRATEC_GRABSTER</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Terratec Grabster AV 150/250 MX&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM5600</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6010_BOARD_TWINHAN_TU501</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Twinhan TU501(704D1)&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">,</span> <span class="cm">/* has a XC3028 */</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_addr</span>   <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM6010</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>  <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>   <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_2</span><span class="p">,</span>
			<span class="p">.</span><span class="n">tuner_on</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_3</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_on</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_4</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_7</span><span class="p">,</span>
			<span class="p">.</span><span class="n">dvb_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_5</span><span class="p">,</span>
			<span class="p">.</span><span class="n">ir</span>		<span class="o">=</span> <span class="n">TM6010_GPIO_0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_COMPOSITE1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_A</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_SVIDEO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_AB</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC2</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6010_BOARD_BEHOLD_WANDER_LITE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Beholder Wander Lite DVB-T/TV/FM USB2.0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC5000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">demod_addr</span>   <span class="o">=</span> <span class="mh">0x1e</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM6010</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>        <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_radio</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">demod_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_6</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">rinput</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_RADIO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">TM6010_BOARD_BEHOLD_VOYAGER_LITE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>         <span class="o">=</span> <span class="s">&quot;Beholder Voyager Lite TV/FM USB2.0&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_type</span>   <span class="o">=</span> <span class="n">TUNER_XC5000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">tuner_addr</span>   <span class="o">=</span> <span class="mh">0xc2</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>         <span class="o">=</span> <span class="n">TM6010</span><span class="p">,</span>
		<span class="p">.</span><span class="n">caps</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">has_tuner</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_dvb</span>        <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_zl10353</span>    <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_eeprom</span>     <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_remote</span>     <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">has_radio</span>	<span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">gpio</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">tuner_reset</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">power_led</span>	<span class="o">=</span> <span class="n">TM6010_GPIO_6</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">vinput</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_TV</span><span class="p">,</span>
			<span class="p">.</span><span class="n">vmux</span>	<span class="o">=</span> <span class="n">TM6000_VMUX_VIDEO_B</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_SIF1</span><span class="p">,</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">rinput</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">type</span>	<span class="o">=</span> <span class="n">TM6000_INPUT_RADIO</span><span class="p">,</span>
			<span class="p">.</span><span class="n">amux</span>	<span class="o">=</span> <span class="n">TM6000_AMUX_ADC1</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* table of devices that work with this driver */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="n">tm6000_id_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x6000</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM5600_BOARD_GENERIC</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x6000</span><span class="p">,</span> <span class="mh">0x0002</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_GENERIC</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x06e1</span><span class="p">,</span> <span class="mh">0xf332</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6000_BOARD_ADSTECH_DUAL_TV</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x14aa</span><span class="p">,</span> <span class="mh">0x0620</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6000_BOARD_FREECOM_AND_SIMILAR</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x06e1</span><span class="p">,</span> <span class="mh">0xb339</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6000_BOARD_ADSTECH_MINI_DUAL_TV</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x2040</span><span class="p">,</span> <span class="mh">0x6600</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x2040</span><span class="p">,</span> <span class="mh">0x6601</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x2040</span><span class="p">,</span> <span class="mh">0x6610</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x2040</span><span class="p">,</span> <span class="mh">0x6611</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x6000</span><span class="p">,</span> <span class="mh">0xdec0</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x6000</span><span class="p">,</span> <span class="mh">0xdec1</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x0ccd</span><span class="p">,</span> <span class="mh">0x0086</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x0ccd</span><span class="p">,</span> <span class="mh">0x00A5</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x0ccd</span><span class="p">,</span> <span class="mh">0x0079</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM5600_BOARD_TERRATEC_GRABSTER</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x13d3</span><span class="p">,</span> <span class="mh">0x3240</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x13d3</span><span class="p">,</span> <span class="mh">0x3241</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x13d3</span><span class="p">,</span> <span class="mh">0x3243</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x13d3</span><span class="p">,</span> <span class="mh">0x3264</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x6000</span><span class="p">,</span> <span class="mh">0xdec2</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER_LITE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x6000</span><span class="p">,</span> <span class="mh">0xdec3</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER_LITE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">usb</span><span class="p">,</span> <span class="n">tm6000_id_table</span><span class="p">);</span>

<span class="cm">/* Control power led for show some activity */</span>
<span class="kt">void</span> <span class="nf">tm6000_flash_led</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* Power LED unconfigured */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/* ON Power LED */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span>:
			<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
				<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER_LITE</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER_LITE</span>:
			<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
				<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="cm">/* OFF Power LED */</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span>:
			<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
				<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER_LITE</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER_LITE</span>:
			<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
				<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Tuner callback to provide the proper gpio changes needed for xc5000 */</span>
<span class="kt">int</span> <span class="nf">tm6000_xc5000_callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component</span><span class="p">,</span> <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_type</span> <span class="o">!=</span> <span class="n">TUNER_XC5000</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">XC5000_TUNER_RESET</span>:
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
			       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
			       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
			       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">tm6000_xc5000_callback</span><span class="p">);</span>

<span class="cm">/* Tuner callback to provide the proper gpio changes needed for xc2028 */</span>

<span class="kt">int</span> <span class="nf">tm6000_tuner_callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component</span><span class="p">,</span> <span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_type</span> <span class="o">!=</span> <span class="n">TUNER_XC2028</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">command</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">XC2028_RESET_CLK</span>:
		<span class="n">tm6000_ir_wait</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_04_EN_DISABLE_MCU_INT</span><span class="p">,</span>
					<span class="mh">0x02</span><span class="p">,</span> <span class="n">arg</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_i2c_reset</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">XC2028_TUNER_RESET</span>:
		<span class="cm">/* Reset codes during load firmware */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:
			<span class="cm">/* newer tuner can faster reset */</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">TM5600_BOARD_10MOONS_UT821</span>:
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="mh">0x300</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="mh">0x300</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="mh">0x300</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span>:
			<span class="k">case</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span>:
			<span class="k">case</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span>:
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">75</span><span class="p">);</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">130</span><span class="p">);</span>
				<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
					       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
				<span class="n">msleep</span><span class="p">(</span><span class="mi">130</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">tm6000_ir_wait</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_04_EN_DISABLE_MCU_INT</span><span class="p">,</span>
						<span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_i2c_reset</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">XC2028_I2C_FLUSH</span>:
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_50_SET_START</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_51_SET_STOP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">tm6000_tuner_callback</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">tm6000_cards_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * Board-specific initialization sequence. Handles all GPIO</span>
<span class="cm">	 * initialization sequences that are board-specific.</span>
<span class="cm">	 * Up to now, all found devices use GPIO1 and GPIO4 at the same way.</span>
<span class="cm">	 * Probably, they&#39;re all based on some reference device. Due to that,</span>
<span class="cm">	 * there&#39;s a common routine at the end to handle those GPIO&#39;s. Devices</span>
<span class="cm">	 * that use different pinups or init sequences can just return at</span>
<span class="cm">	 * the board-specific session.</span>
<span class="cm">	 */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span>:
	<span class="k">case</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span>:
	<span class="k">case</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span>:
	<span class="k">case</span> <span class="n">TM6010_BOARD_GENERIC</span>:
		<span class="cm">/* Turn xceive 3028 on */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_on</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="cm">/* Turn zarlink zl10353 on */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">demod_on</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="cm">/* Reset zarlink zl10353 */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">demod_reset</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">demod_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="cm">/* Turn zarlink zl10353 off */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">demod_on</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="cm">/* ir ? */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">ir</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="cm">/* Power led on (blue) */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="cm">/* DVB led off (orange) */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">dvb_led</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="cm">/* Turn zarlink zl10353 on */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">demod_on</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER</span>:
	<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER_LITE</span>:
		<span class="cm">/* Power led on (blue) */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="cm">/* Reset zarlink zl10353 */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">demod_reset</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">demod_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER</span>:
	<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER_LITE</span>:
		<span class="cm">/* Power led on (blue) */</span>
		<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/*</span>
<span class="cm">	 * Default initialization. Most of the devices seem to use GPIO1</span>
<span class="cm">	 * and GPIO4.on the same way, so, this handles the common sequence</span>
<span class="cm">	 * used by most devices.</span>
<span class="cm">	 * If a device uses a different sequence or different GPIO pins for</span>
<span class="cm">	 * reset, just add the code at the board-specific part</span>
<span class="cm">	 */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
						<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Error %i doing tuner reset</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="p">);</span>
				<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
			<span class="p">}</span>

			<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span> <span class="cm">/* Just to be conservative */</span>
			<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
						<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">tuner_reset</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Error %i doing tuner reset</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="p">);</span>
				<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;Tuner reset is not configured</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">tm6000_config_tuner</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">tuner_setup</span> <span class="n">tun_setup</span><span class="p">;</span>

	<span class="cm">/* Load tuner module */</span>
	<span class="n">v4l2_i2c_new_subdev</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
		<span class="s">&quot;tuner&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_addr</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tun_setup</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tun_setup</span><span class="p">));</span>
	<span class="n">tun_setup</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_type</span><span class="p">;</span>
	<span class="n">tun_setup</span><span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_addr</span><span class="p">;</span>

	<span class="n">tun_setup</span><span class="p">.</span><span class="n">mode_mask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">caps</span><span class="p">.</span><span class="n">has_tuner</span><span class="p">)</span>
		<span class="n">tun_setup</span><span class="p">.</span><span class="n">mode_mask</span> <span class="o">|=</span> <span class="p">(</span><span class="n">T_ANALOG_TV</span> <span class="o">|</span> <span class="n">T_RADIO</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TUNER_XC2028</span>:
		<span class="n">tun_setup</span><span class="p">.</span><span class="n">tuner_callback</span> <span class="o">=</span> <span class="n">tm6000_tuner_callback</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">TUNER_XC5000</span>:
		<span class="n">tun_setup</span><span class="p">.</span><span class="n">tuner_callback</span> <span class="o">=</span> <span class="n">tm6000_xc5000_callback</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">v4l2_device_call_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tuner</span><span class="p">,</span> <span class="n">s_type_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tun_setup</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_type</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TUNER_XC2028</span>: <span class="p">{</span>
		<span class="k">struct</span> <span class="n">v4l2_priv_tun_config</span> <span class="n">xc2028_cfg</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">xc2028_ctrl</span> <span class="n">ctl</span><span class="p">;</span>

		<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">xc2028_cfg</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">xc2028_cfg</span><span class="p">));</span>
		<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">ctl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">ctl</span><span class="p">));</span>

		<span class="n">ctl</span><span class="p">.</span><span class="n">demod</span> <span class="o">=</span> <span class="n">XC3028_FE_ZARLINK456</span><span class="p">;</span>

		<span class="n">xc2028_cfg</span><span class="p">.</span><span class="n">tuner</span> <span class="o">=</span> <span class="n">TUNER_XC2028</span><span class="p">;</span>
		<span class="n">xc2028_cfg</span><span class="p">.</span><span class="n">priv</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">ctl</span><span class="p">;</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span>:
			<span class="n">ctl</span><span class="p">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
			<span class="n">ctl</span><span class="p">.</span><span class="n">fname</span> <span class="o">=</span> <span class="s">&quot;xc3028L-v36.fw&quot;</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_type</span> <span class="o">==</span> <span class="n">TM6010</span><span class="p">)</span>
				<span class="n">ctl</span><span class="p">.</span><span class="n">fname</span> <span class="o">=</span> <span class="s">&quot;xc3028-v27.fw&quot;</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">ctl</span><span class="p">.</span><span class="n">fname</span> <span class="o">=</span> <span class="s">&quot;xc3028-v24.fw&quot;</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;Setting firmware parameters for xc2028</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">v4l2_device_call_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tuner</span><span class="p">,</span> <span class="n">s_config</span><span class="p">,</span>
				     <span class="o">&amp;</span><span class="n">xc2028_cfg</span><span class="p">);</span>

		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">TUNER_XC5000</span>:
		<span class="p">{</span>
		<span class="k">struct</span> <span class="n">v4l2_priv_tun_config</span>  <span class="n">xc5000_cfg</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">xc5000_config</span> <span class="n">ctl</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_addr</span><span class="p">,</span>
			<span class="p">.</span><span class="n">if_khz</span>      <span class="o">=</span> <span class="mi">4570</span><span class="p">,</span>
			<span class="p">.</span><span class="n">radio_input</span> <span class="o">=</span> <span class="n">XC5000_RADIO_FM1_MONO</span><span class="p">,</span>
			<span class="p">};</span>

		<span class="n">xc5000_cfg</span><span class="p">.</span><span class="n">tuner</span> <span class="o">=</span> <span class="n">TUNER_XC5000</span><span class="p">;</span>
		<span class="n">xc5000_cfg</span><span class="p">.</span><span class="n">priv</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">ctl</span><span class="p">;</span>

		<span class="n">v4l2_device_call_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tuner</span><span class="p">,</span> <span class="n">s_config</span><span class="p">,</span>
				     <span class="o">&amp;</span><span class="n">xc5000_cfg</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;Unknown tuner type. Tuner is not configured.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">fill_board_specific_data</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">dev_type</span>   <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">type</span><span class="p">;</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_type</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">tuner_type</span><span class="p">;</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">tuner_addr</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">tuner_addr</span><span class="p">;</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">gpio</span><span class="p">;</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">ir_codes</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">ir_codes</span><span class="p">;</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">demod_addr</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">demod_addr</span><span class="p">;</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">caps</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">caps</span><span class="p">;</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">vinput</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">vinput</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">vinput</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">vinput</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">vinput</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">vinput</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">rinput</span> <span class="o">=</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">rinput</span><span class="p">;</span>

	<span class="cm">/* setup per-model quirks */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span>:
	<span class="k">case</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span>:
		<span class="n">dev</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">TM6000_QUIRK_NO_USB_DELAY</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* initialize hardware */</span>
	<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_init</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">v4l2_device_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">void</span> <span class="nf">use_alternative_detection_method</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">eedata_size</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tm6000_boards</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tm6000_boards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eename_size</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">eedata_size</span> <span class="o">&lt;</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eename_pos</span> <span class="o">+</span>
				       <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eename_size</span><span class="p">)</span>
			<span class="k">continue</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">memcmp</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">eedata</span><span class="p">[</span><span class="n">tm6000_boards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eename_pos</span><span class="p">],</span>
			    <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eename</span><span class="p">,</span>
			    <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">eename_size</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">model</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">model</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;Device has eeprom but is currently unknown</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;Device identified via eeprom as %s (type = %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
	       <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">model</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">model</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#if defined(CONFIG_MODULES) &amp;&amp; defined(MODULE)</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">request_module_async</span><span class="p">(</span><span class="k">struct</span> <span class="n">work_struct</span> <span class="o">*</span><span class="n">work</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">work</span><span class="p">,</span> <span class="k">struct</span> <span class="n">tm6000_core</span><span class="p">,</span>
					       <span class="n">request_module_wk</span><span class="p">);</span>

	<span class="n">request_module</span><span class="p">(</span><span class="s">&quot;tm6000-alsa&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">caps</span><span class="p">.</span><span class="n">has_dvb</span><span class="p">)</span>
		<span class="n">request_module</span><span class="p">(</span><span class="s">&quot;tm6000-dvb&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">request_modules</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">INIT_WORK</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">request_module_wk</span><span class="p">,</span> <span class="n">request_module_async</span><span class="p">);</span>
	<span class="n">schedule_work</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">request_module_wk</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">flush_request_modules</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">flush_work_sync</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">request_module_wk</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#else</span>
<span class="cp">#define request_modules(dev)</span>
<span class="cp">#define flush_request_modules(dev)</span>
<span class="cp">#endif </span><span class="cm">/* CONFIG_MODULES */</span><span class="cp"></span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">tm6000_init_dev</span><span class="p">(</span><span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">v4l2_frequency</span> <span class="n">f</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">);</span>
	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">is_generic</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">fill_board_specific_data</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>

		<span class="cm">/* register i2c bus */</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_i2c_register</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* register i2c bus */</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_i2c_register</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>

		<span class="n">use_alternative_detection_method</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

		<span class="n">rc</span> <span class="o">=</span> <span class="n">fill_board_specific_data</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Default values for STD and resolutions */</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">=</span> <span class="mi">720</span><span class="p">;</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">norm</span> <span class="o">=</span> <span class="n">V4L2_STD_PAL_M</span><span class="p">;</span>

	<span class="cm">/* Configure tuner */</span>
	<span class="n">tm6000_config_tuner</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="cm">/* Set video standard */</span>
	<span class="n">v4l2_device_call_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">core</span><span class="p">,</span> <span class="n">s_std</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">norm</span><span class="p">);</span>

	<span class="cm">/* Set tuner frequency - also loads firmware on xc2028/xc3028 */</span>
	<span class="n">f</span><span class="p">.</span><span class="n">tuner</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">f</span><span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_TUNER_ANALOG_TV</span><span class="p">;</span>
	<span class="n">f</span><span class="p">.</span><span class="n">frequency</span> <span class="o">=</span> <span class="mi">3092</span><span class="p">;</span>	<span class="cm">/* 193.25 MHz */</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">freq</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="n">frequency</span><span class="p">;</span>
	<span class="n">v4l2_device_call_all</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">tuner</span><span class="p">,</span> <span class="n">s_frequency</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">caps</span><span class="p">.</span><span class="n">has_tda9874</span><span class="p">)</span>
		<span class="n">v4l2_i2c_new_subdev</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
			<span class="s">&quot;tvaudio&quot;</span><span class="p">,</span> <span class="n">I2C_ADDR_TDA9874</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="cm">/* register and initialize V4L2 */</span>
	<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_v4l2_register</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">tm6000_add_into_devlist</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">tm6000_init_extension</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">tm6000_ir_init</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">request_modules</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">err:</span>
	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* high bandwidth multiplier, as encoded in highspeed endpoint descriptors */</span>
<span class="cp">#define hb_mult(wMaxPacketSize) (1 + (((wMaxPacketSize) &gt;&gt; 11) &amp; 0x03))</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">get_max_endpoint</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">udev</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">usb_host_interface</span> <span class="o">*</span><span class="n">alt</span><span class="p">,</span>
			     <span class="kt">char</span> <span class="o">*</span><span class="n">msgtype</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">usb_host_endpoint</span> <span class="o">*</span><span class="n">curr_e</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">tm6000_endpoint</span> <span class="o">*</span><span class="n">tm_ep</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">curr_e</span><span class="o">-&gt;</span><span class="n">desc</span><span class="p">.</span><span class="n">wMaxPacketSize</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">tmp</span> <span class="o">&amp;</span> <span class="mh">0x7ff</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">speed</span> <span class="o">==</span> <span class="n">USB_SPEED_HIGH</span><span class="p">)</span>
		<span class="n">size</span> <span class="o">=</span> <span class="n">size</span> <span class="o">*</span> <span class="n">hb_mult</span><span class="p">(</span><span class="n">tmp</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">tm_ep</span><span class="o">-&gt;</span><span class="n">maxsize</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tm_ep</span><span class="o">-&gt;</span><span class="n">endp</span> <span class="o">=</span> <span class="n">curr_e</span><span class="p">;</span>
		<span class="n">tm_ep</span><span class="o">-&gt;</span><span class="n">maxsize</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
		<span class="n">tm_ep</span><span class="o">-&gt;</span><span class="n">bInterfaceNumber</span> <span class="o">=</span> <span class="n">alt</span><span class="o">-&gt;</span><span class="n">desc</span><span class="p">.</span><span class="n">bInterfaceNumber</span><span class="p">;</span>
		<span class="n">tm_ep</span><span class="o">-&gt;</span><span class="n">bAlternateSetting</span> <span class="o">=</span> <span class="n">alt</span><span class="o">-&gt;</span><span class="n">desc</span><span class="p">.</span><span class="n">bAlternateSetting</span><span class="p">;</span>

		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;tm6000: %s endpoint: 0x%02x (max size=%u bytes)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">msgtype</span><span class="p">,</span> <span class="n">curr_e</span><span class="o">-&gt;</span><span class="n">desc</span><span class="p">.</span><span class="n">bEndpointAddress</span><span class="p">,</span>
					<span class="n">size</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * tm6000_usb_probe()</span>
<span class="cm"> * checks for supported devices</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">tm6000_usb_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">interface</span><span class="p">,</span>
			    <span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">usb_device</span> <span class="o">*</span><span class="n">usbdev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">rc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">nr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">speed</span><span class="p">;</span>

	<span class="n">usbdev</span> <span class="o">=</span> <span class="n">usb_get_dev</span><span class="p">(</span><span class="n">interface_to_usbdev</span><span class="p">(</span><span class="n">interface</span><span class="p">));</span>

	<span class="cm">/* Selects the proper interface */</span>
	<span class="n">rc</span> <span class="o">=</span> <span class="n">usb_set_interface</span><span class="p">(</span><span class="n">usbdev</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>

	<span class="cm">/* Check to see next free device and mark as used */</span>
	<span class="n">nr</span> <span class="o">=</span> <span class="n">find_first_zero_bit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tm6000_devused</span><span class="p">,</span> <span class="n">TM6000_MAXBOARDS</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">nr</span> <span class="o">&gt;=</span> <span class="n">TM6000_MAXBOARDS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;tm6000: Supports only %i tm60xx boards.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">TM6000_MAXBOARDS</span><span class="p">);</span>
		<span class="n">usb_put_dev</span><span class="p">(</span><span class="n">usbdev</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Create and initialize dev struct */</span>
	<span class="n">dev</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">dev</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;tm6000&quot;</span> <span class="s">&quot;: out of memory!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">usb_put_dev</span><span class="p">(</span><span class="n">usbdev</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">spin_lock_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">slock</span><span class="p">);</span>
	<span class="n">mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">usb_lock</span><span class="p">);</span>

	<span class="cm">/* Increment usage count */</span>
	<span class="n">set_bit</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tm6000_devused</span><span class="p">);</span>
	<span class="n">snprintf</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="mi">29</span><span class="p">,</span> <span class="s">&quot;tm6000 #%d&quot;</span><span class="p">,</span> <span class="n">nr</span><span class="p">);</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span> <span class="o">=</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">driver_info</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">card</span><span class="p">[</span><span class="n">nr</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">tm6000_boards</span><span class="p">))</span>
		<span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span> <span class="o">=</span> <span class="n">card</span><span class="p">[</span><span class="n">nr</span><span class="p">];</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span> <span class="o">=</span> <span class="n">usbdev</span><span class="p">;</span>
	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">devno</span> <span class="o">=</span> <span class="n">nr</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">usbdev</span><span class="o">-&gt;</span><span class="n">speed</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">USB_SPEED_LOW</span>:
		<span class="n">speed</span> <span class="o">=</span> <span class="s">&quot;1.5&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">USB_SPEED_UNKNOWN</span>:
	<span class="k">case</span> <span class="n">USB_SPEED_FULL</span>:
		<span class="n">speed</span> <span class="o">=</span> <span class="s">&quot;12&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">USB_SPEED_HIGH</span>:
		<span class="n">speed</span> <span class="o">=</span> <span class="s">&quot;480&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">speed</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Get endpoints */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">interface</span><span class="o">-&gt;</span><span class="n">num_altsetting</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">ep</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">ep</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">ep</span> <span class="o">&lt;</span> <span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">desc</span><span class="p">.</span><span class="n">bNumEndpoints</span><span class="p">;</span> <span class="n">ep</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">usb_host_endpoint</span>	<span class="o">*</span><span class="n">e</span><span class="p">;</span>
			<span class="kt">int</span> <span class="n">dir_out</span><span class="p">;</span>

			<span class="n">e</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">endpoint</span><span class="p">[</span><span class="n">ep</span><span class="p">];</span>

			<span class="n">dir_out</span> <span class="o">=</span> <span class="p">((</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">desc</span><span class="p">.</span><span class="n">bEndpointAddress</span> <span class="o">&amp;</span>
					<span class="n">USB_ENDPOINT_DIR_MASK</span><span class="p">)</span> <span class="o">==</span> <span class="n">USB_DIR_OUT</span><span class="p">);</span>

			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;tm6000: alt %d, interface %i, class %i</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">i</span><span class="p">,</span>
			       <span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">desc</span><span class="p">.</span><span class="n">bInterfaceNumber</span><span class="p">,</span>
			       <span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">desc</span><span class="p">.</span><span class="n">bInterfaceClass</span><span class="p">);</span>

			<span class="k">switch</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">desc</span><span class="p">.</span><span class="n">bmAttributes</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">USB_ENDPOINT_XFER_BULK</span>:
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dir_out</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">get_max_endpoint</span><span class="p">(</span><span class="n">usbdev</span><span class="p">,</span>
							 <span class="o">&amp;</span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
							 <span class="s">&quot;Bulk IN&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span>
							 <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bulk_in</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">get_max_endpoint</span><span class="p">(</span><span class="n">usbdev</span><span class="p">,</span>
							 <span class="o">&amp;</span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
							 <span class="s">&quot;Bulk OUT&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span>
							 <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">bulk_out</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">USB_ENDPOINT_XFER_ISOC</span>:
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dir_out</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">get_max_endpoint</span><span class="p">(</span><span class="n">usbdev</span><span class="p">,</span>
							 <span class="o">&amp;</span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
							 <span class="s">&quot;ISOC IN&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span>
							 <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">isoc_in</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">get_max_endpoint</span><span class="p">(</span><span class="n">usbdev</span><span class="p">,</span>
							 <span class="o">&amp;</span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
							 <span class="s">&quot;ISOC OUT&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span>
							 <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">isoc_out</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">USB_ENDPOINT_XFER_INT</span>:
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dir_out</span><span class="p">)</span> <span class="p">{</span>
					<span class="n">get_max_endpoint</span><span class="p">(</span><span class="n">usbdev</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
							<span class="s">&quot;INT IN&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">int_in</span><span class="p">);</span>
				<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
					<span class="n">get_max_endpoint</span><span class="p">(</span><span class="n">usbdev</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
							<span class="s">&quot;INT OUT&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">int_out</span><span class="p">);</span>
				<span class="p">}</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>


	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;tm6000: New video device @ %s Mbps (%04x:%04x, ifnum %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">speed</span><span class="p">,</span>
		<span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idVendor</span><span class="p">),</span>
		<span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">.</span><span class="n">idProduct</span><span class="p">),</span>
		<span class="n">interface</span><span class="o">-&gt;</span><span class="n">altsetting</span><span class="o">-&gt;</span><span class="n">desc</span><span class="p">.</span><span class="n">bInterfaceNumber</span><span class="p">);</span>

<span class="cm">/* check if the the device has the iso in endpoint at the correct place */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">isoc_in</span><span class="p">.</span><span class="n">endp</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;tm6000: probing error: no IN ISOC endpoint!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* save our data pointer in this interface device */</span>
	<span class="n">usb_set_intfdata</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;tm6000: Found %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tm6000_boards</span><span class="p">[</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">tm6000_init_dev</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">err:</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;tm6000: Error %d while registering</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="p">);</span>

	<span class="n">clear_bit</span><span class="p">(</span><span class="n">nr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tm6000_devused</span><span class="p">);</span>
	<span class="n">usb_put_dev</span><span class="p">(</span><span class="n">usbdev</span><span class="p">);</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * tm6000_usb_disconnect()</span>
<span class="cm"> * called when the device gets diconencted</span>
<span class="cm"> * video device will be unregistered on v4l2_close in case it is still open</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">tm6000_usb_disconnect</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">interface</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">tm6000_core</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">usb_get_intfdata</span><span class="p">(</span><span class="n">interface</span><span class="p">);</span>
	<span class="n">usb_set_intfdata</span><span class="p">(</span><span class="n">interface</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dev</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;tm6000: disconnecting %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>

	<span class="n">flush_request_modules</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">tm6000_ir_fini</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">TM6010_BOARD_HAUPPAUGE_900H</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_TERRATEC_CINERGY_HYBRID_XE</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_TWINHAN_TU501</span>:
			<span class="cm">/* Power led off */</span>
			<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
				<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_WANDER_LITE</span>:
		<span class="k">case</span> <span class="n">TM6010_BOARD_BEHOLD_VOYAGER_LITE</span>:
			<span class="cm">/* Power led off */</span>
			<span class="n">tm6000_set_reg</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">REQ_03_SET_GET_MCU_PIN</span><span class="p">,</span>
				<span class="n">dev</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">.</span><span class="n">power_led</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">15</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">tm6000_v4l2_unregister</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">tm6000_i2c_unregister</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">v4l2_device_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">v4l2_dev</span><span class="p">);</span>

	<span class="n">dev</span><span class="o">-&gt;</span><span class="n">state</span> <span class="o">|=</span> <span class="n">DEV_DISCONNECTED</span><span class="p">;</span>

	<span class="n">usb_put_dev</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">udev</span><span class="p">);</span>

	<span class="n">tm6000_close_extension</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">tm6000_remove_from_devlist</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="n">clear_bit</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">devno</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tm6000_devused</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usb_driver</span> <span class="n">tm6000_usb_driver</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;tm6000&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">tm6000_usb_probe</span><span class="p">,</span>
		<span class="p">.</span><span class="n">disconnect</span> <span class="o">=</span> <span class="n">tm6000_usb_disconnect</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">tm6000_id_table</span><span class="p">,</span>
<span class="p">};</span>

<span class="n">module_usb_driver</span><span class="p">(</span><span class="n">tm6000_usb_driver</span><span class="p">);</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Trident TVMaster TM5600/TM6000/TM6010 USB2 adapter&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Mauro Carvalho Chehab&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
