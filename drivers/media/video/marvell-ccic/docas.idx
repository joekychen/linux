f | mcam-core.c | s | 46K | 1636 | Guennadi Liakhovetski | g.liakhovetski@gmx.de | 1337082723 |  | [media] V4L: marvell-ccic: (cosmetic) remove redundant variable assignment  The "ret = 0" assignment in mcam_vidioc_s_fmt_vid_cap() is redundant, because at that location "ret" is anyway guaranteed to be == 0.  Signed-off-by: Guennadi Liakhovetski <g.liakhovetski@gmx.de> Acked-by: Jonathan Corbet <corbet@lwn.net> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | cafe-driver.c | s | 17K | 560 | Jonathan Corbet | corbet@lwn.net | 1311799991 |  | [media] marvell-cam: implement contiguous DMA operation  The core driver can now operate in either vmalloc or dma-contig modes; obviously the latter is preferable when it is supported.  Default is currently vmalloc on all platforms; load the module with buffer_mode=1 for contiguous DMA mode.  Signed-off-by: Jonathan Corbet <corbet@lwn.net> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | mcam-core.h | s | 9.9K | 280 | Jonathan Corbet | corbet@lwn.net | 1332206129 |  | [media] marvell-cam: Remove broken "owner" logic  The marvell cam driver retained just enough of the owner-tracking logic from cafe_ccic to be broken; it could, conceivably, cause the driver to release DMA memory while the controller is still active.  Simply remove the remaining pieces and ensure that the controller is stopped before we free things.  Signed-off-by: Jonathan Corbet <corbet@lwn.net> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | Makefile | g | 176B |  | Jonathan Corbet | corbet@lwn.net | 1311799981 |  | [media] marvell-cam: Basic working MMP camera driver  Now we have a camera working over the marvell cam controller core.  It works like the cafe driver and has all the same limitations, contiguous DMA only being one of them.  But it's a start.  Signed-off-by: Jonathan Corbet <corbet@lwn.net> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | mmp-driver.c | s | 8.9K | 337 | Jonathan Corbet | corbet@lwn.net | 1335465054 |  | [media] marvell-cam: fix an ARM build error  One of the OLPC changes lost a little in its translation to mainline, leading to build errors on the ARM architecture.  Remove the offending line, and all will be well.  Reported-by: Mathieu Poirier <mathieu.poirier@linaro.org> Cc: stable@vger.kernel.org Signed-off-by: Jonathan Corbet <corbet@lwn.net> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | Kconfig | g | 794B |  | Jonathan Corbet | corbet@lwn.net | 1311800154 |  | [media] marvell-cam: Allow selection of supported buffer modes  The Marvell camera core can support all three videobuf2 buffer modes, which is slick, but it also requires that all three modes be built and present, even though only one is likely to be used.  This patch allows the supported modes to be selected at configuration time, reducing the footprint of the driver.  Prior to this patch, the MMP camera driver looked like this:  mmp_camera             19092  0 videobuf2_core         15542  1 mmp_camera videobuf2_dma_sg        3173  1 mmp_camera videobuf2_dma_contig     2188  1 mmp_camera videobuf2_vmalloc       1718  1 mmp_camera videobuf2_memops        2100  3 videobuf2_dma_sg,videobuf2_dma_contig,videobuf2_vmalloc  Afterward, instead, with scatter/gather only configured:  mmp_camera             16021  0 videobuf2_core         15542  1 mmp_camera videobuf2_dma_sg        3173  1 mmp_camera videobuf2_memops        2100  1 videobuf2_dma_sg  The total goes from 43,813 bytes to 36,836.  The emphasis has been on simplicity and minimal #ifdef use rather than on squeezing out every possible byte of code.  For configuration, the driver simply looks at which videobuf2 modes have been configured in and supports them all; it's simplistic but should be good enough.  The cafe driver is set to support vmalloc and dma-contig; mmp supports only dma-sg, since that's the only mode that really makes sense to use.  Signed-off-by: Jonathan Corbet <corbet@lwn.net> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
