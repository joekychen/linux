<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › cx2341x.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>cx2341x.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * cx2341x - generic code for cx23415/6/8 based devices</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2006 Hans Verkuil &lt;hverkuil@xs4all.nl&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>


<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/videodev2.h&gt;</span>

<span class="cp">#include &lt;media/tuner.h&gt;</span>
<span class="cp">#include &lt;media/cx2341x.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-common.h&gt;</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;cx23415/6/8 driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Hans Verkuil&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">debug</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="s">&quot;Debug level (0-1)&quot;</span><span class="p">);</span>

<span class="cm">/********************** COMMON CODE *********************/</span>

<span class="cm">/* definitions for audio properties bits 29-28 */</span>
<span class="cp">#define CX2341X_AUDIO_ENCODING_METHOD_MPEG	0</span>
<span class="cp">#define CX2341X_AUDIO_ENCODING_METHOD_AC3	1</span>
<span class="cp">#define CX2341X_AUDIO_ENCODING_METHOD_LPCM	2</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">cx2341x_get_name</span><span class="p">(</span><span class="n">u32</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
		<span class="k">return</span> <span class="s">&quot;Spatial Filter Mode&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span>:
		<span class="k">return</span> <span class="s">&quot;Spatial Filter&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
		<span class="k">return</span> <span class="s">&quot;Spatial Luma Filter Type&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span>:
		<span class="k">return</span> <span class="s">&quot;Spatial Chroma Filter Type&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
		<span class="k">return</span> <span class="s">&quot;Temporal Filter Mode&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER</span>:
		<span class="k">return</span> <span class="s">&quot;Temporal Filter&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
		<span class="k">return</span> <span class="s">&quot;Median Filter Type&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span>:
		<span class="k">return</span> <span class="s">&quot;Median Luma Filter Maximum&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="k">return</span> <span class="s">&quot;Median Luma Filter Minimum&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_TOP</span>:
		<span class="k">return</span> <span class="s">&quot;Median Chroma Filter Maximum&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="k">return</span> <span class="s">&quot;Median Chroma Filter Minimum&quot;</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span>:
		<span class="k">return</span> <span class="s">&quot;Insert Navigation Packets&quot;</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="nf">cx2341x_get_menu</span><span class="p">(</span><span class="n">u32</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cx2341x_video_spatial_filter_mode_menu</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Manual&quot;</span><span class="p">,</span>
		<span class="s">&quot;Auto&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cx2341x_video_luma_spatial_filter_type_menu</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Off&quot;</span><span class="p">,</span>
		<span class="s">&quot;1D Horizontal&quot;</span><span class="p">,</span>
		<span class="s">&quot;1D Vertical&quot;</span><span class="p">,</span>
		<span class="s">&quot;2D H/V Separable&quot;</span><span class="p">,</span>
		<span class="s">&quot;2D Symmetric non-separable&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cx2341x_video_chroma_spatial_filter_type_menu</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Off&quot;</span><span class="p">,</span>
		<span class="s">&quot;1D Horizontal&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cx2341x_video_temporal_filter_mode_menu</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Manual&quot;</span><span class="p">,</span>
		<span class="s">&quot;Auto&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">cx2341x_video_median_filter_type_menu</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;Off&quot;</span><span class="p">,</span>
		<span class="s">&quot;Horizontal&quot;</span><span class="p">,</span>
		<span class="s">&quot;Vertical&quot;</span><span class="p">,</span>
		<span class="s">&quot;Horizontal/Vertical&quot;</span><span class="p">,</span>
		<span class="s">&quot;Diagonal&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
		<span class="k">return</span> <span class="n">cx2341x_video_spatial_filter_mode_menu</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
		<span class="k">return</span> <span class="n">cx2341x_video_luma_spatial_filter_type_menu</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span>:
		<span class="k">return</span> <span class="n">cx2341x_video_chroma_spatial_filter_type_menu</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
		<span class="k">return</span> <span class="n">cx2341x_video_temporal_filter_mode_menu</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
		<span class="k">return</span> <span class="n">cx2341x_video_median_filter_type_menu</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx2341x_ctrl_fill</span><span class="p">(</span><span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">**</span><span class="n">name</span><span class="p">,</span> <span class="k">enum</span> <span class="n">v4l2_ctrl_type</span> <span class="o">*</span><span class="n">type</span><span class="p">,</span>
		    <span class="n">s32</span> <span class="o">*</span><span class="n">min</span><span class="p">,</span> <span class="n">s32</span> <span class="o">*</span><span class="n">max</span><span class="p">,</span> <span class="n">s32</span> <span class="o">*</span><span class="n">step</span><span class="p">,</span> <span class="n">s32</span> <span class="o">*</span><span class="n">def</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="n">name</span> <span class="o">=</span> <span class="n">cx2341x_get_name</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
	<span class="o">*</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
		<span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_MENU</span><span class="p">;</span>
		<span class="o">*</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="o">*</span><span class="n">step</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span>:
		<span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_BOOLEAN</span><span class="p">;</span>
		<span class="o">*</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="o">*</span><span class="n">max</span> <span class="o">=</span> <span class="o">*</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="o">*</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
		<span class="o">*</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_UPDATE</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_BOTTOM</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_TOP</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="o">*</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_SLIDER</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_ENCODING</span>:
		<span class="o">*</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_READ_ONLY</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>


<span class="cm">/********************** OLD CODE *********************/</span>

<span class="cm">/* Must be sorted from low to high control ID! */</span>
<span class="k">const</span> <span class="n">u32</span> <span class="n">cx2341x_mpeg_ctrls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">V4L2_CID_MPEG_CLASS</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_STREAM_TYPE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_STREAM_VBI_FMT</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_SAMPLING_FREQ</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_ENCODING</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_L2_BITRATE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_MODE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_MODE_EXTENSION</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_EMPHASIS</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_CRC</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_MUTE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_AUDIO_AC3_BITRATE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_ENCODING</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_ASPECT</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_B_FRAMES</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_GOP_SIZE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_GOP_CLOSURE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_MODE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_BITRATE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_PEAK</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_TEMPORAL_DECIMATION</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_MUTE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_VIDEO_MUTE_YUV</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_BOTTOM</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_BOTTOM</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_TOP</span><span class="p">,</span>
	<span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span><span class="p">,</span>
	<span class="mi">0</span>
<span class="p">};</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_mpeg_ctrls</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="n">default_params</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* misc */</span>
	<span class="p">.</span><span class="n">capabilities</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">CX2341X_PORT_MEMORY</span><span class="p">,</span>
	<span class="p">.</span><span class="n">width</span> <span class="o">=</span> <span class="mi">720</span><span class="p">,</span>
	<span class="p">.</span><span class="n">height</span> <span class="o">=</span> <span class="mi">480</span><span class="p">,</span>
	<span class="p">.</span><span class="n">is_50hz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="cm">/* stream */</span>
	<span class="p">.</span><span class="n">stream_type</span> <span class="o">=</span> <span class="n">V4L2_MPEG_STREAM_TYPE_MPEG2_PS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stream_vbi_fmt</span> <span class="o">=</span> <span class="n">V4L2_MPEG_STREAM_VBI_FMT_NONE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stream_insert_nav_packets</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="cm">/* audio */</span>
	<span class="p">.</span><span class="n">audio_sampling_freq</span> <span class="o">=</span> <span class="n">V4L2_MPEG_AUDIO_SAMPLING_FREQ_48000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio_encoding</span> <span class="o">=</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio_l2_bitrate</span> <span class="o">=</span> <span class="n">V4L2_MPEG_AUDIO_L2_BITRATE_224K</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio_ac3_bitrate</span> <span class="o">=</span> <span class="n">V4L2_MPEG_AUDIO_AC3_BITRATE_224K</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio_mode</span> <span class="o">=</span> <span class="n">V4L2_MPEG_AUDIO_MODE_STEREO</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio_mode_extension</span> <span class="o">=</span> <span class="n">V4L2_MPEG_AUDIO_MODE_EXTENSION_BOUND_4</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio_emphasis</span> <span class="o">=</span> <span class="n">V4L2_MPEG_AUDIO_EMPHASIS_NONE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio_crc</span> <span class="o">=</span> <span class="n">V4L2_MPEG_AUDIO_CRC_NONE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">audio_mute</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="cm">/* video */</span>
	<span class="p">.</span><span class="n">video_encoding</span> <span class="o">=</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_aspect</span> <span class="o">=</span> <span class="n">V4L2_MPEG_VIDEO_ASPECT_4x3</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_b_frames</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_gop_size</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_gop_closure</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_bitrate_mode</span> <span class="o">=</span> <span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_VBR</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_bitrate</span> <span class="o">=</span> <span class="mi">6000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_bitrate_peak</span> <span class="o">=</span> <span class="mi">8000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_temporal_decimation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_mute</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_mute_yuv</span> <span class="o">=</span> <span class="mh">0x008080</span><span class="p">,</span>  <span class="cm">/* YCbCr value for black */</span>

	<span class="cm">/* encoding filters */</span>
	<span class="p">.</span><span class="n">video_spatial_filter_mode</span> <span class="o">=</span>
		<span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_MANUAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_spatial_filter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_luma_spatial_filter_type</span> <span class="o">=</span>
		<span class="n">V4L2_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE_1D_HOR</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_chroma_spatial_filter_type</span> <span class="o">=</span>
		<span class="n">V4L2_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE_1D_HOR</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_temporal_filter_mode</span> <span class="o">=</span>
		<span class="n">V4L2_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE_MANUAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_temporal_filter</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_median_filter_type</span> <span class="o">=</span>
		<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_luma_median_filter_top</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_luma_median_filter_bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_chroma_median_filter_top</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
	<span class="p">.</span><span class="n">video_chroma_median_filter_bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>
<span class="cm">/* Map the control ID to the correct field in the cx2341x_mpeg_params</span>
<span class="cm">   struct. Return -EINVAL if the ID is unknown, else return 0. */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx2341x_get_ctrl</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">v4l2_ext_control</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_SAMPLING_FREQ</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_ENCODING</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_encoding</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_L2_BITRATE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_l2_bitrate</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_AC3_BITRATE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_ac3_bitrate</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MODE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mode</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MODE_EXTENSION</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mode_extension</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_EMPHASIS</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_emphasis</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_CRC</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_crc</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MUTE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mute</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_ENCODING</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_encoding</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_ASPECT</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_aspect</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_B_FRAMES</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_b_frames</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_GOP_SIZE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_GOP_CLOSURE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_closure</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_MODE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_PEAK</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_TEMPORAL_DECIMATION</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_temporal_decimation</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_MUTE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_mute</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_MUTE_YUV</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_mute_yuv</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_TYPE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">stream_type</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_VBI_FMT</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">stream_vbi_fmt</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_spatial_filter</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_luma_spatial_filter_type</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_chroma_spatial_filter_type</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_temporal_filter_mode</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_temporal_filter</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_top</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_bottom</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_TOP</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_top</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_bottom</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span>:
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">stream_insert_nav_packets</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Map the control ID to the correct field in the cx2341x_mpeg_params</span>
<span class="cm">   struct. Return -EINVAL if the ID is unknown, else return 0. */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx2341x_set_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="kt">int</span> <span class="n">busy</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">v4l2_ext_control</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_SAMPLING_FREQ</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">busy</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_ENCODING</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">busy</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_AC3</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">!=</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span> <span class="o">&amp;&amp;</span>
			    <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">!=</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_AC3</span><span class="p">)</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">ERANGE</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_encoding</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_L2_BITRATE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">busy</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_l2_bitrate</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_AC3_BITRATE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">busy</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_AC3</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_ac3_bitrate</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MODE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mode</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MODE_EXTENSION</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mode_extension</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_EMPHASIS</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_emphasis</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_CRC</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_crc</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MUTE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mute</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_ASPECT</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_aspect</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_B_FRAMES</span>: <span class="p">{</span>
		<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">gop</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_b_frames</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="p">((</span><span class="n">gop</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">);</span>
		<span class="cm">/* Max GOP size = 34 */</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span> <span class="o">&gt;</span> <span class="mi">34</span><span class="p">)</span>
			<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_GOP_SIZE</span>: <span class="p">{</span>
		<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_b_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">gop</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="p">((</span><span class="n">gop</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">);</span>
		<span class="cm">/* Max GOP size = 34 */</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span> <span class="o">&gt;</span> <span class="mi">34</span><span class="p">)</span>
			<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span>
		<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_GOP_CLOSURE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_gop_closure</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_MODE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">busy</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="cm">/* MPEG-1 only allows CBR */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_encoding</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span> <span class="o">&amp;&amp;</span>
		    <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">!=</span> <span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_CBR</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">busy</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_PEAK</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">busy</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_TEMPORAL_DECIMATION</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_temporal_decimation</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_MUTE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_mute</span> <span class="o">=</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_MUTE_YUV</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_mute_yuv</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_TYPE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">busy</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">stream_type</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_encoding</span> <span class="o">=</span>
		    <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">stream_type</span> <span class="o">==</span> <span class="n">V4L2_MPEG_STREAM_TYPE_MPEG1_SS</span> <span class="o">||</span>
		     <span class="n">params</span><span class="o">-&gt;</span><span class="n">stream_type</span> <span class="o">==</span> <span class="n">V4L2_MPEG_STREAM_TYPE_MPEG1_VCD</span><span class="p">)</span> <span class="o">?</span>
			<span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span> <span class="o">:</span>
			<span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_2</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_encoding</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span><span class="p">)</span>
			<span class="cm">/* MPEG-1 implies CBR */</span>
			<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span> <span class="o">=</span>
				<span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_CBR</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_VBI_FMT</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">stream_vbi_fmt</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_spatial_filter</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_luma_spatial_filter_type</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_chroma_spatial_filter_type</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_temporal_filter_mode</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_temporal_filter</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_top</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_bottom</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_TOP</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_top</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_bottom</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span>:
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">stream_insert_nav_packets</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="o">*</span><span class="n">qctrl</span><span class="p">,</span>
				   <span class="n">s32</span> <span class="n">min</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span> <span class="n">s32</span> <span class="n">step</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="cm">/* MPEG controls */</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_BOTTOM</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_TOP</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_BOTTOM</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span>:
		<span class="n">cx2341x_ctrl_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">max</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">step</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">def</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">);</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">min</span><span class="p">;</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">max</span><span class="p">;</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">;</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">def</span><span class="p">;</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">reserved</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">reserved</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">strlcpy</span><span class="p">(</span><span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">def</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">cx2341x_ctrl_query</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span>
		       <span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="o">*</span><span class="n">qctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CLASS</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_TYPE</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_STREAM_TYPE_MPEG2_PS</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_STREAM_TYPE_MPEG2_SVCD</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_STREAM_TYPE_MPEG2_PS</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_VBI_FMT</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_SLICED_VBI</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
					<span class="n">V4L2_MPEG_STREAM_VBI_FMT_NONE</span><span class="p">,</span>
					<span class="n">V4L2_MPEG_STREAM_VBI_FMT_IVTV</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
					<span class="n">V4L2_MPEG_STREAM_VBI_FMT_NONE</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_STREAM_VBI_FMT_NONE</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_STREAM_VBI_FMT_NONE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">stream_vbi_fmt</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_SAMPLING_FREQ</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_SAMPLING_FREQ_44100</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_SAMPLING_FREQ_32000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_SAMPLING_FREQ_48000</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_ENCODING</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_AC3</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/*</span>
<span class="cm">			 * The state of L2 &amp; AC3 bitrate controls can change</span>
<span class="cm">			 * when this control changes, but v4l2_ctrl_query_fill()</span>
<span class="cm">			 * already sets V4L2_CTRL_FLAG_UPDATE for</span>
<span class="cm">			 * V4L2_CID_MPEG_AUDIO_ENCODING, so we don&#39;t here.</span>
<span class="cm">			 */</span>
			<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
					<span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span><span class="p">,</span>
					<span class="n">V4L2_MPEG_AUDIO_ENCODING_AC3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
					<span class="n">default_params</span><span class="p">.</span><span class="n">audio_encoding</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">audio_encoding</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_L2_BITRATE</span>:
		<span class="n">err</span> <span class="o">=</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_L2_BITRATE_192K</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_L2_BITRATE_384K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">audio_l2_bitrate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_AC3</span> <span class="o">&amp;&amp;</span>
		    <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_encoding</span> <span class="o">!=</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MODE</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_MODE_STEREO</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_MODE_MONO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_MODE_STEREO</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MODE_EXTENSION</span>:
		<span class="n">err</span> <span class="o">=</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_MODE_EXTENSION_BOUND_4</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_MODE_EXTENSION_BOUND_16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_MODE_EXTENSION_BOUND_4</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		    <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mode</span> <span class="o">!=</span> <span class="n">V4L2_MPEG_AUDIO_MODE_JOINT_STEREO</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_EMPHASIS</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_EMPHASIS_NONE</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_EMPHASIS_CCITT_J17</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_EMPHASIS_NONE</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_CRC</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_CRC_NONE</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_CRC_CRC16</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_CRC_NONE</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MUTE</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_AC3_BITRATE</span>:
		<span class="n">err</span> <span class="o">=</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_AC3_BITRATE_48K</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_AC3_BITRATE_448K</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">audio_ac3_bitrate</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_AC3</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_encoding</span> <span class="o">!=</span>
						   <span class="n">V4L2_MPEG_AUDIO_ENCODING_AC3</span><span class="p">)</span>
				<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_DISABLED</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_ENCODING</span>:
		<span class="cm">/* this setting is read-only for the cx2341x since the</span>
<span class="cm">		   V4L2_CID_MPEG_STREAM_TYPE really determines the</span>
<span class="cm">		   MPEG-1/2 setting */</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
					   <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span><span class="p">,</span>
					   <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
					   <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_READ_ONLY</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_ASPECT</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_VIDEO_ASPECT_1x1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_VIDEO_ASPECT_221x100</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_VIDEO_ASPECT_4x3</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_B_FRAMES</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_GOP_SIZE</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">params</span><span class="o">-&gt;</span><span class="n">is_50hz</span> <span class="o">?</span> <span class="mi">12</span> <span class="o">:</span> <span class="mi">15</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_GOP_CLOSURE</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_MODE</span>:
		<span class="n">err</span> <span class="o">=</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_VBR</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_CBR</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_VBR</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		    <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_encoding</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">27000000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6000000</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_PEAK</span>:
		<span class="n">err</span> <span class="o">=</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">27000000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8000000</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		    <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span> <span class="o">==</span>
				<span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_CBR</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_TEMPORAL_DECIMATION</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_MUTE</span>:
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_MUTE_YUV</span>:  <span class="cm">/* Init YUV (really YCbCr) to black */</span>
		<span class="k">return</span> <span class="n">v4l2_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x008080</span><span class="p">);</span>

	<span class="cm">/* CX23415/6 specific */</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
		<span class="k">return</span> <span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_MANUAL</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_AUTO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">default_params</span><span class="p">.</span><span class="n">video_spatial_filter_mode</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span>:
		<span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">video_spatial_filter</span><span class="p">);</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_SLIDER</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span> <span class="o">==</span>
			    <span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_AUTO</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
		<span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE_OFF</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE_2D_SYM_NON_SEPARABLE</span><span class="p">,</span>
			<span class="mi">1</span><span class="p">,</span>
			<span class="n">default_params</span><span class="p">.</span><span class="n">video_luma_spatial_filter_type</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span> <span class="o">==</span>
			    <span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_AUTO</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span>:
		<span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
		    <span class="n">V4L2_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE_OFF</span><span class="p">,</span>
		    <span class="n">V4L2_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE_1D_HOR</span><span class="p">,</span>
		    <span class="mi">1</span><span class="p">,</span>
		    <span class="n">default_params</span><span class="p">.</span><span class="n">video_chroma_spatial_filter_type</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span> <span class="o">==</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_AUTO</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
		<span class="k">return</span> <span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE_MANUAL</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE_AUTO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">default_params</span><span class="p">.</span><span class="n">video_temporal_filter_mode</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER</span>:
		<span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">video_temporal_filter</span><span class="p">);</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_SLIDER</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_temporal_filter_mode</span> <span class="o">==</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE_AUTO</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
		<span class="k">return</span> <span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_DIAG</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">default_params</span><span class="p">.</span><span class="n">video_median_filter_type</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span>:
		<span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">video_luma_median_filter_top</span><span class="p">);</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_SLIDER</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span> <span class="o">==</span>
				<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">video_luma_median_filter_bottom</span><span class="p">);</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_SLIDER</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span> <span class="o">==</span>
				<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_TOP</span>:
		<span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">video_chroma_median_filter_top</span><span class="p">);</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_SLIDER</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span> <span class="o">==</span>
				<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_BOTTOM</span>:
		<span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
			<span class="n">default_params</span><span class="p">.</span><span class="n">video_chroma_median_filter_bottom</span><span class="p">);</span>
		<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_SLIDER</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span> <span class="o">==</span>
				<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">)</span>
			<span class="n">qctrl</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">|=</span> <span class="n">V4L2_CTRL_FLAG_INACTIVE</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span>:
		<span class="k">return</span> <span class="n">cx2341x_ctrl_query_fill</span><span class="p">(</span><span class="n">qctrl</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">default_params</span><span class="p">.</span><span class="n">stream_insert_nav_packets</span><span class="p">);</span>

	<span class="nl">default:</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="p">}</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_ctrl_query</span><span class="p">);</span>

<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="nf">cx2341x_ctrl_get_menu</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">u32</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="n">mpeg_stream_type_without_ts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;MPEG-2 Program Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-1 System Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-2 DVD-compatible Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-1 VCD-compatible Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-2 SVCD-compatible Stream&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mpeg_stream_type_with_ts</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;MPEG-2 Program Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-2 Transport Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-1 System Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-2 DVD-compatible Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-1 VCD-compatible Stream&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-2 SVCD-compatible Stream&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mpeg_audio_encoding_l2_ac3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="s">&quot;MPEG-1/2 Layer II&quot;</span><span class="p">,</span>
		<span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="s">&quot;&quot;</span><span class="p">,</span>
		<span class="s">&quot;AC-3&quot;</span><span class="p">,</span>
		<span class="nb">NULL</span>
	<span class="p">};</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_TYPE</span>:
		<span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_TS</span><span class="p">)</span> <span class="o">?</span>
			<span class="n">mpeg_stream_type_with_ts</span> <span class="o">:</span> <span class="n">mpeg_stream_type_without_ts</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_ENCODING</span>:
		<span class="k">return</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_AC3</span><span class="p">)</span> <span class="o">?</span>
			<span class="n">mpeg_audio_encoding_l2_ac3</span> <span class="o">:</span> <span class="n">v4l2_ctrl_get_menu</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_L1_BITRATE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_L3_BITRATE</span>:
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span>:
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span>:
		<span class="k">return</span> <span class="n">cx2341x_get_menu</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="n">v4l2_ctrl_get_menu</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_ctrl_get_menu</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx2341x_calc_audio_properties</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">params</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_properties</span> <span class="o">=</span>
		<span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mode</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_mode_extension</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(((</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_emphasis</span> <span class="o">==</span> <span class="n">V4L2_MPEG_AUDIO_EMPHASIS_CCITT_J17</span><span class="p">)</span>
		  <span class="o">?</span> <span class="mi">3</span> <span class="o">:</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_emphasis</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_crc</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">capabilities</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_AC3</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
	    <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_encoding</span> <span class="o">==</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_AC3</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_properties</span> <span class="o">|=</span>
			<span class="cm">/* Not sure if this MPEG Layer II setting is required */</span>
			<span class="p">((</span><span class="mi">3</span> <span class="o">-</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_ac3_bitrate</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="n">CX2341X_AUDIO_ENCODING_METHOD_AC3</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Assuming MPEG Layer II */</span>
		<span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_properties</span> <span class="o">|=</span>
			<span class="p">((</span><span class="mi">3</span> <span class="o">-</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_encoding</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">audio_l2_bitrate</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">cx2341x_ext_ctrls</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">params</span><span class="p">,</span> <span class="kt">int</span> <span class="n">busy</span><span class="p">,</span>
		  <span class="k">struct</span> <span class="n">v4l2_ext_controls</span> <span class="o">*</span><span class="n">ctrls</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cmd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">cmd</span> <span class="o">==</span> <span class="n">VIDIOC_G_EXT_CTRLS</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ctrls</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">v4l2_ext_control</span> <span class="o">*</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">ctrls</span><span class="o">-&gt;</span><span class="n">controls</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>

			<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_get_ctrl</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">ctrls</span><span class="o">-&gt;</span><span class="n">error_idx</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ctrls</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">v4l2_ext_control</span> <span class="o">*</span><span class="n">ctrl</span> <span class="o">=</span> <span class="n">ctrls</span><span class="o">-&gt;</span><span class="n">controls</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="n">qctrl</span><span class="p">;</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">menu_items</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="n">qctrl</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_query</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qctrl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">qctrl</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">V4L2_CTRL_TYPE_MENU</span><span class="p">)</span>
			<span class="n">menu_items</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_get_menu</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">qctrl</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">v4l2_ctrl_check</span><span class="p">(</span><span class="n">ctrl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">qctrl</span><span class="p">,</span> <span class="n">menu_items</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_set_ctrl</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">busy</span><span class="p">,</span> <span class="n">ctrl</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
	    <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_VBR</span> <span class="o">&amp;&amp;</span>
	    <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span> <span class="o">&lt;</span> <span class="n">params</span><span class="o">-&gt;</span><span class="n">video_bitrate</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="o">-</span><span class="n">ERANGE</span><span class="p">;</span>
		<span class="n">ctrls</span><span class="o">-&gt;</span><span class="n">error_idx</span> <span class="o">=</span> <span class="n">ctrls</span><span class="o">-&gt;</span><span class="n">count</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="n">ctrls</span><span class="o">-&gt;</span><span class="n">error_idx</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">cx2341x_calc_audio_properties</span><span class="p">(</span><span class="n">params</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_ext_ctrls</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">cx2341x_fill_defaults</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
	<span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">default_params</span><span class="p">;</span>
	<span class="n">cx2341x_calc_audio_properties</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_fill_defaults</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx2341x_api</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">cx2341x_mbox_func</span> <span class="n">func</span><span class="p">,</span>
		       <span class="n">u32</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">args</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">[</span><span class="n">CX2341X_MBOX_MAX_DATA</span><span class="p">];</span>
	<span class="kt">va_list</span> <span class="n">vargs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">va_start</span><span class="p">(</span><span class="n">vargs</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">va_arg</span><span class="p">(</span><span class="n">vargs</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="n">va_end</span><span class="p">(</span><span class="n">vargs</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define NEQ(field) (old-&gt;field != new-&gt;field)</span>

<span class="kt">int</span> <span class="nf">cx2341x_update</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="n">cx2341x_mbox_func</span> <span class="n">func</span><span class="p">,</span>
		   <span class="k">const</span> <span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">old</span><span class="p">,</span>
		   <span class="k">const</span> <span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">new</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">int</span> <span class="n">mpeg_stream_type</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* MPEG-2 PS */</span>
		<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* MPEG-2 TS */</span>
		<span class="mi">2</span><span class="p">,</span>	<span class="cm">/* MPEG-1 SS */</span>
		<span class="mi">14</span><span class="p">,</span>	<span class="cm">/* DVD */</span>
		<span class="mi">11</span><span class="p">,</span>	<span class="cm">/* VCD */</span>
		<span class="mi">12</span><span class="p">,</span>	<span class="cm">/* SVCD */</span>
	<span class="p">};</span>

	<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">force</span> <span class="o">=</span> <span class="p">(</span><span class="n">old</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="n">u16</span> <span class="n">temporal</span> <span class="o">=</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_temporal_filter</span><span class="p">;</span>

	<span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_OUTPUT_PORT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">port</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">is_50hz</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_FRAME_RATE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				  <span class="n">new</span><span class="o">-&gt;</span><span class="n">is_50hz</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_encoding</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">u16</span> <span class="n">w</span> <span class="o">=</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">;</span>
		<span class="n">u16</span> <span class="n">h</span> <span class="o">=</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">new</span><span class="o">-&gt;</span><span class="n">video_encoding</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">w</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">h</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_FRAME_SIZE</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
				  <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">stream_type</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_STREAM_TYPE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				  <span class="n">mpeg_stream_type</span><span class="p">[</span><span class="n">new</span><span class="o">-&gt;</span><span class="n">stream_type</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_aspect</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_ASPECT_RATIO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				  <span class="mi">1</span> <span class="o">+</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_aspect</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_b_frames</span><span class="p">)</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_gop_size</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_GOP_PROPERTIES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_b_frames</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_gop_closure</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_GOP_CLOSURE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				  <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_gop_closure</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">audio_properties</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_AUDIO_PROPERTIES</span><span class="p">,</span>
				  <span class="mi">1</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">audio_properties</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">audio_mute</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_MUTE_AUDIO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				  <span class="n">new</span><span class="o">-&gt;</span><span class="n">audio_mute</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_bitrate_mode</span><span class="p">)</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_bitrate</span><span class="p">)</span> <span class="o">||</span>
						<span class="n">NEQ</span><span class="p">(</span><span class="n">video_bitrate_peak</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_BIT_RATE</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_bitrate</span><span class="p">,</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span> <span class="o">/</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_spatial_filter_mode</span><span class="p">)</span> <span class="o">||</span>
		     <span class="n">NEQ</span><span class="p">(</span><span class="n">video_temporal_filter_mode</span><span class="p">)</span> <span class="o">||</span>
		     <span class="n">NEQ</span><span class="p">(</span><span class="n">video_median_filter_type</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_DNR_FILTER_MODE</span><span class="p">,</span>
				  <span class="mi">2</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span> <span class="o">|</span>
					<span class="p">(</span><span class="n">new</span><span class="o">-&gt;</span><span class="n">video_temporal_filter_mode</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_luma_median_filter_bottom</span><span class="p">)</span> <span class="o">||</span>
		     <span class="n">NEQ</span><span class="p">(</span><span class="n">video_luma_median_filter_top</span><span class="p">)</span> <span class="o">||</span>
		     <span class="n">NEQ</span><span class="p">(</span><span class="n">video_chroma_median_filter_bottom</span><span class="p">)</span> <span class="o">||</span>
		     <span class="n">NEQ</span><span class="p">(</span><span class="n">video_chroma_median_filter_top</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_CORING_LEVELS</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_bottom</span><span class="p">,</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_top</span><span class="p">,</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_bottom</span><span class="p">,</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_top</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_luma_spatial_filter_type</span><span class="p">)</span> <span class="o">||</span>
		     <span class="n">NEQ</span><span class="p">(</span><span class="n">video_chroma_spatial_filter_type</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
				  <span class="n">CX2341X_ENC_SET_SPATIAL_FILTER_TYPE</span><span class="p">,</span>
				  <span class="mi">2</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_luma_spatial_filter_type</span><span class="p">,</span>
				  <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_chroma_spatial_filter_type</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_spatial_filter</span><span class="p">)</span> <span class="o">||</span>
		     <span class="n">old</span><span class="o">-&gt;</span><span class="n">video_temporal_filter</span> <span class="o">!=</span> <span class="n">temporal</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_DNR_FILTER_PROPS</span><span class="p">,</span>
				  <span class="mi">2</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_spatial_filter</span><span class="p">,</span> <span class="n">temporal</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_temporal_decimation</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_FRAME_DROP_RATE</span><span class="p">,</span>
				  <span class="mi">1</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">video_temporal_decimation</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_mute</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">new</span><span class="o">-&gt;</span><span class="n">video_mute</span> <span class="o">&amp;&amp;</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">video_mute_yuv</span><span class="p">)))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_MUTE_VIDEO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">new</span><span class="o">-&gt;</span><span class="n">video_mute</span> <span class="o">|</span> <span class="p">(</span><span class="n">new</span><span class="o">-&gt;</span><span class="n">video_mute_yuv</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">force</span> <span class="o">||</span> <span class="n">NEQ</span><span class="p">(</span><span class="n">stream_insert_nav_packets</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_api</span><span class="p">(</span><span class="n">priv</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">CX2341X_ENC_MISC</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
				<span class="mi">7</span><span class="p">,</span> <span class="n">new</span><span class="o">-&gt;</span><span class="n">stream_insert_nav_packets</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span> <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_update</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">cx2341x_menu_item</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="n">u32</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span> <span class="k">const</span> <span class="o">*</span><span class="n">menu</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_get_menu</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">v4l2_ext_control</span> <span class="n">ctrl</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">menu</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">invalid</span><span class="p">;</span>
	<span class="n">ctrl</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cx2341x_get_ctrl</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctrl</span><span class="p">))</span>
		<span class="k">goto</span> <span class="n">invalid</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">ctrl</span><span class="p">.</span><span class="n">value</span><span class="o">--</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span> <span class="n">menu</span><span class="o">++</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">menu</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">invalid</span><span class="p">;</span>
	<span class="k">return</span> <span class="o">*</span><span class="n">menu</span><span class="p">;</span>

<span class="nl">invalid:</span>
	<span class="k">return</span> <span class="s">&quot;&lt;invalid&gt;&quot;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">cx2341x_log_status</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="o">*</span><span class="n">p</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">prefix</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">is_mpeg1</span> <span class="o">=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">video_encoding</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span><span class="p">;</span>

	<span class="cm">/* Stream */</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: Stream: %s&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_STREAM_TYPE</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">stream_insert_nav_packets</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot; (with navigation packets)&quot;</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: VBI Format: %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_STREAM_VBI_FMT</span><span class="p">));</span>

	<span class="cm">/* Video */</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: Video:  %dx%d, %d fps%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">/</span> <span class="p">(</span><span class="n">is_mpeg1</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">),</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">/</span> <span class="p">(</span><span class="n">is_mpeg1</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">1</span><span class="p">),</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">is_50hz</span> <span class="o">?</span> <span class="mi">25</span> <span class="o">:</span> <span class="mi">30</span><span class="p">,</span>
		<span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">video_mute</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot; (muted)&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: Video:  %s, %s, %s, %d&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_VIDEO_ENCODING</span><span class="p">),</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_VIDEO_ASPECT</span><span class="p">),</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_MODE</span><span class="p">),</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_bitrate</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_VBR</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;, Peak %d&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span>
		<span class="s">&quot;%s: Video:  GOP Size %d, %d B-Frames, %sGOP Closure</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">video_b_frames</span><span class="p">,</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_gop_closure</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot;No &quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">video_temporal_decimation</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: Video: Temporal Decimation %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">prefix</span><span class="p">,</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">video_temporal_decimation</span><span class="p">);</span>

	<span class="cm">/* Audio */</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: Audio:  %s, %s, %s, %s%s&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_AUDIO_SAMPLING_FREQ</span><span class="p">),</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_AUDIO_ENCODING</span><span class="p">),</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
			   <span class="n">p</span><span class="o">-&gt;</span><span class="n">audio_encoding</span> <span class="o">==</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_AC3</span>
					      <span class="o">?</span> <span class="n">V4L2_CID_MPEG_AUDIO_AC3_BITRATE</span>
					      <span class="o">:</span> <span class="n">V4L2_CID_MPEG_AUDIO_L2_BITRATE</span><span class="p">),</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_AUDIO_MODE</span><span class="p">),</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">audio_mute</span> <span class="o">?</span> <span class="s">&quot; (muted)&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">audio_mode</span> <span class="o">==</span> <span class="n">V4L2_MPEG_AUDIO_MODE_JOINT_STEREO</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="s">&quot;, %s&quot;</span><span class="p">,</span> <span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
				<span class="n">V4L2_CID_MPEG_AUDIO_MODE_EXTENSION</span><span class="p">));</span>
	<span class="n">printk</span><span class="p">(</span><span class="s">&quot;, %s, %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_AUDIO_EMPHASIS</span><span class="p">),</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_AUDIO_CRC</span><span class="p">));</span>

	<span class="cm">/* Encoding filters */</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: Spatial Filter:  %s, Luma %s, Chroma %s, %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
		    <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span><span class="p">),</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
		    <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span><span class="p">),</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
		    <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span><span class="p">),</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_spatial_filter</span><span class="p">);</span>

	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: Temporal Filter: %s, %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span><span class="p">),</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_temporal_filter</span><span class="p">);</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span>
		<span class="s">&quot;%s: Median Filter:   %s, Luma [%d, %d], Chroma [%d, %d]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">prefix</span><span class="p">,</span>
		<span class="n">cx2341x_menu_item</span><span class="p">(</span><span class="n">p</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span><span class="p">),</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_bottom</span><span class="p">,</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_top</span><span class="p">,</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_bottom</span><span class="p">,</span>
		<span class="n">p</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_top</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_log_status</span><span class="p">);</span>



<span class="cm">/********************** NEW CODE *********************/</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">cx2341x_handler</span> <span class="o">*</span><span class="nf">to_cxhdl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">handler</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cx2341x_handler</span><span class="p">,</span> <span class="n">hdl</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx2341x_hdl_api</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_handler</span> <span class="o">*</span><span class="n">hdl</span><span class="p">,</span>
		       <span class="n">u32</span> <span class="n">cmd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">args</span><span class="p">,</span> <span class="p">...)</span>
<span class="p">{</span>
	<span class="n">u32</span> <span class="n">data</span><span class="p">[</span><span class="n">CX2341X_MBOX_MAX_DATA</span><span class="p">];</span>
	<span class="kt">va_list</span> <span class="n">vargs</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">va_start</span><span class="p">(</span><span class="n">vargs</span><span class="p">,</span> <span class="n">args</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">args</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
		<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">va_arg</span><span class="p">(</span><span class="n">vargs</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
	<span class="n">va_end</span><span class="p">(</span><span class="n">vargs</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">func</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* ctrl-&gt;handler-&gt;lock is held, so it is safe to access cur.val */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">int</span> <span class="nf">cx2341x_neq</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">ctrl</span> <span class="o">&amp;&amp;</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">!=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">cur</span><span class="p">.</span><span class="n">val</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx2341x_try_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx2341x_handler</span> <span class="o">*</span><span class="n">hdl</span> <span class="o">=</span> <span class="n">to_cxhdl</span><span class="p">(</span><span class="n">ctrl</span><span class="p">);</span>
	<span class="n">s32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_B_FRAMES</span>: <span class="p">{</span>
		<span class="cm">/* video gop cluster */</span>
		<span class="kt">int</span> <span class="n">b</span> <span class="o">=</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
		<span class="kt">int</span> <span class="n">gop</span> <span class="o">=</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">;</span>

		<span class="n">gop</span> <span class="o">=</span> <span class="n">b</span> <span class="o">*</span> <span class="p">((</span><span class="n">gop</span> <span class="o">+</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">b</span><span class="p">);</span>

		<span class="cm">/* Max GOP size = 34 */</span>
		<span class="k">while</span> <span class="p">(</span><span class="n">gop</span> <span class="o">&gt;</span> <span class="mi">34</span><span class="p">)</span>
			<span class="n">gop</span> <span class="o">-=</span> <span class="n">b</span><span class="p">;</span>
		<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span> <span class="n">gop</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_TYPE</span>:
		<span class="cm">/* stream type cluster */</span>
		<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_encoding</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span>
		    <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">stream_type</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span> <span class="n">V4L2_MPEG_STREAM_TYPE_MPEG1_SS</span> <span class="o">||</span>
		     <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">stream_type</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span> <span class="n">V4L2_MPEG_STREAM_TYPE_MPEG1_VCD</span><span class="p">)</span> <span class="o">?</span>
			<span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span> <span class="o">:</span>
			<span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_2</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_encoding</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span><span class="p">)</span>
			<span class="cm">/* MPEG-1 implies CBR */</span>
			<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span>
				<span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_CBR</span><span class="p">;</span>
		<span class="cm">/* peak bitrate shall be &gt;= normal bitrate */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_VBR</span> <span class="o">&amp;&amp;</span>
		    <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">)</span>
			<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">=</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx2341x_s_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">mpeg_stream_type</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* MPEG-2 PS */</span>
		<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* MPEG-2 TS */</span>
		<span class="mi">2</span><span class="p">,</span>	<span class="cm">/* MPEG-1 SS */</span>
		<span class="mi">14</span><span class="p">,</span>	<span class="cm">/* DVD */</span>
		<span class="mi">11</span><span class="p">,</span>	<span class="cm">/* VCD */</span>
		<span class="mi">12</span><span class="p">,</span>	<span class="cm">/* SVCD */</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">cx2341x_handler</span> <span class="o">*</span><span class="n">hdl</span> <span class="o">=</span> <span class="n">to_cxhdl</span><span class="p">(</span><span class="n">ctrl</span><span class="p">);</span>
	<span class="n">s32</span> <span class="n">val</span> <span class="o">=</span> <span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">props</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_VBI_FMT</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span> <span class="o">&amp;&amp;</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">s_stream_vbi_fmt</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">s_stream_vbi_fmt</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_ASPECT</span>:
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">CX2341X_ENC_SET_ASPECT_RATIO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_GOP_CLOSURE</span>:
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_GOP_CLOSURE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_MUTE</span>:
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_MUTE_AUDIO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_TEMPORAL_DECIMATION</span>:
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">CX2341X_ENC_SET_FRAME_DROP_RATE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span>:
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_MISC</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_AUDIO_SAMPLING_FREQ</span>:
		<span class="cm">/* audio properties cluster */</span>
		<span class="n">props</span> <span class="o">=</span> <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_mode_extension</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_crc</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_emphasis</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span> <span class="n">V4L2_MPEG_AUDIO_EMPHASIS_CCITT_J17</span><span class="p">)</span>
			<span class="n">props</span> <span class="o">|=</span> <span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">props</span> <span class="o">|=</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_emphasis</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_encoding</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_AC3</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">props</span> <span class="o">|=</span>
<span class="cp">#if 1</span>
				<span class="cm">/* Not sure if this MPEG Layer II setting is required */</span>
				<span class="p">((</span><span class="mi">3</span> <span class="o">-</span> <span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
<span class="cp">#endif</span>
				<span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_ac3_bitrate</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span>
				<span class="p">(</span><span class="n">CX2341X_AUDIO_ENCODING_METHOD_AC3</span> <span class="o">&lt;&lt;</span> <span class="mi">28</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/* Assuming MPEG Layer II */</span>
			<span class="n">props</span> <span class="o">|=</span>
				<span class="p">((</span><span class="mi">3</span> <span class="o">-</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_encoding</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span>
				<span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_l2_bitrate</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
				<span class="n">CX2341X_ENC_SET_AUDIO_PROPERTIES</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">props</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_properties</span> <span class="o">=</span> <span class="n">props</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_ac3_bitrate</span><span class="p">)</span> <span class="p">{</span>
			<span class="kt">int</span> <span class="n">is_ac3</span> <span class="o">=</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_encoding</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span>
						<span class="n">V4L2_MPEG_AUDIO_ENCODING_AC3</span><span class="p">;</span>

			<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_ac3_bitrate</span><span class="p">,</span> <span class="n">is_ac3</span><span class="p">);</span>
			<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_l2_bitrate</span><span class="p">,</span> <span class="o">!</span><span class="n">is_ac3</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_mode_extension</span><span class="p">,</span>
			<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">==</span> <span class="n">V4L2_MPEG_AUDIO_MODE_JOINT_STEREO</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cx2341x_neq</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span> <span class="o">&amp;&amp;</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">s_audio_sampling_freq</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">s_audio_sampling_freq</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cx2341x_neq</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_mode</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span> <span class="o">&amp;&amp;</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">s_audio_mode</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">s_audio_mode</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">audio_mode</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_B_FRAMES</span>:
		<span class="cm">/* video gop cluster */</span>
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_GOP_PROPERTIES</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_b_frames</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_STREAM_TYPE</span>:
		<span class="cm">/* stream type cluster */</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">CX2341X_ENC_SET_STREAM_TYPE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">mpeg_stream_type</span><span class="p">[</span><span class="n">val</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_BIT_RATE</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">/</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span><span class="p">,</span>
			<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_encoding</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">!=</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span><span class="p">);</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span><span class="p">,</span>
			<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">!=</span> <span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_CBR</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">cx2341x_neq</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_encoding</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span> <span class="o">&amp;&amp;</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">s_video_encoding</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">ops</span><span class="o">-&gt;</span><span class="n">s_video_encoding</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_encoding</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_VIDEO_MUTE</span>:
		<span class="cm">/* video mute cluster */</span>
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_MUTE_VIDEO</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_mute</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">|</span>
					<span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_mute_yuv</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">));</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span>: <span class="p">{</span>
		<span class="kt">int</span> <span class="n">active_filter</span><span class="p">;</span>

		<span class="cm">/* video filter mode */</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_DNR_FILTER_MODE</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">|</span>
					<span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_temporal_filter_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">),</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

		<span class="n">active_filter</span> <span class="o">=</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">!=</span>
				<span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_AUTO</span><span class="p">;</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_spatial_filter</span><span class="p">,</span> <span class="n">active_filter</span><span class="p">);</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_luma_spatial_filter_type</span><span class="p">,</span> <span class="n">active_filter</span><span class="p">);</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_chroma_spatial_filter_type</span><span class="p">,</span> <span class="n">active_filter</span><span class="p">);</span>
		<span class="n">active_filter</span> <span class="o">=</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_temporal_filter_mode</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">!=</span>
				<span class="n">V4L2_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE_AUTO</span><span class="p">;</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_temporal_filter</span><span class="p">,</span> <span class="n">active_filter</span><span class="p">);</span>
		<span class="n">active_filter</span> <span class="o">=</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">!=</span>
				<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">;</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_bottom</span><span class="p">,</span> <span class="n">active_filter</span><span class="p">);</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_top</span><span class="p">,</span> <span class="n">active_filter</span><span class="p">);</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_bottom</span><span class="p">,</span> <span class="n">active_filter</span><span class="p">);</span>
		<span class="n">v4l2_ctrl_activate</span><span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_top</span><span class="p">,</span> <span class="n">active_filter</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span>:
		<span class="cm">/* video filter type cluster */</span>
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
				<span class="n">CX2341X_ENC_SET_SPATIAL_FILTER_TYPE</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_luma_spatial_filter_type</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_chroma_spatial_filter_type</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span>:
		<span class="cm">/* video filter cluster */</span>
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_DNR_FILTER_PROPS</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_spatial_filter</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_temporal_filter</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span>:
		<span class="cm">/* video median cluster */</span>
		<span class="k">return</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_CORING_LEVELS</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_bottom</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_top</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_bottom</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">,</span>
				<span class="n">hdl</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_top</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_ctrl_ops</span> <span class="n">cx2341x_ops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">try_ctrl</span> <span class="o">=</span> <span class="n">cx2341x_try_ctrl</span><span class="p">,</span>
	<span class="p">.</span><span class="n">s_ctrl</span> <span class="o">=</span> <span class="n">cx2341x_s_ctrl</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="nf">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="o">*</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="n">s32</span> <span class="n">min</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span> <span class="n">s32</span> <span class="n">step</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl_config</span> <span class="n">cfg</span><span class="p">;</span>

	<span class="n">cx2341x_ctrl_fill</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">.</span><span class="n">type</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">min</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">max</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">step</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">def</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">.</span><span class="n">flags</span><span class="p">);</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">ops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cx2341x_ops</span><span class="p">;</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">min</span> <span class="o">=</span> <span class="n">min</span><span class="p">;</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">max</span> <span class="o">=</span> <span class="n">max</span><span class="p">;</span>
	<span class="n">cfg</span><span class="p">.</span><span class="n">def</span> <span class="o">=</span> <span class="n">def</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">cfg</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">V4L2_CTRL_TYPE_MENU</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cfg</span><span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">cfg</span><span class="p">.</span><span class="n">menu_skip_mask</span> <span class="o">=</span> <span class="n">step</span><span class="p">;</span>
		<span class="n">cfg</span><span class="p">.</span><span class="n">qmenu</span> <span class="o">=</span> <span class="n">cx2341x_get_menu</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">cfg</span><span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">;</span>
		<span class="n">cfg</span><span class="p">.</span><span class="n">menu_skip_mask</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">v4l2_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="nf">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="o">*</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="n">s32</span> <span class="n">min</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span> <span class="n">s32</span> <span class="n">step</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">v4l2_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cx2341x_ops</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">min</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">def</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="nf">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="o">*</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">u32</span> <span class="n">id</span><span class="p">,</span> <span class="n">s32</span> <span class="n">max</span><span class="p">,</span> <span class="n">s32</span> <span class="n">mask</span><span class="p">,</span> <span class="n">s32</span> <span class="n">def</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">v4l2_ctrl_new_std_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cx2341x_ops</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">def</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">cx2341x_handler_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_handler</span> <span class="o">*</span><span class="n">cxhdl</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="n">nr_of_controls_hint</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="o">*</span><span class="n">hdl</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">hdl</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">caps</span> <span class="o">=</span> <span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">capabilities</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">has_sliced_vbi</span> <span class="o">=</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_SLICED_VBI</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">has_ac3</span> <span class="o">=</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_AC3</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">has_ts</span> <span class="o">=</span> <span class="n">caps</span> <span class="o">&amp;</span> <span class="n">CX2341X_CAP_HAS_TS</span><span class="p">;</span>

	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">=</span> <span class="mi">720</span><span class="p">;</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">=</span> <span class="mi">480</span><span class="p">;</span>

	<span class="n">v4l2_ctrl_handler_init</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">nr_of_controls_hint</span><span class="p">);</span>

	<span class="cm">/* Add controls in ascending control ID order for fastest</span>
<span class="cm">	   insertion time. */</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">stream_type</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_STREAM_TYPE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_STREAM_TYPE_MPEG2_SVCD</span><span class="p">,</span> <span class="n">has_ts</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_STREAM_TYPE_MPEG2_PS</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">stream_vbi_fmt</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_STREAM_VBI_FMT</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_STREAM_VBI_FMT_IVTV</span><span class="p">,</span> <span class="n">has_sliced_vbi</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_STREAM_VBI_FMT_NONE</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_AUDIO_SAMPLING_FREQ</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_SAMPLING_FREQ_32000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_SAMPLING_FREQ_48000</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_encoding</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_AUDIO_ENCODING</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_ENCODING_AC3</span><span class="p">,</span> <span class="n">has_ac3</span> <span class="o">?</span> <span class="o">~</span><span class="mh">0x12</span> <span class="o">:</span> <span class="o">~</span><span class="mh">0x2</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_ENCODING_LAYER_2</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_l2_bitrate</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_AUDIO_L2_BITRATE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_L2_BITRATE_384K</span><span class="p">,</span> <span class="mh">0x1ff</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_L2_BITRATE_224K</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_mode</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_AUDIO_MODE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_MODE_MONO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_MODE_STEREO</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_mode_extension</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_AUDIO_MODE_EXTENSION</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_MODE_EXTENSION_BOUND_16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_MODE_EXTENSION_BOUND_4</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_emphasis</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_AUDIO_EMPHASIS</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_EMPHASIS_CCITT_J17</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_EMPHASIS_NONE</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_crc</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_AUDIO_CRC</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_CRC_CRC16</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_AUDIO_CRC_NONE</span><span class="p">);</span>

	<span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_AUDIO_MUTE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">has_ac3</span><span class="p">)</span>
		<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_ac3_bitrate</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
				<span class="n">V4L2_CID_MPEG_AUDIO_AC3_BITRATE</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_AC3_BITRATE_448K</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span>
				<span class="n">V4L2_MPEG_AUDIO_AC3_BITRATE_224K</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_encoding</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_ENCODING</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_2</span><span class="p">);</span>
	<span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_ASPECT</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_VIDEO_ASPECT_221x100</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_VIDEO_ASPECT_4x3</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_b_frames</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_B_FRAMES</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_gop_size</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_GOP_SIZE</span><span class="p">,</span>
			<span class="mi">1</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">is_50hz</span> <span class="o">?</span> <span class="mi">12</span> <span class="o">:</span> <span class="mi">15</span><span class="p">);</span>
	<span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_VIDEO_GOP_CLOSURE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_menu</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_MODE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_CBR</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_VIDEO_BITRATE_MODE_VBR</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_bitrate</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_BITRATE</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">27000000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">6000000</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_BITRATE_PEAK</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">27000000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8000000</span><span class="p">);</span>
	<span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_TEMPORAL_DECIMATION</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_mute</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_MUTE</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_mute_yuv</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_std</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_VIDEO_MUTE_YUV</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0xffffff</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mh">0x008080</span><span class="p">);</span>

	<span class="cm">/* CX23415/6 specific */</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_MANUAL</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_AUTO</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_SPATIAL_FILTER_MODE_MANUAL</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_spatial_filter</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_SPATIAL_FILTER</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_luma_spatial_filter_type</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE_OFF</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE_2D_SYM_NON_SEPARABLE</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_LUMA_SPATIAL_FILTER_TYPE_1D_HOR</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_chroma_spatial_filter_type</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE_OFF</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE_1D_HOR</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_CHROMA_SPATIAL_FILTER_TYPE_1D_HOR</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_temporal_filter_mode</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE_MANUAL</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE_AUTO</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER_MODE_MANUAL</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_temporal_filter</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_TEMPORAL_FILTER</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_median_filter_type</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_DIAG</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span>
			<span class="n">V4L2_MPEG_CX2341X_VIDEO_MEDIAN_FILTER_TYPE_OFF</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_bottom</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_BOTTOM</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_top</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_LUMA_MEDIAN_FILTER_TOP</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_bottom</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_BOTTOM</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_chroma_median_filter_top</span> <span class="o">=</span> <span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span>
			<span class="n">V4L2_CID_MPEG_CX2341X_VIDEO_CHROMA_MEDIAN_FILTER_TOP</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
	<span class="n">cx2341x_ctrl_new_custom</span><span class="p">(</span><span class="n">hdl</span><span class="p">,</span> <span class="n">V4L2_CID_MPEG_CX2341X_STREAM_INSERT_NAV_PACKETS</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hdl</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">hdl</span><span class="o">-&gt;</span><span class="n">error</span><span class="p">;</span>

		<span class="n">v4l2_ctrl_handler_free</span><span class="p">(</span><span class="n">hdl</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_b_frames</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">stream_type</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_mute</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_spatial_filter_mode</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_luma_spatial_filter_type</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_spatial_filter</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_cluster</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_luma_median_filter_top</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_handler_init</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">cx2341x_handler_set_50hz</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_handler</span> <span class="o">*</span><span class="n">cxhdl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">is_50hz</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">is_50hz</span> <span class="o">=</span> <span class="n">is_50hz</span><span class="p">;</span>
	<span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_gop_size</span><span class="o">-&gt;</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">is_50hz</span> <span class="o">?</span> <span class="mi">12</span> <span class="o">:</span> <span class="mi">15</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_handler_set_50hz</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">cx2341x_handler_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_handler</span> <span class="o">*</span><span class="n">cxhdl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">cxhdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_OUTPUT_PORT</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">port</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">cxhdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_FRAME_RATE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">is_50hz</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">v4l2_ctrl_g_ctrl</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_encoding</span><span class="p">)</span> <span class="o">==</span> <span class="n">V4L2_MPEG_VIDEO_ENCODING_MPEG_1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">w</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">h</span> <span class="o">/=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">cx2341x_hdl_api</span><span class="p">(</span><span class="n">cxhdl</span><span class="p">,</span> <span class="n">CX2341X_ENC_SET_FRAME_SIZE</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">v4l2_ctrl_handler_setup</span><span class="p">(</span><span class="o">&amp;</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">hdl</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_handler_setup</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">cx2341x_handler_set_busy</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx2341x_handler</span> <span class="o">*</span><span class="n">cxhdl</span><span class="p">,</span> <span class="kt">int</span> <span class="n">busy</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_sampling_freq</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_encoding</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_l2_bitrate</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">audio_ac3_bitrate</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">stream_vbi_fmt</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">stream_type</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_mode</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_bitrate</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
	<span class="n">v4l2_ctrl_grab</span><span class="p">(</span><span class="n">cxhdl</span><span class="o">-&gt;</span><span class="n">video_bitrate_peak</span><span class="p">,</span> <span class="n">busy</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">cx2341x_handler_set_busy</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
