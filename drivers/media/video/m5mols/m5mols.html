<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › m5mols › m5mols.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>m5mols.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Header for M-5MOLS 8M Pixel camera sensor with ISP</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2011 Samsung Electronics Co., Ltd.</span>
<span class="cm"> * Author: HeungJun Kim &lt;riverful.kim@samsung.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2009 Samsung Electronics Co., Ltd.</span>
<span class="cm"> * Author: Dongsoo Nathaniel Kim &lt;dongsoo45.kim@samsung.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> */</span>

<span class="cp">#ifndef M5MOLS_H</span>
<span class="cp">#define M5MOLS_H</span>

<span class="cp">#include &lt;media/v4l2-subdev.h&gt;</span>
<span class="cp">#include &quot;m5mols_reg.h&quot;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">m5mols_debug</span><span class="p">;</span>

<span class="k">enum</span> <span class="n">m5mols_restype</span> <span class="p">{</span>
	<span class="n">M5MOLS_RESTYPE_MONITOR</span><span class="p">,</span>
	<span class="n">M5MOLS_RESTYPE_CAPTURE</span><span class="p">,</span>
	<span class="n">M5MOLS_RESTYPE_MAX</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct m5mols_resolution - structure for the resolution</span>
<span class="cm"> * @type: resolution type according to the pixel code</span>
<span class="cm"> * @width: width of the resolution</span>
<span class="cm"> * @height: height of the resolution</span>
<span class="cm"> * @reg: resolution preset register value</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">m5mols_resolution</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">reg</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">m5mols_restype</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">height</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct m5mols_exif - structure for the EXIF information of M-5MOLS</span>
<span class="cm"> * @exposure_time: exposure time register value</span>
<span class="cm"> * @shutter_speed: speed of the shutter register value</span>
<span class="cm"> * @aperture: aperture register value</span>
<span class="cm"> * @exposure_bias: it calls also EV bias</span>
<span class="cm"> * @iso_speed: ISO register value</span>
<span class="cm"> * @flash: status register value of the flash</span>
<span class="cm"> * @sdr: status register value of the Subject Distance Range</span>
<span class="cm"> * @qval: not written exact meaning in document</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">m5mols_exif</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">exposure_time</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">shutter_speed</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">aperture</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">brightness</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">exposure_bias</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">iso_speed</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">flash</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">sdr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">qval</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct m5mols_capture - Structure for the capture capability</span>
<span class="cm"> * @exif: EXIF information</span>
<span class="cm"> * @main: size in bytes of the main image</span>
<span class="cm"> * @thumb: size in bytes of the thumb image, if it was accompanied</span>
<span class="cm"> * @total: total size in bytes of the produced image</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">m5mols_capture</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">m5mols_exif</span> <span class="n">exif</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">main</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">thumb</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">total</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct m5mols_scenemode - structure for the scenemode capability</span>
<span class="cm"> * @metering: metering light register value</span>
<span class="cm"> * @ev_bias: EV bias register value</span>
<span class="cm"> * @wb_mode: mode which means the WhiteBalance is Auto or Manual</span>
<span class="cm"> * @wb_preset: whitebalance preset register value in the Manual mode</span>
<span class="cm"> * @chroma_en: register value whether the Chroma capability is enabled or not</span>
<span class="cm"> * @chroma_lvl: chroma&#39;s level register value</span>
<span class="cm"> * @edge_en: register value Whether the Edge capability is enabled or not</span>
<span class="cm"> * @edge_lvl: edge&#39;s level register value</span>
<span class="cm"> * @af_range: Auto Focus&#39;s range</span>
<span class="cm"> * @fd_mode: Face Detection mode</span>
<span class="cm"> * @mcc: Multi-axis Color Conversion which means emotion color</span>
<span class="cm"> * @light: status of the Light</span>
<span class="cm"> * @flash: status of the Flash</span>
<span class="cm"> * @tone: Tone color which means Contrast</span>
<span class="cm"> * @iso: ISO register value</span>
<span class="cm"> * @capt_mode: Mode of the Image Stabilization while the camera capturing</span>
<span class="cm"> * @wdr: Wide Dynamic Range register value</span>
<span class="cm"> *</span>
<span class="cm"> * The each value according to each scenemode is recommended in the documents.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">m5mols_scenemode</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">metering</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">ev_bias</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">wb_mode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">wb_preset</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">chroma_en</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">chroma_lvl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">edge_en</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">edge_lvl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">af_range</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">fd_mode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mcc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">light</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flash</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">tone</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">iso</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">capt_mode</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">wdr</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct m5mols_version - firmware version information</span>
<span class="cm"> * @customer:	customer information</span>
<span class="cm"> * @project:	version of project information according to customer</span>
<span class="cm"> * @fw:		firmware revision</span>
<span class="cm"> * @hw:		hardware revision</span>
<span class="cm"> * @param:	version of the parameter</span>
<span class="cm"> * @awb:	Auto WhiteBalance algorithm version</span>
<span class="cm"> * @str:	information about manufacturer and packaging vendor</span>
<span class="cm"> * @af:		Auto Focus version</span>
<span class="cm"> *</span>
<span class="cm"> * The register offset starts the customer version at 0x0, and it ends</span>
<span class="cm"> * the awb version at 0x09. The customer, project information occupies 1 bytes</span>
<span class="cm"> * each. And also the fw, hw, param, awb each requires 2 bytes. The str is</span>
<span class="cm"> * unique string associated with firmware&#39;s version. It includes information</span>
<span class="cm"> * about manufacturer and the vendor of the sensor&#39;s packaging. The least</span>
<span class="cm"> * significant 2 bytes of the string indicate packaging manufacturer.</span>
<span class="cm"> */</span>
<span class="cp">#define VERSION_STRING_SIZE	22</span>
<span class="k">struct</span> <span class="n">m5mols_version</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">customer</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">project</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">fw</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">hw</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">param</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">awb</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">str</span><span class="p">[</span><span class="n">VERSION_STRING_SIZE</span><span class="p">];</span>
	<span class="n">u8</span>	<span class="n">af</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * struct m5mols_info - M-5MOLS driver data structure</span>
<span class="cm"> * @pdata: platform data</span>
<span class="cm"> * @sd: v4l-subdev instance</span>
<span class="cm"> * @pad: media pad</span>
<span class="cm"> * @ffmt: current fmt according to resolution type</span>
<span class="cm"> * @res_type: current resolution type</span>
<span class="cm"> * @irq_waitq: waitqueue for the capture</span>
<span class="cm"> * @irq_done: set to 1 in the interrupt handler</span>
<span class="cm"> * @handle: control handler</span>
<span class="cm"> * @auto_exposure: auto/manual exposure control</span>
<span class="cm"> * @exposure_bias: exposure compensation control</span>
<span class="cm"> * @exposure: manual exposure control</span>
<span class="cm"> * @metering: exposure metering control</span>
<span class="cm"> * @auto_iso: auto/manual ISO sensitivity control</span>
<span class="cm"> * @iso: manual ISO sensitivity control</span>
<span class="cm"> * @auto_wb: auto white balance control</span>
<span class="cm"> * @lock_3a: 3A lock control</span>
<span class="cm"> * @colorfx: color effect control</span>
<span class="cm"> * @saturation: saturation control</span>
<span class="cm"> * @zoom: zoom control</span>
<span class="cm"> * @wdr: wide dynamic range control</span>
<span class="cm"> * @stabilization: image stabilization control</span>
<span class="cm"> * @jpeg_quality: JPEG compression quality control</span>
<span class="cm"> * @ver: information of the version</span>
<span class="cm"> * @cap: the capture mode attributes</span>
<span class="cm"> * @isp_ready: 1 when the ISP controller has completed booting</span>
<span class="cm"> * @power: current sensor&#39;s power status</span>
<span class="cm"> * @ctrl_sync: 1 when the control handler state is restored in H/W</span>
<span class="cm"> * @resolution:	register value for current resolution</span>
<span class="cm"> * @mode: register value for current operation mode</span>
<span class="cm"> * @set_power: optional power callback to the board code</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">m5mols_info</span> <span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">m5mols_platform_data</span> <span class="o">*</span><span class="n">pdata</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="n">sd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">media_pad</span> <span class="n">pad</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_mbus_framefmt</span> <span class="n">ffmt</span><span class="p">[</span><span class="n">M5MOLS_RESTYPE_MAX</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">res_type</span><span class="p">;</span>

	<span class="n">wait_queue_head_t</span> <span class="n">irq_waitq</span><span class="p">;</span>
	<span class="n">atomic_t</span> <span class="n">irq_done</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="n">handle</span><span class="p">;</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="cm">/* exposure/exposure bias/auto exposure cluster */</span>
		<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">auto_exposure</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">exposure_bias</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">exposure</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">metering</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="p">{</span>
		<span class="cm">/* iso/auto iso cluster */</span>
		<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">auto_iso</span><span class="p">;</span>
		<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">iso</span><span class="p">;</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">auto_wb</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">lock_3a</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">colorfx</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">saturation</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">zoom</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">wdr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">stabilization</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">jpeg_quality</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">m5mols_version</span> <span class="n">ver</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">m5mols_capture</span> <span class="n">cap</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">isp_ready</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">power</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">ctrl_sync</span><span class="o">:</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">resolution</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">mode</span><span class="p">;</span>

	<span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">set_power</span><span class="p">)(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">on</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#define is_available_af(__info)	(__info-&gt;ver.af)</span>
<span class="cp">#define is_code(__code, __type) (__code == m5mols_default_ffmt[__type].code)</span>
<span class="cp">#define is_manufacturer(__info, __manufacturer)	\</span>
<span class="cp">				(__info-&gt;ver.str[0] == __manufacturer[0] &amp;&amp; \</span>
<span class="cp">				 __info-&gt;ver.str[1] == __manufacturer[1])</span>
<span class="cm">/*</span>
<span class="cm"> * I2C operation of the M-5MOLS</span>
<span class="cm"> *</span>
<span class="cm"> * The I2C read operation of the M-5MOLS requires 2 messages. The first</span>
<span class="cm"> * message sends the information about the command, command category, and total</span>
<span class="cm"> * message size. The second message is used to retrieve the data specifed in</span>
<span class="cm"> * the first message</span>
<span class="cm"> *</span>
<span class="cm"> *   1st message                                2nd message</span>
<span class="cm"> *   +-------+---+----------+-----+-------+     +------+------+------+------+</span>
<span class="cm"> *   | size1 | R | category | cmd | size2 |     | d[0] | d[1] | d[2] | d[3] |</span>
<span class="cm"> *   +-------+---+----------+-----+-------+     +------+------+------+------+</span>
<span class="cm"> *   - size1: message data size(5 in this case)</span>
<span class="cm"> *   - size2: desired buffer size of the 2nd message</span>
<span class="cm"> *   - d[0..3]: according to size2</span>
<span class="cm"> *</span>
<span class="cm"> * The I2C write operation needs just one message. The message includes</span>
<span class="cm"> * category, command, total size, and desired data.</span>
<span class="cm"> *</span>
<span class="cm"> *   1st message</span>
<span class="cm"> *   +-------+---+----------+-----+------+------+------+------+</span>
<span class="cm"> *   | size1 | W | category | cmd | d[0] | d[1] | d[2] | d[3] |</span>
<span class="cm"> *   +-------+---+----------+-----+------+------+------+------+</span>
<span class="cm"> *   - d[0..3]: according to size1</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">m5mols_read_u8</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg_comb</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_read_u16</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg_comb</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_read_u32</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg_comb</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg_comb</span><span class="p">,</span> <span class="n">u32</span> <span class="n">val</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">m5mols_busy_wait</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u32</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">,</span>
		     <span class="kt">int</span> <span class="n">timeout</span><span class="p">);</span>

<span class="cm">/* Mask value for busy waiting until M-5MOLS I2C interface is initialized */</span>
<span class="cp">#define M5MOLS_I2C_RDY_WAIT_FL		(1 &lt;&lt; 16)</span>
<span class="cm">/* ISP state transition timeout, in ms */</span>
<span class="cp">#define M5MOLS_MODE_CHANGE_TIMEOUT	200</span>
<span class="cp">#define M5MOLS_BUSY_WAIT_DEF_TIMEOUT	250</span>

<span class="cm">/*</span>
<span class="cm"> * Mode operation of the M-5MOLS</span>
<span class="cm"> *</span>
<span class="cm"> * Changing the mode of the M-5MOLS is needed right executing order.</span>
<span class="cm"> * There are three modes(PARAMETER, MONITOR, CAPTURE) which can be changed</span>
<span class="cm"> * by user. There are various categories associated with each mode.</span>
<span class="cm"> *</span>
<span class="cm"> * +============================================================+</span>
<span class="cm"> * | mode	| category					|</span>
<span class="cm"> * +============================================================+</span>
<span class="cm"> * | FLASH	| FLASH(only after Stand-by or Power-on)	|</span>
<span class="cm"> * | SYSTEM	| SYSTEM(only after sensor arm-booting)		|</span>
<span class="cm"> * | PARAMETER	| PARAMETER					|</span>
<span class="cm"> * | MONITOR	| MONITOR(preview), Auto Focus, Face Detection	|</span>
<span class="cm"> * | CAPTURE	| Single CAPTURE, Preview(recording)		|</span>
<span class="cm"> * +============================================================+</span>
<span class="cm"> *</span>
<span class="cm"> * The available executing order between each modes are as follows:</span>
<span class="cm"> *   PARAMETER &lt;---&gt; MONITOR &lt;---&gt; CAPTURE</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">m5mols_set_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">m5mols_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">m5mols_enable_interrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_wait_interrupt</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">condition</span><span class="p">,</span> <span class="n">u32</span> <span class="n">timeout</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_restore_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">m5mols_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_start_capture</span><span class="p">(</span><span class="k">struct</span> <span class="n">m5mols_info</span> <span class="o">*</span><span class="n">info</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_do_scenemode</span><span class="p">(</span><span class="k">struct</span> <span class="n">m5mols_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="n">u8</span> <span class="n">mode</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_lock_3a</span><span class="p">(</span><span class="k">struct</span> <span class="n">m5mols_info</span> <span class="o">*</span><span class="n">info</span><span class="p">,</span> <span class="n">bool</span> <span class="n">lock</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_set_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">m5mols_init_controls</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">);</span>

<span class="cm">/* The firmware function */</span>
<span class="kt">int</span> <span class="n">m5mols_update_fw</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
		     <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">set_power</span><span class="p">)(</span><span class="k">struct</span> <span class="n">m5mols_info</span> <span class="o">*</span><span class="p">,</span> <span class="n">bool</span><span class="p">));</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">m5mols_info</span> <span class="o">*</span><span class="nf">to_m5mols</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">subdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">subdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">m5mols_info</span><span class="p">,</span> <span class="n">sd</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="nf">to_sd</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">m5mols_info</span> <span class="o">*</span><span class="n">info</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">handler</span><span class="p">,</span>
						<span class="k">struct</span> <span class="n">m5mols_info</span><span class="p">,</span> <span class="n">handle</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="n">info</span><span class="o">-&gt;</span><span class="n">sd</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">m5mols_set_ctrl_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">,</span>
					<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">mode</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">priv</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">mode</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">m5mols_get_ctrl_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">ctrl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span><span class="n">ctrl</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#endif	</span><span class="cm">/* M5MOLS_H */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
