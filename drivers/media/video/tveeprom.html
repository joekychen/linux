<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › tveeprom.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>tveeprom.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * tveeprom - eeprom decoder for tvcard configuration eeproms</span>
<span class="cm"> *</span>
<span class="cm"> * Data and decoding routines shamelessly borrowed from bttv-cards.c</span>
<span class="cm"> * eeprom access routine shamelessly borrowed from bttv-if.c</span>
<span class="cm"> * which are:</span>

<span class="cm">    Copyright (C) 1996,97,98 Ralph  Metzler (rjkm@thp.uni-koeln.de)</span>
<span class="cm">			   &amp; Marcus Metzler (mocm@thp.uni-koeln.de)</span>
<span class="cm">    (c) 1999-2001 Gerd Knorr &lt;kraxel@goldbach.in-berlin.de&gt;</span>

<span class="cm"> * Adjustments to fit a more general model and all bugs:</span>

<span class="cm">	Copyright (C) 2003 John Klar &lt;linpvr at projectplasma.com&gt;</span>

<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>


<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/errno.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/types.h&gt;</span>
<span class="cp">#include &lt;linux/videodev2.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>

<span class="cp">#include &lt;media/tuner.h&gt;</span>
<span class="cp">#include &lt;media/tveeprom.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-common.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-chip-ident.h&gt;</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;i2c Hauppauge eeprom decoder driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;John Klar&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">debug</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="s">&quot;Debug level (0-1)&quot;</span><span class="p">);</span>

<span class="cp">#define STRM(array, i) \</span>
<span class="cp">	(i &lt; sizeof(array) / sizeof(char *) ? array[i] : &quot;unknown&quot;)</span>

<span class="cp">#define tveeprom_info(fmt, arg...) \</span>
<span class="cp">	v4l_printk(KERN_INFO, &quot;tveeprom&quot;, c-&gt;adapter, c-&gt;addr, fmt , ## arg)</span>
<span class="cp">#define tveeprom_warn(fmt, arg...) \</span>
<span class="cp">	v4l_printk(KERN_WARNING, &quot;tveeprom&quot;, c-&gt;adapter, c-&gt;addr, fmt , ## arg)</span>
<span class="cp">#define tveeprom_dbg(fmt, arg...) do { \</span>
<span class="cp">	if (debug) \</span>
<span class="cp">		v4l_printk(KERN_DEBUG, &quot;tveeprom&quot;, \</span>
<span class="cp">				c-&gt;adapter, c-&gt;addr, fmt , ## arg); \</span>
<span class="cp">	} while (0)</span>

<span class="cm">/*</span>
<span class="cm"> * The Hauppauge eeprom uses an 8bit field to determine which</span>
<span class="cm"> * tuner formats the tuner supports.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">HAUPPAUGE_TUNER_FMT</span>
<span class="p">{</span>
	<span class="kt">int</span>	<span class="n">id</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">hauppauge_tuner_fmt</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="p">{</span> <span class="n">V4L2_STD_UNKNOWN</span><span class="p">,</span>                   <span class="s">&quot; UNKNOWN&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_STD_UNKNOWN</span><span class="p">,</span>                   <span class="s">&quot; FM&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_STD_B</span><span class="o">|</span><span class="n">V4L2_STD_GH</span><span class="p">,</span>             <span class="s">&quot; PAL(B/G)&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_STD_MN</span><span class="p">,</span>                        <span class="s">&quot; NTSC(M)&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_STD_PAL_I</span><span class="p">,</span>                     <span class="s">&quot; PAL(I)&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_STD_SECAM_L</span><span class="o">|</span><span class="n">V4L2_STD_SECAM_LC</span><span class="p">,</span> <span class="s">&quot; SECAM(L/L&#39;)&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_STD_DK</span><span class="p">,</span>                        <span class="s">&quot; PAL(D/D1/K)&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_STD_ATSC</span><span class="p">,</span>                      <span class="s">&quot; ATSC/DVB Digital&quot;</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* This is the full list of possible tuners. Many thanks to Hauppauge for</span>
<span class="cm">   supplying this information. Note that many tuners where only used for</span>
<span class="cm">   testing and never made it to the outside world. So you will only see</span>
<span class="cm">   a subset in actual produced cards. */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">HAUPPAUGE_TUNER</span>
<span class="p">{</span>
	<span class="kt">int</span>  <span class="n">id</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">hauppauge_tuner</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="cm">/* 0-9 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;None&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;External&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Unspecified&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL</span><span class="p">,</span>   		<span class="s">&quot;Philips FI1216&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_SECAM</span><span class="p">,</span> 		<span class="s">&quot;Philips FI1216MF&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_NTSC</span><span class="p">,</span>  		<span class="s">&quot;Philips FI1236&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL_I</span><span class="p">,</span> 		<span class="s">&quot;Philips FI1246&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL_DK</span><span class="p">,</span>		<span class="s">&quot;Philips FI1256&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL</span><span class="p">,</span>   		<span class="s">&quot;Philips FI1216 MK2&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_SECAM</span><span class="p">,</span> 		<span class="s">&quot;Philips FI1216MF MK2&quot;</span> <span class="p">},</span>
	<span class="cm">/* 10-19 */</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_NTSC</span><span class="p">,</span>  		<span class="s">&quot;Philips FI1236 MK2&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL_I</span><span class="p">,</span> 		<span class="s">&quot;Philips FI1246 MK2&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL_DK</span><span class="p">,</span>		<span class="s">&quot;Philips FI1256 MK2&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_NTSC</span><span class="p">,</span>    		<span class="s">&quot;Temic 4032FY5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_PAL</span><span class="p">,</span>     		<span class="s">&quot;Temic 4002FH5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_PAL_I</span><span class="p">,</span>   		<span class="s">&quot;Temic 4062FY5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL</span><span class="p">,</span>   		<span class="s">&quot;Philips FR1216 MK2&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_SECAM</span><span class="p">,</span> 		<span class="s">&quot;Philips FR1216MF MK2&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_NTSC</span><span class="p">,</span>  		<span class="s">&quot;Philips FR1236 MK2&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL_I</span><span class="p">,</span> 		<span class="s">&quot;Philips FR1246 MK2&quot;</span> <span class="p">},</span>
	<span class="cm">/* 20-29 */</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL_DK</span><span class="p">,</span>		<span class="s">&quot;Philips FR1256 MK2&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL</span><span class="p">,</span>   		<span class="s">&quot;Philips FM1216&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_SECAM</span><span class="p">,</span> 		<span class="s">&quot;Philips FM1216MF&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_NTSC</span><span class="p">,</span>  		<span class="s">&quot;Philips FM1236&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL_I</span><span class="p">,</span> 		<span class="s">&quot;Philips FM1246&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_PAL_DK</span><span class="p">,</span>		<span class="s">&quot;Philips FM1256&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_4036FY5_NTSC</span><span class="p">,</span> 	<span class="s">&quot;Temic 4036FY5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Samsung TCPN9082D&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Samsung TCPM9092P&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_4006FH5_PAL</span><span class="p">,</span> 	<span class="s">&quot;Temic 4006FH5&quot;</span> <span class="p">},</span>
	<span class="cm">/* 30-39 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Samsung TCPN9085D&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Samsung TCPB9085P&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Samsung TCPL9091P&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_4039FR5_NTSC</span><span class="p">,</span> 	<span class="s">&quot;Temic 4039FR5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FQ1216ME</span><span class="p">,</span>   	<span class="s">&quot;Philips FQ1216 ME&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_4066FY5_PAL_I</span><span class="p">,</span> 	<span class="s">&quot;Temic 4066FY5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_NTSC</span><span class="p">,</span>        	<span class="s">&quot;Philips TD1536&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_NTSC</span><span class="p">,</span>        	<span class="s">&quot;Philips TD1536D&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_NTSC</span><span class="p">,</span>  		<span class="s">&quot;Philips FMR1236&quot;</span> <span class="p">},</span> <span class="cm">/* mono radio */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips FI1256MP&quot;</span> <span class="p">},</span>
	<span class="cm">/* 40-49 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Samsung TCPQ9091P&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_4006FN5_MULTI_PAL</span><span class="p">,</span> <span class="s">&quot;Temic 4006FN5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_4009FR5_PAL</span><span class="p">,</span> 	<span class="s">&quot;Temic 4009FR5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_4046FM5</span><span class="p">,</span>     	<span class="s">&quot;Temic 4046FM5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEMIC_4009FN5_MULTI_PAL_FM</span><span class="p">,</span> <span class="s">&quot;Temic 4009FN5&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips TD1536D FH 44&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_NTSC_FM</span><span class="p">,</span>    		<span class="s">&quot;LG TP18NSR01F&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_PAL_FM</span><span class="p">,</span>     		<span class="s">&quot;LG TP18PSB01D&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_PAL</span><span class="p">,</span>        		<span class="s">&quot;LG TP18PSB11D&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_PAL_I_FM</span><span class="p">,</span>   		<span class="s">&quot;LG TAPC-I001D&quot;</span><span class="p">},</span>
	<span class="cm">/* 50-59 */</span>
	<span class="p">{</span> <span class="n">TUNER_LG_PAL_I</span><span class="p">,</span>      		<span class="s">&quot;LG TAPC-I701D&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>       		<span class="s">&quot;Temic 4042FI5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_MICROTUNE_4049FM5</span><span class="p">,</span> 	<span class="s">&quot;Microtune 4049 FM5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TPI8NSR11F&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Microtune 4049 FM5 Alt I2C&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1216ME_MK3</span><span class="p">,</span> 	<span class="s">&quot;Philips FQ1216ME MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips FI1236 MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1216ME_MK3</span><span class="p">,</span> 	<span class="s">&quot;Philips FM1216 ME MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1236_MK3</span><span class="p">,</span> 	<span class="s">&quot;Philips FM1236 MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips FM1216MP MK3&quot;</span><span class="p">},</span>
	<span class="cm">/* 60-69 */</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1216ME_MK3</span><span class="p">,</span> 	<span class="s">&quot;LG S001D MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG M001D MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1216ME_MK3</span><span class="p">,</span> 	<span class="s">&quot;LG S701D MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG M701D MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Temic 4146FM5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Temic 4136FY5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Temic 4106FH5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips FQ1216LMP MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_NTSC_TAPE</span><span class="p">,</span>  		<span class="s">&quot;LG TAPE H001F MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_NTSC_TAPE</span><span class="p">,</span>  		<span class="s">&quot;LG TAPE H701F MK3&quot;</span><span class="p">},</span>
	<span class="cm">/* 70-79 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TALN H200T&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TALN H250T&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TALN M200T&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TALN Z200T&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TALN S200T&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Thompson DTT7595&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Thompson DTT7592&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Silicon TDA8275C1 8290&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Silicon TDA8275C1 8290 FM&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Thompson DTT757&quot;</span><span class="p">},</span>
	<span class="cm">/* 80-89 */</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FQ1216LME_MK3</span><span class="p">,</span> 	<span class="s">&quot;Philips FQ1216LME MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_PAL_NEW_TAPC</span><span class="p">,</span> 	<span class="s">&quot;LG TAPC G701D&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_NTSC_NEW_TAPC</span><span class="p">,</span> 	<span class="s">&quot;LG TAPC H791F&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_PAL_NEW_TAPC</span><span class="p">,</span> 	<span class="s">&quot;TCL 2002MB 3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_LG_PAL_NEW_TAPC</span><span class="p">,</span> 	<span class="s">&quot;TCL 2002MI 3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TCL_2002N</span><span class="p">,</span>     		<span class="s">&quot;TCL 2002N 6A&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1236_MK3</span><span class="p">,</span> 	<span class="s">&quot;Philips FQ1236 MK3&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_SAMSUNG_TCPN_2121P30A</span><span class="p">,</span> 	<span class="s">&quot;Samsung TCPN 2121P30A&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Samsung TCPE 4121P30A&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1216ME_MK3</span><span class="p">,</span> 	<span class="s">&quot;TCL MFPE05 2&quot;</span><span class="p">},</span>
	<span class="cm">/* 90-99 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TALN H202T&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FQ1216AME_MK4</span><span class="p">,</span> 	<span class="s">&quot;Philips FQ1216AME MK4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FQ1236A_MK4</span><span class="p">,</span> 	<span class="s">&quot;Philips FQ1236A MK4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>       		<span class="s">&quot;Philips FQ1286A MK4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips FQ1216ME MK5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips FQ1236 MK5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_SAMSUNG_TCPG_6121P30A</span><span class="p">,</span> 	<span class="s">&quot;Samsung TCPG 6121P30A&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TCL_2002MB</span><span class="p">,</span>    		<span class="s">&quot;TCL 2002MB_3H&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL 2002MI_3H&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TCL_2002N</span><span class="p">,</span>     		<span class="s">&quot;TCL 2002N 5H&quot;</span><span class="p">},</span>
	<span class="cm">/* 100-109 */</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FMD1216ME_MK3</span><span class="p">,</span> 	<span class="s">&quot;Philips FMD1216ME&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TEA5767</span><span class="p">,</span>       		<span class="s">&quot;Philips TEA5768HL FM Radio&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Panasonic ENV57H12D5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1236_MK3</span><span class="p">,</span> 	<span class="s">&quot;TCL MFNM05-4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1236_MK3</span><span class="p">,</span>	<span class="s">&quot;TCL MNM05-4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1216ME_MK3</span><span class="p">,</span> 	<span class="s">&quot;TCL MPE05-2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MQNM05-4&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TAPC-W701D&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL 9886P-WM&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL 1676NM-WM&quot;</span><span class="p">},</span>
	<span class="cm">/* 110-119 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Thompson DTT75105&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Conexant_CX24109&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TCL_2002N</span><span class="p">,</span>     		<span class="s">&quot;TCL M2523_5N_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_TCL_2002MB</span><span class="p">,</span>    		<span class="s">&quot;TCL M2523_3DB_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips 8275A&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Microtune MT2060&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1236_MK3</span><span class="p">,</span> 	<span class="s">&quot;Philips FM1236 MK5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FM1216ME_MK3</span><span class="p">,</span> 	<span class="s">&quot;Philips FM1216ME MK5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL M2523_3DI_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Samsung THPD5222FG30A&quot;</span><span class="p">},</span>
	<span class="cm">/* 120-129 */</span>
	<span class="p">{</span> <span class="n">TUNER_XC2028</span><span class="p">,</span>        		<span class="s">&quot;Xceive XC3028&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FQ1216LME_MK3</span><span class="p">,</span>	<span class="s">&quot;Philips FQ1216LME MK5&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips FQD1216LME&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Conexant CX24118A&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL DMF11WIP&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MFNM05_4H_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MNM05_4H_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MPE05_2H_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MQNM05_4_U&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL M2523_5NH_E&quot;</span><span class="p">},</span>
	<span class="cm">/* 130-139 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL M2523_3DBH_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL M2523_3DIH_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MFPE05_2_U&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FMD1216MEX_MK3</span><span class="p">,</span>	<span class="s">&quot;Philips FMD1216MEX&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips FRH2036B&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Panasonic ENGF75_01GF&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;MaxLinear MXL5005&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;MaxLinear MXL5003&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Xceive XC2028&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Microtune MT2131&quot;</span><span class="p">},</span>
	<span class="cm">/* 140-149 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Philips 8275A_8295&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MF02GIP_5N_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MF02GIP_3DB_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MF02GIP_3DI_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;Microtune MT2266&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL MF10WPP_4N_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;LG TAPQ_H702F&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;TCL M09WPP_4N_E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>        		<span class="s">&quot;MaxLinear MXL5005_v2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_TDA8290</span><span class="p">,</span> 	<span class="s">&quot;Philips 18271_8295&quot;</span><span class="p">},</span>
	<span class="cm">/* 150-159 */</span>
	<span class="p">{</span> <span class="n">TUNER_XC5000</span><span class="p">,</span>                 <span class="s">&quot;Xceive XC5000&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Xceive XC3028L&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;NXP 18271C2_716x&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Xceive XC4000&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Dibcom 7070&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_TDA8290</span><span class="p">,</span>        <span class="s">&quot;NXP 18271C2&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Siano SMS1010&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Siano SMS1150&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;MaxLinear 5007&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;TCL M09WPP_2P_E&quot;</span><span class="p">},</span>
	<span class="cm">/* 160-169 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Siano SMS1180&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Maxim_MAX2165&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Siano SMS1140&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Siano SMS1150 B1&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;MaxLinear 111&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Dibcom 7770&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Siano SMS1180VNS&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Siano SMS1184&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_PHILIPS_FQ1236_MK5</span><span class="p">,</span>	<span class="s">&quot;TCL M30WTP-4N-E&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;TCL_M11WPP_2PN_E&quot;</span><span class="p">},</span>
	<span class="cm">/* 170-179 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;MaxLinear 301&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Mirics MSi001&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;MaxLinear MxL241SF&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_XC5000C</span><span class="p">,</span>                <span class="s">&quot;Xceive XC5000C&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Montage M68TS2020&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Siano SMS1530&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Dibcom 7090&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Xceive XC5200C&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;NXP 18273&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;Montage M88TS2022&quot;</span><span class="p">},</span>
	<span class="cm">/* 180-189 */</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;NXP 18272M&quot;</span><span class="p">},</span>
	<span class="p">{</span> <span class="n">TUNER_ABSENT</span><span class="p">,</span>                 <span class="s">&quot;NXP 18272S&quot;</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Use V4L2_IDENT_AMBIGUOUS for those audio &#39;chips&#39; that are</span>
<span class="cm"> * internal to a video chip, i.e. not a separate audio chip. */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">HAUPPAUGE_AUDIOIC</span>
<span class="p">{</span>
	<span class="n">u32</span>   <span class="n">id</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">audioIC</span><span class="p">[]</span> <span class="o">=</span>
<span class="p">{</span>
	<span class="cm">/* 0-4 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_NONE</span><span class="p">,</span>      <span class="s">&quot;None&quot;</span>      <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">,</span>   <span class="s">&quot;TEA6300&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">,</span>   <span class="s">&quot;TEA6320&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">,</span>   <span class="s">&quot;TDA9850&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3400C&quot;</span>  <span class="p">},</span>
	<span class="cm">/* 5-9 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3410D&quot;</span>  <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3415&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3430&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3438&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">,</span>   <span class="s">&quot;CS5331&quot;</span>    <span class="p">},</span>
	<span class="cm">/* 10-14 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3435&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3440&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3445&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3411&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3416&quot;</span>   <span class="p">},</span>
	<span class="cm">/* 15-19 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3425&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3451&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP3418&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">,</span>   <span class="s">&quot;Type 0x12&quot;</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">,</span>   <span class="s">&quot;OKI7716&quot;</span>   <span class="p">},</span>
	<span class="cm">/* 20-24 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4410&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4420&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4440&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4450&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4408&quot;</span>   <span class="p">},</span>
	<span class="cm">/* 25-29 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4418&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4428&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4448&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;MSP4458&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_MSPX4XX</span><span class="p">,</span>   <span class="s">&quot;Type 0x1d&quot;</span> <span class="p">},</span>
	<span class="cm">/* 30-34 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX880&quot;</span>     <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX881&quot;</span>     <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX883&quot;</span>     <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX882&quot;</span>     <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX25840&quot;</span>   <span class="p">},</span>
	<span class="cm">/* 35-39 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX25841&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX25842&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX25843&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX23418&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX23885&quot;</span>   <span class="p">},</span>
	<span class="cm">/* 40-44 */</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX23888&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;SAA7131&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;CX23887&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;SAA7164&quot;</span>   <span class="p">},</span>
	<span class="p">{</span> <span class="n">V4L2_IDENT_AMBIGUOUS</span><span class="p">,</span> <span class="s">&quot;AU8522&quot;</span>    <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* This list is supplied by Hauppauge. Thanks! */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">decoderIC</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* 0-4 */</span>
	<span class="s">&quot;None&quot;</span><span class="p">,</span> <span class="s">&quot;BT815&quot;</span><span class="p">,</span> <span class="s">&quot;BT817&quot;</span><span class="p">,</span> <span class="s">&quot;BT819&quot;</span><span class="p">,</span> <span class="s">&quot;BT815A&quot;</span><span class="p">,</span>
	<span class="cm">/* 5-9 */</span>
	<span class="s">&quot;BT817A&quot;</span><span class="p">,</span> <span class="s">&quot;BT819A&quot;</span><span class="p">,</span> <span class="s">&quot;BT827&quot;</span><span class="p">,</span> <span class="s">&quot;BT829&quot;</span><span class="p">,</span> <span class="s">&quot;BT848&quot;</span><span class="p">,</span>
	<span class="cm">/* 10-14 */</span>
	<span class="s">&quot;BT848A&quot;</span><span class="p">,</span> <span class="s">&quot;BT849A&quot;</span><span class="p">,</span> <span class="s">&quot;BT829A&quot;</span><span class="p">,</span> <span class="s">&quot;BT827A&quot;</span><span class="p">,</span> <span class="s">&quot;BT878&quot;</span><span class="p">,</span>
	<span class="cm">/* 15-19 */</span>
	<span class="s">&quot;BT879&quot;</span><span class="p">,</span> <span class="s">&quot;BT880&quot;</span><span class="p">,</span> <span class="s">&quot;VPX3226E&quot;</span><span class="p">,</span> <span class="s">&quot;SAA7114&quot;</span><span class="p">,</span> <span class="s">&quot;SAA7115&quot;</span><span class="p">,</span>
	<span class="cm">/* 20-24 */</span>
	<span class="s">&quot;CX880&quot;</span><span class="p">,</span> <span class="s">&quot;CX881&quot;</span><span class="p">,</span> <span class="s">&quot;CX883&quot;</span><span class="p">,</span> <span class="s">&quot;SAA7111&quot;</span><span class="p">,</span> <span class="s">&quot;SAA7113&quot;</span><span class="p">,</span>
	<span class="cm">/* 25-29 */</span>
	<span class="s">&quot;CX882&quot;</span><span class="p">,</span> <span class="s">&quot;TVP5150A&quot;</span><span class="p">,</span> <span class="s">&quot;CX25840&quot;</span><span class="p">,</span> <span class="s">&quot;CX25841&quot;</span><span class="p">,</span> <span class="s">&quot;CX25842&quot;</span><span class="p">,</span>
	<span class="cm">/* 30-34 */</span>
	<span class="s">&quot;CX25843&quot;</span><span class="p">,</span> <span class="s">&quot;CX23418&quot;</span><span class="p">,</span> <span class="s">&quot;NEC61153&quot;</span><span class="p">,</span> <span class="s">&quot;CX23885&quot;</span><span class="p">,</span> <span class="s">&quot;CX23888&quot;</span><span class="p">,</span>
	<span class="cm">/* 35-39 */</span>
	<span class="s">&quot;SAA7131&quot;</span><span class="p">,</span> <span class="s">&quot;CX25837&quot;</span><span class="p">,</span> <span class="s">&quot;CX23887&quot;</span><span class="p">,</span> <span class="s">&quot;CX23885A&quot;</span><span class="p">,</span> <span class="s">&quot;CX23887A&quot;</span><span class="p">,</span>
	<span class="cm">/* 40-42 */</span>
	<span class="s">&quot;SAA7164&quot;</span><span class="p">,</span> <span class="s">&quot;CX23885B&quot;</span><span class="p">,</span> <span class="s">&quot;AU8522&quot;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hasRadioTuner</span><span class="p">(</span><span class="kt">int</span> <span class="n">tunerType</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">tunerType</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">18</span>: <span class="cm">/* PNPEnv_TUNER_FR1236_MK2 */</span>
	<span class="k">case</span> <span class="mi">23</span>: <span class="cm">/* PNPEnv_TUNER_FM1236 */</span>
	<span class="k">case</span> <span class="mi">38</span>: <span class="cm">/* PNPEnv_TUNER_FMR1236 */</span>
	<span class="k">case</span> <span class="mi">16</span>: <span class="cm">/* PNPEnv_TUNER_FR1216_MK2 */</span>
	<span class="k">case</span> <span class="mi">19</span>: <span class="cm">/* PNPEnv_TUNER_FR1246_MK2 */</span>
	<span class="k">case</span> <span class="mi">21</span>: <span class="cm">/* PNPEnv_TUNER_FM1216 */</span>
	<span class="k">case</span> <span class="mi">24</span>: <span class="cm">/* PNPEnv_TUNER_FM1246 */</span>
	<span class="k">case</span> <span class="mi">17</span>: <span class="cm">/* PNPEnv_TUNER_FR1216MF_MK2 */</span>
	<span class="k">case</span> <span class="mi">22</span>: <span class="cm">/* PNPEnv_TUNER_FM1216MF */</span>
	<span class="k">case</span> <span class="mi">20</span>: <span class="cm">/* PNPEnv_TUNER_FR1256_MK2 */</span>
	<span class="k">case</span> <span class="mi">25</span>: <span class="cm">/* PNPEnv_TUNER_FM1256 */</span>
	<span class="k">case</span> <span class="mi">33</span>: <span class="cm">/* PNPEnv_TUNER_4039FR5 */</span>
	<span class="k">case</span> <span class="mi">42</span>: <span class="cm">/* PNPEnv_TUNER_4009FR5 */</span>
	<span class="k">case</span> <span class="mi">52</span>: <span class="cm">/* PNPEnv_TUNER_4049FM5 */</span>
	<span class="k">case</span> <span class="mi">54</span>: <span class="cm">/* PNPEnv_TUNER_4049FM5_AltI2C */</span>
	<span class="k">case</span> <span class="mi">44</span>: <span class="cm">/* PNPEnv_TUNER_4009FN5 */</span>
	<span class="k">case</span> <span class="mi">31</span>: <span class="cm">/* PNPEnv_TUNER_TCPB9085P */</span>
	<span class="k">case</span> <span class="mi">30</span>: <span class="cm">/* PNPEnv_TUNER_TCPN9085D */</span>
	<span class="k">case</span> <span class="mi">46</span>: <span class="cm">/* PNPEnv_TUNER_TP18NSR01F */</span>
	<span class="k">case</span> <span class="mi">47</span>: <span class="cm">/* PNPEnv_TUNER_TP18PSB01D */</span>
	<span class="k">case</span> <span class="mi">49</span>: <span class="cm">/* PNPEnv_TUNER_TAPC_I001D */</span>
	<span class="k">case</span> <span class="mi">60</span>: <span class="cm">/* PNPEnv_TUNER_TAPE_S001D_MK3 */</span>
	<span class="k">case</span> <span class="mi">57</span>: <span class="cm">/* PNPEnv_TUNER_FM1216ME_MK3 */</span>
	<span class="k">case</span> <span class="mi">59</span>: <span class="cm">/* PNPEnv_TUNER_FM1216MP_MK3 */</span>
	<span class="k">case</span> <span class="mi">58</span>: <span class="cm">/* PNPEnv_TUNER_FM1236_MK3 */</span>
	<span class="k">case</span> <span class="mi">68</span>: <span class="cm">/* PNPEnv_TUNER_TAPE_H001F_MK3 */</span>
	<span class="k">case</span> <span class="mi">61</span>: <span class="cm">/* PNPEnv_TUNER_TAPE_M001D_MK3 */</span>
	<span class="k">case</span> <span class="mi">78</span>: <span class="cm">/* PNPEnv_TUNER_TDA8275C1_8290_FM */</span>
	<span class="k">case</span> <span class="mi">89</span>: <span class="cm">/* PNPEnv_TUNER_TCL_MFPE05_2 */</span>
	<span class="k">case</span> <span class="mi">92</span>: <span class="cm">/* PNPEnv_TUNER_PHILIPS_FQ1236A_MK4 */</span>
	<span class="k">case</span> <span class="mi">105</span>:
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">tveeprom_hauppauge_analog</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="k">struct</span> <span class="n">tveeprom</span> <span class="o">*</span><span class="n">tvee</span><span class="p">,</span>
				<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">eeprom_data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* ----------------------------------------------</span>
<span class="cm">	** The hauppauge eeprom format is tagged</span>
<span class="cm">	**</span>
<span class="cm">	** if packet[0] == 0x84, then packet[0..1] == length</span>
<span class="cm">	** else length = packet[0] &amp; 3f;</span>
<span class="cm">	** if packet[0] &amp; f8 == f8, then EOD and packet[1] == checksum</span>
<span class="cm">	**</span>
<span class="cm">	** In our (ivtv) case we&#39;re interested in the following:</span>
<span class="cm">	** tuner type:   tag [00].05 or [0a].01 (index into hauppauge_tuner)</span>
<span class="cm">	** tuner fmts:   tag [00].04 or [0a].00 (bitmask index into</span>
<span class="cm">	**		 hauppauge_tuner_fmt)</span>
<span class="cm">	** radio:        tag [00].{last} or [0e].00  (bitmask.  bit2=FM)</span>
<span class="cm">	** audio proc:   tag [02].01 or [05].00 (mask with 0x7f)</span>
<span class="cm">	** decoder proc: tag [09].01)</span>

<span class="cm">	** Fun info:</span>
<span class="cm">	** model:      tag [00].07-08 or [06].00-01</span>
<span class="cm">	** revision:   tag [00].09-0b or [06].04-06</span>
<span class="cm">	** serial#:    tag [01].05-07 or [04].04-06</span>

<span class="cm">	** # of inputs/outputs ???</span>
<span class="cm">	*/</span>

	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">beenhere</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">start</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">tuner1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">t_format1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">audioic</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">t_name1</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot; none&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">};</span>

	<span class="kt">int</span> <span class="n">tuner2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">t_format2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">t_name2</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot; none&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span> <span class="p">};</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">tvee</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">tvee</span><span class="p">));</span>
	<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner_type</span> <span class="o">=</span> <span class="n">TUNER_ABSENT</span><span class="p">;</span>
	<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner2_type</span> <span class="o">=</span> <span class="n">TUNER_ABSENT</span><span class="p">;</span>

	<span class="n">done</span> <span class="o">=</span> <span class="n">len</span> <span class="o">=</span> <span class="n">beenhere</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Different eeprom start offsets for em28xx, cx2388x and cx23418 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x1a</span> <span class="o">&amp;&amp;</span>
	    <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xeb</span> <span class="o">&amp;&amp;</span>
	    <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x67</span> <span class="o">&amp;&amp;</span>
	    <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x95</span><span class="p">)</span>
		<span class="n">start</span> <span class="o">=</span> <span class="mh">0xa0</span><span class="p">;</span> <span class="cm">/* Generic em28xx offset */</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">eeprom_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xe1</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x01</span> <span class="o">&amp;&amp;</span>
		 <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="o">&amp;&amp;</span>
		 <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="o">&amp;&amp;</span>
		 <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x84</span><span class="p">)</span>
		<span class="n">start</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="cm">/* Generic cx2388x offset */</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x70</span> <span class="o">&amp;&amp;</span>
		 <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x00</span> <span class="o">&amp;&amp;</span>
		 <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x74</span> <span class="o">&amp;&amp;</span>
		 <span class="n">eeprom_data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x84</span><span class="p">)</span>
		<span class="n">start</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="cm">/* Generic cx23418 offset (models 74xxx) */</span>
	<span class="k">else</span>
		<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span> <span class="o">!</span><span class="n">done</span> <span class="o">&amp;&amp;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x84</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">len</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
			<span class="n">i</span> <span class="o">+=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x70</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* verify checksum! */</span>
				<span class="n">done</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">len</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">;</span>
			<span class="o">++</span><span class="n">i</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">tveeprom_warn</span><span class="p">(</span><span class="s">&quot;Encountered bad packet header [%02x]. &quot;</span>
				<span class="s">&quot;Corrupt or not a Hauppauge eeprom.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;Tag [%02x] + %d bytes:&quot;</span><span class="p">,</span>
					<span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
				<span class="n">printk</span><span class="p">(</span><span class="n">KERN_CONT</span> <span class="s">&quot; %02x&quot;</span><span class="p">,</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]);</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_CONT</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>

		<span class="cm">/* process by tag */</span>
		<span class="n">tag</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x00</span>:
			<span class="cm">/* tag: &#39;Comprehensive&#39; */</span>
			<span class="n">tuner1</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">];</span>
			<span class="n">t_format1</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">];</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_radio</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">len</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
			<span class="cm">/* old style tag, don&#39;t know how to detect</span>
<span class="cm">			IR presence, mark as unknown. */</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_ir</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">model</span> <span class="o">=</span>
				<span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">9</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">revision</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">11</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">12</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x01</span>:
			<span class="cm">/* tag: &#39;SerialID&#39; */</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">serial_number</span> <span class="o">=</span>
				<span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">8</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x02</span>:
			<span class="cm">/* tag &#39;AudioInfo&#39;</span>
<span class="cm">			Note mask with 0x7F, high bit used on some older models</span>
<span class="cm">			to indicate 4052 mux was removed in favor of using MSP</span>
<span class="cm">			inputs directly. */</span>
			<span class="n">audioic</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">audioic</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">audioIC</span><span class="p">))</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">audio_processor</span> <span class="o">=</span> <span class="n">audioIC</span><span class="p">[</span><span class="n">audioic</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">audio_processor</span> <span class="o">=</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* case 0x03: tag &#39;EEInfo&#39; */</span>

		<span class="k">case</span> <span class="mh">0x04</span>:
			<span class="cm">/* tag &#39;SerialID2&#39; */</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">serial_number</span> <span class="o">=</span>
				<span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">7</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>

			<span class="k">if</span> <span class="p">((</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">8</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
					<span class="p">(</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">serial_number</span> <span class="o">&lt;</span> <span class="mh">0xffffff</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">MAC_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">MAC_address</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0D</span><span class="p">;</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">MAC_address</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xFE</span><span class="p">;</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">MAC_address</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">7</span><span class="p">];</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">MAC_address</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">];</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">MAC_address</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">];</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_MAC_address</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x05</span>:
			<span class="cm">/* tag &#39;Audio2&#39;</span>
<span class="cm">			Note mask with 0x7F, high bit used on some older models</span>
<span class="cm">			to indicate 4052 mux was removed in favor of using MSP</span>
<span class="cm">			inputs directly. */</span>
			<span class="n">audioic</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">audioic</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">audioIC</span><span class="p">))</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">audio_processor</span> <span class="o">=</span> <span class="n">audioIC</span><span class="p">[</span><span class="n">audioic</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
			<span class="k">else</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">audio_processor</span> <span class="o">=</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">;</span>

			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x06</span>:
			<span class="cm">/* tag &#39;ModelRev&#39; */</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">model</span> <span class="o">=</span>
				<span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">24</span><span class="p">);</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">revision</span> <span class="o">=</span>
				<span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">5</span><span class="p">]</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">6</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span>
				<span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">7</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x07</span>:
			<span class="cm">/* tag &#39;Details&#39;: according to Hauppauge not interesting</span>
<span class="cm">			on any PCI-era or later boards. */</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* there is no tag 0x08 defined */</span>

		<span class="k">case</span> <span class="mh">0x09</span>:
			<span class="cm">/* tag &#39;Video&#39; */</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">decoder_processor</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x0a</span>:
			<span class="cm">/* tag &#39;Tuner&#39; */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">beenhere</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">tuner1</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
				<span class="n">t_format1</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
				<span class="n">beenhere</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* a second (radio) tuner may be present */</span>
				<span class="n">tuner2</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
				<span class="n">t_format2</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
				<span class="cm">/* not a TV tuner? */</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">t_format2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
					<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_radio</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="cm">/* must be radio */</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x0b</span>:
			<span class="cm">/* tag &#39;Inputs&#39;: according to Hauppauge this is specific</span>
<span class="cm">			to each driver family, so no good assumptions can be</span>
<span class="cm">			made. */</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* case 0x0c: tag &#39;Balun&#39; */</span>
		<span class="cm">/* case 0x0d: tag &#39;Teletext&#39; */</span>

		<span class="k">case</span> <span class="mh">0x0e</span>:
			<span class="cm">/* tag: &#39;Radio&#39; */</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_radio</span> <span class="o">=</span> <span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="k">case</span> <span class="mh">0x0f</span>:
			<span class="cm">/* tag &#39;IRInfo&#39; */</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_ir</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">|</span> <span class="p">(</span><span class="n">eeprom_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* case 0x10: tag &#39;VBIInfo&#39; */</span>
		<span class="cm">/* case 0x11: tag &#39;QCInfo&#39; */</span>
		<span class="cm">/* case 0x12: tag &#39;InfoBits&#39; */</span>

		<span class="nl">default:</span>
			<span class="n">tveeprom_dbg</span><span class="p">(</span><span class="s">&quot;Not sure what to do with tag [%02x]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">tag</span><span class="p">);</span>
			<span class="cm">/* dump the rest of the packet? */</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">done</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tveeprom_warn</span><span class="p">(</span><span class="s">&quot;Ran out of data!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">revision</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">rev_str</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">+</span> <span class="p">((</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">revision</span> <span class="o">&gt;&gt;</span> <span class="mi">18</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">);</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">rev_str</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">+</span> <span class="p">((</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">revision</span> <span class="o">&gt;&gt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">);</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">rev_str</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">+</span> <span class="p">((</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">revision</span> <span class="o">&gt;&gt;</span>  <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">);</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">rev_str</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">+</span> <span class="p">(</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">revision</span> <span class="o">&amp;</span> <span class="mh">0x3f</span><span class="p">);</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">rev_str</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hasRadioTuner</span><span class="p">(</span><span class="n">tuner1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_radio</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;The eeprom says no radio is present, but the tuner type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;indicates otherwise. I will assume that radio is present.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_radio</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tuner1</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">hauppauge_tuner</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner_type</span> <span class="o">=</span> <span class="n">hauppauge_tuner</span><span class="p">[</span><span class="n">tuner1</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
		<span class="n">t_name1</span> <span class="o">=</span> <span class="n">hauppauge_tuner</span><span class="p">[</span><span class="n">tuner1</span><span class="p">].</span><span class="n">name</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">t_name1</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">tuner2</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">hauppauge_tuner</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner2_type</span> <span class="o">=</span> <span class="n">hauppauge_tuner</span><span class="p">[</span><span class="n">tuner2</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
		<span class="n">t_name2</span> <span class="o">=</span> <span class="n">hauppauge_tuner</span><span class="p">[</span><span class="n">tuner2</span><span class="p">].</span><span class="n">name</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">t_name2</span> <span class="o">=</span> <span class="s">&quot;unknown&quot;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner_hauppauge_model</span> <span class="o">=</span> <span class="n">tuner1</span><span class="p">;</span>
	<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner2_hauppauge_model</span> <span class="o">=</span> <span class="n">tuner2</span><span class="p">;</span>
	<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner_formats</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner2_formats</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">t_format1</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner_formats</span> <span class="o">|=</span> <span class="n">hauppauge_tuner_fmt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
			<span class="n">t_fmt_name1</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">hauppauge_tuner_fmt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">t_format2</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner2_formats</span> <span class="o">|=</span> <span class="n">hauppauge_tuner_fmt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">id</span><span class="p">;</span>
			<span class="n">t_fmt_name2</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">hauppauge_tuner_fmt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;Hauppauge model %d, rev %s, serial# %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">model</span><span class="p">,</span> <span class="n">tvee</span><span class="o">-&gt;</span><span class="n">rev_str</span><span class="p">,</span> <span class="n">tvee</span><span class="o">-&gt;</span><span class="n">serial_number</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_MAC_address</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;MAC address is %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">tvee</span><span class="o">-&gt;</span><span class="n">MAC_address</span><span class="p">);</span>
	<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;tuner model is %s (idx %d, type %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">t_name1</span><span class="p">,</span> <span class="n">tuner1</span><span class="p">,</span> <span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner_type</span><span class="p">);</span>
	<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;TV standards%s%s%s%s%s%s%s%s (eeprom 0x%02x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		<span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
		<span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>	<span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
		<span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">t_fmt_name1</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span>	<span class="n">t_format1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tuner2</span><span class="p">)</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;second tuner model is %s (idx %d, type %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">t_name2</span><span class="p">,</span> <span class="n">tuner2</span><span class="p">,</span> <span class="n">tvee</span><span class="o">-&gt;</span><span class="n">tuner2_type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">t_format2</span><span class="p">)</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;TV standards%s%s%s%s%s%s%s%s (eeprom 0x%02x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			<span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>	<span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
			<span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">t_fmt_name2</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">t_format2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">audioic</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;audio processor is unknown (no idx)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">audio_processor</span> <span class="o">=</span> <span class="n">V4L2_IDENT_UNKNOWN</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">audioic</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">audioIC</span><span class="p">))</span>
			<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;audio processor is %s (idx %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">audioIC</span><span class="p">[</span><span class="n">audioic</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">audioic</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;audio processor is unknown (idx %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
								<span class="n">audioic</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">decoder_processor</span><span class="p">)</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;decoder processor is %s (idx %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">STRM</span><span class="p">(</span><span class="n">decoderIC</span><span class="p">,</span> <span class="n">tvee</span><span class="o">-&gt;</span><span class="n">decoder_processor</span><span class="p">),</span>
			<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">decoder_processor</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_ir</span><span class="p">)</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;has %sradio, has %sIR receiver, has %sIR transmitter</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_radio</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot;no &quot;</span><span class="p">,</span>
				<span class="p">(</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_ir</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot;no &quot;</span><span class="p">,</span>
				<span class="p">(</span><span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_ir</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot;no &quot;</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;has %sradio</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">tvee</span><span class="o">-&gt;</span><span class="n">has_radio</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot;no &quot;</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">tveeprom_hauppauge_analog</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------------------- */</span>
<span class="cm">/* generic helper functions                                                */</span>

<span class="kt">int</span> <span class="nf">tveeprom_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">i2c_client</span> <span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">eedata</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">i2c_master_send</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;Huh, no eeprom present (err=%d)?</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">i2c_master_recv</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">eedata</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="n">len</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">tveeprom_warn</span><span class="p">(</span><span class="s">&quot;i2c eeprom read error (err=%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">debug</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

		<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;full 256-byte eeprom dump:</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">16</span><span class="p">))</span>
				<span class="n">tveeprom_info</span><span class="p">(</span><span class="s">&quot;%02x:&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_CONT</span> <span class="s">&quot; %02x&quot;</span><span class="p">,</span> <span class="n">eedata</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
			<span class="k">if</span> <span class="p">(</span><span class="mi">15</span> <span class="o">==</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">16</span><span class="p">))</span>
				<span class="n">printk</span><span class="p">(</span><span class="n">KERN_CONT</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL</span><span class="p">(</span><span class="n">tveeprom_read</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Local variables:</span>
<span class="cm"> * c-basic-offset: 8</span>
<span class="cm"> * End:</span>
<span class="cm"> */</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
