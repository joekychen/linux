<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › gspca › sq930x.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>sq930x.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * SQ930x subdriver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2010 Jean-François Moine &lt;http://moinejf.free.fr&gt;</span>
<span class="cm"> * Copyright (C) 2006 -2008 Gerard Klaver &lt;gerard at gkall dot hobby dot nl&gt;</span>
<span class="cm"> * Copyright (C) 2007 Sam Revitch &lt;samr7@cs.washington.edu&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> */</span>

<span class="cp">#define pr_fmt(fmt) KBUILD_MODNAME &quot;: &quot; fmt</span>

<span class="cp">#define MODULE_NAME &quot;sq930x&quot;</span>

<span class="cp">#include &quot;gspca.h&quot;</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Jean-Francois Moine &lt;http://moinejf.free.fr&gt;</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="s">&quot;Gerard Klaver &lt;gerard at gkall dot hobby dot nl</span><span class="se">\n</span><span class="s">&quot;</span>
		<span class="s">&quot;Sam Revitch &lt;samr7@cs.washington.edu&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;GSPCA/SQ930x USB Camera Driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

<span class="cm">/* Structure to hold all of our device specific stuff */</span>
<span class="k">struct</span> <span class="n">sd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gspca_dev</span> <span class="n">gspca_dev</span><span class="p">;</span>	<span class="cm">/* !! must be the first item */</span>

	<span class="n">u16</span> <span class="n">expo</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">gain</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">do_ctrl</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">gpio</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">sensor</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">type</span><span class="p">;</span>
<span class="cp">#define Generic 0</span>
<span class="cp">#define Creative_live_motion 1</span>
<span class="p">};</span>
<span class="k">enum</span> <span class="n">sensors</span> <span class="p">{</span>
	<span class="n">SENSOR_ICX098BQ</span><span class="p">,</span>
	<span class="n">SENSOR_LZ24BP</span><span class="p">,</span>
	<span class="n">SENSOR_MI0360</span><span class="p">,</span>
	<span class="n">SENSOR_MT9V111</span><span class="p">,</span>		<span class="cm">/* = MI360SOC */</span>
	<span class="n">SENSOR_OV7660</span><span class="p">,</span>
	<span class="n">SENSOR_OV9630</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_setexpo</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_getexpo</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_setgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_getgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ctrl</span> <span class="n">sd_ctrls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_EXPOSURE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Exposure&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mh">0x0001</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mh">0x0fff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="cp">#define EXPO_DEF 0x0356</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">EXPO_DEF</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setexpo</span><span class="p">,</span>
	    <span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getexpo</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_GAIN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Gain&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="cp">#define GAIN_DEF 0x8d</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">GAIN_DEF</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setgain</span><span class="p">,</span>
	    <span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getgain</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">vga_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SRGGB8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SRGGB8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">640</span> <span class="o">*</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* sq930x registers */</span>
<span class="cp">#define SQ930_CTRL_UCBUS_IO	0x0001</span>
<span class="cp">#define SQ930_CTRL_I2C_IO	0x0002</span>
<span class="cp">#define SQ930_CTRL_GPIO		0x0005</span>
<span class="cp">#define SQ930_CTRL_CAP_START	0x0010</span>
<span class="cp">#define SQ930_CTRL_CAP_STOP	0x0011</span>
<span class="cp">#define SQ930_CTRL_SET_EXPOSURE 0x001d</span>
<span class="cp">#define SQ930_CTRL_RESET	0x001e</span>
<span class="cp">#define SQ930_CTRL_GET_DEV_INFO 0x001f</span>

<span class="cm">/* gpio 1 (8..15) */</span>
<span class="cp">#define SQ930_GPIO_DFL_I2C_SDA	0x0001</span>
<span class="cp">#define SQ930_GPIO_DFL_I2C_SCL	0x0002</span>
<span class="cp">#define SQ930_GPIO_RSTBAR	0x0004</span>
<span class="cp">#define SQ930_GPIO_EXTRA1	0x0040</span>
<span class="cp">#define SQ930_GPIO_EXTRA2	0x0080</span>
<span class="cm">/* gpio 3 (24..31) */</span>
<span class="cp">#define SQ930_GPIO_POWER	0x0200</span>
<span class="cp">#define SQ930_GPIO_DFL_LED	0x1000</span>

<span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="p">{</span>
	<span class="n">u16</span>	<span class="n">bw_addr</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">bw_data</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">reg</span><span class="p">;</span>
	<span class="n">u16</span>	<span class="n">val</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">icx098bq_start_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x0354</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x03fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf801</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf802</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf804</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf808</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf809</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf80a</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf80b</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf80c</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf80d</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf80e</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf80f</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81c</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf81d</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81e</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81f</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf83a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf83b</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf83c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf83d</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf810</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf811</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf812</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf813</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf803</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf814</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf815</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf816</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf817</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf818</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf819</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81b</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf82f</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf820</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf821</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf822</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf823</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf824</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf825</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf826</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf827</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf828</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf829</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf82a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf82b</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf82c</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf82d</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf82e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf830</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf831</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf832</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf833</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf850</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf851</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf852</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf853</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf854</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf855</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf856</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf857</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf858</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf859</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85b</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf85c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85d</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85f</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf860</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf861</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf862</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf863</span><span class="p">,</span> <span class="mh">0xdc</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf864</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf865</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf866</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf867</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf868</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf869</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86c</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf86a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86b</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86e</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf870</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf871</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf872</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf873</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf874</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf875</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf876</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf877</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf878</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf879</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf87a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf87b</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">}</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">icx098bq_start_1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f6</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f7</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f9</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">icx098bq_start_2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf805</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf806</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf805</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf806</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf805</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf806</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf805</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf806</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">lz24bp_start_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x0354</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x03fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf801</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf802</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf804</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf808</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf809</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf80a</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf80b</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf80c</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf80d</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf80e</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf80f</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf81d</span><span class="p">,</span> <span class="mh">0x49</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81e</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81f</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf83a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf83b</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf83c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf83d</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf810</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf811</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf812</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf813</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf803</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf814</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf815</span><span class="p">,</span> <span class="mh">0x44</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf816</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf817</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf818</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf819</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf81b</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf82f</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf820</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf821</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf822</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf823</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf824</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf825</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf826</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf827</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf828</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf829</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf82a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf82b</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf82c</span><span class="p">,</span> <span class="mh">0xfc</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf82d</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf82e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf830</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf831</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf832</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf833</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf850</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf851</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf852</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf853</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf854</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf855</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf856</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf857</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf858</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf859</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85b</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf85c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85d</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf85f</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf860</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf861</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf862</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf863</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf864</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf865</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf866</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf867</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf868</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf869</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86c</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86d</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf86a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86b</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86e</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf86f</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf870</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf871</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf872</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf873</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf874</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf875</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf876</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf877</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf878</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf879</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf87a</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf87b</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">}</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">lz24bp_start_1_gen</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f6</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f7</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f9</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">lz24bp_start_1_clm</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f6</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f7</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f9</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">lz24bp_start_2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf805</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf806</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf805</span><span class="p">,</span> <span class="mh">0x4e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf806</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf805</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf806</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf805</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf806</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf807</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf800</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">mi0360_start_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x0354</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x03fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf332</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf333</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf334</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf335</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf33f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mi0360_init_23</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x0040</span><span class="p">},</span>		<span class="cm">/* reserved - def 0x0005 */</span>
	<span class="p">{</span><span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">},</span>		<span class="cm">/* reserved - def 0x002a */</span>
	<span class="p">{</span><span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x0100</span><span class="p">},</span>		<span class="cm">/* reserved - def 0x0100 */</span>
	<span class="p">{</span><span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x068f</span><span class="p">},</span>		<span class="cm">/* reserved - def 0x068f */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mi0360_init_24</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01e5</span><span class="p">},</span>		<span class="cm">/* window height */</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0285</span><span class="p">},</span>		<span class="cm">/* window width */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mi0360_init_25</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">},</span>		<span class="cm">/* global gain */</span>
	<span class="p">{</span><span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">},</span>		<span class="cm">/* green1 gain */</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x002a</span><span class="p">},</span>		<span class="cm">/* blue gain */</span>
	<span class="p">{</span><span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x0028</span><span class="p">},</span>		<span class="cm">/* red gain */</span>
	<span class="p">{</span><span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">},</span>		<span class="cm">/* green2 gain */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">mi0360_start_1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0x99</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f6</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f7</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f8</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f9</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mi0360_start_2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x041d</span><span class="p">},</span>		<span class="cm">/* reserved - def 0x0418 */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mi0360_start_3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x007b</span><span class="p">},</span>		<span class="cm">/* horiz blanking */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mi0360_start_4</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x03f5</span><span class="p">},</span>		<span class="cm">/* horiz blanking */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mt9v111_init_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">},</span>		<span class="cm">/* select IFP/SOC registers */</span>
	<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x300c</span><span class="p">},</span>		<span class="cm">/* operating mode control */</span>
	<span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0xcc00</span><span class="p">},</span>		<span class="cm">/* output format control (RGB) */</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">},</span>		<span class="cm">/* select sensor core registers */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mt9v111_init_1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x01e5</span><span class="p">},</span>		<span class="cm">/* window height */</span>
	<span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x0285</span><span class="p">},</span>		<span class="cm">/* window width */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mt9v111_init_2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x7800</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x3002</span><span class="p">},</span>		<span class="cm">/* output control */</span>
	<span class="p">{</span><span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">},</span>		<span class="cm">/* global gain */</span>
	<span class="p">{</span><span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">},</span>		<span class="cm">/* green1 gain */</span>
	<span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">},</span>		<span class="cm">/* blue gain */</span>
	<span class="p">{</span><span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">},</span>		<span class="cm">/* red gain */</span>
	<span class="p">{</span><span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x0020</span><span class="p">},</span>		<span class="cm">/* green2 gain */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">mt9v111_start_1</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f0</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f1</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f2</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f3</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f4</span><span class="p">,</span> <span class="mh">0xaa</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f6</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f7</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf5f8</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf5f9</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">}</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mt9v111_init_3</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x0405</span><span class="p">},</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="n">mt9v111_init_4</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/*	{0x05, 0x00ce}, */</span>
	<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x005d</span><span class="p">},</span>		<span class="cm">/* horizontal blanking */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">ov7660_start_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x0354</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x03fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf332</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf333</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf334</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf335</span><span class="p">,</span> <span class="mh">0xe7</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf33f</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">ov9630_start_0</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x0354</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x03fa</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf332</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf333</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xf334</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf335</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">},</span> <span class="p">{</span><span class="mh">0xf33f</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* start parameters indexed by [sensor][mode] */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">cap_s</span> <span class="p">{</span>
	<span class="n">u8</span>	<span class="n">cc_sizeid</span><span class="p">;</span>
	<span class="n">u8</span>	<span class="n">cc_bytes</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>
<span class="p">}</span> <span class="n">capconfig</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">SENSOR_ICX098BQ</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mi">2</span><span class="p">,</span>				<span class="cm">/* Bayer 320x240 */</span>
		  <span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x9f</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span>
		   <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
		<span class="p">{</span><span class="mi">4</span><span class="p">,</span>				<span class="cm">/* Bayer 640x480 */</span>
		  <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x9f</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span>
		   <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">SENSOR_LZ24BP</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mi">2</span><span class="p">,</span>				<span class="cm">/* Bayer 320x240 */</span>
		  <span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span>
		   <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
		<span class="p">{</span><span class="mi">4</span><span class="p">,</span>				<span class="cm">/* Bayer 640x480 */</span>
		  <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span>
		   <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">SENSOR_MI0360</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mi">2</span><span class="p">,</span>				<span class="cm">/* Bayer 320x240 */</span>
		  <span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span>
		   <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
		<span class="p">{</span><span class="mi">4</span><span class="p">,</span>				<span class="cm">/* Bayer 640x480 */</span>
		  <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span>
		   <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">},</span>
	<span class="p">[</span><span class="n">SENSOR_MT9V111</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mi">2</span><span class="p">,</span>				<span class="cm">/* Bayer 320x240 */</span>
		  <span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span>
		   <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
		<span class="p">{</span><span class="mi">4</span><span class="p">,</span>				<span class="cm">/* Bayer 640x480 */</span>
		  <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">,</span>
		   <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		   <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}</span> <span class="p">},</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sensor_s</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i2c_addr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">i2c_dum</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">gpio</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">cmd_len</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="o">*</span><span class="n">cmd</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_s</span> <span class="n">sensor_tb</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">SENSOR_ICX098BQ</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;icx098bp&quot;</span><span class="p">,</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		<span class="p">{</span><span class="mi">0</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span> <span class="o">|</span> <span class="n">SQ930_GPIO_DFL_I2C_SCL</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_RSTBAR</span>
		<span class="p">},</span>
		<span class="mi">8</span><span class="p">,</span> <span class="n">icx098bq_start_0</span>
	    <span class="p">},</span>
	<span class="p">[</span><span class="n">SENSOR_LZ24BP</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;lz24bp&quot;</span><span class="p">,</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		<span class="p">{</span><span class="mi">0</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span> <span class="o">|</span> <span class="n">SQ930_GPIO_DFL_I2C_SCL</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_RSTBAR</span>
		<span class="p">},</span>
		<span class="mi">8</span><span class="p">,</span> <span class="n">lz24bp_start_0</span>
	    <span class="p">},</span>
	<span class="p">[</span><span class="n">SENSOR_MI0360</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;mi0360&quot;</span><span class="p">,</span>
		<span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
		<span class="p">{</span><span class="n">SQ930_GPIO_RSTBAR</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span> <span class="o">|</span> <span class="n">SQ930_GPIO_DFL_I2C_SCL</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span>
		<span class="p">},</span>
		<span class="mi">7</span><span class="p">,</span> <span class="n">mi0360_start_0</span>
	    <span class="p">},</span>
	<span class="p">[</span><span class="n">SENSOR_MT9V111</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;mt9v111&quot;</span><span class="p">,</span>
		<span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span>
		<span class="p">{</span><span class="n">SQ930_GPIO_RSTBAR</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span> <span class="o">|</span> <span class="n">SQ930_GPIO_DFL_I2C_SCL</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">,</span>
		 <span class="mi">0</span>
		<span class="p">},</span>
		<span class="mi">7</span><span class="p">,</span> <span class="n">mi0360_start_0</span>
	    <span class="p">},</span>
	<span class="p">[</span><span class="n">SENSOR_OV7660</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;ov7660&quot;</span><span class="p">,</span>
		<span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		<span class="p">{</span><span class="mi">0</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span> <span class="o">|</span> <span class="n">SQ930_GPIO_DFL_I2C_SCL</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_RSTBAR</span>
		<span class="p">},</span>
		<span class="mi">7</span><span class="p">,</span> <span class="n">ov7660_start_0</span>
	    <span class="p">},</span>
	<span class="p">[</span><span class="n">SENSOR_OV9630</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;ov9630&quot;</span><span class="p">,</span>
		<span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		<span class="p">{</span><span class="mi">0</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span> <span class="o">|</span> <span class="n">SQ930_GPIO_DFL_I2C_SCL</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_DFL_I2C_SDA</span><span class="p">,</span>
		 <span class="mi">0</span><span class="p">,</span>
		 <span class="n">SQ930_GPIO_RSTBAR</span>
		<span class="p">},</span>
		<span class="mi">7</span><span class="p">,</span> <span class="n">ov9630_start_0</span>
	    <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">reg_r</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
		<span class="n">u16</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_rcvctrlpipe</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="mh">0x0c</span><span class="p">,</span>
			<span class="n">USB_DIR_IN</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="n">value</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span>
			<span class="mi">500</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg_r %04x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">reg_w</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">value</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;reg_w v: %04x i: %04x&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="mh">0x0c</span><span class="p">,</span>			<span class="cm">/* request */</span>
			<span class="n">USB_DIR_OUT</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="mi">500</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg_w %04x %04x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">reg_wb</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">u16</span> <span class="n">value</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span>
		<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;reg_wb v: %04x i: %04x %02x...%02x&quot;</span><span class="p">,</span>
			<span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">len</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]);</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="mh">0x0c</span><span class="p">,</span>			<span class="cm">/* request */</span>
			<span class="n">USB_DIR_OUT</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span>
			<span class="mi">1000</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg_wb %04x %04x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2c_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">i2c_write_cmd</span> <span class="o">*</span><span class="n">cmd</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">ncmds</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_s</span> <span class="o">*</span><span class="n">sensor</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">val</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">sensor</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sensor_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">];</span>

	<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">sensor</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">SQ930_CTRL_I2C_IO</span><span class="p">;</span>
	<span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xff00</span><span class="p">)</span> <span class="o">|</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">;</span>
	<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">-&gt;</span><span class="n">i2c_dum</span><span class="p">;</span>
	<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">ncmds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cmd</span><span class="o">++</span><span class="p">;</span>
		<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">;</span>
		<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
		<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">-&gt;</span><span class="n">i2c_dum</span><span class="p">;</span>
		<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;i2c_w v: %04x i: %04x %02x...%02x&quot;</span><span class="p">,</span>
			<span class="n">val</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="mh">0x0c</span><span class="p">,</span>			<span class="cm">/* request */</span>
			<span class="n">USB_DIR_OUT</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="n">val</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span> <span class="n">buf</span> <span class="o">-</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span>
			<span class="mi">500</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;i2c_write failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ucbus_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="o">*</span><span class="n">cmd</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">ncmds</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">batchsize</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">val</span><span class="p">,</span> <span class="n">idx</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

<span class="cp">#ifdef GSPCA_DEBUG</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">batchsize</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">&gt;</span> <span class="n">USB_BUF_SZ</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Bug: usb_buf overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#endif</span>

	<span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
		<span class="n">len</span> <span class="o">=</span> <span class="n">ncmds</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;</span> <span class="n">batchsize</span><span class="p">)</span>
			<span class="n">len</span> <span class="o">=</span> <span class="n">batchsize</span><span class="p">;</span>
		<span class="n">ncmds</span> <span class="o">-=</span> <span class="n">len</span><span class="p">;</span>

		<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">bw_addr</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="n">SQ930_CTRL_UCBUS_IO</span><span class="p">;</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">bw_data</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">bw_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>

		<span class="n">buf</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">;</span>
		<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">len</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">cmd</span><span class="o">++</span><span class="p">;</span>
			<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">bw_addr</span><span class="p">;</span>
			<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">bw_addr</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
			<span class="o">*</span><span class="n">buf</span><span class="o">++</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">bw_data</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">buf</span> <span class="o">!=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">)</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;ucbus v: %04x i: %04x %02x...%02x&quot;</span><span class="p">,</span>
					<span class="n">val</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span>
					<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">buf</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
		<span class="k">else</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;ucbus v: %04x i: %04x&quot;</span><span class="p">,</span>
					<span class="n">val</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				<span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
				<span class="mh">0x0c</span><span class="p">,</span>			<span class="cm">/* request */</span>
			   <span class="n">USB_DIR_OUT</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
				<span class="n">val</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span>
				<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span> <span class="n">buf</span> <span class="o">-</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span>
				<span class="mi">500</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;ucbus_write failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ncmds</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">cmd</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">gpio_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u16</span> <span class="n">val</span><span class="p">,</span> <span class="n">u16</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mask</span> <span class="o">&amp;</span> <span class="mh">0x00ff</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|=</span> <span class="n">val</span><span class="p">;</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x0100</span> <span class="o">|</span> <span class="n">SQ930_CTRL_GPIO</span><span class="p">,</span>
			<span class="o">~</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">mask</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">val</span> <span class="o">&gt;&gt;=</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">|=</span> <span class="n">val</span><span class="p">;</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x0300</span> <span class="o">|</span> <span class="n">SQ930_CTRL_GPIO</span><span class="p">,</span>
			<span class="o">~</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">gpio_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">gpio</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="o">*</span><span class="n">gpio</span><span class="o">++</span><span class="p">,</span> <span class="mh">0x000f</span><span class="p">);</span>
	<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="o">*</span><span class="n">gpio</span><span class="o">++</span><span class="p">,</span> <span class="mh">0x000f</span><span class="p">);</span>
	<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="o">*</span><span class="n">gpio</span><span class="o">++</span><span class="p">,</span> <span class="mh">0x000f</span><span class="p">);</span>
	<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="o">*</span><span class="n">gpio</span><span class="o">++</span><span class="p">,</span> <span class="mh">0x000f</span><span class="p">);</span>
	<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="o">*</span><span class="n">gpio</span><span class="p">,</span> <span class="mh">0x000f</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">bridge_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">clkfreq_cmd</span> <span class="o">=</span> <span class="p">{</span>
				<span class="mh">0xf031</span><span class="p">,</span> <span class="mi">0</span>	<span class="cm">/* SQ930_CLKFREQ_60MHZ */</span>
	<span class="p">};</span>

	<span class="n">ucbus_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">clkfreq_cmd</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">SQ930_GPIO_POWER</span><span class="p">,</span> <span class="mh">0xff00</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cmos_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_s</span> <span class="o">*</span><span class="n">sensor</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">probe_order</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/*		SENSOR_LZ24BP,		(tested as ccd) */</span>
		<span class="n">SENSOR_OV9630</span><span class="p">,</span>
		<span class="n">SENSOR_MI0360</span><span class="p">,</span>
		<span class="n">SENSOR_OV7660</span><span class="p">,</span>
		<span class="n">SENSOR_MT9V111</span><span class="p">,</span>
	<span class="p">};</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">probe_order</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sensor</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sensor_tb</span><span class="p">[</span><span class="n">probe_order</span><span class="p">[</span><span class="n">i</span><span class="p">]];</span>
		<span class="n">ucbus_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">sensor</span><span class="o">-&gt;</span><span class="n">cmd</span><span class="p">,</span> <span class="n">sensor</span><span class="o">-&gt;</span><span class="n">cmd_len</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">gpio_init</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">sensor</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="n">reg_r</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="p">(</span><span class="n">sensor</span><span class="o">-&gt;</span><span class="n">i2c_addr</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x001c</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">probe_order</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Unknown sensor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">probe_order</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SENSOR_OV7660</span>:
	<span class="k">case</span> <span class="n">SENSOR_OV9630</span>:
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Sensor %s not yet treated</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">sensor_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mt9v111_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">nwait</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">cmd_001b</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">cmd_011b</span><span class="p">[][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xae</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">};</span>

	<span class="n">reg_wb</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x001b</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="n">cmd_001b</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">cmd_001b</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cmd_011b</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg_wb</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x001b</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">,</span> <span class="n">cmd_011b</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cmd_011b</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">400</span><span class="p">);</span>
		<span class="n">nwait</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
		<span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
			<span class="n">reg_r</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x031b</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
			 <span class="o">||</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">nwait</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;mt9v111_init timeout&quot;</span><span class="p">);</span>
				<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">=</span> <span class="o">-</span><span class="n">ETIME</span><span class="p">;</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">global_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">first_time</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SENSOR_ICX098BQ</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">first_time</span><span class="p">)</span>
			<span class="n">ucbus_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">,</span>
					<span class="n">icx098bq_start_0</span><span class="p">,</span>
					<span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">gpio_init</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">sensor_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">].</span><span class="n">gpio</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SENSOR_LZ24BP</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">!=</span> <span class="n">Creative_live_motion</span><span class="p">)</span>
			<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">SQ930_GPIO_EXTRA1</span><span class="p">,</span> <span class="mh">0x00ff</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mh">0x00ff</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">first_time</span><span class="p">)</span>
			<span class="n">ucbus_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">,</span>
					<span class="n">lz24bp_start_0</span><span class="p">,</span>
					<span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">gpio_init</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">sensor_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">].</span><span class="n">gpio</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SENSOR_MI0360</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">first_time</span><span class="p">)</span>
			<span class="n">ucbus_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">,</span>
					<span class="n">mi0360_start_0</span><span class="p">,</span>
					<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_start_0</span><span class="p">),</span>
					<span class="mi">8</span><span class="p">);</span>
		<span class="n">gpio_init</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">sensor_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">].</span><span class="n">gpio</span><span class="p">);</span>
		<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">SQ930_GPIO_EXTRA2</span><span class="p">,</span> <span class="n">SQ930_GPIO_EXTRA2</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
<span class="cm">/*	case SENSOR_MT9V111: */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">first_time</span><span class="p">)</span>
			<span class="n">mt9v111_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">gpio_init</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">sensor_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">].</span><span class="n">gpio</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">lz24bp_ppl</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u16</span> <span class="n">ppl</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">ucbus_write_cmd</span> <span class="n">cmds</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="mh">0xf810</span><span class="p">,</span> <span class="n">ppl</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">},</span>
		<span class="p">{</span><span class="mh">0xf811</span><span class="p">,</span> <span class="n">ppl</span><span class="p">}</span>
	<span class="p">};</span>

	<span class="n">ucbus_write</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">cmds</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cmds</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">integclks</span><span class="p">,</span> <span class="n">intstartclk</span><span class="p">,</span> <span class="n">frameclks</span><span class="p">,</span> <span class="n">min_frclk</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_s</span> <span class="o">*</span><span class="n">sensor</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">cmd</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">buf</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>

	<span class="n">integclks</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">expo</span><span class="p">;</span>
	<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">cmd</span> <span class="o">=</span> <span class="n">SQ930_CTRL_SET_EXPOSURE</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SENSOR_ICX098BQ</span>:			<span class="cm">/* ccd */</span>
	<span class="k">case</span> <span class="n">SENSOR_LZ24BP</span>:
		<span class="n">min_frclk</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SENSOR_ICX098BQ</span> <span class="o">?</span> <span class="mh">0x210</span> <span class="o">:</span> <span class="mh">0x26f</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">integclks</span> <span class="o">&gt;=</span> <span class="n">min_frclk</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">intstartclk</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">frameclks</span> <span class="o">=</span> <span class="n">integclks</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">intstartclk</span> <span class="o">=</span> <span class="n">min_frclk</span> <span class="o">-</span> <span class="n">integclks</span><span class="p">;</span>
			<span class="n">frameclks</span> <span class="o">=</span> <span class="n">min_frclk</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">intstartclk</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">intstartclk</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">frameclks</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">frameclks</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>				<span class="cm">/* cmos */</span>
<span class="cm">/*	case SENSOR_MI0360: */</span>
<span class="cm">/*	case SENSOR_MT9V111: */</span>
		<span class="n">cmd</span> <span class="o">|=</span> <span class="mh">0x0100</span><span class="p">;</span>
		<span class="n">sensor</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sensor_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">];</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">-&gt;</span><span class="n">i2c_addr</span><span class="p">;</span>	<span class="cm">/* i2c_slave_addr */</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x08</span><span class="p">;</span>	<span class="cm">/* 2 * ni2c */</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>	<span class="cm">/* reg = shutter width */</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">integclks</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span> <span class="cm">/* val H */</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">-&gt;</span><span class="n">i2c_dum</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">integclks</span><span class="p">;</span>	<span class="cm">/* val L */</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x35</span><span class="p">;</span>	<span class="cm">/* reg = global gain */</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>	<span class="cm">/* val H */</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensor</span><span class="o">-&gt;</span><span class="n">i2c_dum</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x80</span> <span class="o">+</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="cm">/* val L */</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x83</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">reg_wb</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* This function is called at probe time just before sd_init */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cam</span> <span class="o">*</span><span class="n">cam</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">driver_info</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">driver_info</span><span class="p">;</span>

	<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">vga_mode</span><span class="p">;</span>
	<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">vga_mode</span><span class="p">);</span>

	<span class="n">cam</span><span class="o">-&gt;</span><span class="n">bulk</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">=</span> <span class="n">GAIN_DEF</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">expo</span> <span class="o">=</span> <span class="n">EXPO_DEF</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* this function is called at probe and resume time */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gpio</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xff</span><span class="p">;</span>	<span class="cm">/* force gpio rewrite */</span>

<span class="cm">/*fixme: is this needed for icx098bp and mi0360?</span>
<span class="cm">	if (sd-&gt;sensor != SENSOR_LZ24BP)</span>
<span class="cm">		reg_w(gspca_dev, SQ930_CTRL_RESET, 0x0000);</span>
<span class="cm"> */</span>

	<span class="n">reg_r</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">SQ930_CTRL_GET_DEV_INFO</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span><span class="p">;</span>

<span class="cm">/* it returns:</span>
<span class="cm"> * 03 00 12 93 0b f6 c9 00	live! ultra</span>
<span class="cm"> * 03 00 07 93 0b f6 ca 00	live! ultra for notebook</span>
<span class="cm"> * 03 00 12 93 0b fe c8 00	Trust WB-3500T</span>
<span class="cm"> * 02 00 06 93 0b fe c8 00	Joy-IT 318S</span>
<span class="cm"> * 03 00 12 93 0b f6 cf 00	icam tracer - sensor icx098bq</span>
<span class="cm"> * 02 00 12 93 0b fe cf 00	ProQ Motion Webcam</span>
<span class="cm"> *</span>
<span class="cm"> * byte</span>
<span class="cm"> * 0: 02 = usb 1.0 (12Mbit) / 03 = usb2.0 (480Mbit)</span>
<span class="cm"> * 1: 00</span>
<span class="cm"> * 2: 06 / 07 / 12 = mode webcam? firmware??</span>
<span class="cm"> * 3: 93 chip = 930b (930b or 930c)</span>
<span class="cm"> * 4: 0b</span>
<span class="cm"> * 5: f6 = cdd (icx098bq, lz24bp) / fe or de = cmos (i2c) (other sensors)</span>
<span class="cm"> * 6: c8 / c9 / ca / cf = mode webcam?, sensor? webcam?</span>
<span class="cm"> * 7: 00</span>
<span class="cm"> */</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;info: %02x %02x %02x %02x %02x %02x %02x %02x&quot;</span><span class="p">,</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">7</span><span class="p">]);</span>

	<span class="n">bridge_init</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SENSOR_MI0360</span><span class="p">)</span> <span class="p">{</span>

		<span class="cm">/* no sensor probe for icam tracer */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xf6</span><span class="p">)</span>	<span class="cm">/* if ccd */</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SENSOR_ICX098BQ</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">cmos_probe</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor %s&quot;</span><span class="p">,</span> <span class="n">sensor_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">].</span><span class="n">name</span><span class="p">);</span>
		<span class="n">global_init</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* send the start/stop commands to the webcam */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">send_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">cap_s</span> <span class="o">*</span><span class="n">cap</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mode</span><span class="p">;</span>

	<span class="n">mode</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">cam_mode</span><span class="p">[</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">curr_mode</span><span class="p">].</span><span class="n">priv</span><span class="p">;</span>
	<span class="n">cap</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">capconfig</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">][</span><span class="n">mode</span><span class="p">];</span>
	<span class="n">reg_wb</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x0900</span> <span class="o">|</span> <span class="n">SQ930_CTRL_CAP_START</span><span class="p">,</span>
			<span class="mh">0x0a00</span> <span class="o">|</span> <span class="n">cap</span><span class="o">-&gt;</span><span class="n">cc_sizeid</span><span class="p">,</span>
			<span class="n">cap</span><span class="o">-&gt;</span><span class="n">cc_bytes</span><span class="p">,</span> <span class="mi">32</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">send_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">SQ930_CTRL_CAP_STOP</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* function called at start time before URB creation */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_isoc_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">bulk_nurbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* there must be one URB only */</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_ctrl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">bulk_size</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">*</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">height</span> <span class="o">+</span> <span class="mi">8</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* start the capture */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mode</span><span class="p">;</span>

	<span class="n">bridge_init</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="n">global_init</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SENSOR_ICX098BQ</span>:
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">icx098bq_start_0</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">icx098bq_start_0</span><span class="p">),</span>
				<span class="mi">8</span><span class="p">);</span>
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">icx098bq_start_1</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">icx098bq_start_1</span><span class="p">),</span>
				<span class="mi">5</span><span class="p">);</span>
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">icx098bq_start_2</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">icx098bq_start_2</span><span class="p">),</span>
				<span class="mi">6</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>

		<span class="cm">/* 1st start */</span>
		<span class="n">send_start</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">SQ930_GPIO_EXTRA2</span> <span class="o">|</span> <span class="n">SQ930_GPIO_RSTBAR</span><span class="p">,</span> <span class="mh">0x00ff</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">70</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">SQ930_CTRL_CAP_STOP</span><span class="p">,</span> <span class="mh">0x0000</span><span class="p">);</span>
		<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x00ff</span><span class="p">);</span>

		<span class="cm">/* 2nd start */</span>
		<span class="n">send_start</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">SQ930_GPIO_EXTRA2</span> <span class="o">|</span> <span class="n">SQ930_GPIO_RSTBAR</span><span class="p">,</span> <span class="mh">0x00ff</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SENSOR_LZ24BP</span>:
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">lz24bp_start_0</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lz24bp_start_0</span><span class="p">),</span>
				<span class="mi">8</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">!=</span> <span class="n">Creative_live_motion</span><span class="p">)</span>
			<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">lz24bp_start_1_gen</span><span class="p">,</span>
					<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lz24bp_start_1_gen</span><span class="p">),</span>
					<span class="mi">5</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">lz24bp_start_1_clm</span><span class="p">,</span>
					<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lz24bp_start_1_clm</span><span class="p">),</span>
					<span class="mi">5</span><span class="p">);</span>
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">lz24bp_start_2</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">lz24bp_start_2</span><span class="p">),</span>
				<span class="mi">6</span><span class="p">);</span>
		<span class="n">mode</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">cam_mode</span><span class="p">[</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">curr_mode</span><span class="p">].</span><span class="n">priv</span><span class="p">;</span>
		<span class="n">lz24bp_ppl</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mode</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="mh">0x0564</span> <span class="o">:</span> <span class="mh">0x0310</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SENSOR_MI0360</span>:
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">mi0360_start_0</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_start_0</span><span class="p">),</span>
				<span class="mi">8</span><span class="p">);</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mi0360_init_23</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_init_23</span><span class="p">));</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mi0360_init_24</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_init_24</span><span class="p">));</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mi0360_init_25</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_init_25</span><span class="p">));</span>
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">mi0360_start_1</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_start_1</span><span class="p">),</span>
				<span class="mi">5</span><span class="p">);</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mi0360_start_2</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_start_2</span><span class="p">));</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mi0360_start_3</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_start_3</span><span class="p">));</span>

		<span class="cm">/* 1st start */</span>
		<span class="n">send_start</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">60</span><span class="p">);</span>
		<span class="n">send_stop</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>

		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span>
			<span class="n">mi0360_start_4</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_start_4</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
<span class="cm">/*	case SENSOR_MT9V111: */</span>
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">mi0360_start_0</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mi0360_start_0</span><span class="p">),</span>
				<span class="mi">8</span><span class="p">);</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mt9v111_init_0</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mt9v111_init_0</span><span class="p">));</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mt9v111_init_1</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mt9v111_init_1</span><span class="p">));</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mt9v111_init_2</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mt9v111_init_2</span><span class="p">));</span>
		<span class="n">ucbus_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">mt9v111_start_1</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mt9v111_start_1</span><span class="p">),</span>
				<span class="mi">5</span><span class="p">);</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mt9v111_init_3</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mt9v111_init_3</span><span class="p">));</span>
		<span class="n">i2c_write</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mt9v111_init_4</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mt9v111_init_4</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">send_start</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SENSOR_MT9V111</span><span class="p">)</span>
		<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">SQ930_GPIO_DFL_LED</span><span class="p">,</span> <span class="n">SQ930_GPIO_DFL_LED</span><span class="p">);</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_ctrl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* set the exposure */</span>

	<span class="k">return</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_stopN</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SENSOR_MT9V111</span><span class="p">)</span>
		<span class="n">gpio_set</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">SQ930_GPIO_DFL_LED</span><span class="p">);</span>
	<span class="n">send_stop</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* function called when the application gets a new frame */</span>
<span class="cm">/* It sets the exposure if required and restart the bulk transfer. */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_dq_callback</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_ctrl</span> <span class="o">||</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">bulk_nurbs</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_ctrl</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">setexposure</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>

	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">bulk_nurbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_submit_urb</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">urb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;sd_dq_callback() err %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>

	<span class="cm">/* wait a little time, otherwise the webcam crashes */</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_pkt_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>		<span class="cm">/* isoc packet */</span>
			<span class="kt">int</span> <span class="n">len</span><span class="p">)</span>		<span class="cm">/* iso packet length */</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_ctrl</span><span class="p">)</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">bulk_nurbs</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">FIRST_PACKET</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">INTER_PACKET</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span>
	<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">LAST_PACKET</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_setgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_ctrl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_getgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_setexpo</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">expo</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_ctrl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_getexpo</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">expo</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* sub-driver description */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sd_desc</span> <span class="n">sd_desc</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>   <span class="o">=</span> <span class="n">MODULE_NAME</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ctrls</span> <span class="o">=</span> <span class="n">sd_ctrls</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nctrls</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sd_ctrls</span><span class="p">),</span>
	<span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">sd_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span>   <span class="o">=</span> <span class="n">sd_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">isoc_init</span> <span class="o">=</span> <span class="n">sd_isoc_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">start</span>  <span class="o">=</span> <span class="n">sd_start</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stopN</span>  <span class="o">=</span> <span class="n">sd_stopN</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pkt_scan</span> <span class="o">=</span> <span class="n">sd_pkt_scan</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dq_callback</span> <span class="o">=</span> <span class="n">sd_dq_callback</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Table of supported USB devices */</span>
<span class="cp">#define ST(sensor, type) \</span>
<span class="cp">	.driver_info = (SENSOR_ ## sensor &lt;&lt; 8) \</span>
<span class="cp">			| (type)</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="n">device_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4038</span><span class="p">),</span> <span class="n">ST</span><span class="p">(</span><span class="n">MI0360</span><span class="p">,</span> <span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x403c</span><span class="p">),</span> <span class="n">ST</span><span class="p">(</span><span class="n">LZ24BP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x403d</span><span class="p">),</span> <span class="n">ST</span><span class="p">(</span><span class="n">LZ24BP</span><span class="p">,</span> <span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4041</span><span class="p">),</span> <span class="n">ST</span><span class="p">(</span><span class="n">LZ24BP</span><span class="p">,</span> <span class="n">Creative_live_motion</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x2770</span><span class="p">,</span> <span class="mh">0x930b</span><span class="p">),</span> <span class="n">ST</span><span class="p">(</span><span class="n">MI0360</span><span class="p">,</span> <span class="mi">0</span><span class="p">)},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x2770</span><span class="p">,</span> <span class="mh">0x930c</span><span class="p">),</span> <span class="n">ST</span><span class="p">(</span><span class="n">MI0360</span><span class="p">,</span> <span class="mi">0</span><span class="p">)},</span>
	<span class="p">{}</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">usb</span><span class="p">,</span> <span class="n">device_table</span><span class="p">);</span>


<span class="cm">/* -- device connect -- */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">intf</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">gspca_dev_probe</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sd_desc</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span><span class="p">),</span>
			<span class="n">THIS_MODULE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usb_driver</span> <span class="n">sd_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>	    <span class="o">=</span> <span class="n">MODULE_NAME</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span>   <span class="o">=</span> <span class="n">device_table</span><span class="p">,</span>
	<span class="p">.</span><span class="n">probe</span>	    <span class="o">=</span> <span class="n">sd_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disconnect</span> <span class="o">=</span> <span class="n">gspca_disconnect</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_PM</span>
	<span class="p">.</span><span class="n">suspend</span>    <span class="o">=</span> <span class="n">gspca_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resume</span>     <span class="o">=</span> <span class="n">gspca_resume</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="n">module_usb_driver</span><span class="p">(</span><span class="n">sd_driver</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
