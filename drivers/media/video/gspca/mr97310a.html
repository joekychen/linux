<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › gspca › mr97310a.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>mr97310a.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * Mars MR97310A library</span>
<span class="cm"> *</span>
<span class="cm"> * The original mr97310a driver, which supported the Aiptek Pencam VGA+, is</span>
<span class="cm"> * Copyright (C) 2009 Kyle Guinn &lt;elyk03@gmail.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Support for the MR97310A cameras in addition to the Aiptek Pencam VGA+</span>
<span class="cm"> * and for the routines for detecting and classifying these various cameras,</span>
<span class="cm"> * is Copyright (C) 2009 Theodore Kilgore &lt;kilgota@auburn.edu&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Support for the control settings for the CIF cameras is</span>
<span class="cm"> * Copyright (C) 2009 Hans de Goede &lt;hdegoede@redhat.com&gt; and</span>
<span class="cm"> * Thomas Kaiser &lt;thomas@kaiser-linux.li&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Support for the control settings for the VGA cameras is</span>
<span class="cm"> * Copyright (C) 2009 Theodore Kilgore &lt;kilgota@auburn.edu&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Several previously unsupported cameras are owned and have been tested by</span>
<span class="cm"> * Hans de Goede &lt;hdegoede@redhat.com&gt; and</span>
<span class="cm"> * Thomas Kaiser &lt;thomas@kaiser-linux.li&gt; and</span>
<span class="cm"> * Theodore Kilgore &lt;kilgota@auburn.edu&gt; and</span>
<span class="cm"> * Edmond Rodriguez &lt;erodrig_97@yahoo.com&gt; and</span>
<span class="cm"> * Aurelien Jacobs &lt;aurel@gnuage.org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * The MR97311A support in gspca/mars.c has been helpful in understanding some</span>
<span class="cm"> * of the registers in these cameras.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> */</span>

<span class="cp">#define pr_fmt(fmt) KBUILD_MODNAME &quot;: &quot; fmt</span>

<span class="cp">#define MODULE_NAME &quot;mr97310a&quot;</span>

<span class="cp">#include &quot;gspca.h&quot;</span>

<span class="cp">#define CAM_TYPE_CIF			0</span>
<span class="cp">#define CAM_TYPE_VGA			1</span>

<span class="cp">#define MR97310A_BRIGHTNESS_DEFAULT	0</span>

<span class="cp">#define MR97310A_EXPOSURE_MIN		0</span>
<span class="cp">#define MR97310A_EXPOSURE_MAX		4095</span>
<span class="cp">#define MR97310A_EXPOSURE_DEFAULT	1000</span>

<span class="cp">#define MR97310A_GAIN_MIN		0</span>
<span class="cp">#define MR97310A_GAIN_MAX		31</span>
<span class="cp">#define MR97310A_GAIN_DEFAULT		25</span>

<span class="cp">#define MR97310A_CONTRAST_MIN		0</span>
<span class="cp">#define MR97310A_CONTRAST_MAX		31</span>
<span class="cp">#define MR97310A_CONTRAST_DEFAULT	23</span>

<span class="cp">#define MR97310A_CS_GAIN_MIN		0</span>
<span class="cp">#define MR97310A_CS_GAIN_MAX		0x7ff</span>
<span class="cp">#define MR97310A_CS_GAIN_DEFAULT	0x110</span>

<span class="cp">#define MR97310A_MIN_CLOCKDIV_MIN	3</span>
<span class="cp">#define MR97310A_MIN_CLOCKDIV_MAX	8</span>
<span class="cp">#define MR97310A_MIN_CLOCKDIV_DEFAULT	3</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Kyle Guinn &lt;elyk03@gmail.com&gt;,&quot;</span>
	      <span class="s">&quot;Theodore Kilgore &lt;kilgota@auburn.edu&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;GSPCA/Mars-Semi MR97310A USB Camera Driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

<span class="cm">/* global parameters */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">force_sensor_type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">force_sensor_type</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">force_sensor_type</span><span class="p">,</span> <span class="s">&quot;Force sensor type (-1 (auto), 0 or 1)&quot;</span><span class="p">);</span>

<span class="cm">/* specific webcam descriptor */</span>
<span class="k">struct</span> <span class="n">sd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gspca_dev</span> <span class="n">gspca_dev</span><span class="p">;</span>  <span class="cm">/* !! must be the first item */</span>
	<span class="n">u8</span> <span class="n">sof_read</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">cam_type</span><span class="p">;</span>	<span class="cm">/* 0 is CIF and 1 is VGA */</span>
	<span class="n">u8</span> <span class="n">sensor_type</span><span class="p">;</span>	<span class="cm">/* We use 0 and 1 here, too. */</span>
	<span class="n">u8</span> <span class="n">do_lcd_stop</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">adj_colors</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">brightness</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">exposure</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">gain</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">contrast</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">min_clockdiv</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">];</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">sd_stopN</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_setbrightness</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_getbrightness</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_setexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_getexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_getcontrast</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_setcontrast</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_setgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_getgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_setmin_clockdiv</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_getmin_clockdiv</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setbrightness</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setcontrast</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>

<span class="cm">/* V4L2 controls supported by the driver */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ctrl</span> <span class="n">sd_ctrls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="cm">/* Separate brightness control description for Argus QuickClix as it has</span>
<span class="cm"> * different limits from the other mr97310a cameras, and separate gain</span>
<span class="cm"> * control for Sakar CyberPix camera. */</span>
	<span class="p">{</span>
<span class="cp">#define NORM_BRIGHTNESS_IDX 0</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_BRIGHTNESS</span><span class="p">,</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Brightness&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="o">-</span><span class="mi">254</span><span class="p">,</span>
			<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
			<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">MR97310A_BRIGHTNESS_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setbrightness</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getbrightness</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
<span class="cp">#define ARGUS_QC_BRIGHTNESS_IDX 1</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_BRIGHTNESS</span><span class="p">,</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Brightness&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
			<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">15</span><span class="p">,</span>
			<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">MR97310A_BRIGHTNESS_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setbrightness</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getbrightness</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
<span class="cp">#define EXPOSURE_IDX 2</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_EXPOSURE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Exposure&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">MR97310A_EXPOSURE_MIN</span><span class="p">,</span>
			<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">MR97310A_EXPOSURE_MAX</span><span class="p">,</span>
			<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">MR97310A_EXPOSURE_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setexposure</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getexposure</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
<span class="cp">#define GAIN_IDX 3</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_GAIN</span><span class="p">,</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Gain&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">MR97310A_GAIN_MIN</span><span class="p">,</span>
			<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">MR97310A_GAIN_MAX</span><span class="p">,</span>
			<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">MR97310A_GAIN_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setgain</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getgain</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
<span class="cp">#define SAKAR_CS_GAIN_IDX 4</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_GAIN</span><span class="p">,</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Gain&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">MR97310A_CS_GAIN_MIN</span><span class="p">,</span>
			<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">MR97310A_CS_GAIN_MAX</span><span class="p">,</span>
			<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">MR97310A_CS_GAIN_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setgain</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getgain</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
<span class="cp">#define CONTRAST_IDX 5</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_CONTRAST</span><span class="p">,</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Contrast&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">MR97310A_CONTRAST_MIN</span><span class="p">,</span>
			<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">MR97310A_CONTRAST_MAX</span><span class="p">,</span>
			<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">MR97310A_CONTRAST_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setcontrast</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getcontrast</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
<span class="cp">#define MIN_CLOCKDIV_IDX 6</span>
		<span class="p">{</span>
			<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">V4L2_CID_PRIVATE_BASE</span><span class="p">,</span>
			<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
			<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Minimum Clock Divider&quot;</span><span class="p">,</span>
			<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">MR97310A_MIN_CLOCKDIV_MIN</span><span class="p">,</span>
			<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="n">MR97310A_MIN_CLOCKDIV_MAX</span><span class="p">,</span>
			<span class="p">.</span><span class="n">step</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
			<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">MR97310A_MIN_CLOCKDIV_DEFAULT</span><span class="p">,</span>
			<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setmin_clockdiv</span><span class="p">,</span>
		<span class="p">.</span><span class="n">get</span> <span class="o">=</span> <span class="n">sd_getmin_clockdiv</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">vga_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">160</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_MR97310A</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">160</span> <span class="o">*</span> <span class="mi">120</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">4</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">176</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_MR97310A</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">176</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">176</span> <span class="o">*</span> <span class="mi">144</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_MR97310A</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">352</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_MR97310A</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">352</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">352</span> <span class="o">*</span> <span class="mi">288</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_MR97310A</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">640</span> <span class="o">*</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* the bytes to write are in gspca_dev-&gt;usb_buf */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mr_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">usb_bulk_msg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			  <span class="n">usb_sndbulkpipe</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
			  <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg write [%02x] error %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rc</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* the bytes are read into gspca_dev-&gt;usb_buf */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">mr_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">rc</span> <span class="o">=</span> <span class="n">usb_bulk_msg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
			  <span class="n">usb_rcvbulkpipe</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
			  <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg read [%02x] error %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rc</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sensor_write_reg</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">flags</span><span class="p">,</span>
	<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1f</span><span class="p">;</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">memcpy</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span> <span class="o">+</span> <span class="mi">3</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">len</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sensor_write_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">len</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">rc</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">sensor_write_reg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">reg</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">flags</span><span class="p">,</span>
					  <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">len</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sensor_write1</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">buf</span><span class="p">,</span> <span class="n">confirm_reg</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">==</span> <span class="n">CAM_TYPE_CIF</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">sensor_write_reg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">confirm_reg</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">?</span> <span class="mh">0x13</span> <span class="o">:</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">rc</span> <span class="o">=</span> <span class="n">sensor_write_reg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">confirm_reg</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	<span class="n">rc</span> <span class="o">=</span> <span class="n">sensor_write_reg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">confirm_reg</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cam_get_response16</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="kt">int</span> <span class="n">verbose</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_read</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">verbose</span><span class="p">)</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Register: %02x reads %02x%02x%02x&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span>
		       <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
		       <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
		       <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">zero_the_pointer</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err_code</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">cam_get_response16</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x51</span><span class="p">;</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">cam_get_response16</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xba</span><span class="p">;</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">cam_get_response16</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">cam_get_response16</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="k">while</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mh">0x0a</span> <span class="o">&amp;&amp;</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">cam_get_response16</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">tries</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">!=</span> <span class="mh">0x0a</span><span class="p">)</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_ERR</span><span class="p">,</span> <span class="s">&quot;status is %02x&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">);</span>

	<span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">tries</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

		<span class="n">err_code</span> <span class="o">=</span> <span class="n">cam_get_response16</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">status</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">tries</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_read</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">stream_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">stream_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x01</span><span class="p">;</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_ERR</span><span class="p">,</span> <span class="s">&quot;Stream Stop failed&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">lcd_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">;</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x54</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_ERR</span><span class="p">,</span> <span class="s">&quot;LCD Stop failed&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">isoc_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x4d</span><span class="p">;</span>  <span class="cm">/* ISOC transferring enable... */</span>
	<span class="k">return</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* This function is called at probe time */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
		     <span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cam</span> <span class="o">*</span><span class="n">cam</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">gain_default</span> <span class="o">=</span> <span class="n">MR97310A_GAIN_DEFAULT</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">cam</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">;</span>
	<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">vga_mode</span><span class="p">;</span>
	<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">vga_mode</span><span class="p">);</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_lcd_stop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Several of the supported CIF cameras share the same USB ID but</span>
<span class="cm">	 * require different initializations and different control settings.</span>
<span class="cm">	 * The same is true of the VGA cameras. Therefore, we are forced</span>
<span class="cm">	 * to start the initialization process in order to determine which</span>
<span class="cm">	 * camera is present. Some of the supported cameras require the</span>
<span class="cm">	 * memory pointer to be set to 0 as the very first item of business</span>
<span class="cm">	 * or else they will not stream. So we do that immediately.</span>
<span class="cm">	 */</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">zero_the_pointer</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">stream_start</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="cm">/* Now, the query for sensor type. */</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">cam_get_response16</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">idProduct</span> <span class="o">==</span> <span class="mh">0x0110</span> <span class="o">||</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">idProduct</span> <span class="o">==</span> <span class="mh">0x010e</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">=</span> <span class="n">CAM_TYPE_CIF</span><span class="p">;</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span><span class="o">--</span><span class="p">;</span>
		<span class="cm">/*</span>
<span class="cm">		 * All but one of the known CIF cameras share the same USB ID,</span>
<span class="cm">		 * but two different init routines are in use, and the control</span>
<span class="cm">		 * settings are different, too. We need to detect which camera</span>
<span class="cm">		 * of the two known varieties is connected!</span>
<span class="cm">		 *</span>
<span class="cm">		 * A list of known CIF cameras follows. They all report either</span>
<span class="cm">		 * 0200 for type 0 or 0300 for type 1.</span>
<span class="cm">		 * If you have another to report, please do</span>
<span class="cm">		 *</span>
<span class="cm">		 * Name		sd-&gt;sensor_type		reported by</span>
<span class="cm">		 *</span>
<span class="cm">		 * Sakar 56379 Spy-shot	0		T. Kilgore</span>
<span class="cm">		 * Innovage		0		T. Kilgore</span>
<span class="cm">		 * Vivitar Mini		0		H. De Goede</span>
<span class="cm">		 * Vivitar Mini		0		E. Rodriguez</span>
<span class="cm">		 * Vivitar Mini		1		T. Kilgore</span>
<span class="cm">		 * Elta-Media 8212dc	1		T. Kaiser</span>
<span class="cm">		 * Philips dig. keych.	1		T. Kilgore</span>
<span class="cm">		 * Trust Spyc@m 100	1		A. Jacobs</span>
<span class="cm">		 */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Unknown CIF Sensor id : %02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;MR97310A CIF camera detected, sensor: %d&quot;</span><span class="p">,</span>
		       <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">=</span> <span class="n">CAM_TYPE_VGA</span><span class="p">;</span>

		<span class="cm">/*</span>
<span class="cm">		 * Here is a table of the responses to the query for sensor</span>
<span class="cm">		 * type, from the known MR97310A VGA cameras. Six different</span>
<span class="cm">		 * cameras of which five share the same USB ID.</span>
<span class="cm">		 *</span>
<span class="cm">		 * Name			gspca_dev-&gt;usb_buf[]	sd-&gt;sensor_type</span>
<span class="cm">		 *				sd-&gt;do_lcd_stop</span>
<span class="cm">		 * Aiptek Pencam VGA+	0300		0		1</span>
<span class="cm">		 * ION digital		0300		0		1</span>
<span class="cm">		 * Argus DC-1620	0450		1		0</span>
<span class="cm">		 * Argus QuickClix	0420		1		1</span>
<span class="cm">		 * Sakar 77379 Digital	0350		0		1</span>
<span class="cm">		 * Sakar 1638x CyberPix	0120		0		2</span>
<span class="cm">		 *</span>
<span class="cm">		 * Based upon these results, we assume default settings</span>
<span class="cm">		 * and then correct as necessary, as follows.</span>
<span class="cm">		 *</span>
<span class="cm">		 */</span>

		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_lcd_stop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">adj_colors</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x01</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
					<span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mh">0x04</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Unknown VGA Sensor id Byte 0: %02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			       <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Defaults assumed, may not work</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Please report this</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="cm">/* Sakar Digital color needs to be adjusted. */</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x03</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
					<span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x50</span><span class="p">))</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">adj_colors</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x04</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_lcd_stop</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mh">0x50</span>:
				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;sensor_type corrected to 0&quot;</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x20</span>:
				<span class="cm">/* Nothing to do here. */</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Unknown VGA Sensor id Byte 1: %02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				       <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
				<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Defaults assumed, may not work</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Please report this</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;MR97310A VGA camera detected, sensor: %d&quot;</span><span class="p">,</span>
		       <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/* Stop streaming as we&#39;ve started it only to probe the sensor type. */</span>
	<span class="n">sd_stopN</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">force_sensor_type</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">=</span> <span class="o">!!</span><span class="n">force_sensor_type</span><span class="p">;</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Forcing sensor type to: %d&quot;</span><span class="p">,</span>
		       <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* Setup controls depending on camera type */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">==</span> <span class="n">CAM_TYPE_CIF</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* No brightness for sensor_type 0 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NORM_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ARGUS_QC_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">SAKAR_CS_GAIN_IDX</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ARGUS_QC_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">SAKAR_CS_GAIN_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">MIN_CLOCKDIV_IDX</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* All controls need to be disabled if VGA sensor_type is 0 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NORM_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ARGUS_QC_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GAIN_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">SAKAR_CS_GAIN_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">MIN_CLOCKDIV_IDX</span><span class="p">);</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NORM_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ARGUS_QC_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GAIN_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">MIN_CLOCKDIV_IDX</span><span class="p">);</span>
			<span class="n">gain_default</span> <span class="o">=</span> <span class="n">MR97310A_CS_GAIN_DEFAULT</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_lcd_stop</span><span class="p">)</span>
			<span class="cm">/* Argus QuickClix has different brightness limits */</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NORM_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">SAKAR_CS_GAIN_IDX</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ARGUS_QC_BRIGHTNESS_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST_IDX</span><span class="p">)</span> <span class="o">|</span>
					      <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">SAKAR_CS_GAIN_IDX</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">brightness</span> <span class="o">=</span> <span class="n">MR97310A_BRIGHTNESS_DEFAULT</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">exposure</span> <span class="o">=</span> <span class="n">MR97310A_EXPOSURE_DEFAULT</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">=</span> <span class="n">gain_default</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">contrast</span> <span class="o">=</span> <span class="n">MR97310A_CONTRAST_DEFAULT</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">min_clockdiv</span> <span class="o">=</span> <span class="n">MR97310A_MIN_CLOCKDIV_DEFAULT</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* this function is called at probe and resume time */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">start_cif_cam</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err_code</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">__u8</span> <span class="n">startup_string</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mh">0x00</span><span class="p">,</span>
		<span class="mh">0x0d</span><span class="p">,</span>
		<span class="mh">0x01</span><span class="p">,</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* Hsize/8 for 352 or 320 */</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* Vsize/4 for 288 or 240 */</span>
		<span class="mh">0x13</span><span class="p">,</span> <span class="cm">/* or 0xbb, depends on sensor */</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* Hstart, depends on res. */</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* reserved ? */</span>
		<span class="mh">0x00</span><span class="p">,</span> <span class="cm">/* Vstart, depends on res. and sensor */</span>
		<span class="mh">0x50</span><span class="p">,</span> <span class="cm">/* 0x54 to get 176 or 160 */</span>
		<span class="mh">0xc0</span>
	<span class="p">};</span>

	<span class="cm">/* Note: Some of the above descriptions guessed from MR97113A driver */</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">startup_string</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">)</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xbb</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">160</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* reg 8, 2:1 scale down from 320 */</span>
		<span class="cm">/* fall thru */</span>
	<span class="k">case</span> <span class="mi">320</span>:
	<span class="nl">default:</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x28</span><span class="p">;</span>			   <span class="cm">/* reg 2, H size/8 */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x3c</span><span class="p">;</span>			   <span class="cm">/* reg 3, V size/4 */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x14</span><span class="p">;</span>			   <span class="cm">/* reg 5, H start  */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x1a</span> <span class="o">+</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">;</span>  <span class="cm">/* reg 7, V start  */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">176</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* reg 8, 2:1 scale down from 352 */</span>
		<span class="cm">/* fall thru */</span>
	<span class="k">case</span> <span class="mi">352</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">;</span>			   <span class="cm">/* reg 2, H size/8 */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x48</span><span class="p">;</span>			   <span class="cm">/* reg 3, V size/4 */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>			   <span class="cm">/* reg 5, H start  */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x06</span> <span class="o">-</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">;</span>  <span class="cm">/* reg 7, V start  */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="n">cif_sensor0_init_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
				      <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">},</span> <span class="mi">8</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">},</span> <span class="mi">5</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x07</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x06</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x0c</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span> <span class="mi">3</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x60</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x06</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">},</span> <span class="mi">6</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">},</span> <span class="mi">2</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
				      <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="mi">9</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">}</span>
		<span class="p">};</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">sensor_write_regs</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">cif_sensor0_init_data</span><span class="p">,</span>
					 <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cif_sensor0_init_data</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>	<span class="cm">/* sd-&gt;sensor_type = 1 */</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="n">cif_sensor1_init_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="cm">/* Reg 3,4, 7,8 get set by the controls */</span>
			<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x10</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x22</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span> <span class="cm">/* 5/6 also seen as 65h/32h */</span>
			<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x0e</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x05</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x05</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x0f</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x07</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x0c</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x06</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x07</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">}</span>
		<span class="p">};</span>
		<span class="cm">/* Without this command the cam won&#39;t work with USB-UHCI */</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">sensor_write_regs</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">cif_sensor1_init_data</span><span class="p">,</span>
					 <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">cif_sensor1_init_data</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">start_vga_cam</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_buf</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err_code</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">__u8</span> <span class="n">startup_string</span><span class="p">[]</span> <span class="o">=</span>
		<span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
		 <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">};</span>
	<span class="cm">/* What some of these mean is explained in start_cif_cam(), above */</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">startup_string</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>  <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x91</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>  <span class="o">=</span> <span class="mh">0x00</span><span class="p">;</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x18</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">160</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x0c</span><span class="p">;</span>  <span class="cm">/* reg 8, 4:1 scale down */</span>
		<span class="cm">/* fall thru */</span>
	<span class="k">case</span> <span class="mi">320</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* reg 8, 2:1 scale down */</span>
		<span class="cm">/* fall thru */</span>
	<span class="k">case</span> <span class="mi">640</span>:
	<span class="nl">default:</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x50</span><span class="p">;</span>  <span class="cm">/* reg 2, H size/8 */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x78</span><span class="p">;</span>  <span class="cm">/* reg 3, V size/4 */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* reg 5, H start */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>  <span class="cm">/* reg 7, V start */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_lcd_stop</span><span class="p">)</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* Bayer tile shifted */</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="mi">176</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x04</span><span class="p">;</span>  <span class="cm">/* reg 8, 2:1 scale down */</span>
		<span class="cm">/* fall thru */</span>
	<span class="k">case</span> <span class="mi">352</span>:
		<span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x2c</span><span class="p">;</span>  <span class="cm">/* reg 2, H size */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x48</span><span class="p">;</span>  <span class="cm">/* reg 3, V size */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x94</span><span class="p">;</span>  <span class="cm">/* reg 5, H start */</span>
		<span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x63</span><span class="p">;</span>  <span class="cm">/* reg 7, V start */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_lcd_stop</span><span class="p">)</span>
			<span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x64</span><span class="p">;</span>  <span class="cm">/* Bayer tile shifted */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">mr_write</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="n">vga_sensor0_init_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span> <span class="mi">3</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">},</span> <span class="mi">4</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span> <span class="mi">4</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xa9</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="mi">3</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">},</span> <span class="mi">4</span><span class="p">},</span>
			<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">}</span>
		<span class="p">};</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">sensor_write_regs</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">vga_sensor0_init_data</span><span class="p">,</span>
					 <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">vga_sensor0_init_data</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="n">color_adj</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
				<span class="cm">/* adjusted blue, green, red gain correct</span>
<span class="cm">				   too much blue from the Sakar Digital */</span>
				<span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span> <span class="mi">8</span><span class="p">}</span>
		<span class="p">};</span>

		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="n">color_no_adj</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
				<span class="cm">/* default blue, green, red gain settings */</span>
				<span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="mi">8</span><span class="p">}</span>
		<span class="p">};</span>

		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="n">vga_sensor1_init_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>
			<span class="cm">/* These settings may be better for some cameras */</span>
			<span class="cm">/* {0x0a, 0x00, {0x01, 0x06, 0x00, 0x00, 0x01, */</span>
				<span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span> <span class="mi">7</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="mi">6</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">}</span>
		<span class="p">};</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">adj_colors</span><span class="p">)</span>
			<span class="n">err_code</span> <span class="o">=</span> <span class="n">sensor_write_regs</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">color_adj</span><span class="p">,</span>
					 <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">color_adj</span><span class="p">));</span>
		<span class="k">else</span>
			<span class="n">err_code</span> <span class="o">=</span> <span class="n">sensor_write_regs</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">color_no_adj</span><span class="p">,</span>
					 <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">color_no_adj</span><span class="p">));</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

		<span class="n">err_code</span> <span class="o">=</span> <span class="n">sensor_write_regs</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">vga_sensor1_init_data</span><span class="p">,</span>
					 <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">vga_sensor1_init_data</span><span class="p">));</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>	<span class="cm">/* sensor type == 2 */</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sensor_w_data</span> <span class="n">vga_sensor2_init_data</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>

			<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x48</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x22</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="cm">/* Reg 3 msb and 4 is lsb of the exposure setting*/</span>
			<span class="p">{</span><span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x10</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="cm">/* The following are used in the gain control</span>
<span class="cm">			 * which is BTW completely borked in the OEM driver</span>
<span class="cm">			 * The values for each color go from 0 to 0x7ff</span>
<span class="cm">			 *{0x0a, 0x00, {0x01}, 1},  green1 gain msb</span>
<span class="cm">			 *{0x0b, 0x00, {0x10}, 1},  green1 gain lsb</span>
<span class="cm">			 *{0x0c, 0x00, {0x01}, 1},  red gain msb</span>
<span class="cm">			 *{0x0d, 0x00, {0x10}, 1},  red gain lsb</span>
<span class="cm">			 *{0x0e, 0x00, {0x01}, 1},  blue gain msb</span>
<span class="cm">			 *{0x0f, 0x00, {0x10}, 1},  blue gain lsb</span>
<span class="cm">			 *{0x10, 0x00, {0x01}, 1}, green2 gain msb</span>
<span class="cm">			 *{0x11, 0x00, {0x10}, 1}, green2 gain lsb</span>
<span class="cm">			 */</span>
			<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span> <span class="cm">/* weird effect on colors */</span>
			<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x06</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x01</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0xe2</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span> <span class="cm">/* vertical alignment */</span>
			<span class="p">{</span><span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x02</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x82</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span> <span class="cm">/* don&#39;t mess with */</span>
			<span class="p">{</span><span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x20</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="cm">/* {0x1c, 0x00, {0x17}, 1}, contrast control */</span>
			<span class="p">{</span><span class="mh">0x1d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x80</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span> <span class="cm">/* moving causes a mess */</span>
			<span class="p">{</span><span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x08</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span> <span class="cm">/* moving jams the camera */</span>
			<span class="p">{</span><span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x0c</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="p">{</span><span class="mh">0x00</span><span class="p">},</span> <span class="mi">1</span><span class="p">},</span>
			<span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">{</span><span class="mi">0</span><span class="p">},</span> <span class="mi">0</span><span class="p">}</span>
		<span class="p">};</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">sensor_write_regs</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">vga_sensor2_init_data</span><span class="p">,</span>
					 <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">vga_sensor2_init_data</span><span class="p">));</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sof_read</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Some of the VGA cameras require the memory pointer</span>
<span class="cm">	 * to be set to 0 again. We have been forced to start the</span>
<span class="cm">	 * stream in sd_config() to detect the hardware, and closed it.</span>
<span class="cm">	 * Thus, we need here to do a completely fresh and clean start. */</span>
	<span class="n">err_code</span> <span class="o">=</span> <span class="n">zero_the_pointer</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">err_code</span> <span class="o">=</span> <span class="n">stream_start</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">==</span> <span class="n">CAM_TYPE_CIF</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">start_cif_cam</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">err_code</span> <span class="o">=</span> <span class="n">start_vga_cam</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err_code</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">err_code</span><span class="p">;</span>

	<span class="n">setbrightness</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="n">setcontrast</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="n">setexposure</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="n">setgain</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">isoc_enable</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_stopN</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">stream_stop</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="cm">/* Not all the cams need this, but even if not, probably a good idea */</span>
	<span class="n">zero_the_pointer</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_lcd_stop</span><span class="p">)</span>
		<span class="n">lcd_stop</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setbrightness</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">val</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">sign_reg</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>  <span class="cm">/* This reg and the next one used on CIF cams. */</span>
	<span class="n">u8</span> <span class="n">value_reg</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="cm">/* VGA cams seem to use regs 0x0b and 0x0c */</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">quick_clix_table</span><span class="p">[]</span> <span class="o">=</span>
	<span class="cm">/*	  0  1  2   3  4  5  6  7  8  9  10  11  12  13  14  15 */</span>
		<span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span>  <span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">};</span>
	<span class="cm">/*</span>
<span class="cm">	 * This control is disabled for CIF type 1 and VGA type 0 cameras.</span>
<span class="cm">	 * It does not quite act linearly for the Argus QuickClix camera,</span>
<span class="cm">	 * but it does control brightness. The values are 0 - 15 only, and</span>
<span class="cm">	 * the table above makes them act consecutively.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NORM_BRIGHTNESS_IDX</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">ARGUS_QC_BRIGHTNESS_IDX</span><span class="p">)))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">==</span> <span class="n">CAM_TYPE_VGA</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sign_reg</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">value_reg</span> <span class="o">+=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Note register 7 is also seen as 0x8x or 0xCx in some dumps */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">brightness</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">sign_reg</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">brightness</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">sign_reg</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
		<span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="mi">257</span> <span class="o">-</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">brightness</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="cm">/* Use lookup table for funky Argus QuickClix brightness */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">do_lcd_stop</span><span class="p">)</span>
		<span class="n">val</span> <span class="o">=</span> <span class="n">quick_clix_table</span><span class="p">[</span><span class="n">val</span><span class="p">];</span>

	<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">value_reg</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">exposure</span> <span class="o">=</span> <span class="n">MR97310A_EXPOSURE_DEFAULT</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE_IDX</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">==</span> <span class="n">CAM_TYPE_CIF</span> <span class="o">&amp;&amp;</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* This cam does not like exposure settings &lt; 300,</span>
<span class="cm">		   so scale 0 - 4095 to 300 - 4095 */</span>
		<span class="n">exposure</span> <span class="o">=</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">exposure</span> <span class="o">*</span> <span class="mi">9267</span><span class="p">)</span> <span class="o">/</span> <span class="mi">10000</span> <span class="o">+</span> <span class="mi">300</span><span class="p">;</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">exposure</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">exposure</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">exposure</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">exposure</span><span class="p">;</span>
		<span class="n">exposure</span> <span class="o">&gt;&gt;=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">exposure</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">exposure</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* We have both a clock divider and an exposure register.</span>
<span class="cm">		   We first calculate the clock divider, as that determines</span>
<span class="cm">		   the maximum exposure and then we calculate the exposure</span>
<span class="cm">		   register setting (which goes from 0 - 511).</span>

<span class="cm">		   Note our 0 - 4095 exposure is mapped to 0 - 511</span>
<span class="cm">		   milliseconds exposure time */</span>
		<span class="n">u8</span> <span class="n">clockdiv</span> <span class="o">=</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">exposure</span> <span class="o">+</span> <span class="mi">7999</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8000</span><span class="p">;</span>

		<span class="cm">/* Limit framerate to not exceed usb bandwidth */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">clockdiv</span> <span class="o">&lt;</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">min_clockdiv</span> <span class="o">&amp;&amp;</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">&gt;=</span> <span class="mi">320</span><span class="p">)</span>
			<span class="n">clockdiv</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">min_clockdiv</span><span class="p">;</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">clockdiv</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
			<span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">==</span> <span class="n">CAM_TYPE_VGA</span> <span class="o">&amp;&amp;</span> <span class="n">clockdiv</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
			<span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>

		<span class="cm">/* Frame exposure time in ms = 1000 * clockdiv / 60 -&gt;</span>
<span class="cm">		exposure = (sd-&gt;exposure / 8) * 511 / (1000 * clockdiv / 60) */</span>
		<span class="n">exposure</span> <span class="o">=</span> <span class="p">(</span><span class="mi">60</span> <span class="o">*</span> <span class="mi">511</span> <span class="o">*</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">exposure</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">8000</span> <span class="o">*</span> <span class="n">clockdiv</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">exposure</span> <span class="o">&gt;</span> <span class="mi">511</span><span class="p">)</span>
			<span class="n">exposure</span> <span class="o">=</span> <span class="mi">511</span><span class="p">;</span>

		<span class="cm">/* exposure register value is reversed! */</span>
		<span class="n">exposure</span> <span class="o">=</span> <span class="mi">511</span> <span class="o">-</span> <span class="n">exposure</span><span class="p">;</span>

		<span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">exposure</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
		<span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">exposure</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">;</span>
		<span class="n">sensor_write_reg</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="n">clockdiv</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">gainreg</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">GAIN_IDX</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">SAKAR_CS_GAIN_IDX</span><span class="p">)))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">==</span> <span class="n">CAM_TYPE_CIF</span> <span class="o">&amp;&amp;</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">cam_type</span> <span class="o">==</span> <span class="n">CAM_TYPE_VGA</span> <span class="o">&amp;&amp;</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">gainreg</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span> <span class="n">gainreg</span> <span class="o">&lt;</span> <span class="mh">0x11</span><span class="p">;</span> <span class="n">gainreg</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">gainreg</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">);</span>
			<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">gainreg</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="k">else</span>
		<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setcontrast</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST_IDX</span><span class="p">))</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">sensor_write1</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">contrast</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_setbrightness</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">brightness</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">setbrightness</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_getbrightness</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">brightness</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_setexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">exposure</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">setexposure</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_getexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">exposure</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_setgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">setgain</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_getgain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gain</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_setcontrast</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">contrast</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">setcontrast</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_getcontrast</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">contrast</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_setmin_clockdiv</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">min_clockdiv</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">setexposure</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_getmin_clockdiv</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="o">*</span><span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="o">*</span><span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">min_clockdiv</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Include pac common sof detection functions */</span>
<span class="cp">#include &quot;pac_common.h&quot;</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_pkt_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>		<span class="cm">/* isoc packet */</span>
			<span class="kt">int</span> <span class="n">len</span><span class="p">)</span>		<span class="cm">/* iso packet length */</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">sof</span><span class="p">;</span>

	<span class="n">sof</span> <span class="o">=</span> <span class="n">pac_find_sof</span><span class="p">(</span><span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sof_read</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sof</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>

		<span class="cm">/* finish decoding current frame */</span>
		<span class="n">n</span> <span class="o">=</span> <span class="n">sof</span> <span class="o">-</span> <span class="n">data</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="k">sizeof</span> <span class="n">pac_sof_marker</span><span class="p">)</span>
			<span class="n">n</span> <span class="o">-=</span> <span class="k">sizeof</span> <span class="n">pac_sof_marker</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">LAST_PACKET</span><span class="p">,</span>
					<span class="n">data</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
		<span class="cm">/* Start next frame. */</span>
		<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">FIRST_PACKET</span><span class="p">,</span>
			<span class="n">pac_sof_marker</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">pac_sof_marker</span><span class="p">);</span>
		<span class="n">len</span> <span class="o">-=</span> <span class="n">sof</span> <span class="o">-</span> <span class="n">data</span><span class="p">;</span>
		<span class="n">data</span> <span class="o">=</span> <span class="n">sof</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">INTER_PACKET</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* sub-driver description */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sd_desc</span> <span class="n">sd_desc</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">MODULE_NAME</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ctrls</span> <span class="o">=</span> <span class="n">sd_ctrls</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nctrls</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sd_ctrls</span><span class="p">),</span>
	<span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">sd_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">sd_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">sd_start</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stopN</span> <span class="o">=</span> <span class="n">sd_stopN</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pkt_scan</span> <span class="o">=</span> <span class="n">sd_pkt_scan</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* -- module initialisation -- */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="n">device_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x08ca</span><span class="p">,</span> <span class="mh">0x0110</span><span class="p">)},</span>	<span class="cm">/* Trust Spyc@m 100 */</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x08ca</span><span class="p">,</span> <span class="mh">0x0111</span><span class="p">)},</span>	<span class="cm">/* Aiptek Pencam VGA+ */</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x093a</span><span class="p">,</span> <span class="mh">0x010f</span><span class="p">)},</span>	<span class="cm">/* All other known MR97310A VGA cams */</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x093a</span><span class="p">,</span> <span class="mh">0x010e</span><span class="p">)},</span>	<span class="cm">/* All known MR97310A CIF cams */</span>
	<span class="p">{}</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">usb</span><span class="p">,</span> <span class="n">device_table</span><span class="p">);</span>

<span class="cm">/* -- device connect -- */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">intf</span><span class="p">,</span>
		    <span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">gspca_dev_probe</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sd_desc</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span><span class="p">),</span>
			       <span class="n">THIS_MODULE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usb_driver</span> <span class="n">sd_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">MODULE_NAME</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">device_table</span><span class="p">,</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">sd_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disconnect</span> <span class="o">=</span> <span class="n">gspca_disconnect</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_PM</span>
	<span class="p">.</span><span class="n">suspend</span> <span class="o">=</span> <span class="n">gspca_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resume</span> <span class="o">=</span> <span class="n">gspca_resume</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="n">module_usb_driver</span><span class="p">(</span><span class="n">sd_driver</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
