<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › gspca › ov519.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>ov519.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * OV519 driver</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2008-2011 Jean-François Moine &lt;moinejf@free.fr&gt;</span>
<span class="cm"> * Copyright (C) 2009 Hans de Goede &lt;hdegoede@redhat.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This module is adapted from the ov51x-jpeg package, which itself</span>
<span class="cm"> * was adapted from the ov511 driver.</span>
<span class="cm"> *</span>
<span class="cm"> * Original copyright for the ov511 driver is:</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 1999-2006 Mark W. McClelland</span>
<span class="cm"> * Support for OV519, OV8610 Copyright (c) 2003 Joerg Heckenbach</span>
<span class="cm"> * Many improvements by Bret Wallach &lt;bwallac1@san.rr.com&gt;</span>
<span class="cm"> * Color fixes by by Orion Sky Lawlor &lt;olawlor@acm.org&gt; (2/26/2000)</span>
<span class="cm"> * OV7620 fixes by Charl P. Botha &lt;cpbotha@ieee.org&gt;</span>
<span class="cm"> * Changes by Claudio Matsuoka &lt;claudio@conectiva.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * ov51x-jpeg original copyright is:</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (c) 2004-2007 Romain Beauxis &lt;toots@rastageeks.org&gt;</span>
<span class="cm"> * Support for OV7670 sensors was contributed by Sam Skipsey &lt;aoanla@yahoo.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> * it under the terms of the GNU General Public License as published by</span>
<span class="cm"> * the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> * any later version.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful,</span>
<span class="cm"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="cm"> * GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#define pr_fmt(fmt) KBUILD_MODNAME &quot;: &quot; fmt</span>

<span class="cp">#define MODULE_NAME &quot;ov519&quot;</span>

<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &quot;gspca.h&quot;</span>

<span class="cm">/* The jpeg_hdr is used by w996Xcf only */</span>
<span class="cm">/* The CONEX_CAM define for jpeg.h needs renaming, now its used here too */</span>
<span class="cp">#define CONEX_CAM</span>
<span class="cp">#include &quot;jpeg.h&quot;</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Jean-Francois Moine &lt;http://moinejf.free.fr&gt;&quot;</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;OV519 USB Camera Driver&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

<span class="cm">/* global parameters */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">frame_rate</span><span class="p">;</span>

<span class="cm">/* Number of times to retry a failed I2C transaction. Increase this if you</span>
<span class="cm"> * are getting &quot;Failed to read sensor ID...&quot; */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">i2c_detect_tries</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="cm">/* controls */</span>
<span class="k">enum</span> <span class="n">e_ctrl</span> <span class="p">{</span>
	<span class="n">BRIGHTNESS</span><span class="p">,</span>
	<span class="n">CONTRAST</span><span class="p">,</span>
	<span class="n">EXPOSURE</span><span class="p">,</span>
	<span class="n">COLORS</span><span class="p">,</span>
	<span class="n">HFLIP</span><span class="p">,</span>
	<span class="n">VFLIP</span><span class="p">,</span>
	<span class="n">AUTOBRIGHT</span><span class="p">,</span>
	<span class="n">AUTOGAIN</span><span class="p">,</span>
	<span class="n">FREQ</span><span class="p">,</span>
	<span class="n">NCTRL</span>		<span class="cm">/* number of controls */</span>
<span class="p">};</span>

<span class="cm">/* ov519 device descriptor */</span>
<span class="k">struct</span> <span class="n">sd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gspca_dev</span> <span class="n">gspca_dev</span><span class="p">;</span>		<span class="cm">/* !! must be the first item */</span>

	<span class="k">struct</span> <span class="n">gspca_ctrl</span> <span class="n">ctrls</span><span class="p">[</span><span class="n">NCTRL</span><span class="p">];</span>

	<span class="n">u8</span> <span class="n">packet_nr</span><span class="p">;</span>

	<span class="kt">char</span> <span class="n">bridge</span><span class="p">;</span>
<span class="cp">#define BRIDGE_OV511		0</span>
<span class="cp">#define BRIDGE_OV511PLUS	1</span>
<span class="cp">#define BRIDGE_OV518		2</span>
<span class="cp">#define BRIDGE_OV518PLUS	3</span>
<span class="cp">#define BRIDGE_OV519		4		</span><span class="cm">/* = ov530 */</span><span class="cp"></span>
<span class="cp">#define BRIDGE_OVFX2		5</span>
<span class="cp">#define BRIDGE_W9968CF		6</span>
<span class="cp">#define BRIDGE_MASK		7</span>

	<span class="kt">char</span> <span class="n">invert_led</span><span class="p">;</span>
<span class="cp">#define BRIDGE_INVERT_LED	8</span>

	<span class="kt">char</span> <span class="n">snapshot_pressed</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">snapshot_needs_reset</span><span class="p">;</span>

	<span class="cm">/* Determined by sensor type */</span>
	<span class="n">u8</span> <span class="n">sif</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">quality</span><span class="p">;</span>
<span class="cp">#define QUALITY_MIN 50</span>
<span class="cp">#define QUALITY_MAX 70</span>
<span class="cp">#define QUALITY_DEF 50</span>

	<span class="n">u8</span> <span class="n">stopped</span><span class="p">;</span>		<span class="cm">/* Streaming is temporarily paused */</span>
	<span class="n">u8</span> <span class="n">first_frame</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">frame_rate</span><span class="p">;</span>		<span class="cm">/* current Framerate */</span>
	<span class="n">u8</span> <span class="n">clockdiv</span><span class="p">;</span>		<span class="cm">/* clockdiv override */</span>

	<span class="n">s8</span> <span class="n">sensor</span><span class="p">;</span>		<span class="cm">/* Type of image sensor chip (SEN_*) */</span>

	<span class="n">u8</span> <span class="n">sensor_addr</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">sensor_width</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">sensor_height</span><span class="p">;</span>
	<span class="n">s16</span> <span class="n">sensor_reg_cache</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span>

	<span class="n">u8</span> <span class="n">jpeg_hdr</span><span class="p">[</span><span class="n">JPEG_HDR_SZ</span><span class="p">];</span>
<span class="p">};</span>
<span class="k">enum</span> <span class="n">sensors</span> <span class="p">{</span>
	<span class="n">SEN_OV2610</span><span class="p">,</span>
	<span class="n">SEN_OV2610AE</span><span class="p">,</span>
	<span class="n">SEN_OV3610</span><span class="p">,</span>
	<span class="n">SEN_OV6620</span><span class="p">,</span>
	<span class="n">SEN_OV6630</span><span class="p">,</span>
	<span class="n">SEN_OV66308AF</span><span class="p">,</span>
	<span class="n">SEN_OV7610</span><span class="p">,</span>
	<span class="n">SEN_OV7620</span><span class="p">,</span>
	<span class="n">SEN_OV7620AE</span><span class="p">,</span>
	<span class="n">SEN_OV7640</span><span class="p">,</span>
	<span class="n">SEN_OV7648</span><span class="p">,</span>
	<span class="n">SEN_OV7660</span><span class="p">,</span>
	<span class="n">SEN_OV7670</span><span class="p">,</span>
	<span class="n">SEN_OV76BE</span><span class="p">,</span>
	<span class="n">SEN_OV8610</span><span class="p">,</span>
	<span class="n">SEN_OV9600</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* Note this is a bit of a hack, but the w9968cf driver needs the code for all</span>
<span class="cm">   the ov sensors which is already present here. When we have the time we</span>
<span class="cm">   really should move the sensor drivers to v4l2 sub drivers. */</span>
<span class="cp">#include &quot;w996Xcf.c&quot;</span>

<span class="cm">/* V4L2 controls supported by the driver */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setbrightness</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setcontrast</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setcolors</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">sethvflip</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setautobright</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">int</span> <span class="n">sd_setautogain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setfreq</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">);</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">setfreq_i</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">);</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ctrl</span> <span class="n">sd_ctrls</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">[</span><span class="n">BRIGHTNESS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">V4L2_CID_BRIGHTNESS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Brightness&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">127</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set_control</span> <span class="o">=</span> <span class="n">setbrightness</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">[</span><span class="n">CONTRAST</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">V4L2_CID_CONTRAST</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Contrast&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">127</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set_control</span> <span class="o">=</span> <span class="n">setcontrast</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">[</span><span class="n">EXPOSURE</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">V4L2_CID_EXPOSURE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Exposure&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">127</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set_control</span> <span class="o">=</span> <span class="n">setexposure</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">[</span><span class="n">COLORS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">V4L2_CID_SATURATION</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_INTEGER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Color&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">255</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">127</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set_control</span> <span class="o">=</span> <span class="n">setcolors</span><span class="p">,</span>
	<span class="p">},</span>
<span class="cm">/* The flip controls work for sensors ov7660 and ov7670 only */</span>
<span class="p">[</span><span class="n">HFLIP</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">V4L2_CID_HFLIP</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_BOOLEAN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Mirror&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set_control</span> <span class="o">=</span> <span class="n">sethvflip</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">[</span><span class="n">VFLIP</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">V4L2_CID_VFLIP</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_BOOLEAN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Vflip&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set_control</span> <span class="o">=</span> <span class="n">sethvflip</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">[</span><span class="n">AUTOBRIGHT</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">V4L2_CID_AUTOBRIGHTNESS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_BOOLEAN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Auto Brightness&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set_control</span> <span class="o">=</span> <span class="n">setautobright</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">[</span><span class="n">AUTOGAIN</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>      <span class="o">=</span> <span class="n">V4L2_CID_AUTOGAIN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_BOOLEAN</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Auto Gain&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span>	 <span class="o">=</span> <span class="n">V4L2_CTRL_FLAG_UPDATE</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set</span> <span class="o">=</span> <span class="n">sd_setautogain</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">[</span><span class="n">FREQ</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	    <span class="p">{</span>
		<span class="p">.</span><span class="n">id</span>	 <span class="o">=</span> <span class="n">V4L2_CID_POWER_LINE_FREQUENCY</span><span class="p">,</span>
		<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">V4L2_CTRL_TYPE_MENU</span><span class="p">,</span>
		<span class="p">.</span><span class="n">name</span>    <span class="o">=</span> <span class="s">&quot;Light frequency filter&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">maximum</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>	<span class="cm">/* 0: no flicker, 1: 50Hz, 2:60Hz, 3: auto */</span>
		<span class="p">.</span><span class="n">step</span>    <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="p">},</span>
	    <span class="p">.</span><span class="n">set_control</span> <span class="o">=</span> <span class="n">setfreq</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* table of the disabled controls */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="n">ctrl_dis</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="p">[</span><span class="n">SEN_OV2610</span><span class="p">]</span> <span class="o">=</span>		<span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NCTRL</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>	<span class="cm">/* no control */</span>
			<span class="o">^</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span>	<span class="cm">/* but exposure */</span>
			 <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">)),</span>	<span class="cm">/* and autogain */</span>

<span class="p">[</span><span class="n">SEN_OV2610AE</span><span class="p">]</span> <span class="o">=</span>	<span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NCTRL</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>	<span class="cm">/* no control */</span>
			<span class="o">^</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span>	<span class="cm">/* but exposure */</span>
			 <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">)),</span>	<span class="cm">/* and autogain */</span>

<span class="p">[</span><span class="n">SEN_OV3610</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NCTRL</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>	<span class="cm">/* no control */</span>

<span class="p">[</span><span class="n">SEN_OV6620</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV6630</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV66308AF</span><span class="p">]</span> <span class="o">=</span>	<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV7610</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV7620</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV7620AE</span><span class="p">]</span> <span class="o">=</span>	<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV7640</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOBRIGHT</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV7648</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOBRIGHT</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV7660</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOBRIGHT</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV7670</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">COLORS</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOBRIGHT</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV76BE</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">),</span>

<span class="p">[</span><span class="n">SEN_OV8610</span><span class="p">]</span> <span class="o">=</span>		<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">)</span> <span class="o">|</span>
			<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">FREQ</span><span class="p">),</span>
<span class="p">[</span><span class="n">SEN_OV9600</span><span class="p">]</span> <span class="o">=</span>		<span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">NCTRL</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>	<span class="cm">/* no control */</span>
			<span class="o">^</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)</span>	<span class="cm">/* but exposure */</span>
			 <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">)),</span>	<span class="cm">/* and autogain */</span>

<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ov519_vga_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_JPEG</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">590</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_JPEG</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">640</span> <span class="o">*</span> <span class="mi">480</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">590</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ov519_sif_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">160</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_JPEG</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">160</span> <span class="o">*</span> <span class="mi">120</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">590</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">176</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_JPEG</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">176</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">176</span> <span class="o">*</span> <span class="mi">144</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">590</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_JPEG</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">590</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">352</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_JPEG</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">352</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">352</span> <span class="o">*</span> <span class="mi">288</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">590</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Note some of the sizeimage values for the ov511 / ov518 may seem</span>
<span class="cm">   larger then necessary, however they need to be this big as the ov511 /</span>
<span class="cm">   ov518 always fills the entire isoc frame, using 0 padding bytes when</span>
<span class="cm">   it doesn&#39;t have any data. So with low framerates the amount of data</span>
<span class="cm">   transferred can become quite large (libv4l will remove all the 0 padding</span>
<span class="cm">   in userspace). */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ov518_vga_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV518</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV518</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">640</span> <span class="o">*</span> <span class="mi">480</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ov518_sif_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">160</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV518</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">70000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">176</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV518</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">176</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">70000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV518</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">352</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV518</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">352</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">352</span> <span class="o">*</span> <span class="mi">288</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ov511_vga_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV511</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV511</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">640</span> <span class="o">*</span> <span class="mi">480</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ov511_sif_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">160</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV511</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">70000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">176</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV511</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">176</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">70000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV511</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">352</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_OV511</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">352</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">352</span> <span class="o">*</span> <span class="mi">288</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_JPEG</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ovfx2_vga_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">640</span> <span class="o">*</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ovfx2_cif_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">160</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">160</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">160</span> <span class="o">*</span> <span class="mi">120</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">176</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">176</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">176</span> <span class="o">*</span> <span class="mi">144</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">320</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">320</span> <span class="o">*</span> <span class="mi">240</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">352</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">352</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">352</span> <span class="o">*</span> <span class="mi">288</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ovfx2_ov2610_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">800</span> <span class="o">*</span> <span class="mi">600</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">1600</span> <span class="o">*</span> <span class="mi">1200</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">},</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ovfx2_ov3610_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">640</span> <span class="o">*</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">800</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">800</span> <span class="o">*</span> <span class="mi">600</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">768</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">768</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">1600</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">1600</span> <span class="o">*</span> <span class="mi">1200</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">2048</span><span class="p">,</span> <span class="mi">1536</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">2048</span> <span class="o">*</span> <span class="mi">1536</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">},</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">v4l2_pix_format</span> <span class="n">ovfx2_ov9600_mode</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">640</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">640</span> <span class="o">*</span> <span class="mi">480</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">,</span>
		<span class="p">.</span><span class="n">priv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">},</span>
	<span class="p">{</span><span class="mi">1280</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="n">V4L2_PIX_FMT_SBGGR8</span><span class="p">,</span> <span class="n">V4L2_FIELD_NONE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">bytesperline</span> <span class="o">=</span> <span class="mi">1280</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sizeimage</span> <span class="o">=</span> <span class="mi">1280</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
		<span class="p">.</span><span class="n">colorspace</span> <span class="o">=</span> <span class="n">V4L2_COLORSPACE_SRGB</span><span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Registers common to OV511 / OV518 */</span>
<span class="cp">#define R51x_FIFO_PSIZE			0x30	</span><span class="cm">/* 2 bytes wide w/ OV518(+) */</span><span class="cp"></span>
<span class="cp">#define R51x_SYS_RESET			0x50</span>
	<span class="cm">/* Reset type flags */</span>
	<span class="cp">#define	OV511_RESET_OMNICE	0x08</span>
<span class="cp">#define R51x_SYS_INIT			0x53</span>
<span class="cp">#define R51x_SYS_SNAP			0x52</span>
<span class="cp">#define R51x_SYS_CUST_ID		0x5f</span>
<span class="cp">#define R51x_COMP_LUT_BEGIN		0x80</span>

<span class="cm">/* OV511 Camera interface register numbers */</span>
<span class="cp">#define R511_CAM_DELAY			0x10</span>
<span class="cp">#define R511_CAM_EDGE			0x11</span>
<span class="cp">#define R511_CAM_PXCNT			0x12</span>
<span class="cp">#define R511_CAM_LNCNT			0x13</span>
<span class="cp">#define R511_CAM_PXDIV			0x14</span>
<span class="cp">#define R511_CAM_LNDIV			0x15</span>
<span class="cp">#define R511_CAM_UV_EN			0x16</span>
<span class="cp">#define R511_CAM_LINE_MODE		0x17</span>
<span class="cp">#define R511_CAM_OPTS			0x18</span>

<span class="cp">#define R511_SNAP_FRAME			0x19</span>
<span class="cp">#define R511_SNAP_PXCNT			0x1a</span>
<span class="cp">#define R511_SNAP_LNCNT			0x1b</span>
<span class="cp">#define R511_SNAP_PXDIV			0x1c</span>
<span class="cp">#define R511_SNAP_LNDIV			0x1d</span>
<span class="cp">#define R511_SNAP_UV_EN			0x1e</span>
<span class="cp">#define R511_SNAP_OPTS			0x1f</span>

<span class="cp">#define R511_DRAM_FLOW_CTL		0x20</span>
<span class="cp">#define R511_FIFO_OPTS			0x31</span>
<span class="cp">#define R511_I2C_CTL			0x40</span>
<span class="cp">#define R511_SYS_LED_CTL		0x55	</span><span class="cm">/* OV511+ only */</span><span class="cp"></span>
<span class="cp">#define R511_COMP_EN			0x78</span>
<span class="cp">#define R511_COMP_LUT_EN		0x79</span>

<span class="cm">/* OV518 Camera interface register numbers */</span>
<span class="cp">#define R518_GPIO_OUT			0x56	</span><span class="cm">/* OV518(+) only */</span><span class="cp"></span>
<span class="cp">#define R518_GPIO_CTL			0x57	</span><span class="cm">/* OV518(+) only */</span><span class="cp"></span>

<span class="cm">/* OV519 Camera interface register numbers */</span>
<span class="cp">#define OV519_R10_H_SIZE		0x10</span>
<span class="cp">#define OV519_R11_V_SIZE		0x11</span>
<span class="cp">#define OV519_R12_X_OFFSETL		0x12</span>
<span class="cp">#define OV519_R13_X_OFFSETH		0x13</span>
<span class="cp">#define OV519_R14_Y_OFFSETL		0x14</span>
<span class="cp">#define OV519_R15_Y_OFFSETH		0x15</span>
<span class="cp">#define OV519_R16_DIVIDER		0x16</span>
<span class="cp">#define OV519_R20_DFR			0x20</span>
<span class="cp">#define OV519_R25_FORMAT		0x25</span>

<span class="cm">/* OV519 System Controller register numbers */</span>
<span class="cp">#define OV519_R51_RESET1		0x51</span>
<span class="cp">#define OV519_R54_EN_CLK1		0x54</span>
<span class="cp">#define OV519_R57_SNAPSHOT		0x57</span>

<span class="cp">#define OV519_GPIO_DATA_OUT0		0x71</span>
<span class="cp">#define OV519_GPIO_IO_CTRL0		0x72</span>

<span class="cm">/*#define OV511_ENDPOINT_ADDRESS 1	 * Isoc endpoint number */</span>

<span class="cm">/*</span>
<span class="cm"> * The FX2 chip does not give us a zero length read at end of frame.</span>
<span class="cm"> * It does, however, give a short read at the end of a frame, if</span>
<span class="cm"> * necessary, rather than run two frames together.</span>
<span class="cm"> *</span>
<span class="cm"> * By choosing the right bulk transfer size, we are guaranteed to always</span>
<span class="cm"> * get a short read for the last read of each frame.  Frame sizes are</span>
<span class="cm"> * always a composite number (width * height, or a multiple) so if we</span>
<span class="cm"> * choose a prime number, we are guaranteed that the last read of a</span>
<span class="cm"> * frame will be short.</span>
<span class="cm"> *</span>
<span class="cm"> * But it isn&#39;t that easy: the 2.6 kernel requires a multiple of 4KB,</span>
<span class="cm"> * otherwise EOVERFLOW &quot;babbling&quot; errors occur.  I have not been able</span>
<span class="cm"> * to figure out why.  [PMiller]</span>
<span class="cm"> *</span>
<span class="cm"> * The constant (13 * 4096) is the largest &quot;prime enough&quot; number less than 64KB.</span>
<span class="cm"> *</span>
<span class="cm"> * It isn&#39;t enough to know the number of bytes per frame, in case we</span>
<span class="cm"> * have data dropouts or buffer overruns (even though the FX2 double</span>
<span class="cm"> * buffers, there are some pretty strict real time constraints for</span>
<span class="cm"> * isochronous transfer for larger frame sizes).</span>
<span class="cm"> */</span>
<span class="cm">/*jfm: this value does not work for 800x600 - see isoc_init */</span>
<span class="cp">#define OVFX2_BULK_SIZE (13 * 4096)</span>

<span class="cm">/* I2C registers */</span>
<span class="cp">#define R51x_I2C_W_SID		0x41</span>
<span class="cp">#define R51x_I2C_SADDR_3	0x42</span>
<span class="cp">#define R51x_I2C_SADDR_2	0x43</span>
<span class="cp">#define R51x_I2C_R_SID		0x44</span>
<span class="cp">#define R51x_I2C_DATA		0x45</span>
<span class="cp">#define R518_I2C_CTL		0x47	</span><span class="cm">/* OV518(+) only */</span><span class="cp"></span>
<span class="cp">#define OVFX2_I2C_ADDR		0x00</span>

<span class="cm">/* I2C ADDRESSES */</span>
<span class="cp">#define OV7xx0_SID   0x42</span>
<span class="cp">#define OV_HIRES_SID 0x60		</span><span class="cm">/* OV9xxx / OV2xxx / OV3xxx */</span><span class="cp"></span>
<span class="cp">#define OV8xx0_SID   0xa0</span>
<span class="cp">#define OV6xx0_SID   0xc0</span>

<span class="cm">/* OV7610 registers */</span>
<span class="cp">#define OV7610_REG_GAIN		0x00	</span><span class="cm">/* gain setting (5:0) */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_BLUE		0x01	</span><span class="cm">/* blue channel balance */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_RED		0x02	</span><span class="cm">/* red channel balance */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_SAT		0x03	</span><span class="cm">/* saturation */</span><span class="cp"></span>
<span class="cp">#define OV8610_REG_HUE		0x04	</span><span class="cm">/* 04 reserved */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_CNT		0x05	</span><span class="cm">/* Y contrast */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_BRT		0x06	</span><span class="cm">/* Y brightness */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_COM_C	0x14	</span><span class="cm">/* misc common regs */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_ID_HIGH	0x1c	</span><span class="cm">/* manufacturer ID MSB */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_ID_LOW	0x1d	</span><span class="cm">/* manufacturer ID LSB */</span><span class="cp"></span>
<span class="cp">#define OV7610_REG_COM_I	0x29	</span><span class="cm">/* misc settings */</span><span class="cp"></span>

<span class="cm">/* OV7660 and OV7670 registers */</span>
<span class="cp">#define OV7670_R00_GAIN		0x00	</span><span class="cm">/* Gain lower 8 bits (rest in vref) */</span><span class="cp"></span>
<span class="cp">#define OV7670_R01_BLUE		0x01	</span><span class="cm">/* blue gain */</span><span class="cp"></span>
<span class="cp">#define OV7670_R02_RED		0x02	</span><span class="cm">/* red gain */</span><span class="cp"></span>
<span class="cp">#define OV7670_R03_VREF		0x03	</span><span class="cm">/* Pieces of GAIN, VSTART, VSTOP */</span><span class="cp"></span>
<span class="cp">#define OV7670_R04_COM1		0x04	</span><span class="cm">/* Control 1 */</span><span class="cp"></span>
<span class="cm">/*#define OV7670_R07_AECHH	0x07	 * AEC MS 5 bits */</span>
<span class="cp">#define OV7670_R0C_COM3		0x0c	</span><span class="cm">/* Control 3 */</span><span class="cp"></span>
<span class="cp">#define OV7670_R0D_COM4		0x0d	</span><span class="cm">/* Control 4 */</span><span class="cp"></span>
<span class="cp">#define OV7670_R0E_COM5		0x0e	</span><span class="cm">/* All &quot;reserved&quot; */</span><span class="cp"></span>
<span class="cp">#define OV7670_R0F_COM6		0x0f	</span><span class="cm">/* Control 6 */</span><span class="cp"></span>
<span class="cp">#define OV7670_R10_AECH		0x10	</span><span class="cm">/* More bits of AEC value */</span><span class="cp"></span>
<span class="cp">#define OV7670_R11_CLKRC	0x11	</span><span class="cm">/* Clock control */</span><span class="cp"></span>
<span class="cp">#define OV7670_R12_COM7		0x12	</span><span class="cm">/* Control 7 */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM7_FMT_VGA	 0x00</span>
<span class="cm">/*#define   OV7670_COM7_YUV	 0x00	 * YUV */</span>
<span class="cp">#define   OV7670_COM7_FMT_QVGA	 0x10	</span><span class="cm">/* QVGA format */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM7_FMT_MASK	 0x38</span>
<span class="cp">#define   OV7670_COM7_RESET	 0x80	</span><span class="cm">/* Register reset */</span><span class="cp"></span>
<span class="cp">#define OV7670_R13_COM8		0x13	</span><span class="cm">/* Control 8 */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM8_AEC	 0x01	</span><span class="cm">/* Auto exposure enable */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM8_AWB	 0x02	</span><span class="cm">/* White balance enable */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM8_AGC	 0x04	</span><span class="cm">/* Auto gain enable */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM8_BFILT	 0x20	</span><span class="cm">/* Band filter enable */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM8_AECSTEP	 0x40	</span><span class="cm">/* Unlimited AEC step size */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM8_FASTAEC	 0x80	</span><span class="cm">/* Enable fast AGC/AEC */</span><span class="cp"></span>
<span class="cp">#define OV7670_R14_COM9		0x14	</span><span class="cm">/* Control 9 - gain ceiling */</span><span class="cp"></span>
<span class="cp">#define OV7670_R15_COM10	0x15	</span><span class="cm">/* Control 10 */</span><span class="cp"></span>
<span class="cp">#define OV7670_R17_HSTART	0x17	</span><span class="cm">/* Horiz start high bits */</span><span class="cp"></span>
<span class="cp">#define OV7670_R18_HSTOP	0x18	</span><span class="cm">/* Horiz stop high bits */</span><span class="cp"></span>
<span class="cp">#define OV7670_R19_VSTART	0x19	</span><span class="cm">/* Vert start high bits */</span><span class="cp"></span>
<span class="cp">#define OV7670_R1A_VSTOP	0x1a	</span><span class="cm">/* Vert stop high bits */</span><span class="cp"></span>
<span class="cp">#define OV7670_R1E_MVFP		0x1e	</span><span class="cm">/* Mirror / vflip */</span><span class="cp"></span>
<span class="cp">#define   OV7670_MVFP_VFLIP	 0x10	</span><span class="cm">/* vertical flip */</span><span class="cp"></span>
<span class="cp">#define   OV7670_MVFP_MIRROR	 0x20	</span><span class="cm">/* Mirror image */</span><span class="cp"></span>
<span class="cp">#define OV7670_R24_AEW		0x24	</span><span class="cm">/* AGC upper limit */</span><span class="cp"></span>
<span class="cp">#define OV7670_R25_AEB		0x25	</span><span class="cm">/* AGC lower limit */</span><span class="cp"></span>
<span class="cp">#define OV7670_R26_VPT		0x26	</span><span class="cm">/* AGC/AEC fast mode op region */</span><span class="cp"></span>
<span class="cp">#define OV7670_R32_HREF		0x32	</span><span class="cm">/* HREF pieces */</span><span class="cp"></span>
<span class="cp">#define OV7670_R3A_TSLB		0x3a	</span><span class="cm">/* lots of stuff */</span><span class="cp"></span>
<span class="cp">#define OV7670_R3B_COM11	0x3b	</span><span class="cm">/* Control 11 */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM11_EXP	 0x02</span>
<span class="cp">#define   OV7670_COM11_HZAUTO	 0x10	</span><span class="cm">/* Auto detect 50/60 Hz */</span><span class="cp"></span>
<span class="cp">#define OV7670_R3C_COM12	0x3c	</span><span class="cm">/* Control 12 */</span><span class="cp"></span>
<span class="cp">#define OV7670_R3D_COM13	0x3d	</span><span class="cm">/* Control 13 */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM13_GAMMA	 0x80	</span><span class="cm">/* Gamma enable */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM13_UVSAT	 0x40	</span><span class="cm">/* UV saturation auto adjustment */</span><span class="cp"></span>
<span class="cp">#define OV7670_R3E_COM14	0x3e	</span><span class="cm">/* Control 14 */</span><span class="cp"></span>
<span class="cp">#define OV7670_R3F_EDGE		0x3f	</span><span class="cm">/* Edge enhancement factor */</span><span class="cp"></span>
<span class="cp">#define OV7670_R40_COM15	0x40	</span><span class="cm">/* Control 15 */</span><span class="cp"></span>
<span class="cm">/*#define   OV7670_COM15_R00FF	 0xc0	 *	00 to FF */</span>
<span class="cp">#define OV7670_R41_COM16	0x41	</span><span class="cm">/* Control 16 */</span><span class="cp"></span>
<span class="cp">#define   OV7670_COM16_AWBGAIN	 0x08	</span><span class="cm">/* AWB gain enable */</span><span class="cp"></span>
<span class="cm">/* end of ov7660 common registers */</span>
<span class="cp">#define OV7670_R55_BRIGHT	0x55	</span><span class="cm">/* Brightness */</span><span class="cp"></span>
<span class="cp">#define OV7670_R56_CONTRAS	0x56	</span><span class="cm">/* Contrast control */</span><span class="cp"></span>
<span class="cp">#define OV7670_R69_GFIX		0x69	</span><span class="cm">/* Fix gain control */</span><span class="cp"></span>
<span class="cm">/*#define OV7670_R8C_RGB444	0x8c	 * RGB 444 control */</span>
<span class="cp">#define OV7670_R9F_HAECC1	0x9f	</span><span class="cm">/* Hist AEC/AGC control 1 */</span><span class="cp"></span>
<span class="cp">#define OV7670_RA0_HAECC2	0xa0	</span><span class="cm">/* Hist AEC/AGC control 2 */</span><span class="cp"></span>
<span class="cp">#define OV7670_RA5_BD50MAX	0xa5	</span><span class="cm">/* 50hz banding step limit */</span><span class="cp"></span>
<span class="cp">#define OV7670_RA6_HAECC3	0xa6	</span><span class="cm">/* Hist AEC/AGC control 3 */</span><span class="cp"></span>
<span class="cp">#define OV7670_RA7_HAECC4	0xa7	</span><span class="cm">/* Hist AEC/AGC control 4 */</span><span class="cp"></span>
<span class="cp">#define OV7670_RA8_HAECC5	0xa8	</span><span class="cm">/* Hist AEC/AGC control 5 */</span><span class="cp"></span>
<span class="cp">#define OV7670_RA9_HAECC6	0xa9	</span><span class="cm">/* Hist AEC/AGC control 6 */</span><span class="cp"></span>
<span class="cp">#define OV7670_RAA_HAECC7	0xaa	</span><span class="cm">/* Hist AEC/AGC control 7 */</span><span class="cp"></span>
<span class="cp">#define OV7670_RAB_BD60MAX	0xab	</span><span class="cm">/* 60hz banding step limit */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">ov_regvals</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">val</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">reg</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">val</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Settings for OV2610 camera chip */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_2610</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>	<span class="cm">/* reset */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_2610ae</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>	<span class="cm">/* reset */</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">},</span>	<span class="cm">/* 1600x1200 */</span>
	<span class="p">{</span><span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">},</span>
<span class="cm">/* ms-win traces */</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">},</span>	<span class="cm">/* clock / 3 ? */</span>
	<span class="p">{</span><span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>	<span class="cm">/* 60 Hz filter */</span>
	<span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">},</span>	<span class="cm">/* normal colors */</span>
	<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_3620b</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * From the datasheet: &quot;Note that after writing to register COMH</span>
<span class="cm">	 * (0x12) to change the sensor mode, registers related to the</span>
<span class="cm">	 * sensor’s cropping window will be reset back to their default</span>
<span class="cm">	 * values.&quot;</span>
<span class="cm">	 *</span>
<span class="cm">	 * &quot;wait 4096 external clock ... to make sure the sensor is</span>
<span class="cm">	 * stable and ready to access registers&quot; i.e. 160us at 24MHz</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span> <span class="cm">/* COMH reset */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* QXGA, master */</span>

	<span class="cm">/*</span>
<span class="cm">	 * 11 CLKRC &quot;Clock Rate Control&quot;</span>
<span class="cm">	 * [7] internal frequency doublers: on</span>
<span class="cm">	 * [6] video port mode: master</span>
<span class="cm">	 * [5:0] clock divider: 1</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 13 COMI &quot;Common Control I&quot;</span>
<span class="cm">	 *                  = 192 (0xC0) 11000000</span>
<span class="cm">	 *    COMI[7] &quot;AEC speed selection&quot;</span>
<span class="cm">	 *                  =   1 (0x01) 1....... &quot;Faster AEC correction&quot;</span>
<span class="cm">	 *    COMI[6] &quot;AEC speed step selection&quot;</span>
<span class="cm">	 *                  =   1 (0x01) .1...... &quot;Big steps, fast&quot;</span>
<span class="cm">	 *    COMI[5] &quot;Banding filter on off&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..0..... &quot;Off&quot;</span>
<span class="cm">	 *    COMI[4] &quot;Banding filter option&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ...0.... &quot;Main clock is 48 MHz and</span>
<span class="cm">	 *                                         the PLL is ON&quot;</span>
<span class="cm">	 *    COMI[3] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0...</span>
<span class="cm">	 *    COMI[2] &quot;AGC auto manual control selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;Manual&quot;</span>
<span class="cm">	 *    COMI[1] &quot;AWB auto manual control selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;Manual&quot;</span>
<span class="cm">	 *    COMI[0] &quot;Exposure control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .......0 &quot;Manual&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 09 COMC &quot;Common Control C&quot;</span>
<span class="cm">	 *                  =   8 (0x08) 00001000</span>
<span class="cm">	 *    COMC[7:5] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 000.....</span>
<span class="cm">	 *    COMC[4] &quot;Sleep Mode Enable&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ...0.... &quot;Normal mode&quot;</span>
<span class="cm">	 *    COMC[3:2] &quot;Sensor sampling reset timing selection&quot;</span>
<span class="cm">	 *                  =   2 (0x02) ....10.. &quot;Longer reset time&quot;</span>
<span class="cm">	 *    COMC[1:0] &quot;Output drive current select&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......00 &quot;Weakest&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x08</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 0C COMD &quot;Common Control D&quot;</span>
<span class="cm">	 *                  =   8 (0x08) 00001000</span>
<span class="cm">	 *    COMD[7] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0.......</span>
<span class="cm">	 *    COMD[6] &quot;Swap MSB and LSB at the output port&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .0...... &quot;False&quot;</span>
<span class="cm">	 *    COMD[5:3] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ..001...</span>
<span class="cm">	 *    COMD[2] &quot;Output Average On Off&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;Output Normal&quot;</span>
<span class="cm">	 *    COMD[1] &quot;Sensor precharge voltage selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;Selects internal</span>
<span class="cm">	 *                                         reference precharge</span>
<span class="cm">	 *                                         voltage&quot;</span>
<span class="cm">	 *    COMD[0] &quot;Snapshot option&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .......0 &quot;Enable live video output</span>
<span class="cm">	 *                                         after snapshot sequence&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x08</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 0D COME &quot;Common Control E&quot;</span>
<span class="cm">	 *                  = 161 (0xA1) 10100001</span>
<span class="cm">	 *    COME[7] &quot;Output average option&quot;</span>
<span class="cm">	 *                  =   1 (0x01) 1....... &quot;Output average of 4 pixels&quot;</span>
<span class="cm">	 *    COME[6] &quot;Anti-blooming control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .0...... &quot;Off&quot;</span>
<span class="cm">	 *    COME[5:3] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   4 (0x04) ..100...</span>
<span class="cm">	 *    COME[2] &quot;Clock output power down pin status&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;Tri-state data output pin</span>
<span class="cm">	 *                                         on power down&quot;</span>
<span class="cm">	 *    COME[1] &quot;Data output pin status selection at power down&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;Tri-state VSYNC, PCLK,</span>
<span class="cm">	 *                                         HREF, and CHSYNC pins on</span>
<span class="cm">	 *                                         power down&quot;</span>
<span class="cm">	 *    COME[0] &quot;Auto zero circuit select&quot;</span>
<span class="cm">	 *                  =   1 (0x01) .......1 &quot;On&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0xa1</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 0E COMF &quot;Common Control F&quot;</span>
<span class="cm">	 *                  = 112 (0x70) 01110000</span>
<span class="cm">	 *    COMF[7] &quot;System clock selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;Use 24 MHz system clock&quot;</span>
<span class="cm">	 *    COMF[6:4] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   7 (0x07) .111....</span>
<span class="cm">	 *    COMF[3] &quot;Manual auto negative offset canceling selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0... &quot;Auto detect negative</span>
<span class="cm">	 *                                         offset and cancel it&quot;</span>
<span class="cm">	 *    COMF[2:0] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x70</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 0F COMG &quot;Common Control G&quot;</span>
<span class="cm">	 *                  =  66 (0x42) 01000010</span>
<span class="cm">	 *    COMG[7] &quot;Optical black output selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;Disable&quot;</span>
<span class="cm">	 *    COMG[6] &quot;Black level calibrate selection&quot;</span>
<span class="cm">	 *                  =   1 (0x01) .1...... &quot;Use optical black pixels</span>
<span class="cm">	 *                                         to calibrate&quot;</span>
<span class="cm">	 *    COMG[5:4] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..00....</span>
<span class="cm">	 *    COMG[3] &quot;Channel offset adjustment&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0... &quot;Disable offset adjustment&quot;</span>
<span class="cm">	 *    COMG[2] &quot;ADC black level calibration option&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;Use B/G line and G/R</span>
<span class="cm">	 *                                         line to calibrate each</span>
<span class="cm">	 *                                         channel&#39;s black level&quot;</span>
<span class="cm">	 *    COMG[1] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ......1.</span>
<span class="cm">	 *    COMG[0] &quot;ADC black level calibration enable&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .......0 &quot;Disable&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x42</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 14 COMJ &quot;Common Control J&quot;</span>
<span class="cm">	 *                  = 198 (0xC6) 11000110</span>
<span class="cm">	 *    COMJ[7:6] &quot;AGC gain ceiling&quot;</span>
<span class="cm">	 *                  =   3 (0x03) 11...... &quot;8x&quot;</span>
<span class="cm">	 *    COMJ[5:4] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..00....</span>
<span class="cm">	 *    COMJ[3] &quot;Auto banding filter&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0... &quot;Banding filter is always</span>
<span class="cm">	 *                                         on off depending on</span>
<span class="cm">	 *                                         COMI[5] setting&quot;</span>
<span class="cm">	 *    COMJ[2] &quot;VSYNC drop option&quot;</span>
<span class="cm">	 *                  =   1 (0x01) .....1.. &quot;SYNC is dropped if frame</span>
<span class="cm">	 *                                         data is dropped&quot;</span>
<span class="cm">	 *    COMJ[1] &quot;Frame data drop&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ......1. &quot;Drop frame data if</span>
<span class="cm">	 *                                         exposure is not within</span>
<span class="cm">	 *                                         tolerance.  In AEC mode,</span>
<span class="cm">	 *                                         data is normally dropped</span>
<span class="cm">	 *                                         when data is out of</span>
<span class="cm">	 *                                         range.&quot;</span>
<span class="cm">	 *    COMJ[0] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .......0</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0xc6</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 15 COMK &quot;Common Control K&quot;</span>
<span class="cm">	 *                  =   2 (0x02) 00000010</span>
<span class="cm">	 *    COMK[7] &quot;CHSYNC pin output swap&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;CHSYNC&quot;</span>
<span class="cm">	 *    COMK[6] &quot;HREF pin output swap&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .0...... &quot;HREF&quot;</span>
<span class="cm">	 *    COMK[5] &quot;PCLK output selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..0..... &quot;PCLK always output&quot;</span>
<span class="cm">	 *    COMK[4] &quot;PCLK edge selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ...0.... &quot;Data valid on falling edge&quot;</span>
<span class="cm">	 *    COMK[3] &quot;HREF output polarity&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0... &quot;positive&quot;</span>
<span class="cm">	 *    COMK[2] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0..</span>
<span class="cm">	 *    COMK[1] &quot;VSYNC polarity&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ......1. &quot;negative&quot;</span>
<span class="cm">	 *    COMK[0] &quot;HSYNC polarity&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .......0 &quot;positive&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 33 CHLF &quot;Current Control&quot;</span>
<span class="cm">	 *                  =   9 (0x09) 00001001</span>
<span class="cm">	 *    CHLF[7:6] &quot;Sensor current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00......</span>
<span class="cm">	 *    CHLF[5] &quot;Sensor current range control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..0..... &quot;normal range&quot;</span>
<span class="cm">	 *    CHLF[4] &quot;Sensor current&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ...0.... &quot;normal current&quot;</span>
<span class="cm">	 *    CHLF[3] &quot;Sensor buffer current control&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ....1... &quot;half current&quot;</span>
<span class="cm">	 *    CHLF[2] &quot;Column buffer current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;normal current&quot;</span>
<span class="cm">	 *    CHLF[1] &quot;Analog DSP current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;normal current&quot;</span>
<span class="cm">	 *    CHLF[1] &quot;ADC current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;normal current&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x09</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 34 VBLM &quot;Blooming Control&quot;</span>
<span class="cm">	 *                  =  80 (0x50) 01010000</span>
<span class="cm">	 *    VBLM[7] &quot;Hard soft reset switch&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;Hard reset&quot;</span>
<span class="cm">	 *    VBLM[6:4] &quot;Blooming voltage selection&quot;</span>
<span class="cm">	 *                  =   5 (0x05) .101....</span>
<span class="cm">	 *    VBLM[3:0] &quot;Sensor current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x50</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 36 VCHG &quot;Sensor Precharge Voltage Control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 *    VCHG[7] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0.......</span>
<span class="cm">	 *    VCHG[6:4] &quot;Sensor precharge voltage control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .000....</span>
<span class="cm">	 *    VCHG[3:0] &quot;Sensor array common reference&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 37 ADC &quot;ADC Reference Control&quot;</span>
<span class="cm">	 *                  =   4 (0x04) 00000100</span>
<span class="cm">	 *    ADC[7:4] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0000....</span>
<span class="cm">	 *    ADC[3] &quot;ADC input signal range&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0... &quot;Input signal 1.0x&quot;</span>
<span class="cm">	 *    ADC[2:0] &quot;ADC range control&quot;</span>
<span class="cm">	 *                  =   4 (0x04) .....100</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 38 ACOM &quot;Analog Common Ground&quot;</span>
<span class="cm">	 *                  =  82 (0x52) 01010010</span>
<span class="cm">	 *    ACOM[7] &quot;Analog gain control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;Gain 1x&quot;</span>
<span class="cm">	 *    ACOM[6] &quot;Analog black level calibration&quot;</span>
<span class="cm">	 *                  =   1 (0x01) .1...... &quot;On&quot;</span>
<span class="cm">	 *    ACOM[5:0] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =  18 (0x12) ..010010</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x52</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 3A FREFA &quot;Internal Reference Adjustment&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 *    FREFA[7:0] &quot;Range&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 3C FVOPT &quot;Internal Reference Adjustment&quot;</span>
<span class="cm">	 *                  =  31 (0x1F) 00011111</span>
<span class="cm">	 *    FVOPT[7:0] &quot;Range&quot;</span>
<span class="cm">	 *                  =  31 (0x1F) 00011111</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x1f</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 44 Undocumented  =   0 (0x00) 00000000</span>
<span class="cm">	 *    44[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 40 Undocumented  =   0 (0x00) 00000000</span>
<span class="cm">	 *    40[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 41 Undocumented  =   0 (0x00) 00000000</span>
<span class="cm">	 *    41[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 42 Undocumented  =   0 (0x00) 00000000</span>
<span class="cm">	 *    42[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 43 Undocumented  =   0 (0x00) 00000000</span>
<span class="cm">	 *    43[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 45 Undocumented  = 128 (0x80) 10000000</span>
<span class="cm">	 *    45[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  = 128 (0x80) 10000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 48 Undocumented  = 192 (0xC0) 11000000</span>
<span class="cm">	 *    48[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  = 192 (0xC0) 11000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 49 Undocumented  =  25 (0x19) 00011001</span>
<span class="cm">	 *    49[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  =  25 (0x19) 00011001</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x19</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 4B Undocumented  = 128 (0x80) 10000000</span>
<span class="cm">	 *    4B[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  = 128 (0x80) 10000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 4D Undocumented  = 196 (0xC4) 11000100</span>
<span class="cm">	 *    4D[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  = 196 (0xC4) 11000100</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0xc4</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 35 VREF &quot;Reference Voltage Control&quot;</span>
<span class="cm">	 *                  =  76 (0x4c) 01001100</span>
<span class="cm">	 *    VREF[7:5] &quot;Column high reference control&quot;</span>
<span class="cm">	 *                  =   2 (0x02) 010..... &quot;higher voltage&quot;</span>
<span class="cm">	 *    VREF[4:2] &quot;Column low reference control&quot;</span>
<span class="cm">	 *                  =   3 (0x03) ...011.. &quot;Highest voltage&quot;</span>
<span class="cm">	 *    VREF[1:0] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......00</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x4c</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 3D Undocumented  =   0 (0x00) 00000000</span>
<span class="cm">	 *    3D[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 3E Undocumented  =   0 (0x00) 00000000</span>
<span class="cm">	 *    3E[7:0] &quot;It&#39;s a secret&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 3B FREFB &quot;Internal Reference Adjustment&quot;</span>
<span class="cm">	 *                  =  24 (0x18) 00011000</span>
<span class="cm">	 *    FREFB[7:0] &quot;Range&quot;</span>
<span class="cm">	 *                  =  24 (0x18) 00011000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x18</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 33 CHLF &quot;Current Control&quot;</span>
<span class="cm">	 *                  =  25 (0x19) 00011001</span>
<span class="cm">	 *    CHLF[7:6] &quot;Sensor current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00......</span>
<span class="cm">	 *    CHLF[5] &quot;Sensor current range control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..0..... &quot;normal range&quot;</span>
<span class="cm">	 *    CHLF[4] &quot;Sensor current&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ...1.... &quot;double current&quot;</span>
<span class="cm">	 *    CHLF[3] &quot;Sensor buffer current control&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ....1... &quot;half current&quot;</span>
<span class="cm">	 *    CHLF[2] &quot;Column buffer current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;normal current&quot;</span>
<span class="cm">	 *    CHLF[1] &quot;Analog DSP current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;normal current&quot;</span>
<span class="cm">	 *    CHLF[1] &quot;ADC current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;normal current&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x19</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 34 VBLM &quot;Blooming Control&quot;</span>
<span class="cm">	 *                  =  90 (0x5A) 01011010</span>
<span class="cm">	 *    VBLM[7] &quot;Hard soft reset switch&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;Hard reset&quot;</span>
<span class="cm">	 *    VBLM[6:4] &quot;Blooming voltage selection&quot;</span>
<span class="cm">	 *                  =   5 (0x05) .101....</span>
<span class="cm">	 *    VBLM[3:0] &quot;Sensor current control&quot;</span>
<span class="cm">	 *                  =  10 (0x0A) ....1010</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x5a</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 3B FREFB &quot;Internal Reference Adjustment&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 *    FREFB[7:0] &quot;Range&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 33 CHLF &quot;Current Control&quot;</span>
<span class="cm">	 *                  =   9 (0x09) 00001001</span>
<span class="cm">	 *    CHLF[7:6] &quot;Sensor current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00......</span>
<span class="cm">	 *    CHLF[5] &quot;Sensor current range control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..0..... &quot;normal range&quot;</span>
<span class="cm">	 *    CHLF[4] &quot;Sensor current&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ...0.... &quot;normal current&quot;</span>
<span class="cm">	 *    CHLF[3] &quot;Sensor buffer current control&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ....1... &quot;half current&quot;</span>
<span class="cm">	 *    CHLF[2] &quot;Column buffer current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;normal current&quot;</span>
<span class="cm">	 *    CHLF[1] &quot;Analog DSP current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;normal current&quot;</span>
<span class="cm">	 *    CHLF[1] &quot;ADC current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;normal current&quot;</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x09</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 34 VBLM &quot;Blooming Control&quot;</span>
<span class="cm">	 *                  =  80 (0x50) 01010000</span>
<span class="cm">	 *    VBLM[7] &quot;Hard soft reset switch&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;Hard reset&quot;</span>
<span class="cm">	 *    VBLM[6:4] &quot;Blooming voltage selection&quot;</span>
<span class="cm">	 *                  =   5 (0x05) .101....</span>
<span class="cm">	 *    VBLM[3:0] &quot;Sensor current control&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x50</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 12 COMH &quot;Common Control H&quot;</span>
<span class="cm">	 *                  =  64 (0x40) 01000000</span>
<span class="cm">	 *    COMH[7] &quot;SRST&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;No-op&quot;</span>
<span class="cm">	 *    COMH[6:4] &quot;Resolution selection&quot;</span>
<span class="cm">	 *                  =   4 (0x04) .100.... &quot;XGA&quot;</span>
<span class="cm">	 *    COMH[3] &quot;Master slave selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0... &quot;Master mode&quot;</span>
<span class="cm">	 *    COMH[2] &quot;Internal B/R channel option&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;B/R use same channel&quot;</span>
<span class="cm">	 *    COMH[1] &quot;Color bar test pattern&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;Off&quot;</span>
<span class="cm">	 *    COMH[0] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .......0</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 17 HREFST &quot;Horizontal window start&quot;</span>
<span class="cm">	 *                  =  31 (0x1F) 00011111</span>
<span class="cm">	 *    HREFST[7:0] &quot;Horizontal window start, 8 MSBs&quot;</span>
<span class="cm">	 *                  =  31 (0x1F) 00011111</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x1f</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 18 HREFEND &quot;Horizontal window end&quot;</span>
<span class="cm">	 *                  =  95 (0x5F) 01011111</span>
<span class="cm">	 *    HREFEND[7:0] &quot;Horizontal Window End, 8 MSBs&quot;</span>
<span class="cm">	 *                  =  95 (0x5F) 01011111</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x5f</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 19 VSTRT &quot;Vertical window start&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 *    VSTRT[7:0] &quot;Vertical Window Start, 8 MSBs&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 1A VEND &quot;Vertical window end&quot;</span>
<span class="cm">	 *                  =  96 (0x60) 01100000</span>
<span class="cm">	 *    VEND[7:0] &quot;Vertical Window End, 8 MSBs&quot;</span>
<span class="cm">	 *                  =  96 (0x60) 01100000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x60</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 32 COMM &quot;Common Control M&quot;</span>
<span class="cm">	 *                  =  18 (0x12) 00010010</span>
<span class="cm">	 *    COMM[7:6] &quot;Pixel clock divide option&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00...... &quot;/1&quot;</span>
<span class="cm">	 *    COMM[5:3] &quot;Horizontal window end position, 3 LSBs&quot;</span>
<span class="cm">	 *                  =   2 (0x02) ..010...</span>
<span class="cm">	 *    COMM[2:0] &quot;Horizontal window start position, 3 LSBs&quot;</span>
<span class="cm">	 *                  =   2 (0x02) .....010</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x12</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 03 COMA &quot;Common Control A&quot;</span>
<span class="cm">	 *                  =  74 (0x4A) 01001010</span>
<span class="cm">	 *    COMA[7:4] &quot;AWB Update Threshold&quot;</span>
<span class="cm">	 *                  =   4 (0x04) 0100....</span>
<span class="cm">	 *    COMA[3:2] &quot;Vertical window end line control 2 LSBs&quot;</span>
<span class="cm">	 *                  =   2 (0x02) ....10..</span>
<span class="cm">	 *    COMA[1:0] &quot;Vertical window start line control 2 LSBs&quot;</span>
<span class="cm">	 *                  =   2 (0x02) ......10</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x4a</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 11 CLKRC &quot;Clock Rate Control&quot;</span>
<span class="cm">	 *                  = 128 (0x80) 10000000</span>
<span class="cm">	 *    CLKRC[7] &quot;Internal frequency doublers on off seclection&quot;</span>
<span class="cm">	 *                  =   1 (0x01) 1....... &quot;On&quot;</span>
<span class="cm">	 *    CLKRC[6] &quot;Digital video master slave selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .0...... &quot;Master mode, sensor</span>
<span class="cm">	 *                                         provides PCLK&quot;</span>
<span class="cm">	 *    CLKRC[5:0] &quot;Clock divider { CLK = PCLK/(1+CLKRC[5:0]) }&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 12 COMH &quot;Common Control H&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 *    COMH[7] &quot;SRST&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;No-op&quot;</span>
<span class="cm">	 *    COMH[6:4] &quot;Resolution selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .000.... &quot;QXGA&quot;</span>
<span class="cm">	 *    COMH[3] &quot;Master slave selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0... &quot;Master mode&quot;</span>
<span class="cm">	 *    COMH[2] &quot;Internal B/R channel option&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;B/R use same channel&quot;</span>
<span class="cm">	 *    COMH[1] &quot;Color bar test pattern&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;Off&quot;</span>
<span class="cm">	 *    COMH[0] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .......0</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 12 COMH &quot;Common Control H&quot;</span>
<span class="cm">	 *                  =  64 (0x40) 01000000</span>
<span class="cm">	 *    COMH[7] &quot;SRST&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 0....... &quot;No-op&quot;</span>
<span class="cm">	 *    COMH[6:4] &quot;Resolution selection&quot;</span>
<span class="cm">	 *                  =   4 (0x04) .100.... &quot;XGA&quot;</span>
<span class="cm">	 *    COMH[3] &quot;Master slave selection&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ....0... &quot;Master mode&quot;</span>
<span class="cm">	 *    COMH[2] &quot;Internal B/R channel option&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .....0.. &quot;B/R use same channel&quot;</span>
<span class="cm">	 *    COMH[1] &quot;Color bar test pattern&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ......0. &quot;Off&quot;</span>
<span class="cm">	 *    COMH[0] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) .......0</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 17 HREFST &quot;Horizontal window start&quot;</span>
<span class="cm">	 *                  =  31 (0x1F) 00011111</span>
<span class="cm">	 *    HREFST[7:0] &quot;Horizontal window start, 8 MSBs&quot;</span>
<span class="cm">	 *                  =  31 (0x1F) 00011111</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x1f</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 18 HREFEND &quot;Horizontal window end&quot;</span>
<span class="cm">	 *                  =  95 (0x5F) 01011111</span>
<span class="cm">	 *    HREFEND[7:0] &quot;Horizontal Window End, 8 MSBs&quot;</span>
<span class="cm">	 *                  =  95 (0x5F) 01011111</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0x5f</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 19 VSTRT &quot;Vertical window start&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 *    VSTRT[7:0] &quot;Vertical Window Start, 8 MSBs&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00000000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 1A VEND &quot;Vertical window end&quot;</span>
<span class="cm">	 *                  =  96 (0x60) 01100000</span>
<span class="cm">	 *    VEND[7:0] &quot;Vertical Window End, 8 MSBs&quot;</span>
<span class="cm">	 *                  =  96 (0x60) 01100000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x60</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 32 COMM &quot;Common Control M&quot;</span>
<span class="cm">	 *                  =  18 (0x12) 00010010</span>
<span class="cm">	 *    COMM[7:6] &quot;Pixel clock divide option&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00...... &quot;/1&quot;</span>
<span class="cm">	 *    COMM[5:3] &quot;Horizontal window end position, 3 LSBs&quot;</span>
<span class="cm">	 *                  =   2 (0x02) ..010...</span>
<span class="cm">	 *    COMM[2:0] &quot;Horizontal window start position, 3 LSBs&quot;</span>
<span class="cm">	 *                  =   2 (0x02) .....010</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x12</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 03 COMA &quot;Common Control A&quot;</span>
<span class="cm">	 *                  =  74 (0x4A) 01001010</span>
<span class="cm">	 *    COMA[7:4] &quot;AWB Update Threshold&quot;</span>
<span class="cm">	 *                  =   4 (0x04) 0100....</span>
<span class="cm">	 *    COMA[3:2] &quot;Vertical window end line control 2 LSBs&quot;</span>
<span class="cm">	 *                  =   2 (0x02) ....10..</span>
<span class="cm">	 *    COMA[1:0] &quot;Vertical window start line control 2 LSBs&quot;</span>
<span class="cm">	 *                  =   2 (0x02) ......10</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x4a</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 02 RED &quot;Red Gain Control&quot;</span>
<span class="cm">	 *                  = 175 (0xAF) 10101111</span>
<span class="cm">	 *    RED[7] &quot;Action&quot;</span>
<span class="cm">	 *                  =   1 (0x01) 1....... &quot;gain = 1/(1+bitrev([6:0]))&quot;</span>
<span class="cm">	 *    RED[6:0] &quot;Value&quot;</span>
<span class="cm">	 *                  =  47 (0x2F) .0101111</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0xaf</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 2D ADDVSL &quot;VSYNC Pulse Width&quot;</span>
<span class="cm">	 *                  = 210 (0xD2) 11010010</span>
<span class="cm">	 *    ADDVSL[7:0] &quot;VSYNC pulse width, LSB&quot;</span>
<span class="cm">	 *                  = 210 (0xD2) 11010010</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0xd2</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 00 GAIN          =  24 (0x18) 00011000</span>
<span class="cm">	 *    GAIN[7:6] &quot;Reserved&quot;</span>
<span class="cm">	 *                  =   0 (0x00) 00......</span>
<span class="cm">	 *    GAIN[5] &quot;Double&quot;</span>
<span class="cm">	 *                  =   0 (0x00) ..0..... &quot;False&quot;</span>
<span class="cm">	 *    GAIN[4] &quot;Double&quot;</span>
<span class="cm">	 *                  =   1 (0x01) ...1.... &quot;True&quot;</span>
<span class="cm">	 *    GAIN[3:0] &quot;Range&quot;</span>
<span class="cm">	 *                  =   8 (0x08) ....1000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x18</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 01 BLUE &quot;Blue Gain Control&quot;</span>
<span class="cm">	 *                  = 240 (0xF0) 11110000</span>
<span class="cm">	 *    BLUE[7] &quot;Action&quot;</span>
<span class="cm">	 *                  =   1 (0x01) 1....... &quot;gain = 1/(1+bitrev([6:0]))&quot;</span>
<span class="cm">	 *    BLUE[6:0] &quot;Value&quot;</span>
<span class="cm">	 *                  = 112 (0x70) .1110000</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>

	<span class="cm">/*</span>
<span class="cm">	 * 10 AEC &quot;Automatic Exposure Control&quot;</span>
<span class="cm">	 *                  =  10 (0x0A) 00001010</span>
<span class="cm">	 *    AEC[7:0] &quot;Automatic Exposure Control, 8 MSBs&quot;</span>
<span class="cm">	 *                  =  10 (0x0A) 00001010</span>
<span class="cm">	 */</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x0a</span> <span class="p">},</span>

	<span class="p">{</span> <span class="mh">0xe1</span><span class="p">,</span> <span class="mh">0x67</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xe4</span><span class="p">,</span> <span class="mh">0x26</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xe5</span><span class="p">,</span> <span class="mh">0x3e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xf8</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_6x20</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span> <span class="cm">/* reset */</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x60</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x7f</span> <span class="p">},</span> <span class="cm">/* For when autoadjust is off */</span>
	<span class="p">{</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0xa8</span> <span class="p">},</span>
	<span class="cm">/* The ratio of 0x0c and 0x0d controls the white point */</span>
	<span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x15</span> <span class="p">},</span> <span class="cm">/* COMS */</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x75</span> <span class="p">},</span> <span class="cm">/* AEC Exposure time */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span> <span class="cm">/* Enable AGC */</span>
	<span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="cm">/* 0x16: 0x06 helps frame stability with moving objects */</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x06</span> <span class="p">},</span>
<span class="cm">/*	{ 0x20, 0x30 },  * Aperture correction enable */</span>
	<span class="p">{</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xb2</span> <span class="p">},</span> <span class="cm">/* BLC enable */</span>
	<span class="cm">/* 0x28: 0x05 Selects RGB format if RGB on */</span>
	<span class="p">{</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span> <span class="cm">/* Disable framerate adjust */</span>
<span class="cm">/*	{ 0x2b, 0xac },  * Framerate; Set 2a[7] first */</span>
	<span class="p">{</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x85</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0xa0</span> <span class="p">},</span> <span class="cm">/* Color Processing Parameter */</span>
	<span class="p">{</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0xd2</span> <span class="p">},</span> <span class="cm">/* Max A/D range */</span>
	<span class="p">{</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x8b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>

	<span class="p">{</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x39</span> <span class="p">},</span> <span class="cm">/* Enable AEC mode changing */</span>
	<span class="p">{</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x3c</span> <span class="p">},</span> <span class="cm">/* Change AEC mode */</span>
	<span class="p">{</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span> <span class="cm">/* Disable AEC mode changing */</span>

	<span class="p">{</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="cm">/* These next two registers (0x4a, 0x4b) are undocumented.</span>
<span class="cm">	 * They control the color balance */</span>
	<span class="p">{</span> <span class="mh">0x4a</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0xd2</span> <span class="p">},</span> <span class="cm">/* This reduces noise a bit */</span>
	<span class="p">{</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0xc1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
<span class="cm">/* Do 50-53 have any effect? */</span>
<span class="cm">/* Toggle 0x12[2] off and on here? */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_6x30</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span> <span class="cm">/* Reset */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x1f</span> <span class="p">},</span> <span class="cm">/* Gain */</span>
	<span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x99</span> <span class="p">},</span> <span class="cm">/* Blue gain */</span>
	<span class="p">{</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x7c</span> <span class="p">},</span> <span class="cm">/* Red gain */</span>
	<span class="p">{</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span> <span class="cm">/* Saturation */</span>
	<span class="p">{</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x0a</span> <span class="p">},</span> <span class="cm">/* Contrast */</span>
	<span class="p">{</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x95</span> <span class="p">},</span> <span class="cm">/* Brightness */</span>
	<span class="p">{</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x2d</span> <span class="p">},</span> <span class="cm">/* Sharpness */</span>
	<span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0xa0</span> <span class="p">},</span> <span class="cm">/* Was 0x20, bit7 enables a 2x gain which we need */</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x9a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* Pixel clock = fastest */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span> <span class="cm">/* Enable AGC and AWB */</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x21</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x38</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xea</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x93</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0xc4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x88</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span> <span class="cm">/* Crystal circuit power level */</span>
	<span class="p">{</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x9a</span> <span class="p">},</span> <span class="cm">/* Increase AEC black ratio */</span>
	<span class="p">{</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xb2</span> <span class="p">},</span> <span class="cm">/* BLC enable */</span>
	<span class="p">{</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xa2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x84</span> <span class="p">},</span> <span class="cm">/* 60 Hz power */</span>
	<span class="p">{</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0xa8</span> <span class="p">},</span> <span class="cm">/* 60 Hz power */</span>
	<span class="p">{</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xa0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x95</span> <span class="p">},</span> <span class="cm">/* Enable auto-brightness */</span>
	<span class="p">{</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x88</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x26</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x8f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x83</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mh">0x3c</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x1a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3f</span><span class="p">,</span> <span class="mh">0x0e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* White bal */</span>
	<span class="p">{</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* White bal */</span>
	<span class="p">{</span> <span class="mh">0x42</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x3f</span> <span class="p">},</span> <span class="cm">/* White bal */</span>
	<span class="p">{</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x7f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4a</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0xd0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span> <span class="cm">/* U = 0.563u, V = 0.714v */</span>
	<span class="p">{</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x07</span> <span class="p">},</span> <span class="cm">/* UV avg., col. killer: max */</span>
	<span class="p">{</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x23</span> <span class="p">},</span> <span class="cm">/* Max AGC gain: 18dB */</span>
	<span class="p">{</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x12</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x81</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x75</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span> <span class="cm">/* AGC dark current comp.: +1 */</span>
	<span class="p">{</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x2c</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span> <span class="cm">/* AWB chrominance levels */</span>
	<span class="p">{</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xa6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span> <span class="cm">/* Toggle AWB */</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* Lawrence Glaister &lt;lg@jfm.bc.ca&gt; reports:</span>
<span class="cm"> *</span>
<span class="cm"> * Register 0x0f in the 7610 has the following effects:</span>
<span class="cm"> *</span>
<span class="cm"> * 0x85 (AEC method 1): Best overall, good contrast range</span>
<span class="cm"> * 0x45 (AEC method 2): Very overexposed</span>
<span class="cm"> * 0xa5 (spec sheet default): Ok, but the black level is</span>
<span class="cm"> *	shifted resulting in loss of contrast</span>
<span class="cm"> * 0x05 (old driver setting): very overexposed, too much</span>
<span class="cm"> *	contrast</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_7610</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x06</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0xac</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x81</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>	<span class="cm">/* 0c */</span>
	<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x85</span> <span class="p">},</span>	<span class="cm">/* lg&#39;s setting */</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x1c</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x2a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x8a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xa2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xc2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xfe</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x93</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x30</span><span class="p">,</span> <span class="mh">0x71</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x31</span><span class="p">,</span> <span class="mh">0x60</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x32</span><span class="p">,</span> <span class="mh">0x26</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x48</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_7620</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>		<span class="cm">/* reset */</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>		<span class="cm">/* gain */</span>
	<span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>		<span class="cm">/* blue gain */</span>
	<span class="p">{</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>		<span class="cm">/* red gain */</span>
	<span class="p">{</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>		<span class="cm">/* OV7670_R03_VREF */</span>
	<span class="p">{</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x60</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x24</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x84</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x2f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xcf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x06</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xf5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x18</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xa2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xea</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x22</span> <span class="p">},</span> <span class="cm">/* Was 0x20, bit1 enables a 2x gain which we need */</span>
	<span class="p">{</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x88</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x91</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x27</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x5f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0xd5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x57</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x83</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x55</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x92</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0xcf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x76</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x22</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x1d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x8b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x14</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x54</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x8e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0xe2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
<span class="p">};</span>

<span class="cm">/* 7640 and 7648. The defaults should be OK for most registers. */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_7640</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x14</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">init_519_ov7660</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x5d</span><span class="p">,</span>	<span class="mh">0x03</span> <span class="p">},</span> <span class="cm">/* Turn off suspend mode */</span>
	<span class="p">{</span> <span class="mh">0x53</span><span class="p">,</span>	<span class="mh">0x9b</span> <span class="p">},</span> <span class="cm">/* 0x9f enables the (unused) microcontroller */</span>
	<span class="p">{</span> <span class="mh">0x54</span><span class="p">,</span>	<span class="mh">0x0f</span> <span class="p">},</span> <span class="cm">/* bit2 (jpeg enable) */</span>
	<span class="p">{</span> <span class="mh">0xa2</span><span class="p">,</span>	<span class="mh">0x20</span> <span class="p">},</span> <span class="cm">/* a2-a5 are undocumented */</span>
	<span class="p">{</span> <span class="mh">0xa3</span><span class="p">,</span>	<span class="mh">0x18</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xa4</span><span class="p">,</span>	<span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xa5</span><span class="p">,</span>	<span class="mh">0x28</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span>	<span class="cm">/* SetUsbInit */</span>
	<span class="p">{</span> <span class="mh">0x55</span><span class="p">,</span>	<span class="mh">0x02</span> <span class="p">},</span> <span class="cm">/* 4.096 Mhz audio clock */</span>
	<span class="cm">/* Enable both fields, YUV Input, disable defect comp (why?) */</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span>	<span class="mh">0x0c</span> <span class="p">},</span>	<span class="cm">/* 0x0d does U &lt;-&gt; V swap */</span>
	<span class="p">{</span> <span class="mh">0x21</span><span class="p">,</span>	<span class="mh">0x38</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x22</span><span class="p">,</span>	<span class="mh">0x1d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span>	<span class="mh">0x50</span> <span class="p">},</span> <span class="cm">/* undocumented */</span>
	<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* undocumented */</span>
	<span class="p">{</span> <span class="mh">0x40</span><span class="p">,</span>	<span class="mh">0xff</span> <span class="p">},</span> <span class="cm">/* I2C timeout counter */</span>
	<span class="p">{</span> <span class="mh">0x46</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* I2C clock prescaler */</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_7660</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="n">OV7670_R12_COM7</span><span class="p">,</span> <span class="n">OV7670_COM7_RESET</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R11_CLKRC</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>			<span class="cm">/* DM_LNL */</span>
	<span class="p">{</span><span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>			<span class="cm">/* DM_LNH */</span>
	<span class="p">{</span><span class="mh">0x9d</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">},</span>			<span class="cm">/* BD50ST */</span>
	<span class="p">{</span><span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x3f</span><span class="p">},</span>			<span class="cm">/* BD60ST */</span>
	<span class="p">{</span><span class="n">OV7670_R3B_COM11</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="mh">0xf5</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R10_AECH</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R00_GAIN</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R01_BLUE</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R02_RED</span><span class="p">,</span> <span class="mh">0x9d</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R12_COM7</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R04_COM1</span><span class="p">,</span> <span class="mo">00</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R18_HSTOP</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R17_HSTART</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R32_HREF</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R19_VSTART</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R1A_VSTOP</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R03_VREF</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R0E_COM5</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R0F_COM6</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R15_COM10</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>			<span class="cm">/* RSVD */</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>			<span class="cm">/* PSHFT */</span>
	<span class="p">{</span><span class="n">OV7670_R1E_MVFP</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span>			<span class="cm">/* RSVD */</span>
	<span class="p">{</span><span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>			<span class="cm">/* CHLF */</span>
	<span class="p">{</span><span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">},</span>			<span class="cm">/* ARBLM */</span>
	<span class="p">{</span><span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">},</span>			<span class="cm">/* RSVD */</span>
	<span class="p">{</span><span class="mh">0x36</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>			<span class="cm">/* RSVD */</span>
	<span class="p">{</span><span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>			<span class="cm">/* ADC */</span>
	<span class="p">{</span><span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">},</span>			<span class="cm">/* OFON */</span>
	<span class="p">{</span><span class="n">OV7670_R3A_TSLB</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R3C_COM12</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R3D_COM13</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R3F_EDGE</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R40_COM15</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R41_COM16</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span>			<span class="cm">/* DBLV */</span>
	<span class="p">{</span><span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span>			<span class="cm">/* RSVD */</span>
	<span class="p">{</span><span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>			<span class="cm">/* HV */</span>
	<span class="p">{</span><span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span>			<span class="cm">/* RSVD.. */</span>
	<span class="p">{</span><span class="mh">0x44</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x46</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xba</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x9a</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0xb9</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x9b</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x5f</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x9f</span><span class="p">,</span> <span class="mh">0x9d</span><span class="p">},</span>			<span class="cm">/* RSVD */</span>
	<span class="p">{</span><span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">},</span>			<span class="cm">/* DSPC2 */</span>
	<span class="p">{</span><span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span>			<span class="cm">/* matrix */</span>
	<span class="p">{</span><span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x57</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x0d</span><span class="p">},</span>			<span class="cm">/* matrix sign */</span>
	<span class="p">{</span><span class="mh">0x8b</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">},</span>			<span class="cm">/* RSVD */</span>
	<span class="p">{</span><span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span>			<span class="cm">/* gamma curve */</span>
	<span class="p">{</span><span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>			<span class="cm">/* gamma curve */</span>
	<span class="p">{</span><span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R14_COM9</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R24_AEW</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R25_AEB</span><span class="p">,</span> <span class="mh">0x72</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R26_VPT</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>			<span class="cm">/* LCC1 */</span>
	<span class="p">{</span><span class="mh">0x63</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>			<span class="cm">/* LCC2 */</span>
	<span class="p">{</span><span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">},</span>			<span class="cm">/* LCC3 */</span>
	<span class="p">{</span><span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>			<span class="cm">/* LCC4 */</span>
	<span class="p">{</span><span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>			<span class="cm">/* LCC5 */</span>
	<span class="p">{</span><span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">},</span>			<span class="cm">/* RSVD.. */</span>
	<span class="p">{</span><span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">},</span>
	<span class="p">{</span><span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="n">OV7670_COM8_FASTAEC</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AECSTEP</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_BFILT</span>
			<span class="o">|</span> <span class="mh">0x10</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AGC</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AWB</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AEC</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">}</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_9600</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0xb5</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">},</span>
	<span class="p">{</span><span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">}</span>
<span class="p">};</span>

<span class="cm">/* 7670. Defaults taken from OmniVision provided data,</span>
<span class="cm">*  as provided by Jonathan Corbet of OLPC		*/</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_7670</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">OV7670_R12_COM7</span><span class="p">,</span> <span class="n">OV7670_COM7_RESET</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R3A_TSLB</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>		<span class="cm">/* OV */</span>
	<span class="p">{</span> <span class="n">OV7670_R12_COM7</span><span class="p">,</span> <span class="n">OV7670_COM7_FMT_VGA</span> <span class="p">},</span> <span class="cm">/* VGA */</span>
	<span class="p">{</span> <span class="n">OV7670_R11_CLKRC</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
<span class="cm">/*</span>
<span class="cm"> * Set the hardware window.  These values from OV don&#39;t entirely</span>
<span class="cm"> * make sense - hstop is less than hstart.  But they work...</span>
<span class="cm"> */</span>
	<span class="p">{</span> <span class="n">OV7670_R17_HSTART</span><span class="p">,</span> <span class="mh">0x13</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R18_HSTOP</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R32_HREF</span><span class="p">,</span> <span class="mh">0xb6</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R19_VSTART</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R1A_VSTOP</span><span class="p">,</span> <span class="mh">0x7a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R03_VREF</span><span class="p">,</span> <span class="mh">0x0a</span> <span class="p">},</span>

	<span class="p">{</span> <span class="n">OV7670_R0C_COM3</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R3E_COM14</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
<span class="cm">/* Mystery scaling numbers */</span>
	<span class="p">{</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x3a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x35</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x11</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xa2</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
<span class="cm">/*	{ OV7670_R15_COM10, 0x0 }, */</span>

<span class="cm">/* Gamma curve values */</span>
	<span class="p">{</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x1e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x35</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x5a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x69</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x76</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x88</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x8f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x96</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xa3</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xaf</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xc4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xd7</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xe8</span> <span class="p">},</span>

<span class="cm">/* AGC and AEC parameters.  Note we start by disabling those features,</span>
<span class="cm">   then turn them only after tweaking the values. */</span>
	<span class="p">{</span> <span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="n">OV7670_COM8_FASTAEC</span>
			 <span class="o">|</span> <span class="n">OV7670_COM8_AECSTEP</span>
			 <span class="o">|</span> <span class="n">OV7670_COM8_BFILT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R00_GAIN</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R10_AECH</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R0D_COM4</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span> <span class="cm">/* magic reserved bit */</span>
	<span class="p">{</span> <span class="n">OV7670_R14_COM9</span><span class="p">,</span> <span class="mh">0x18</span> <span class="p">},</span> <span class="cm">/* 4x gain + magic rsvd bit */</span>
	<span class="p">{</span> <span class="n">OV7670_RA5_BD50MAX</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_RAB_BD60MAX</span><span class="p">,</span> <span class="mh">0x07</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R24_AEW</span><span class="p">,</span> <span class="mh">0x95</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R25_AEB</span><span class="p">,</span> <span class="mh">0x33</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R26_VPT</span><span class="p">,</span> <span class="mh">0xe3</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R9F_HAECC1</span><span class="p">,</span> <span class="mh">0x78</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_RA0_HAECC2</span><span class="p">,</span> <span class="mh">0x68</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xa1</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span> <span class="cm">/* magic */</span>
	<span class="p">{</span> <span class="n">OV7670_RA6_HAECC3</span><span class="p">,</span> <span class="mh">0xd8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_RA7_HAECC4</span><span class="p">,</span> <span class="mh">0xd8</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_RA8_HAECC5</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_RA9_HAECC6</span><span class="p">,</span> <span class="mh">0x90</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_RAA_HAECC7</span><span class="p">,</span> <span class="mh">0x94</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="n">OV7670_COM8_FASTAEC</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AECSTEP</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_BFILT</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AGC</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AEC</span> <span class="p">},</span>

<span class="cm">/* Almost all of these are magic &quot;reserved&quot; values.  */</span>
	<span class="p">{</span> <span class="n">OV7670_R0E_COM5</span><span class="p">,</span> <span class="mh">0x61</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R0F_COM6</span><span class="p">,</span> <span class="mh">0x4b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R1E_MVFP</span><span class="p">,</span> <span class="mh">0x07</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x91</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x07</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x33</span><span class="p">,</span> <span class="mh">0x0b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x0b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x1d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x71</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x2a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R3C_COM12</span><span class="p">,</span> <span class="mh">0x78</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4e</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R69_GFIX</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x4a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8d</span><span class="p">,</span> <span class="mh">0x4f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8e</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x8f</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xb0</span><span class="p">,</span> <span class="mh">0x84</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x0c</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x0e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0x82</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xb8</span><span class="p">,</span> <span class="mh">0x0a</span> <span class="p">},</span>

<span class="cm">/* More reserved magic, some of which tweaks white balance */</span>
	<span class="p">{</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0x0a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x44</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x34</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x58</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x47</span><span class="p">,</span> <span class="mh">0x28</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x3a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x88</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x88</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0x44</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x5c</span><span class="p">,</span> <span class="mh">0x67</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x49</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x5e</span><span class="p">,</span> <span class="mh">0x0e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x0a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x55</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x11</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x9f</span> <span class="p">},</span>			<span class="cm">/* &quot;9e for advance AWB&quot; */</span>
	<span class="p">{</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R01_BLUE</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R02_RED</span><span class="p">,</span> <span class="mh">0x60</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="n">OV7670_COM8_FASTAEC</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AECSTEP</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_BFILT</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AGC</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AEC</span>
			<span class="o">|</span> <span class="n">OV7670_COM8_AWB</span> <span class="p">},</span>

<span class="cm">/* Matrix coefficients */</span>
	<span class="p">{</span> <span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x22</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x5e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x9e</span> <span class="p">},</span>

	<span class="p">{</span> <span class="n">OV7670_R41_COM16</span><span class="p">,</span> <span class="n">OV7670_COM16_AWBGAIN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R3F_EDGE</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0xe1</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R3D_COM13</span><span class="p">,</span> <span class="n">OV7670_COM13_GAMMA</span>
			  <span class="o">|</span> <span class="n">OV7670_COM13_UVSAT</span>
			  <span class="o">|</span> <span class="mi">2</span><span class="p">},</span>		<span class="cm">/* was 3 */</span>
	<span class="p">{</span> <span class="mh">0x4b</span><span class="p">,</span> <span class="mh">0x09</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0x60</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R41_COM16</span><span class="p">,</span> <span class="mh">0x38</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>

	<span class="p">{</span> <span class="mh">0x34</span><span class="p">,</span> <span class="mh">0x11</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">OV7670_R3B_COM11</span><span class="p">,</span> <span class="n">OV7670_COM11_EXP</span><span class="o">|</span><span class="n">OV7670_COM11_HZAUTO</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x88</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x97</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x98</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x99</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x9a</span><span class="p">,</span> <span class="mh">0x84</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x9b</span><span class="p">,</span> <span class="mh">0x29</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x9c</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x9d</span><span class="p">,</span> <span class="mh">0x4c</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0x3f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>

<span class="cm">/* Extra-weird stuff.  Some sort of multiplexor register */</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xf0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x7e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x0a</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x0b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x0c</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x0d</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x09</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xc8</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x26</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">norm_8610</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x03</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span> <span class="cm">/* was 0x10, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0x70</span> <span class="p">},</span> <span class="cm">/* was 0x80, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x0a</span><span class="p">,</span> <span class="mh">0x86</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0xb0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x0d</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x25</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span> <span class="cm">/* Lin and Win think different about UV order */</span>
	<span class="p">{</span> <span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span> <span class="mh">0x38</span> <span class="p">},</span> <span class="cm">/* was 0x2f, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xea</span> <span class="p">},</span> <span class="cm">/* was 0xcf, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span> <span class="cm">/* was 0x06, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0xf5</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0xd0</span> <span class="p">},</span> <span class="cm">/* was 0x90, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span> <span class="cm">/* was 0x00, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span> <span class="cm">/* was 0x1d, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x50</span> <span class="p">},</span> <span class="cm">/* was 0x57, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xa2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xea</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0xc8</span> <span class="p">},</span> <span class="cm">/* was 0xcc, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xac</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x45</span> <span class="p">},</span> <span class="cm">/* was 0xd5, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x14</span> <span class="p">},</span> <span class="cm">/* was 0x01, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x4c</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x4d</span><span class="p">,</span> <span class="mh">0x30</span> <span class="p">},</span> <span class="cm">/* was 0x10, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x60</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span> <span class="cm">/* was 0x01, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* was 0x09, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x62</span><span class="p">,</span> <span class="mh">0x5f</span> <span class="p">},</span> <span class="cm">/* was 0xd7, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x63</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x64</span><span class="p">,</span> <span class="mh">0x53</span> <span class="p">},</span> <span class="cm">/* new windrv 090403 says 0x57,</span>
<span class="cm">			 * maybe thats wrong */</span>
	<span class="p">{</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0x55</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xb0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x68</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span> <span class="cm">/* was 0xaf, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x69</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x22</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6b</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x99</span> <span class="p">},</span> <span class="cm">/* was 0x80, old windrv says 0x00, but</span>
<span class="cm">			 * deleting bit7 colors the first images red */</span>
	<span class="p">{</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x11</span> <span class="p">},</span> <span class="cm">/* was 0x00, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x11</span> <span class="p">},</span> <span class="cm">/* was 0x00, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x8b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x14</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x54</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span><span class="cm">/* 0x60? - was 0x00, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x0e</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x02</span> <span class="p">},</span> <span class="cm">/* was 0x02, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span> <span class="cm">/* was 0x13, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x08</span> <span class="p">},</span> <span class="cm">/* was 0x09, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x08</span> <span class="p">},</span> <span class="cm">/* was 0xc0, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0xfb</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x28</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x23</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x0b</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x62</span> <span class="p">},</span> <span class="cm">/* was 0x61, new from windrv 090403 */</span>
	<span class="p">{</span> <span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xc9</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x88</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x89</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x25</span> <span class="p">},</span> <span class="cm">/* was 0x24, new from windrv 090403 */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="nf">ov7670_abs_to_sm</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">v</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">v</span> <span class="o">&amp;</span> <span class="mh">0x7f</span><span class="p">;</span>
	<span class="k">return</span> <span class="p">(</span><span class="mi">128</span> <span class="o">-</span> <span class="n">v</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x80</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Write a OV519 register */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">reg_w</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u16</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">,</span> <span class="n">req</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">req</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">req</span> <span class="o">=</span> <span class="mh">0x0a</span><span class="p">;</span>
		<span class="cm">/* fall through */</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;SET %02x %04x %04x&quot;</span><span class="p">,</span>
				<span class="n">req</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">req</span><span class="p">,</span>
			<span class="n">USB_DIR_OUT</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="n">value</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">leave</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">req</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;SET %02x 0000 %04x %02x&quot;</span><span class="p">,</span>
			<span class="n">req</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">req</span><span class="p">,</span>
			<span class="n">USB_DIR_OUT</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
<span class="nl">leave:</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg_w %02x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Read from a OV519 register, note not valid for the w9968cf!! */</span>
<span class="cm">/* returns: negative is error, pos or zero is data */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">reg_r</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">req</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">req</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">req</span> <span class="o">=</span> <span class="mh">0x0b</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">req</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_rcvctrlpipe</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="n">req</span><span class="p">,</span>
			<span class="n">USB_DIR_IN</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBI</span><span class="p">,</span> <span class="s">&quot;GET %02x 0000 %04x %02x&quot;</span><span class="p">,</span>
			<span class="n">req</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg_r %02x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Read 8 values from a OV519 register */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">reg_r8</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
		  <span class="n">u16</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_rcvctrlpipe</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="mi">1</span><span class="p">,</span>			<span class="cm">/* REQ_IO */</span>
			<span class="n">USB_DIR_IN</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg_r8 %02x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Writes bits at positions specified by mask to an OV51x reg. Bits that are in</span>
<span class="cm"> * the same position as 1&#39;s in &quot;mask&quot; are cleared and set to &quot;value&quot;. Bits</span>
<span class="cm"> * that are in the same position as 0&#39;s in &quot;mask&quot; are preserved, regardless</span>
<span class="cm"> * of their respective state in &quot;value&quot;.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">reg_w_mask</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			<span class="n">u16</span> <span class="n">index</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">value</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oldval</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">mask</span> <span class="o">!=</span> <span class="mh">0xff</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">value</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>			<span class="cm">/* Enforce mask on value */</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">reg_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">index</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>

		<span class="n">oldval</span> <span class="o">=</span> <span class="n">ret</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>		<span class="cm">/* Clear the masked bits */</span>
		<span class="n">value</span> <span class="o">|=</span> <span class="n">oldval</span><span class="p">;</span>		<span class="cm">/* Set the desired bits */</span>
	<span class="p">}</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Writes multiple (n) byte value to a single register. Only valid with certain</span>
<span class="cm"> * registers (0x30 and 0xc4 - 0xce).</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov518_reg_w32</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u16</span> <span class="n">index</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="o">*</span><span class="p">((</span><span class="n">__le32</span> <span class="o">*</span><span class="p">)</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">)</span> <span class="o">=</span> <span class="n">__cpu_to_le32</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="mi">1</span> <span class="cm">/* REG_IO */</span><span class="p">,</span>
			<span class="n">USB_DIR_OUT</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;reg_w32 %02x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov511_i2c_w</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">,</span> <span class="n">retries</span><span class="p">;</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;ov511_i2c_w %02x %02x&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

	<span class="cm">/* Three byte write cycle */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">retries</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Select camera register */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_SADDR_3</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>

		<span class="cm">/* Write &quot;value&quot; to I2C data port of OV511 */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_DATA</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

		<span class="cm">/* Initiate 3-byte write cycle */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>

		<span class="k">do</span> <span class="p">{</span>
			<span class="n">rc</span> <span class="o">=</span> <span class="n">reg_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">));</span> <span class="cm">/* Retry until idle */</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/* Ack? */</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">retries</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;i2c write retries exhausted&quot;</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ov511_i2c_r</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">retries</span><span class="p">;</span>

	<span class="cm">/* Two byte write cycle */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">retries</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Select camera register */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_SADDR_2</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>

		<span class="cm">/* Initiate 2-byte write cycle */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>

		<span class="k">do</span> <span class="p">{</span>
			<span class="n">rc</span> <span class="o">=</span> <span class="n">reg_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">));</span> <span class="cm">/* Retry until idle */</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/* Ack? */</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* I2C abort */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">retries</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBI</span><span class="p">,</span> <span class="s">&quot;i2c write retries exhausted&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* Two byte read cycle */</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">retries</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span> <span class="p">;</span> <span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Initiate 2-byte read cycle */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>

		<span class="k">do</span> <span class="p">{</span>
			<span class="n">rc</span> <span class="o">=</span> <span class="n">reg_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">));</span> <span class="cm">/* Retry until idle */</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">rc</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="cm">/* Ack? */</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* I2C abort */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="n">retries</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBI</span><span class="p">,</span> <span class="s">&quot;i2c read retries exhausted&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">value</span> <span class="o">=</span> <span class="n">reg_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_DATA</span><span class="p">);</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBI</span><span class="p">,</span> <span class="s">&quot;ov511_i2c_r %02x %02x&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

	<span class="cm">/* This is needed to make i2c_w() work */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_I2C_CTL</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * The OV518 I2C I/O procedure is different, hence, this function.</span>
<span class="cm"> * This is normally only called from i2c_w(). Note that this function</span>
<span class="cm"> * always succeeds regardless of whether the sensor is present and working.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov518_i2c_w</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
		<span class="n">u8</span> <span class="n">reg</span><span class="p">,</span>
		<span class="n">u8</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;ov518_i2c_w %02x %02x&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

	<span class="cm">/* Select camera register */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_SADDR_3</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>

	<span class="cm">/* Write &quot;value&quot; to I2C data port of OV511 */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_DATA</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

	<span class="cm">/* Initiate 3-byte write cycle */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R518_I2C_CTL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>

	<span class="cm">/* wait for write complete */</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
	<span class="n">reg_r8</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R518_I2C_CTL</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * returns: negative is error, pos or zero is data</span>
<span class="cm"> *</span>
<span class="cm"> * The OV518 I2C I/O procedure is different, hence, this function.</span>
<span class="cm"> * This is normally only called from i2c_r(). Note that this function</span>
<span class="cm"> * always succeeds regardless of whether the sensor is present and working.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">ov518_i2c_r</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">value</span><span class="p">;</span>

	<span class="cm">/* Select camera register */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_SADDR_2</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>

	<span class="cm">/* Initiate 2-byte write cycle */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R518_I2C_CTL</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>
	<span class="n">reg_r8</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R518_I2C_CTL</span><span class="p">);</span>

	<span class="cm">/* Initiate 2-byte read cycle */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R518_I2C_CTL</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>
	<span class="n">reg_r8</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R518_I2C_CTL</span><span class="p">);</span>

	<span class="n">value</span> <span class="o">=</span> <span class="n">reg_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_DATA</span><span class="p">);</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBI</span><span class="p">,</span> <span class="s">&quot;ov518_i2c_r %02x %02x&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ovfx2_i2c_w</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_sndctrlpipe</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="mh">0x02</span><span class="p">,</span>
			<span class="n">USB_DIR_OUT</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">reg</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;ovfx2_i2c_w %02x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBO</span><span class="p">,</span> <span class="s">&quot;ovfx2_i2c_w %02x %02x&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">ovfx2_i2c_r</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">usb_control_msg</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span>
			<span class="n">usb_rcvctrlpipe</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
			<span class="mh">0x03</span><span class="p">,</span>
			<span class="n">USB_DIR_IN</span> <span class="o">|</span> <span class="n">USB_TYPE_VENDOR</span> <span class="o">|</span> <span class="n">USB_RECIP_DEVICE</span><span class="p">,</span>
			<span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">u16</span><span class="p">)</span> <span class="n">reg</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">500</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_USBI</span><span class="p">,</span> <span class="s">&quot;ovfx2_i2c_r %02x %02x&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;ovfx2_i2c_r %02x failed %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2c_w</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u8</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_reg_cache</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">ov511_i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">ov518_i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">ovfx2_i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">w9968cf_i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Up on sensor reset empty the register cache */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">==</span> <span class="mh">0x12</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">))</span>
			<span class="n">memset</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_reg_cache</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
				<span class="k">sizeof</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_reg_cache</span><span class="p">));</span>
		<span class="k">else</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_reg_cache</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">i2c_r</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_reg_cache</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_reg_cache</span><span class="p">[</span><span class="n">reg</span><span class="p">];</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">ov511_i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">ov518_i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">ovfx2_i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">w9968cf_i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_reg_cache</span><span class="p">[</span><span class="n">reg</span><span class="p">]</span> <span class="o">=</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Writes bits at positions specified by mask to an I2C reg. Bits that are in</span>
<span class="cm"> * the same position as 1&#39;s in &quot;mask&quot; are cleared and set to &quot;value&quot;. Bits</span>
<span class="cm"> * that are in the same position as 0&#39;s in &quot;mask&quot; are preserved, regardless</span>
<span class="cm"> * of their respective state in &quot;value&quot;.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">i2c_w_mask</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">reg</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">value</span><span class="p">,</span>
			<span class="n">u8</span> <span class="n">mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">oldval</span><span class="p">;</span>

	<span class="n">value</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>			<span class="cm">/* Enforce mask on value */</span>
	<span class="n">rc</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">oldval</span> <span class="o">=</span> <span class="n">rc</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">mask</span><span class="p">;</span>		<span class="cm">/* Clear the masked bits */</span>
	<span class="n">value</span> <span class="o">|=</span> <span class="n">oldval</span><span class="p">;</span>		<span class="cm">/* Set the desired bits */</span>
	<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Temporarily stops OV511 from functioning. Must do this before changing</span>
<span class="cm"> * registers while the camera is streaming */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ov51x_stop</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_STREAM</span><span class="p">,</span> <span class="s">&quot;stopping&quot;</span><span class="p">);</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">stopped</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R51_RESET1</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R51_RESET1</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>		<span class="cm">/* FRAR */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x0a05</span><span class="p">);</span> <span class="cm">/* stop USB transfer */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* Restarts OV511 after ov511_stop() is called. Has no effect if it is not</span>
<span class="cm"> * actually stopped (for performance). */</span>
<span class="k">static</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">ov51x_restart</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_STREAM</span><span class="p">,</span> <span class="s">&quot;restarting&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">stopped</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">stopped</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Reinitialize the stream */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R51_RESET1</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R51_RESET1</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x1d</span><span class="p">);</span>		<span class="cm">/* FRAR */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mh">0x8a05</span><span class="p">);</span> <span class="cm">/* USB FIFO enable */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">ov51x_set_slave_ids</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">slave</span><span class="p">);</span>

<span class="cm">/* This does an initial reset of an OmniVision sensor and ensures that I2C</span>
<span class="cm"> * is synchronized. Returns &lt;0 on failure.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">init_ov_sensor</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="n">u8</span> <span class="n">slave</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">ov51x_set_slave_ids</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">slave</span><span class="p">);</span>

	<span class="cm">/* Reset the sensor */</span>
	<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>

	<span class="cm">/* Wait for it to initialize */</span>
	<span class="n">msleep</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">i2c_detect_tries</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_ID_HIGH</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x7f</span> <span class="o">&amp;&amp;</span>
		    <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_ID_LOW</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xa2</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;I2C synced in %d attempt(s)&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="cm">/* Reset the sensor */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>

		<span class="cm">/* Wait for it to initialize */</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">150</span><span class="p">);</span>

		<span class="cm">/* Dummy read to sync I2C */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Set the read and write slave IDs. The &quot;slave&quot; argument is the write slave,</span>
<span class="cm"> * and the read slave will be set to (slave + 1).</span>
<span class="cm"> * This should not be called from outside the i2c I/O functions.</span>
<span class="cm"> * Sets I2C read and write slave IDs. Returns &lt;0 for error</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov51x_set_slave_ids</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
				<span class="n">u8</span> <span class="n">slave</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OVFX2_I2C_ADDR</span><span class="p">,</span> <span class="n">slave</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_addr</span> <span class="o">=</span> <span class="n">slave</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_W_SID</span><span class="p">,</span> <span class="n">slave</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_I2C_R_SID</span><span class="p">,</span> <span class="n">slave</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">write_regvals</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			 <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="o">*</span><span class="n">regvals</span><span class="p">,</span>
			 <span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">regvals</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span> <span class="n">regvals</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
		<span class="n">regvals</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">write_i2c_regvals</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="o">*</span><span class="n">regvals</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">regvals</span><span class="o">-&gt;</span><span class="n">reg</span><span class="p">,</span> <span class="n">regvals</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span>
		<span class="n">regvals</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/****************************************************************************</span>
<span class="cm"> *</span>
<span class="cm"> * OV511 and sensor configuration</span>
<span class="cm"> *</span>
<span class="cm"> ***************************************************************************/</span>

<span class="cm">/* This initializes the OV2x10 / OV3610 / OV3620 / OV9600 */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov_hires_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">!=</span> <span class="n">BRIDGE_OVFX2</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;error hires sensors only supported with ovfx2</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;starting ov hires configuration&quot;</span><span class="p">);</span>

	<span class="cm">/* Detect sensor (sub)type */</span>
	<span class="n">high</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">);</span>
	<span class="n">low</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">);</span>
	<span class="cm">/* info(&quot;%x, %x&quot;, high, low); */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">high</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x96</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">low</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x40</span>:
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is a OV2610&quot;</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV2610</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">case</span> <span class="mh">0x41</span>:
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is a OV2610AE&quot;</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV2610AE</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">case</span> <span class="mh">0xb1</span>:
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is a OV9600&quot;</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV9600</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x36</span>:
		<span class="k">if</span> <span class="p">((</span><span class="n">low</span> <span class="o">&amp;</span> <span class="mh">0x0f</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x00</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is a OV3610&quot;</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV3610</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Error unknown sensor type: %02x%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* This initializes the OV8110, OV8610 sensor. The OV8110 uses</span>
<span class="cm"> * the same register settings as the OV8610, since they are very similar.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov8xx0_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;starting ov8xx0 configuration&quot;</span><span class="p">);</span>

	<span class="cm">/* Detect sensor (sub)type */</span>
	<span class="n">rc</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_COM_I</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_ERR</span><span class="p">,</span> <span class="s">&quot;Error detecting sensor type&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV8610</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Unknown image sensor version: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* This initializes the OV7610, OV7620, or OV76BE sensor. The OV76BE uses</span>
<span class="cm"> * the same register settings as the OV7610, since they are very similar.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov7xx0_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">low</span><span class="p">;</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;starting OV7xx0 configuration&quot;</span><span class="p">);</span>

	<span class="cm">/* Detect sensor (sub)type */</span>
	<span class="n">rc</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_COM_I</span><span class="p">);</span>

	<span class="cm">/* add OV7670 here</span>
<span class="cm">	 * it appears to be wrongly detected as a 7610 by default */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Error detecting sensor type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* quick hack to make OV7670s work */</span>
		<span class="n">high</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">);</span>
		<span class="n">low</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">);</span>
		<span class="cm">/* info(&quot;%x, %x&quot;, high, low); */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">==</span> <span class="mh">0x76</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">low</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x70</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV76%02x&quot;</span><span class="p">,</span> <span class="n">low</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV7670</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV7610&quot;</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV7610</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* I don&#39;t know what&#39;s different about the 76BE yet. */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV7620AE&quot;</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV7620AE</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV76BE&quot;</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV76BE</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* try to read product id registers */</span>
		<span class="n">high</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Error detecting camera chip PID</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">low</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">low</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Error detecting camera chip VER</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">high</span> <span class="o">==</span> <span class="mh">0x76</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">low</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="mh">0x30</span>:
				<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Sensor is an OV7630/OV7635</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;7630 is not supported by this driver</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x40</span>:
				<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV7645&quot;</span><span class="p">);</span>
				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV7640</span><span class="p">;</span> <span class="cm">/* FIXME */</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x45</span>:
				<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV7645B&quot;</span><span class="p">);</span>
				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV7640</span><span class="p">;</span> <span class="cm">/* FIXME */</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x48</span>:
				<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV7648&quot;</span><span class="p">);</span>
				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV7648</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="mh">0x60</span>:
				<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is a OV7660&quot;</span><span class="p">);</span>
				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV7660</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="nl">default:</span>
				<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Unknown sensor: 0x76%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">low</span><span class="p">);</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV7620&quot;</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV7620</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Unknown image sensor version: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rc</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* This initializes the OV6620, OV6630, OV6630AE, or OV6630AF sensor. */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov6xx0_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">rc</span><span class="p">;</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;starting OV6xx0 configuration&quot;</span><span class="p">);</span>

	<span class="cm">/* Detect sensor (sub)type */</span>
	<span class="n">rc</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_COM_I</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">rc</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Error detecting sensor type</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Ugh. The first two bits are the version bits, but</span>
<span class="cm">	 * the entire register value must be used. I guess OVT</span>
<span class="cm">	 * underestimated how many variants they would make. */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">rc</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x00</span>:
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV6630</span><span class="p">;</span>
		<span class="n">pr_warn</span><span class="p">(</span><span class="s">&quot;WARNING: Sensor is an OV66308. Your camera may have been misdetected in previous driver versions.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x01</span>:
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV6620</span><span class="p">;</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV6620&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x02</span>:
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV6630</span><span class="p">;</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV66308AE&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x03</span>:
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV66308AF</span><span class="p">;</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Sensor is an OV66308AF&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x90</span>:
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="n">SEN_OV6630</span><span class="p">;</span>
		<span class="n">pr_warn</span><span class="p">(</span><span class="s">&quot;WARNING: Sensor is an OV66307. Your camera may have been misdetected in previous driver versions.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;FATAL: Unknown sensor version: 0x%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">rc</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Set sensor-specific vars */</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sif</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Turns on or off the LED. Only has an effect with OV511+/OV518(+)/OV519 */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov51x_led_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">on</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">invert_led</span><span class="p">)</span>
		<span class="n">on</span> <span class="o">=</span> <span class="o">!</span><span class="n">on</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="cm">/* OV511 has no LED control */</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_SYS_LED_CTL</span><span class="p">,</span> <span class="n">on</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R518_GPIO_OUT</span><span class="p">,</span> <span class="mh">0x02</span> <span class="o">*</span> <span class="n">on</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_GPIO_DATA_OUT0</span><span class="p">,</span> <span class="n">on</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_reset_snapshot</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_needs_reset</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/* Note it is important that we clear sd-&gt;snapshot_needs_reset,</span>
<span class="cm">	   before actually clearing the snapshot state in the bridge</span>
<span class="cm">	   otherwise we might race with the pkt_scan interrupt handler */</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_needs_reset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span> <span class="cm">/* Reset */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span> <span class="cm">/* Enable */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov51x_upload_quan_tables</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">yQuanTable511</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
		<span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
		<span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
		<span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span>
	<span class="p">};</span>

	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">uvQuanTable511</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>
		<span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span>
	<span class="p">};</span>

	<span class="cm">/* OV518 quantization tables are 8x4 (instead of 8x8) */</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">yQuanTable518</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
		<span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
		<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span>
	<span class="p">};</span>
	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">uvQuanTable518</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
		<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span>
		<span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span>
		<span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span>
	<span class="p">};</span>

	<span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="o">*</span><span class="n">pYTable</span><span class="p">,</span> <span class="o">*</span><span class="n">pUVTable</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">val0</span><span class="p">,</span> <span class="n">val1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">reg</span> <span class="o">=</span> <span class="n">R51x_COMP_LUT_BEGIN</span><span class="p">;</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Uploading quantization tables&quot;</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">==</span> <span class="n">BRIDGE_OV511</span> <span class="o">||</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">==</span> <span class="n">BRIDGE_OV511PLUS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pYTable</span> <span class="o">=</span> <span class="n">yQuanTable511</span><span class="p">;</span>
		<span class="n">pUVTable</span> <span class="o">=</span> <span class="n">uvQuanTable511</span><span class="p">;</span>
		<span class="n">size</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pYTable</span> <span class="o">=</span> <span class="n">yQuanTable518</span><span class="p">;</span>
		<span class="n">pUVTable</span> <span class="o">=</span> <span class="n">uvQuanTable518</span><span class="p">;</span>
		<span class="n">size</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">val0</span> <span class="o">=</span> <span class="o">*</span><span class="n">pYTable</span><span class="o">++</span><span class="p">;</span>
		<span class="n">val1</span> <span class="o">=</span> <span class="o">*</span><span class="n">pYTable</span><span class="o">++</span><span class="p">;</span>
		<span class="n">val0</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
		<span class="n">val1</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
		<span class="n">val0</span> <span class="o">|=</span> <span class="n">val1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">val0</span><span class="p">);</span>

		<span class="n">val0</span> <span class="o">=</span> <span class="o">*</span><span class="n">pUVTable</span><span class="o">++</span><span class="p">;</span>
		<span class="n">val1</span> <span class="o">=</span> <span class="o">*</span><span class="n">pUVTable</span><span class="o">++</span><span class="p">;</span>
		<span class="n">val0</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
		<span class="n">val1</span> <span class="o">&amp;=</span> <span class="mh">0x0f</span><span class="p">;</span>
		<span class="n">val0</span> <span class="o">|=</span> <span class="n">val1</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">;</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">reg</span> <span class="o">+</span> <span class="n">size</span><span class="p">,</span> <span class="n">val0</span><span class="p">);</span>

		<span class="n">reg</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* This initializes the OV511/OV511+ and the sensor */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov511_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="cm">/* For 511 and 511+ */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">init_511</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span>	<span class="mh">0x7f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_INIT</span><span class="p">,</span>	<span class="mh">0x01</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span>	<span class="mh">0x7f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_INIT</span><span class="p">,</span>	<span class="mh">0x01</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span>	<span class="mh">0x3f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_INIT</span><span class="p">,</span>	<span class="mh">0x01</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span>	<span class="mh">0x3d</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">norm_511</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="n">R511_DRAM_FLOW_CTL</span><span class="p">,</span>	<span class="mh">0x01</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x02</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R511_FIFO_OPTS</span><span class="p">,</span>	<span class="mh">0x1f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R511_COMP_EN</span><span class="p">,</span>		<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R511_COMP_LUT_EN</span><span class="p">,</span>	<span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">norm_511_p</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="n">R511_DRAM_FLOW_CTL</span><span class="p">,</span>	<span class="mh">0xff</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x02</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R511_FIFO_OPTS</span><span class="p">,</span>	<span class="mh">0xff</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R511_COMP_EN</span><span class="p">,</span>		<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R511_COMP_LUT_EN</span><span class="p">,</span>	<span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">compress_511</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x1f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x05</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x06</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x06</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x14</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x04</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Device custom id %x&quot;</span><span class="p">,</span> <span class="n">reg_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_CUST_ID</span><span class="p">));</span>

	<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">init_511</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">init_511</span><span class="p">));</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
		<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_511</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_511</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_511_p</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_511_p</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Init compression */</span>
	<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">compress_511</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">compress_511</span><span class="p">));</span>

	<span class="n">ov51x_upload_quan_tables</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* This initializes the OV518/OV518+ and the sensor */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov518_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="cm">/* For 518 and 518+ */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">init_518</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span>	<span class="mh">0x40</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_INIT</span><span class="p">,</span>	<span class="mh">0xe1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span>	<span class="mh">0x3e</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_INIT</span><span class="p">,</span>	<span class="mh">0xe1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">R51x_SYS_INIT</span><span class="p">,</span>	<span class="mh">0xe1</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x46</span><span class="p">,</span>			<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x5d</span><span class="p">,</span>			<span class="mh">0x03</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">norm_518</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x02</span> <span class="p">},</span> <span class="cm">/* Reset */</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x01</span> <span class="p">},</span> <span class="cm">/* Enable */</span>
		<span class="p">{</span> <span class="mh">0x31</span><span class="p">,</span>			<span class="mh">0x0f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x5d</span><span class="p">,</span>			<span class="mh">0x03</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x24</span><span class="p">,</span>			<span class="mh">0x9f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x25</span><span class="p">,</span>			<span class="mh">0x90</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span>			<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x51</span><span class="p">,</span>			<span class="mh">0x04</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x71</span><span class="p">,</span>			<span class="mh">0x19</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x2f</span><span class="p">,</span>			<span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">norm_518_p</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x02</span> <span class="p">},</span> <span class="cm">/* Reset */</span>
		<span class="p">{</span> <span class="n">R51x_SYS_SNAP</span><span class="p">,</span>	<span class="mh">0x01</span> <span class="p">},</span> <span class="cm">/* Enable */</span>
		<span class="p">{</span> <span class="mh">0x31</span><span class="p">,</span>			<span class="mh">0x0f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x5d</span><span class="p">,</span>			<span class="mh">0x03</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x24</span><span class="p">,</span>			<span class="mh">0x9f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x25</span><span class="p">,</span>			<span class="mh">0x90</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span>			<span class="mh">0x60</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x51</span><span class="p">,</span>			<span class="mh">0x02</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x71</span><span class="p">,</span>			<span class="mh">0x19</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x40</span><span class="p">,</span>			<span class="mh">0xff</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x41</span><span class="p">,</span>			<span class="mh">0x42</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x46</span><span class="p">,</span>			<span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x33</span><span class="p">,</span>			<span class="mh">0x04</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x21</span><span class="p">,</span>			<span class="mh">0x19</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x3f</span><span class="p">,</span>			<span class="mh">0x10</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x2f</span><span class="p">,</span>			<span class="mh">0x80</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="cm">/* First 5 bits of custom ID reg are a revision ID on OV518 */</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_PROBE</span><span class="p">,</span> <span class="s">&quot;Device revision %d&quot;</span><span class="p">,</span>
		<span class="mh">0x1f</span> <span class="o">&amp;</span> <span class="n">reg_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_CUST_ID</span><span class="p">));</span>

	<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">init_518</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">init_518</span><span class="p">));</span>

	<span class="cm">/* Set LED GPIO pin to output mode */</span>
	<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R518_GPIO_CTL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
		<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_518</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_518</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_518_p</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_518_p</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ov51x_upload_quan_tables</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov519_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">init_519</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="mh">0x5a</span><span class="p">,</span> <span class="mh">0x6d</span> <span class="p">},</span> <span class="cm">/* EnableSystem */</span>
		<span class="p">{</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x9b</span> <span class="p">},</span> <span class="cm">/* don&#39;t enable the microcontroller */</span>
		<span class="p">{</span> <span class="n">OV519_R54_EN_CLK1</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span> <span class="cm">/* set bit2 to enable jpeg */</span>
		<span class="p">{</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0x03</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x49</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
		<span class="cm">/* Set LED pin to output mode. Bit 4 must be cleared or sensor</span>
<span class="cm">		 * detection will fail. This deserves further investigation. */</span>
		<span class="p">{</span> <span class="n">OV519_GPIO_IO_CTRL0</span><span class="p">,</span>   <span class="mh">0xee</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">OV519_R51_RESET1</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span>
		<span class="p">{</span> <span class="n">OV519_R51_RESET1</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
		<span class="cm">/* windows reads 0x55 at this point*/</span>
	<span class="p">};</span>

	<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">init_519</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">init_519</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ovfx2_configure</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">init_fx2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x60</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x02</span><span class="p">,</span> <span class="mh">0x01</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x1d</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x82</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0xea</span><span class="p">,</span> <span class="mh">0xc7</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0xeb</span><span class="p">,</span> <span class="mh">0x10</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0xf6</span> <span class="p">},</span>
	<span class="p">};</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">stopped</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">init_fx2</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">init_fx2</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* set the mode */</span>
<span class="cm">/* This function works for ov7660 only */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov519_set_mode</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">bridge_ov7660</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x16</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">sensor_ov7660</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}}</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">sensor_ov7660_2</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="n">OV7670_R17_HSTART</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">},</span>
		<span class="p">{</span><span class="n">OV7670_R18_HSTOP</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
		<span class="p">{</span><span class="n">OV7670_R32_HREF</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">},</span>
		<span class="p">{</span><span class="n">OV7670_R19_VSTART</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span>
		<span class="p">{</span><span class="n">OV7670_R1A_VSTOP</span><span class="p">,</span> <span class="mh">0x7a</span><span class="p">},</span>
		<span class="p">{</span><span class="n">OV7670_R03_VREF</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
<span class="cm">/*		{0x33, 0x00}, */</span>
<span class="cm">/*		{0x34, 0x07}, */</span>
<span class="cm">/*		{0x36, 0x00}, */</span>
<span class="cm">/*		{0x6b, 0x0a}, */</span>
	<span class="p">};</span>

	<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">bridge_ov7660</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">curr_mode</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">bridge_ov7660</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
	<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">sensor_ov7660</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">curr_mode</span><span class="p">],</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sensor_ov7660</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
	<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">sensor_ov7660_2</span><span class="p">,</span>
			<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sensor_ov7660_2</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* set the frame rate */</span>
<span class="cm">/* This function works for sensors ov7640, ov7648 ov7660 and ov7670 only */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov519_set_fr</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">fr</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">clock</span><span class="p">;</span>
	<span class="cm">/* frame rate table with indices:</span>
<span class="cm">	 *	- mode = 0: 320x240, 1: 640x480</span>
<span class="cm">	 *	- fr rate = 0: 30, 1: 25, 2: 20, 3: 15, 4: 10, 5: 5</span>
<span class="cm">	 *	- reg = 0: bridge a4, 1: bridge 23, 2: sensor 11 (clock)</span>
<span class="cm">	 */</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">fr_tb</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">6</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x0c</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">}},</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">frame_rate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">=</span> <span class="n">frame_rate</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)</span>
		<span class="n">fr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&gt;=</span> <span class="mi">25</span><span class="p">)</span>
		<span class="n">fr</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">)</span>
		<span class="n">fr</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&gt;=</span> <span class="mi">15</span><span class="p">)</span>
		<span class="n">fr</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span>
		<span class="n">fr</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">fr</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="n">fr_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">curr_mode</span><span class="p">][</span><span class="n">fr</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="n">fr_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">curr_mode</span><span class="p">][</span><span class="n">fr</span><span class="p">][</span><span class="mi">1</span><span class="p">]);</span>
	<span class="n">clock</span> <span class="o">=</span> <span class="n">fr_tb</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">curr_mode</span><span class="p">][</span><span class="n">fr</span><span class="p">][</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV7660</span><span class="p">)</span>
		<span class="n">clock</span> <span class="o">|=</span> <span class="mh">0x80</span><span class="p">;</span>		<span class="cm">/* enable double clock */</span>
	<span class="n">ov518_i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R11_CLKRC</span><span class="p">,</span> <span class="n">clock</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setautogain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">AUTOGAIN</span><span class="p">].</span><span class="n">val</span> <span class="o">?</span> <span class="mh">0x05</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* this function is called at probe time */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_config</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cam</span> <span class="o">*</span><span class="n">cam</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">=</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">driver_info</span> <span class="o">&amp;</span> <span class="n">BRIDGE_MASK</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">invert_led</span> <span class="o">=</span> <span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">driver_info</span> <span class="o">&amp;</span> <span class="n">BRIDGE_INVERT_LED</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ov511_vga_mode</span><span class="p">;</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ov511_vga_mode</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ov518_vga_mode</span><span class="p">;</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ov518_vga_mode</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ov519_vga_mode</span><span class="p">;</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ov519_vga_mode</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ov519_vga_mode</span><span class="p">;</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ov519_vga_mode</span><span class="p">);</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">bulk_size</span> <span class="o">=</span> <span class="n">OVFX2_BULK_SIZE</span><span class="p">;</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">bulk_nurbs</span> <span class="o">=</span> <span class="n">MAX_NURBS</span><span class="p">;</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">bulk</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">w9968cf_vga_mode</span><span class="p">;</span>
		<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">w9968cf_vga_mode</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">ctrls</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">=</span> <span class="n">QUALITY_DEF</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* this function is called at probe and resume time */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cam</span> <span class="o">*</span><span class="n">cam</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">ov511_configure</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">ov518_configure</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">ov519_configure</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">ovfx2_configure</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">w9968cf_configure</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* The OV519 must be more aggressive about sensor detection since</span>
<span class="cm">	 * I2C write will never fail if the sensor is not present. We have</span>
<span class="cm">	 * to try to initialize the sensor to detect its presence */</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* Test for 76xx */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">init_ov_sensor</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7xx0_SID</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ov7xx0_configure</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="cm">/* Test for 6xx0 */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">init_ov_sensor</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV6xx0_SID</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ov6xx0_configure</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="cm">/* Test for 8xx0 */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">init_ov_sensor</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV8xx0_SID</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ov8xx0_configure</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="cm">/* Test for 3xxx / 2xxx */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">init_ov_sensor</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV_HIRES_SID</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ov_hires_configure</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Can&#39;t determine sensor slave IDs</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

	<span class="n">ov51x_led_control</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>	<span class="cm">/* turn LED off */</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sif</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ov511_sif_mode</span><span class="p">;</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ov511_sif_mode</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sif</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ov518_sif_mode</span><span class="p">;</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ov518_sif_mode</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sif</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ov519_sif_mode</span><span class="p">;</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ov519_sif_mode</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SEN_OV2610</span>:
		<span class="k">case</span> <span class="n">SEN_OV2610AE</span>:
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ovfx2_ov2610_mode</span><span class="p">;</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ovfx2_ov2610_mode</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SEN_OV3610</span>:
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ovfx2_ov3610_mode</span><span class="p">;</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ovfx2_ov3610_mode</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SEN_OV9600</span>:
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ovfx2_ov9600_mode</span><span class="p">;</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ovfx2_ov9600_mode</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sif</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">cam</span><span class="o">-&gt;</span><span class="n">cam_mode</span> <span class="o">=</span> <span class="n">ov519_sif_mode</span><span class="p">;</span>
				<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">ov519_sif_mode</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sif</span><span class="p">)</span>
			<span class="n">cam</span><span class="o">-&gt;</span><span class="n">nmodes</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">w9968cf_vga_mode</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

		<span class="cm">/* w9968cf needs initialisation once the sensor is known */</span>
		<span class="n">w9968cf_init</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_dis</span> <span class="o">=</span> <span class="n">ctrl_dis</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">];</span>

	<span class="cm">/* initialize the sensor */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV2610</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_2610</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_2610</span><span class="p">));</span>

		<span class="cm">/* Enable autogain, autoexpo, awb, bandfilter */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV2610AE</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_2610ae</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_2610ae</span><span class="p">));</span>

		<span class="cm">/* enable autoexpo */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV3610</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_3620b</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_3620b</span><span class="p">));</span>

		<span class="cm">/* Enable autogain, autoexpo, awb, bandfilter */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x27</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV6620</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_6x20</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_6x20</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV6630</span>:
	<span class="k">case</span> <span class="n">SEN_OV66308AF</span>:
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">CONTRAST</span><span class="p">].</span><span class="n">def</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
				 <span class="cm">/* The default is too low for the ov6630 */</span>
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_6x30</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_6x30</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
<span class="cm">/*	case SEN_OV7610: */</span>
<span class="cm">/*	case SEN_OV76BE: */</span>
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_7610</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_7610</span><span class="p">));</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7620</span>:
	<span class="k">case</span> <span class="n">SEN_OV7620AE</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_7620</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_7620</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7640</span>:
	<span class="k">case</span> <span class="n">SEN_OV7648</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_7640</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_7640</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7660</span>:
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R12_COM7</span><span class="p">,</span> <span class="n">OV7670_COM7_RESET</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">14</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R57_SNAPSHOT</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">);</span>
		<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">init_519_ov7660</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">init_519_ov7660</span><span class="p">));</span>
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_7660</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_7660</span><span class="p">));</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">curr_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* 640x480 */</span>
		<span class="n">ov519_set_mode</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="n">ov519_set_fr</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">COLORS</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>	<span class="cm">/* 0..4 */</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">COLORS</span><span class="p">].</span><span class="n">val</span> <span class="o">=</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">COLORS</span><span class="p">].</span><span class="n">def</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="n">setcolors</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">CONTRAST</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>	<span class="cm">/* 0..6 */</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">CONTRAST</span><span class="p">].</span><span class="n">val</span> <span class="o">=</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">CONTRAST</span><span class="p">].</span><span class="n">def</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">setcontrast</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">BRIGHTNESS</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>	<span class="cm">/* 0..6 */</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">BRIGHTNESS</span><span class="p">].</span><span class="n">val</span> <span class="o">=</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">BRIGHTNESS</span><span class="p">].</span><span class="n">def</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">setbrightness</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="n">sd_reset_snapshot</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
		<span class="n">ov51x_restart</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="n">ov51x_stop</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>			<span class="cm">/* not in win traces */</span>
		<span class="n">ov51x_led_control</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">FREQ</span><span class="p">].</span><span class="n">max</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>	<span class="cm">/* auto */</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">FREQ</span><span class="p">].</span><span class="n">def</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_7670</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_7670</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV8610</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_8610</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_8610</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV9600</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">norm_9600</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">norm_9600</span><span class="p">));</span>

		<span class="cm">/* enable autoexpo */</span>
<span class="cm">/*		i2c_w_mask(sd, 0x13, 0x05, 0x05); */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span><span class="p">;</span>
<span class="nl">error:</span>
	<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_ERR</span><span class="p">,</span> <span class="s">&quot;OV519 Config failed&quot;</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* function called at start time before URB creation */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_isoc_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">!=</span> <span class="mi">800</span><span class="p">)</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">bulk_size</span> <span class="o">=</span> <span class="n">OVFX2_BULK_SIZE</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">bulk_size</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">4096</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Set up the OV511/OV511+ with the given image parameters.</span>
<span class="cm"> *</span>
<span class="cm"> * Do not put any sensor-specific code in here (including I2C I/O functions)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov511_mode_init_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">hsegs</span><span class="p">,</span> <span class="n">vsegs</span><span class="p">,</span> <span class="n">packet_size</span><span class="p">,</span> <span class="n">fps</span><span class="p">,</span> <span class="n">needed</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">interlaced</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_host_interface</span> <span class="o">*</span><span class="n">alt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">intf</span><span class="p">;</span>

	<span class="n">intf</span> <span class="o">=</span> <span class="n">usb_ifnum_to_if</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">iface</span><span class="p">);</span>
	<span class="n">alt</span> <span class="o">=</span> <span class="n">usb_altnum_to_altsetting</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">alt</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">alt</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t get altsetting</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">packet_size</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">alt</span><span class="o">-&gt;</span><span class="n">endpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">desc</span><span class="p">.</span><span class="n">wMaxPacketSize</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_FIFO_PSIZE</span><span class="p">,</span> <span class="n">packet_size</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">);</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_CAM_UV_EN</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_SNAP_UV_EN</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_SNAP_OPTS</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>

	<span class="cm">/* Here I&#39;m assuming that snapshot size == image size.</span>
<span class="cm">	 * I hope that&#39;s always true. --claudio</span>
<span class="cm">	 */</span>
	<span class="n">hsegs</span> <span class="o">=</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">vsegs</span> <span class="o">=</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">height</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_CAM_PXCNT</span><span class="p">,</span> <span class="n">hsegs</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_CAM_LNCNT</span><span class="p">,</span> <span class="n">vsegs</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_CAM_PXDIV</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_CAM_LNDIV</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="cm">/* YUV420, low pass filter on */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_CAM_OPTS</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>

	<span class="cm">/* Snapshot additions */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_SNAP_PXCNT</span><span class="p">,</span> <span class="n">hsegs</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_SNAP_LNCNT</span><span class="p">,</span> <span class="n">vsegs</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_SNAP_PXDIV</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_SNAP_LNDIV</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>

	<span class="cm">/******** Set the framerate ********/</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">frame_rate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">=</span> <span class="n">frame_rate</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV6620</span>:
		<span class="cm">/* No framerate control, doesn&#39;t like higher rates yet */</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="cm">/* Note once the FIXME&#39;s in mode_init_ov_sensor_regs() are fixed</span>
<span class="cm">	   for more sensors we need to do this for them too */</span>
	<span class="k">case</span> <span class="n">SEN_OV7620</span>:
	<span class="k">case</span> <span class="n">SEN_OV7620AE</span>:
	<span class="k">case</span> <span class="n">SEN_OV7640</span>:
	<span class="k">case</span> <span class="n">SEN_OV7648</span>:
	<span class="k">case</span> <span class="n">SEN_OV76BE</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">320</span><span class="p">)</span>
			<span class="n">interlaced</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="cm">/* Fall through */</span>
	<span class="k">case</span> <span class="n">SEN_OV6630</span>:
	<span class="k">case</span> <span class="n">SEN_OV7610</span>:
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">30</span>:
		<span class="k">case</span> <span class="mi">25</span>:
			<span class="cm">/* Not enough bandwidth to do 640x480 @ 30 fps */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span> <span class="o">!=</span> <span class="mi">640</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="cm">/* Fall through for 640x480 case */</span>
		<span class="nl">default:</span>
<span class="cm">/*		case 20: */</span>
<span class="cm">/*		case 15: */</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">10</span>:
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">5</span>:
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">interlaced</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
			<span class="cm">/* Higher then 10 does not work */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span>
				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">SEN_OV8610</span>:
		<span class="cm">/* No framerate control ?? */</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Check if we have enough bandwidth to disable compression */</span>
	<span class="n">fps</span> <span class="o">=</span> <span class="p">(</span><span class="n">interlaced</span> <span class="o">?</span> <span class="mi">60</span> <span class="o">:</span> <span class="mi">30</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">needed</span> <span class="o">=</span> <span class="n">fps</span> <span class="o">*</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">height</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
	<span class="cm">/* 1000 isoc packets/sec */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">needed</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="o">*</span> <span class="n">packet_size</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Enable Y and UV quantization and compression */</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_COMP_EN</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_COMP_LUT_EN</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_COMP_EN</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R511_COMP_LUT_EN</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span> <span class="n">OV511_RESET_OMNICE</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_SYS_RESET</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Sets up the OV518/OV518+ with the given image parameters</span>
<span class="cm"> *</span>
<span class="cm"> * OV518 needs a completely different approach, until we can figure out what</span>
<span class="cm"> * the individual registers do. Also, only 15 FPS is supported now.</span>
<span class="cm"> *</span>
<span class="cm"> * Do not put any sensor-specific code in here (including I2C I/O functions)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov518_mode_init_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">hsegs</span><span class="p">,</span> <span class="n">vsegs</span><span class="p">,</span> <span class="n">packet_size</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_host_interface</span> <span class="o">*</span><span class="n">alt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">intf</span><span class="p">;</span>

	<span class="n">intf</span> <span class="o">=</span> <span class="n">usb_ifnum_to_if</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">dev</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">iface</span><span class="p">);</span>
	<span class="n">alt</span> <span class="o">=</span> <span class="n">usb_altnum_to_altsetting</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">alt</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">alt</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;Couldn&#39;t get altsetting</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">usb_err</span> <span class="o">=</span> <span class="o">-</span><span class="n">EIO</span><span class="p">;</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">packet_size</span> <span class="o">=</span> <span class="n">le16_to_cpu</span><span class="p">(</span><span class="n">alt</span><span class="o">-&gt;</span><span class="n">endpoint</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">desc</span><span class="p">.</span><span class="n">wMaxPacketSize</span><span class="p">);</span>
	<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">R51x_FIFO_PSIZE</span><span class="p">,</span> <span class="n">packet_size</span> <span class="o">&amp;</span> <span class="o">~</span><span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

	<span class="cm">/******** Set the mode ********/</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x3b</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">==</span> <span class="n">BRIDGE_OV518</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Set 8-bit (YVYU) input format */</span>
		<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">);</span>

		<span class="cm">/* Set 12-bit (4:2:0) output format */</span>
		<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">);</span>
		<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">hsegs</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mi">16</span><span class="p">;</span>
	<span class="n">vsegs</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">4</span><span class="p">;</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x29</span><span class="p">,</span> <span class="n">hsegs</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="n">vsegs</span><span class="p">);</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="n">hsegs</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">,</span> <span class="n">vsegs</span><span class="p">);</span>

	<span class="cm">/* Windows driver does this here; who knows why */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>

	<span class="cm">/******** Set the framerate ********/</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* Mode independent, but framerate dependent, regs */</span>
	<span class="cm">/* 0x51: Clock divider; Only works on some cams which use 2 crystals */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">==</span> <span class="n">BRIDGE_OV518PLUS</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">SEN_OV7620AE</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span> <span class="o">==</span> <span class="mi">320</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
				<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">);</span>
				<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">SEN_OV7620</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">);</span>	<span class="cm">/* Compression-related? */</span>

	<span class="cm">/* FIXME: Sensor-specific */</span>
	<span class="cm">/* Bit 5 is what matters here. Of course, it is &quot;reserved&quot; */</span>
	<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">);</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">==</span> <span class="n">BRIDGE_OV518PLUS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span>    <span class="mi">400</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 190h   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">,</span>    <span class="mi">540</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 21ch   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span>    <span class="mi">540</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 21ch   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>    <span class="mi">108</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 6ch    */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mi">131098</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>	<span class="cm">/* 2001ah */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span>    <span class="mi">532</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 214h   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span>   <span class="mi">2400</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 960h   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span>     <span class="mi">32</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 20h    */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span>    <span class="mi">608</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 260h   */</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x9f</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">);</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">,</span>    <span class="mi">400</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 190h   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">,</span>    <span class="mi">381</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 17dh   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span>    <span class="mi">381</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 17dh   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">,</span>    <span class="mi">128</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 80h    */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xca</span><span class="p">,</span> <span class="mi">183331</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>	<span class="cm">/* 2cc23h */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span>    <span class="mi">746</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 2eah   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xcc</span><span class="p">,</span>   <span class="mi">1750</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 6d6h   */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span>     <span class="mi">45</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 2dh    */</span>
		<span class="n">ov518_reg_w32</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span>    <span class="mi">851</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>	<span class="cm">/* 353h   */</span>
	<span class="p">}</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Sets up the OV519 with the given image parameters</span>
<span class="cm"> *</span>
<span class="cm"> * OV519 needs a completely different approach, until we can figure out what</span>
<span class="cm"> * the individual registers do.</span>
<span class="cm"> *</span>
<span class="cm"> * Do not put any sensor-specific code in here (including I2C I/O functions)</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov519_mode_init_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">mode_init_519_ov7670</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="mh">0x5d</span><span class="p">,</span>	<span class="mh">0x03</span> <span class="p">},</span> <span class="cm">/* Turn off suspend mode */</span>
		<span class="p">{</span> <span class="mh">0x53</span><span class="p">,</span>	<span class="mh">0x9f</span> <span class="p">},</span> <span class="cm">/* was 9b in 1.65-1.08 */</span>
		<span class="p">{</span> <span class="n">OV519_R54_EN_CLK1</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span> <span class="cm">/* bit2 (jpeg enable) */</span>
		<span class="p">{</span> <span class="mh">0xa2</span><span class="p">,</span>	<span class="mh">0x20</span> <span class="p">},</span> <span class="cm">/* a2-a5 are undocumented */</span>
		<span class="p">{</span> <span class="mh">0xa3</span><span class="p">,</span>	<span class="mh">0x18</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0xa4</span><span class="p">,</span>	<span class="mh">0x04</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0xa5</span><span class="p">,</span>	<span class="mh">0x28</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span>	<span class="cm">/* SetUsbInit */</span>
		<span class="p">{</span> <span class="mh">0x55</span><span class="p">,</span>	<span class="mh">0x02</span> <span class="p">},</span> <span class="cm">/* 4.096 Mhz audio clock */</span>
		<span class="cm">/* Enable both fields, YUV Input, disable defect comp (why?) */</span>
		<span class="p">{</span> <span class="mh">0x20</span><span class="p">,</span>	<span class="mh">0x0c</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x21</span><span class="p">,</span>	<span class="mh">0x38</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x22</span><span class="p">,</span>	<span class="mh">0x1d</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span>	<span class="mh">0x50</span> <span class="p">},</span> <span class="cm">/* undocumented */</span>
		<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* undocumented */</span>
		<span class="p">{</span> <span class="mh">0x40</span><span class="p">,</span>	<span class="mh">0xff</span> <span class="p">},</span> <span class="cm">/* I2C timeout counter */</span>
		<span class="p">{</span> <span class="mh">0x46</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* I2C clock prescaler */</span>
		<span class="p">{</span> <span class="mh">0x59</span><span class="p">,</span>	<span class="mh">0x04</span> <span class="p">},</span>	<span class="cm">/* new from windrv 090403 */</span>
		<span class="p">{</span> <span class="mh">0xff</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* undocumented */</span>
		<span class="cm">/* windows reads 0x55 at this point, why? */</span>
	<span class="p">};</span>

	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_regvals</span> <span class="n">mode_init_519</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span> <span class="mh">0x5d</span><span class="p">,</span>	<span class="mh">0x03</span> <span class="p">},</span> <span class="cm">/* Turn off suspend mode */</span>
		<span class="p">{</span> <span class="mh">0x53</span><span class="p">,</span>	<span class="mh">0x9f</span> <span class="p">},</span> <span class="cm">/* was 9b in 1.65-1.08 */</span>
		<span class="p">{</span> <span class="n">OV519_R54_EN_CLK1</span><span class="p">,</span> <span class="mh">0x0f</span> <span class="p">},</span> <span class="cm">/* bit2 (jpeg enable) */</span>
		<span class="p">{</span> <span class="mh">0xa2</span><span class="p">,</span>	<span class="mh">0x20</span> <span class="p">},</span> <span class="cm">/* a2-a5 are undocumented */</span>
		<span class="p">{</span> <span class="mh">0xa3</span><span class="p">,</span>	<span class="mh">0x18</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0xa4</span><span class="p">,</span>	<span class="mh">0x04</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0xa5</span><span class="p">,</span>	<span class="mh">0x28</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span>	<span class="cm">/* SetUsbInit */</span>
		<span class="p">{</span> <span class="mh">0x55</span><span class="p">,</span>	<span class="mh">0x02</span> <span class="p">},</span> <span class="cm">/* 4.096 Mhz audio clock */</span>
		<span class="cm">/* Enable both fields, YUV Input, disable defect comp (why?) */</span>
		<span class="p">{</span> <span class="mh">0x22</span><span class="p">,</span>	<span class="mh">0x1d</span> <span class="p">},</span>
		<span class="p">{</span> <span class="mh">0x17</span><span class="p">,</span>	<span class="mh">0x50</span> <span class="p">},</span> <span class="cm">/* undocumented */</span>
		<span class="p">{</span> <span class="mh">0x37</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* undocumented */</span>
		<span class="p">{</span> <span class="mh">0x40</span><span class="p">,</span>	<span class="mh">0xff</span> <span class="p">},</span> <span class="cm">/* I2C timeout counter */</span>
		<span class="p">{</span> <span class="mh">0x46</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* I2C clock prescaler */</span>
		<span class="p">{</span> <span class="mh">0x59</span><span class="p">,</span>	<span class="mh">0x04</span> <span class="p">},</span>	<span class="cm">/* new from windrv 090403 */</span>
		<span class="p">{</span> <span class="mh">0xff</span><span class="p">,</span>	<span class="mh">0x00</span> <span class="p">},</span> <span class="cm">/* undocumented */</span>
		<span class="cm">/* windows reads 0x55 at this point, why? */</span>
	<span class="p">};</span>

	<span class="cm">/******** Set the mode ********/</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="nl">default:</span>
		<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mode_init_519</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mode_init_519</span><span class="p">));</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV7640</span> <span class="o">||</span>
		    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV7648</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Select 8-bit input mode */</span>
			<span class="n">reg_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R20_DFR</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7660</span>:
		<span class="k">return</span><span class="p">;</span>		<span class="cm">/* done by ov519_set_mode/fr() */</span>
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:
		<span class="n">write_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">mode_init_519_ov7670</span><span class="p">,</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">mode_init_519_ov7670</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R10_H_SIZE</span><span class="p">,</span>	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R11_V_SIZE</span><span class="p">,</span>	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">height</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV7670</span> <span class="o">&amp;&amp;</span>
	    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">cam</span><span class="p">.</span><span class="n">cam_mode</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">curr_mode</span><span class="p">].</span><span class="n">priv</span><span class="p">)</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R12_X_OFFSETL</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV7648</span> <span class="o">&amp;&amp;</span>
	    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">cam</span><span class="p">.</span><span class="n">cam_mode</span><span class="p">[</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">curr_mode</span><span class="p">].</span><span class="n">priv</span><span class="p">)</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R12_X_OFFSETL</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R12_X_OFFSETL</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R13_X_OFFSETH</span><span class="p">,</span>	<span class="mh">0x00</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R14_Y_OFFSETL</span><span class="p">,</span>	<span class="mh">0x00</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R15_Y_OFFSETH</span><span class="p">,</span>	<span class="mh">0x00</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R16_DIVIDER</span><span class="p">,</span>	<span class="mh">0x00</span><span class="p">);</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R25_FORMAT</span><span class="p">,</span>	<span class="mh">0x03</span><span class="p">);</span> <span class="cm">/* YUV422 */</span>
	<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">,</span>			<span class="mh">0x00</span><span class="p">);</span> <span class="cm">/* Undocumented */</span>

	<span class="cm">/******** Set the framerate ********/</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">frame_rate</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">=</span> <span class="n">frame_rate</span><span class="p">;</span>

<span class="cm">/* FIXME: These are only valid at the max resolution. */</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV7640</span>:
	<span class="k">case</span> <span class="n">SEN_OV7648</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="nl">default:</span>
<span class="cm">/*		case 30: */</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">25</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">20</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x0c</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">15</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">10</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">5</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV8610</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="nl">default:</span>	<span class="cm">/* 15 fps */</span>
<span class="cm">/*		case 15: */</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">10</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x1f</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">5</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:		<span class="cm">/* guesses, based on 7640 */</span>
		<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_STREAM</span><span class="p">,</span> <span class="s">&quot;Setting framerate to %d fps&quot;</span><span class="p">,</span>
				 <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="mi">15</span> <span class="o">:</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span><span class="p">);</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0xa4</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">30</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">20</span>:
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0x1b</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="nl">default:</span>
<span class="cm">/*		case 15: */</span>
			<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">mode_init_ov_sensor_regs</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">qvga</span><span class="p">,</span> <span class="n">xstart</span><span class="p">,</span> <span class="n">xend</span><span class="p">,</span> <span class="n">ystart</span><span class="p">,</span> <span class="n">yend</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">v</span><span class="p">;</span>

	<span class="n">gspca_dev</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">;</span>
	<span class="n">qvga</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">cam_mode</span><span class="p">[</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">curr_mode</span><span class="p">].</span><span class="n">priv</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>

	<span class="cm">/******** Mode (VGA/QVGA) and sensor specific regs ********/</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV2610</span>:
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x00</span> <span class="o">:</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x3a</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x30</span> <span class="o">:</span> <span class="mh">0x60</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x40</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0xf0</span> <span class="o">:</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV2610AE</span>: <span class="p">{</span>
		<span class="n">u8</span> <span class="n">v</span><span class="p">;</span>

		<span class="cm">/* frame rates:</span>
<span class="cm">		 *	10fps / 5 fps for 1600x1200</span>
<span class="cm">		 *	40fps / 20fps for 800x600</span>
<span class="cm">		 */</span>
		<span class="n">v</span> <span class="o">=</span> <span class="mi">80</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">qvga</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">)</span>
				<span class="n">v</span> <span class="o">=</span> <span class="mh">0x81</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
				<span class="n">v</span> <span class="o">=</span> <span class="mh">0x81</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x60</span> <span class="o">:</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="k">case</span> <span class="n">SEN_OV3610</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">qvga</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">xstart</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1040</span> <span class="o">-</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mh">0x1f</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
			<span class="n">ystart</span> <span class="o">=</span> <span class="p">(</span><span class="mi">776</span> <span class="o">-</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">xstart</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2076</span> <span class="o">-</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mh">0x10</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">);</span>
			<span class="n">ystart</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1544</span> <span class="o">-</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">xend</span> <span class="o">=</span> <span class="n">xstart</span> <span class="o">+</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">;</span>
		<span class="n">yend</span> <span class="o">=</span> <span class="n">ystart</span> <span class="o">+</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">;</span>
		<span class="cm">/* Writing to the COMH register resets the other windowing regs</span>
<span class="cm">		   to their default values, so we must do this first. */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x40</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x32</span><span class="p">,</span>
			   <span class="p">(((</span><span class="n">xend</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">xstart</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">),</span>
			   <span class="mh">0x3f</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">,</span>
			   <span class="p">(((</span><span class="n">yend</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">ystart</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">),</span>
			   <span class="mh">0x0f</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">xstart</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="n">xend</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="n">ystart</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="n">yend</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV8610</span>:
		<span class="cm">/* For OV8610 qvga means qsvga */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_COM_C</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span> <span class="cm">/* Select 16 bit data bus */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span> <span class="cm">/* AWB: 1 Test pattern: 0 */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span> <span class="cm">/* from windrv 090403 */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span> <span class="cm">/* progressive mode on */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7610</span>:
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x1e</span> <span class="o">:</span> <span class="mh">0x9e</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span> <span class="cm">/* Select 16 bit data bus */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span> <span class="cm">/* AWB: 1 Test pattern: 0 */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7620</span>:
	<span class="k">case</span> <span class="n">SEN_OV7620AE</span>:
	<span class="k">case</span> <span class="n">SEN_OV76BE</span>:
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x00</span> <span class="o">:</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x3a</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x30</span> <span class="o">:</span> <span class="mh">0x60</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x40</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0xb0</span> <span class="o">:</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span> <span class="cm">/* Select 16 bit data bus */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span> <span class="cm">/* AWB: 1 Test pattern: 0 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV76BE</span><span class="p">)</span>
			<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x1e</span> <span class="o">:</span> <span class="mh">0x9e</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7640</span>:
	<span class="k">case</span> <span class="n">SEN_OV7648</span>:
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x00</span> <span class="o">:</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="cm">/* Setting this undocumented bit in qvga mode removes a very</span>
<span class="cm">		   annoying vertical shaking of the image */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x40</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="cm">/* Unknown */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0xf0</span> <span class="o">:</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">);</span>
		<span class="cm">/* Allow higher automatic gain (to allow higher framerates) */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x74</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span> <span class="cm">/* AWB: 1 */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:
		<span class="cm">/* set COM7_FMT_VGA or COM7_FMT_QVGA</span>
<span class="cm">		 * do we need to set anything else?</span>
<span class="cm">		 *	HSTART etc are set in set_ov_sensor_window itself */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R12_COM7</span><span class="p">,</span>
			 <span class="n">qvga</span> <span class="o">?</span> <span class="n">OV7670_COM7_FMT_QVGA</span> <span class="o">:</span> <span class="n">OV7670_COM7_FMT_VGA</span><span class="p">,</span>
			 <span class="n">OV7670_COM7_FMT_MASK</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span> <span class="cm">/* Select 16 bit data bus */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="n">OV7670_COM8_AWB</span><span class="p">,</span>
				<span class="n">OV7670_COM8_AWB</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">qvga</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* QVGA from ov7670.c by</span>
<span class="cm">					 * Jonathan Corbet */</span>
			<span class="n">xstart</span> <span class="o">=</span> <span class="mi">164</span><span class="p">;</span>
			<span class="n">xend</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
			<span class="n">ystart</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
			<span class="n">yend</span> <span class="o">=</span> <span class="mi">494</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>		<span class="cm">/* VGA */</span>
			<span class="n">xstart</span> <span class="o">=</span> <span class="mi">158</span><span class="p">;</span>
			<span class="n">xend</span> <span class="o">=</span> <span class="mi">14</span><span class="p">;</span>
			<span class="n">ystart</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
			<span class="n">yend</span> <span class="o">=</span> <span class="mi">490</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="cm">/* OV7670 hardware window registers are split across</span>
<span class="cm">		 * multiple locations */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R17_HSTART</span><span class="p">,</span> <span class="n">xstart</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R18_HSTOP</span><span class="p">,</span> <span class="n">xend</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">);</span>
		<span class="n">v</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R32_HREF</span><span class="p">);</span>
		<span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">xend</span> <span class="o">&amp;</span> <span class="mh">0x7</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">xstart</span> <span class="o">&amp;</span> <span class="mh">0x07</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>	<span class="cm">/* need to sleep between read and write to</span>
<span class="cm">				 * same reg! */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R32_HREF</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>

		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R19_VSTART</span><span class="p">,</span> <span class="n">ystart</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R1A_VSTOP</span><span class="p">,</span> <span class="n">yend</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">);</span>
		<span class="n">v</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R03_VREF</span><span class="p">);</span>
		<span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span> <span class="o">&amp;</span> <span class="mh">0xc0</span><span class="p">)</span> <span class="o">|</span> <span class="p">((</span><span class="n">yend</span> <span class="o">&amp;</span> <span class="mh">0x3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">ystart</span> <span class="o">&amp;</span> <span class="mh">0x03</span><span class="p">);</span>
		<span class="n">msleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>	<span class="cm">/* need to sleep between read and write to</span>
<span class="cm">				 * same reg! */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R03_VREF</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV6620</span>:
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span> <span class="cm">/* Select 16 bit data bus */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span> <span class="cm">/* AWB: 1 Test pattern: 0 */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV6630</span>:
	<span class="k">case</span> <span class="n">SEN_OV66308AF</span>:
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x20</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">);</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">);</span> <span class="cm">/* AWB: 1 Test pattern: 0 */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV9600</span>: <span class="p">{</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="o">*</span><span class="n">vals</span><span class="p">;</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">sxga_15</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">}</span>
		<span class="p">};</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">sxga_7_5</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x85</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">}</span>
		<span class="p">};</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">vga_30</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">}</span>
		<span class="p">};</span>
		<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">vga_15</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">{</span><span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">}</span>
		<span class="p">};</span>

		<span class="cm">/* frame rates:</span>
<span class="cm">		 *	15fps / 7.5 fps for 1280x1024</span>
<span class="cm">		 *	30fps / 15fps for 640x480</span>
<span class="cm">		 */</span>
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="n">qvga</span> <span class="o">?</span> <span class="mh">0x40</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">qvga</span><span class="p">)</span>
			<span class="n">vals</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&lt;</span> <span class="mi">30</span> <span class="o">?</span> <span class="n">vga_15</span> <span class="o">:</span> <span class="n">vga_30</span><span class="p">;</span>
		<span class="k">else</span>
			<span class="n">vals</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">frame_rate</span> <span class="o">&lt;</span> <span class="mi">15</span> <span class="o">?</span> <span class="n">sxga_7_5</span> <span class="o">:</span> <span class="n">sxga_15</span><span class="p">;</span>
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">vals</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sxga_15</span><span class="p">));</span>
		<span class="k">return</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="nl">default:</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/******** Clock programming ********/</span>
	<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">clockdiv</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* this function works for bridge ov519 and sensors ov7660 and ov7670 only */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">sethvflip</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R51_RESET1</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">);</span>	<span class="cm">/* block stream */</span>
	<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R1E_MVFP</span><span class="p">,</span>
		<span class="n">OV7670_MVFP_MIRROR</span> <span class="o">*</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">HFLIP</span><span class="p">].</span><span class="n">val</span>
			<span class="o">|</span> <span class="n">OV7670_MVFP_VFLIP</span> <span class="o">*</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">VFLIP</span><span class="p">].</span><span class="n">val</span><span class="p">,</span>
		<span class="n">OV7670_MVFP_MIRROR</span> <span class="o">|</span> <span class="n">OV7670_MVFP_VFLIP</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R51_RESET1</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">);</span>	<span class="cm">/* restart stream */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">set_ov_sensor_window</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">qvga</span><span class="p">,</span> <span class="n">crop</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">hwsbase</span><span class="p">,</span> <span class="n">hwebase</span><span class="p">,</span> <span class="n">vwsbase</span><span class="p">,</span> <span class="n">vwebase</span><span class="p">,</span> <span class="n">hwscale</span><span class="p">,</span> <span class="n">vwscale</span><span class="p">;</span>

	<span class="cm">/* mode setup is fully handled in mode_init_ov_sensor_regs for these */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV2610</span>:
	<span class="k">case</span> <span class="n">SEN_OV2610AE</span>:
	<span class="k">case</span> <span class="n">SEN_OV3610</span>:
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:
	<span class="k">case</span> <span class="n">SEN_OV9600</span>:
		<span class="n">mode_init_ov_sensor_regs</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7660</span>:
		<span class="n">ov519_set_mode</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="n">ov519_set_fr</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">gspca_dev</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">;</span>
	<span class="n">qvga</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">cam_mode</span><span class="p">[</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">curr_mode</span><span class="p">].</span><span class="n">priv</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">crop</span> <span class="o">=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">cam_mode</span><span class="p">[</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">curr_mode</span><span class="p">].</span><span class="n">priv</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">;</span>

	<span class="cm">/* The different sensor ICs handle setting up of window differently.</span>
<span class="cm">	 * IF YOU SET IT WRONG, YOU WILL GET ALL ZERO ISOC DATA FROM OV51x!! */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV8610</span>:
		<span class="n">hwsbase</span> <span class="o">=</span> <span class="mh">0x1e</span><span class="p">;</span>
		<span class="n">hwebase</span> <span class="o">=</span> <span class="mh">0x1e</span><span class="p">;</span>
		<span class="n">vwsbase</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
		<span class="n">vwebase</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7610</span>:
	<span class="k">case</span> <span class="n">SEN_OV76BE</span>:
		<span class="n">hwsbase</span> <span class="o">=</span> <span class="mh">0x38</span><span class="p">;</span>
		<span class="n">hwebase</span> <span class="o">=</span> <span class="mh">0x3a</span><span class="p">;</span>
		<span class="n">vwsbase</span> <span class="o">=</span> <span class="n">vwebase</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV6620</span>:
	<span class="k">case</span> <span class="n">SEN_OV6630</span>:
	<span class="k">case</span> <span class="n">SEN_OV66308AF</span>:
		<span class="n">hwsbase</span> <span class="o">=</span> <span class="mh">0x38</span><span class="p">;</span>
		<span class="n">hwebase</span> <span class="o">=</span> <span class="mh">0x3a</span><span class="p">;</span>
		<span class="n">vwsbase</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
		<span class="n">vwebase</span> <span class="o">=</span> <span class="mh">0x06</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV66308AF</span> <span class="o">&amp;&amp;</span> <span class="n">qvga</span><span class="p">)</span>
			<span class="cm">/* HDG: this fixes U and V getting swapped */</span>
			<span class="n">hwsbase</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">crop</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hwsbase</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
			<span class="n">hwebase</span> <span class="o">+=</span> <span class="mi">8</span><span class="p">;</span>
			<span class="n">vwsbase</span> <span class="o">+=</span> <span class="mi">11</span><span class="p">;</span>
			<span class="n">vwebase</span> <span class="o">+=</span> <span class="mi">11</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7620</span>:
	<span class="k">case</span> <span class="n">SEN_OV7620AE</span>:
		<span class="n">hwsbase</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">;</span>		<span class="cm">/* From 7620.SET (spec is wrong) */</span>
		<span class="n">hwebase</span> <span class="o">=</span> <span class="mh">0x2f</span><span class="p">;</span>
		<span class="n">vwsbase</span> <span class="o">=</span> <span class="n">vwebase</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7640</span>:
	<span class="k">case</span> <span class="n">SEN_OV7648</span>:
		<span class="n">hwsbase</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
		<span class="n">hwebase</span> <span class="o">=</span> <span class="mh">0x1a</span><span class="p">;</span>
		<span class="n">vwsbase</span> <span class="o">=</span> <span class="n">vwebase</span> <span class="o">=</span> <span class="mh">0x03</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV6620</span>:
	<span class="k">case</span> <span class="n">SEN_OV6630</span>:
	<span class="k">case</span> <span class="n">SEN_OV66308AF</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">qvga</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* QCIF */</span>
			<span class="n">hwscale</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
			<span class="n">vwscale</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>		<span class="cm">/* CIF */</span>
			<span class="n">hwscale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">vwscale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>	<span class="cm">/* The datasheet says 0;</span>
<span class="cm">					 * it&#39;s wrong */</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV8610</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">qvga</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* QSVGA */</span>
			<span class="n">hwscale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">vwscale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>		<span class="cm">/* SVGA */</span>
			<span class="n">hwscale</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">vwscale</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>			<span class="cm">/* SEN_OV7xx0 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">qvga</span><span class="p">)</span> <span class="p">{</span>		<span class="cm">/* QVGA */</span>
			<span class="n">hwscale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">vwscale</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>		<span class="cm">/* VGA */</span>
			<span class="n">hwscale</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
			<span class="n">vwscale</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">mode_init_ov_sensor_regs</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x17</span><span class="p">,</span> <span class="n">hwsbase</span><span class="p">);</span>
	<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="n">hwebase</span> <span class="o">+</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_width</span> <span class="o">&gt;&gt;</span> <span class="n">hwscale</span><span class="p">));</span>
	<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">,</span> <span class="n">vwsbase</span><span class="p">);</span>
	<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="n">vwebase</span> <span class="o">+</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_height</span> <span class="o">&gt;&gt;</span> <span class="n">vwscale</span><span class="p">));</span>
<span class="p">}</span>

<span class="cm">/* -- start the camera -- */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_start</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="cm">/* Default for most bridges, allow bridge_mode_init_regs to override */</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_width</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor_height</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">height</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">ov511_mode_init_regs</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">ov518_mode_init_regs</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">ov519_mode_init_regs</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="cm">/* case BRIDGE_OVFX2: nothing to do */</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">w9968cf_mode_init_regs</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">set_ov_sensor_window</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CONTRAST</span><span class="p">)))</span>
		<span class="n">setcontrast</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">BRIGHTNESS</span><span class="p">)))</span>
		<span class="n">setbrightness</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">)))</span>
		<span class="n">setexposure</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">COLORS</span><span class="p">)))</span>
		<span class="n">setcolors</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">HFLIP</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">VFLIP</span><span class="p">))))</span>
		<span class="n">sethvflip</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOBRIGHT</span><span class="p">)))</span>
		<span class="n">setautobright</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">AUTOGAIN</span><span class="p">)))</span>
		<span class="n">setautogain</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">ctrl_dis</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">FREQ</span><span class="p">)))</span>
		<span class="n">setfreq_i</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="cm">/* Force clear snapshot state in case the snapshot button was</span>
<span class="cm">	   pressed while we weren&#39;t streaming */</span>
	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_needs_reset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="n">sd_reset_snapshot</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">first_frame</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

	<span class="n">ov51x_restart</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="n">ov51x_led_control</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_stopN</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">ov51x_stop</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
	<span class="n">ov51x_led_control</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_stop0</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">present</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">==</span> <span class="n">BRIDGE_W9968CF</span><span class="p">)</span>
		<span class="n">w9968cf_stop0</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

<span class="cp">#if defined(CONFIG_INPUT) || defined(CONFIG_INPUT_MODULE)</span>
	<span class="cm">/* If the last button state is pressed, release it now! */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_pressed</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">input_report_key</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">input_dev</span><span class="p">,</span> <span class="n">KEY_CAMERA</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">input_sync</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">input_dev</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_pressed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="cp">#endif</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">==</span> <span class="n">BRIDGE_OV519</span><span class="p">)</span>
		<span class="n">reg_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV519_R57_SNAPSHOT</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov51x_handle_button</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">u8</span> <span class="n">state</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_pressed</span> <span class="o">!=</span> <span class="n">state</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#if defined(CONFIG_INPUT) || defined(CONFIG_INPUT_MODULE)</span>
		<span class="n">input_report_key</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">input_dev</span><span class="p">,</span> <span class="n">KEY_CAMERA</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
		<span class="n">input_sync</span><span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">input_dev</span><span class="p">);</span>
<span class="cp">#endif</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_needs_reset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_pressed</span> <span class="o">=</span> <span class="n">state</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* On the ov511 / ov519 we need to reset the button state</span>
<span class="cm">		   multiple times, as resetting does not work as long as the</span>
<span class="cm">		   button stays pressed */</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
		<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">state</span><span class="p">)</span>
				<span class="n">sd</span><span class="o">-&gt;</span><span class="n">snapshot_needs_reset</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov511_pkt_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="n">u8</span> <span class="o">*</span><span class="n">in</span><span class="p">,</span>			<span class="cm">/* isoc packet */</span>
			<span class="kt">int</span> <span class="n">len</span><span class="p">)</span>		<span class="cm">/* iso packet length */</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="cm">/* SOF/EOF packets have 1st to 8th bytes zeroed and the 9th</span>
<span class="cm">	 * byte non-zero. The EOF packet has image width/height in the</span>
<span class="cm">	 * 10th and 11th bytes. The 9th byte is given as follows:</span>
<span class="cm">	 *</span>
<span class="cm">	 * bit 7: EOF</span>
<span class="cm">	 *     6: compression enabled</span>
<span class="cm">	 *     5: 422/420/400 modes</span>
<span class="cm">	 *     4: 422/420/400 modes</span>
<span class="cm">	 *     3: 1</span>
<span class="cm">	 *     2: snapshot button on</span>
<span class="cm">	 *     1: snapshot frame</span>
<span class="cm">	 *     0: even/odd field</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="n">in</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">|</span> <span class="n">in</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="n">in</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">|</span> <span class="n">in</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">|</span> <span class="n">in</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">|</span> <span class="n">in</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">|</span> <span class="n">in</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span> <span class="o">&amp;&amp;</span>
	    <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x08</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ov51x_handle_button</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* Frame end */</span>
			<span class="k">if</span> <span class="p">((</span><span class="n">in</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">!=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span> <span class="o">||</span>
			    <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">!=</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_ERR</span><span class="p">,</span> <span class="s">&quot;Invalid frame size, got: %dx%d,&quot;</span>
					<span class="s">&quot; requested: %dx%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span> <span class="p">(</span><span class="n">in</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
					<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">width</span><span class="p">,</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">height</span><span class="p">);</span>
				<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">last_packet_type</span> <span class="o">=</span> <span class="n">DISCARD_PACKET</span><span class="p">;</span>
				<span class="k">return</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="cm">/* Add 11 byte footer to frame, might be useful */</span>
			<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">LAST_PACKET</span><span class="p">,</span> <span class="n">in</span><span class="p">,</span> <span class="mi">11</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="cm">/* Frame start */</span>
			<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">FIRST_PACKET</span><span class="p">,</span> <span class="n">in</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">packet_nr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* Ignore the packet number */</span>
	<span class="n">len</span><span class="o">--</span><span class="p">;</span>

	<span class="cm">/* intermediate packet */</span>
	<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">INTER_PACKET</span><span class="p">,</span> <span class="n">in</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov518_pkt_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>			<span class="cm">/* isoc packet */</span>
			<span class="kt">int</span> <span class="n">len</span><span class="p">)</span>			<span class="cm">/* iso packet length */</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="cm">/* A false positive here is likely, until OVT gives me</span>
<span class="cm">	 * the definitive SOF/EOF format */</span>
	<span class="k">if</span> <span class="p">((</span><span class="o">!</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">|</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]))</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="p">{</span>
		<span class="n">ov51x_handle_button</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">LAST_PACKET</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">FIRST_PACKET</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">packet_nr</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">last_packet_type</span> <span class="o">==</span> <span class="n">DISCARD_PACKET</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="cm">/* Does this device use packet numbers ? */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&amp;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">len</span><span class="o">--</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">packet_nr</span> <span class="o">==</span> <span class="n">data</span><span class="p">[</span><span class="n">len</span><span class="p">])</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">packet_nr</span><span class="o">++</span><span class="p">;</span>
		<span class="cm">/* The last few packets of the frame (which are all 0&#39;s</span>
<span class="cm">		   except that they may contain part of the footer), are</span>
<span class="cm">		   numbered 0 */</span>
		<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">packet_nr</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="n">len</span><span class="p">])</span> <span class="p">{</span>
			<span class="n">PDEBUG</span><span class="p">(</span><span class="n">D_ERR</span><span class="p">,</span> <span class="s">&quot;Invalid packet nr: %d (expect: %d)&quot;</span><span class="p">,</span>
				<span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">data</span><span class="p">[</span><span class="n">len</span><span class="p">],</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">packet_nr</span><span class="p">);</span>
			<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">last_packet_type</span> <span class="o">=</span> <span class="n">DISCARD_PACKET</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* intermediate packet */</span>
	<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">INTER_PACKET</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ov519_pkt_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>			<span class="cm">/* isoc packet */</span>
			<span class="kt">int</span> <span class="n">len</span><span class="p">)</span>			<span class="cm">/* iso packet length */</span>
<span class="p">{</span>
	<span class="cm">/* Header of ov519 is 16 bytes:</span>
<span class="cm">	 *     Byte     Value      Description</span>
<span class="cm">	 *	0	0xff	magic</span>
<span class="cm">	 *	1	0xff	magic</span>
<span class="cm">	 *	2	0xff	magic</span>
<span class="cm">	 *	3	0xXX	0x50 = SOF, 0x51 = EOF</span>
<span class="cm">	 *	9	0xXX	0x01 initial frame without data,</span>
<span class="cm">	 *			0x00 standard frame with image</span>
<span class="cm">	 *	14	Lo	in EOF: length of image data / 8</span>
<span class="cm">	 *	15	Hi</span>
<span class="cm">	 */</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mh">0x50</span>:		<span class="cm">/* start of frame */</span>
			<span class="cm">/* Don&#39;t check the button state here, as the state</span>
<span class="cm">			   usually (always ?) changes at EOF and checking it</span>
<span class="cm">			   here leads to unnecessary snapshot state resets. */</span>
<span class="cp">#define HDRSZ 16</span>
			<span class="n">data</span> <span class="o">+=</span> <span class="n">HDRSZ</span><span class="p">;</span>
			<span class="n">len</span> <span class="o">-=</span> <span class="n">HDRSZ</span><span class="p">;</span>
<span class="cp">#undef HDRSZ</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xd8</span><span class="p">)</span>
				<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">FIRST_PACKET</span><span class="p">,</span>
						<span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">last_packet_type</span> <span class="o">=</span> <span class="n">DISCARD_PACKET</span><span class="p">;</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="k">case</span> <span class="mh">0x51</span>:		<span class="cm">/* end of frame */</span>
			<span class="n">ov51x_handle_button</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">last_packet_type</span> <span class="o">=</span> <span class="n">DISCARD_PACKET</span><span class="p">;</span>
			<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">LAST_PACKET</span><span class="p">,</span>
					<span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* intermediate packet */</span>
	<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">INTER_PACKET</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">ovfx2_pkt_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>			<span class="cm">/* isoc packet */</span>
			<span class="kt">int</span> <span class="n">len</span><span class="p">)</span>			<span class="cm">/* iso packet length */</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">INTER_PACKET</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>

	<span class="cm">/* A short read signals EOF */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">len</span> <span class="o">&lt;</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">cam</span><span class="p">.</span><span class="n">bulk_size</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* If the frame is short, and it is one of the first ones</span>
<span class="cm">		   the sensor and bridge are still syncing, so drop it. */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">first_frame</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">sd</span><span class="o">-&gt;</span><span class="n">first_frame</span><span class="o">--</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">image_len</span> <span class="o">&lt;</span>
				  <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">gspca_dev</span><span class="p">.</span><span class="n">height</span><span class="p">)</span>
				<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">last_packet_type</span> <span class="o">=</span> <span class="n">DISCARD_PACKET</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">LAST_PACKET</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="n">gspca_frame_add</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">FIRST_PACKET</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">sd_pkt_scan</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span>			<span class="cm">/* isoc packet */</span>
			<span class="kt">int</span> <span class="n">len</span><span class="p">)</span>			<span class="cm">/* iso packet length */</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV511</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV511PLUS</span>:
		<span class="n">ov511_pkt_scan</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV518</span>:
	<span class="k">case</span> <span class="n">BRIDGE_OV518PLUS</span>:
		<span class="n">ov518_pkt_scan</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OV519</span>:
		<span class="n">ov519_pkt_scan</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_OVFX2</span>:
		<span class="n">ovfx2_pkt_scan</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BRIDGE_W9968CF</span>:
		<span class="n">w9968cf_pkt_scan</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">len</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* -- management routines -- */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setbrightness</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">brit_7660</span><span class="p">[][</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xe0</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xc2</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xd3</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x24</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">},</span>
			<span class="p">{</span><span class="mh">0x27</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x28</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x2c</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">}}</span>
	<span class="p">};</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">BRIGHTNESS</span><span class="p">].</span><span class="n">val</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV8610</span>:
	<span class="k">case</span> <span class="n">SEN_OV7610</span>:
	<span class="k">case</span> <span class="n">SEN_OV76BE</span>:
	<span class="k">case</span> <span class="n">SEN_OV6620</span>:
	<span class="k">case</span> <span class="n">SEN_OV6630</span>:
	<span class="k">case</span> <span class="n">SEN_OV66308AF</span>:
	<span class="k">case</span> <span class="n">SEN_OV7640</span>:
	<span class="k">case</span> <span class="n">SEN_OV7648</span>:
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_BRT</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7620</span>:
	<span class="k">case</span> <span class="n">SEN_OV7620AE</span>:
		<span class="cm">/* 7620 doesn&#39;t like manual changes when in auto mode */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">AUTOBRIGHT</span><span class="p">].</span><span class="n">val</span><span class="p">)</span>
			<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_BRT</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7660</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">brit_7660</span><span class="p">[</span><span class="n">val</span><span class="p">],</span>
				<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">brit_7660</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:
<span class="cm">/*win trace</span>
<span class="cm"> *		i2c_w_mask(sd, OV7670_R13_COM8, 0, OV7670_COM8_AEC); */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R55_BRIGHT</span><span class="p">,</span> <span class="n">ov7670_abs_to_sm</span><span class="p">(</span><span class="n">val</span><span class="p">));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setcontrast</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">contrast_7660</span><span class="p">[][</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x83</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x9f</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xb0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xc4</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0xf8</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x3d</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x62</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x75</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x8d</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x98</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xa1</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x71</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x86</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x95</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xc5</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x34</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x2e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x24</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x6e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0x9c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xa9</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xd4</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0xf0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x46</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x54</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x7c</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x87</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xb4</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xd0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xe5</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xf5</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x68</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x3c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x3a</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x5a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x89</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xc3</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xe1</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xfa</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6e</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x60</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x88</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x71</span><span class="p">,</span> <span class="mh">0xc8</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x72</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x73</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x74</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x75</span><span class="p">,</span> <span class="mh">0xb8</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x76</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x5c</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x26</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7a</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7b</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x7c</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x7f</span><span class="p">,</span> <span class="mh">0x22</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x33</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x4c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x82</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x83</span><span class="p">,</span> <span class="mh">0x7b</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x84</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x85</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x86</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x87</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x88</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x89</span><span class="p">,</span> <span class="mh">0xf9</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x8a</span><span class="p">,</span> <span class="mh">0xfd</span><span class="p">}},</span>
	<span class="p">};</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">CONTRAST</span><span class="p">].</span><span class="n">val</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV7610</span>:
	<span class="k">case</span> <span class="n">SEN_OV6620</span>:
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_CNT</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV6630</span>:
	<span class="k">case</span> <span class="n">SEN_OV66308AF</span>:
		<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_CNT</span><span class="p">,</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV8610</span>: <span class="p">{</span>
		<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">ctab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="mh">0x03</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x0b</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x6f</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x7f</span>
		<span class="p">};</span>

		<span class="cm">/* Use Y gamma control instead. Bit 0 enables it. */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="n">ctab</span><span class="p">[</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">5</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="k">case</span> <span class="n">SEN_OV7620</span>:
	<span class="k">case</span> <span class="n">SEN_OV7620AE</span>: <span class="p">{</span>
		<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">ctab</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
			<span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x15</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x37</span><span class="p">,</span> <span class="mh">0x57</span><span class="p">,</span>
			<span class="mh">0x5b</span><span class="p">,</span> <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0xa7</span><span class="p">,</span> <span class="mh">0xc7</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0xef</span><span class="p">,</span> <span class="mh">0xff</span>
		<span class="p">};</span>

		<span class="cm">/* Use Y gamma control instead. Bit 0 enables it. */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x64</span><span class="p">,</span> <span class="n">ctab</span><span class="p">[</span><span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">]);</span>
		<span class="k">break</span><span class="p">;</span>
	    <span class="p">}</span>
	<span class="k">case</span> <span class="n">SEN_OV7660</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">contrast_7660</span><span class="p">[</span><span class="n">val</span><span class="p">],</span>
					<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">contrast_7660</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:
		<span class="cm">/* check that this isn&#39;t just the same as ov7610 */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R56_CONTRAS</span><span class="p">,</span> <span class="n">val</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setexposure</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">AUTOGAIN</span><span class="p">].</span><span class="n">val</span><span class="p">)</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">EXPOSURE</span><span class="p">].</span><span class="n">val</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setcolors</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">ov_i2c_regvals</span> <span class="n">colors_7660</span><span class="p">[][</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{{</span><span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x23</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x47</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x4a</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x03</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x2c</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x6b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x05</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x19</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0x84</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x8b</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x53</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">}},</span>
		<span class="p">{{</span><span class="mh">0x4f</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x50</span><span class="p">,</span> <span class="mh">0xab</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x51</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x52</span><span class="p">,</span> <span class="mh">0x28</span><span class="p">},</span>
		 <span class="p">{</span><span class="mh">0x53</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">},</span> <span class="p">{</span><span class="mh">0x54</span><span class="p">,</span> <span class="mh">0x8e</span><span class="p">}},</span>
	<span class="p">};</span>

	<span class="n">val</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">COLORS</span><span class="p">].</span><span class="n">val</span><span class="p">;</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">SEN_OV8610</span>:
	<span class="k">case</span> <span class="n">SEN_OV7610</span>:
	<span class="k">case</span> <span class="n">SEN_OV76BE</span>:
	<span class="k">case</span> <span class="n">SEN_OV6620</span>:
	<span class="k">case</span> <span class="n">SEN_OV6630</span>:
	<span class="k">case</span> <span class="n">SEN_OV66308AF</span>:
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_SAT</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7620</span>:
	<span class="k">case</span> <span class="n">SEN_OV7620AE</span>:
		<span class="cm">/* Use UV gamma control instead. Bits 0 &amp; 7 are reserved. */</span>
<span class="cm">/*		rc = ov_i2c_write(sd-&gt;dev, 0x62, (val &gt;&gt; 9) &amp; 0x7e);</span>
<span class="cm">		if (rc &lt; 0)</span>
<span class="cm">			goto out; */</span>
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_SAT</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7640</span>:
	<span class="k">case</span> <span class="n">SEN_OV7648</span>:
		<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7610_REG_SAT</span><span class="p">,</span> <span class="n">val</span> <span class="o">&amp;</span> <span class="mh">0xf0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7660</span>:
		<span class="n">write_i2c_regvals</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">colors_7660</span><span class="p">[</span><span class="n">val</span><span class="p">],</span>
					<span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">colors_7660</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">SEN_OV7670</span>:
		<span class="cm">/* supported later once I work out how to do it</span>
<span class="cm">		 * transparently fail now! */</span>
		<span class="cm">/* set REG_COM13 values for UV sat auto mode */</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setautobright</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">AUTOBRIGHT</span><span class="p">].</span><span class="n">val</span> <span class="o">?</span> <span class="mh">0x10</span> <span class="o">:</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_setautogain</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">AUTOGAIN</span><span class="p">].</span><span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_inac</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">ctrl_inac</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">EXPOSURE</span><span class="p">);</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">EXPOSURE</span><span class="p">].</span><span class="n">val</span> <span class="o">=</span> <span class="n">i2c_r</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="n">setautogain</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">usb_err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">setfreq_i</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV7660</span>
	 <span class="o">||</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV7670</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">FREQ</span><span class="p">].</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>: <span class="cm">/* Banding filter disabled */</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">OV7670_COM8_BFILT</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="cm">/* 50 hz */</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="n">OV7670_COM8_BFILT</span><span class="p">,</span>
				   <span class="n">OV7670_COM8_BFILT</span><span class="p">);</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R3B_COM11</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>: <span class="cm">/* 60 hz */</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="n">OV7670_COM8_BFILT</span><span class="p">,</span>
				   <span class="n">OV7670_COM8_BFILT</span><span class="p">);</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R3B_COM11</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>: <span class="cm">/* Auto hz - ov7670 only */</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R13_COM8</span><span class="p">,</span> <span class="n">OV7670_COM8_BFILT</span><span class="p">,</span>
				   <span class="n">OV7670_COM8_BFILT</span><span class="p">);</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="n">OV7670_R3B_COM11</span><span class="p">,</span> <span class="n">OV7670_COM11_HZAUTO</span><span class="p">,</span>
				   <span class="mh">0x18</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">ctrls</span><span class="p">[</span><span class="n">FREQ</span><span class="p">].</span><span class="n">val</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>: <span class="cm">/* Banding filter disabled */</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>: <span class="cm">/* 50 hz (filter on and framerate adj) */</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
			<span class="cm">/* 20 fps -&gt; 16.667 fps */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV6620</span> <span class="o">||</span>
			    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV6630</span> <span class="o">||</span>
			    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV66308AF</span><span class="p">)</span>
				<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0x5e</span><span class="p">);</span>
			<span class="k">else</span>
				<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0xac</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>: <span class="cm">/* 60 hz (filter on, ...) */</span>
			<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV6620</span> <span class="o">||</span>
			    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV6630</span> <span class="o">||</span>
			    <span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">==</span> <span class="n">SEN_OV66308AF</span><span class="p">)</span> <span class="p">{</span>
				<span class="cm">/* 20 fps -&gt; 15 fps */</span>
				<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
				<span class="n">i2c_w</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2b</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
				<span class="cm">/* no framerate adj. */</span>
				<span class="n">i2c_w_mask</span><span class="p">(</span><span class="n">sd</span><span class="p">,</span> <span class="mh">0x2a</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">setfreq</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="n">setfreq_i</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>

	<span class="cm">/* Ugly but necessary */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">==</span> <span class="n">BRIDGE_W9968CF</span><span class="p">)</span>
		<span class="n">w9968cf_set_crop_window</span><span class="p">(</span><span class="n">sd</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_querymenu</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">v4l2_querymenu</span> <span class="o">*</span><span class="n">menu</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">V4L2_CID_POWER_LINE_FREQUENCY</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">menu</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">0</span>:		<span class="cm">/* V4L2_CID_POWER_LINE_FREQUENCY_DISABLED */</span>
			<span class="n">strcpy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;NoFliker&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">1</span>:		<span class="cm">/* V4L2_CID_POWER_LINE_FREQUENCY_50HZ */</span>
			<span class="n">strcpy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;50 Hz&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">2</span>:		<span class="cm">/* V4L2_CID_POWER_LINE_FREQUENCY_60HZ */</span>
			<span class="n">strcpy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;60 Hz&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">3</span>:
			<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">sensor</span> <span class="o">!=</span> <span class="n">SEN_OV7670</span><span class="p">)</span>
				<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

			<span class="n">strcpy</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span> <span class="n">menu</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Automatic&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_get_jcomp</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">v4l2_jpegcompression</span> <span class="o">*</span><span class="n">jcomp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">!=</span> <span class="n">BRIDGE_W9968CF</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">jcomp</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span> <span class="o">*</span><span class="n">jcomp</span><span class="p">);</span>
	<span class="n">jcomp</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">=</span> <span class="n">sd</span><span class="o">-&gt;</span><span class="n">quality</span><span class="p">;</span>
	<span class="n">jcomp</span><span class="o">-&gt;</span><span class="n">jpeg_markers</span> <span class="o">=</span> <span class="n">V4L2_JPEG_MARKER_DHT</span> <span class="o">|</span> <span class="n">V4L2_JPEG_MARKER_DQT</span> <span class="o">|</span>
			      <span class="n">V4L2_JPEG_MARKER_DRI</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_set_jcomp</span><span class="p">(</span><span class="k">struct</span> <span class="n">gspca_dev</span> <span class="o">*</span><span class="n">gspca_dev</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">v4l2_jpegcompression</span> <span class="o">*</span><span class="n">jcomp</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="p">)</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">sd</span><span class="o">-&gt;</span><span class="n">bridge</span> <span class="o">!=</span> <span class="n">BRIDGE_W9968CF</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">gspca_dev</span><span class="o">-&gt;</span><span class="n">streaming</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">jcomp</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">&lt;</span> <span class="n">QUALITY_MIN</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">=</span> <span class="n">QUALITY_MIN</span><span class="p">;</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">jcomp</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">&gt;</span> <span class="n">QUALITY_MAX</span><span class="p">)</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">=</span> <span class="n">QUALITY_MAX</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">sd</span><span class="o">-&gt;</span><span class="n">quality</span> <span class="o">=</span> <span class="n">jcomp</span><span class="o">-&gt;</span><span class="n">quality</span><span class="p">;</span>

	<span class="cm">/* Return resulting jcomp params to app */</span>
	<span class="n">sd_get_jcomp</span><span class="p">(</span><span class="n">gspca_dev</span><span class="p">,</span> <span class="n">jcomp</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* sub-driver description */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">sd_desc</span> <span class="n">sd_desc</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">MODULE_NAME</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ctrls</span> <span class="o">=</span> <span class="n">sd_ctrls</span><span class="p">,</span>
	<span class="p">.</span><span class="n">nctrls</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">sd_ctrls</span><span class="p">),</span>
	<span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">sd_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">init</span> <span class="o">=</span> <span class="n">sd_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">isoc_init</span> <span class="o">=</span> <span class="n">sd_isoc_init</span><span class="p">,</span>
	<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">sd_start</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stopN</span> <span class="o">=</span> <span class="n">sd_stopN</span><span class="p">,</span>
	<span class="p">.</span><span class="n">stop0</span> <span class="o">=</span> <span class="n">sd_stop0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">pkt_scan</span> <span class="o">=</span> <span class="n">sd_pkt_scan</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dq_callback</span> <span class="o">=</span> <span class="n">sd_reset_snapshot</span><span class="p">,</span>
	<span class="p">.</span><span class="n">querymenu</span> <span class="o">=</span> <span class="n">sd_querymenu</span><span class="p">,</span>
	<span class="p">.</span><span class="n">get_jcomp</span> <span class="o">=</span> <span class="n">sd_get_jcomp</span><span class="p">,</span>
	<span class="p">.</span><span class="n">set_jcomp</span> <span class="o">=</span> <span class="n">sd_set_jcomp</span><span class="p">,</span>
<span class="cp">#if defined(CONFIG_INPUT) || defined(CONFIG_INPUT_MODULE)</span>
	<span class="p">.</span><span class="n">other_input</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="cm">/* -- module initialisation -- */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="n">device_table</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4003</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_W9968CF</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4052</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="o">|</span> <span class="n">BRIDGE_INVERT_LED</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x405f</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4060</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4061</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4064</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4067</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x041e</span><span class="p">,</span> <span class="mh">0x4068</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x045e</span><span class="p">,</span> <span class="mh">0x028c</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="o">|</span> <span class="n">BRIDGE_INVERT_LED</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x054c</span><span class="p">,</span> <span class="mh">0x0154</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x054c</span><span class="p">,</span> <span class="mh">0x0155</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0x0511</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV511</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0x0518</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV518</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0x0519</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="o">|</span> <span class="n">BRIDGE_INVERT_LED</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0x0530</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="o">|</span> <span class="n">BRIDGE_INVERT_LED</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0x2800</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OVFX2</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0x4519</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0x8519</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV519</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0xa511</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV511PLUS</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x05a9</span><span class="p">,</span> <span class="mh">0xa518</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV518PLUS</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x0813</span><span class="p">,</span> <span class="mh">0x0002</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OV511PLUS</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x0b62</span><span class="p">,</span> <span class="mh">0x0059</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OVFX2</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x0e96</span><span class="p">,</span> <span class="mh">0xc001</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OVFX2</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x1046</span><span class="p">,</span> <span class="mh">0x9967</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_W9968CF</span> <span class="p">},</span>
	<span class="p">{</span><span class="n">USB_DEVICE</span><span class="p">(</span><span class="mh">0x8020</span><span class="p">,</span> <span class="mh">0xef04</span><span class="p">),</span> <span class="p">.</span><span class="n">driver_info</span> <span class="o">=</span> <span class="n">BRIDGE_OVFX2</span> <span class="p">},</span>
	<span class="p">{}</span>
<span class="p">};</span>

<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">usb</span><span class="p">,</span> <span class="n">device_table</span><span class="p">);</span>

<span class="cm">/* -- device connect -- */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">sd_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">usb_interface</span> <span class="o">*</span><span class="n">intf</span><span class="p">,</span>
			<span class="k">const</span> <span class="k">struct</span> <span class="n">usb_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">gspca_dev_probe</span><span class="p">(</span><span class="n">intf</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sd_desc</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span><span class="p">),</span>
				<span class="n">THIS_MODULE</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">usb_driver</span> <span class="n">sd_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">MODULE_NAME</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">device_table</span><span class="p">,</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">sd_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disconnect</span> <span class="o">=</span> <span class="n">gspca_disconnect</span><span class="p">,</span>
<span class="cp">#ifdef CONFIG_PM</span>
	<span class="p">.</span><span class="n">suspend</span> <span class="o">=</span> <span class="n">gspca_suspend</span><span class="p">,</span>
	<span class="p">.</span><span class="n">resume</span> <span class="o">=</span> <span class="n">gspca_resume</span><span class="p">,</span>
<span class="cp">#endif</span>
<span class="p">};</span>

<span class="n">module_usb_driver</span><span class="p">(</span><span class="n">sd_driver</span><span class="p">);</span>

<span class="n">module_param</span><span class="p">(</span><span class="n">frame_rate</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">frame_rate</span><span class="p">,</span> <span class="s">&quot;Frame rate (5, 10, 15, 20 or 30 fps)&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
