<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › gspca › m5602 › m5602_bridge.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../../index.html"></a><h1>m5602_bridge.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * USB Driver for ALi m5602 based webcams</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2008 Erik Andrén</span>
<span class="cm"> * Copyright (C) 2007 Ilyes Gouta. Based on the m5603x Linux Driver Project.</span>
<span class="cm"> * Copyright (C) 2005 m5603x Linux Driver Project &lt;m5602@x3ng.com.br&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * Portions of code to USB interface and ALi driver software,</span>
<span class="cm"> * Copyright (c) 2006 Willem Duinker</span>
<span class="cm"> * v4l2 interface modeled after the V4L2 driver</span>
<span class="cm"> * for SN9C10x PC Camera Controllers</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License as</span>
<span class="cm"> * published by the Free Software Foundation, version 2.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef M5602_BRIDGE_H_</span>
<span class="cp">#define M5602_BRIDGE_H_</span>

<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &quot;gspca.h&quot;</span>

<span class="cp">#define MODULE_NAME &quot;ALi m5602&quot;</span>

<span class="cm">/*****************************************************************************/</span>

<span class="cp">#define M5602_XB_SENSOR_TYPE		0x00</span>
<span class="cp">#define M5602_XB_SENSOR_CTRL		0x01</span>
<span class="cp">#define M5602_XB_LINE_OF_FRAME_H	0x02</span>
<span class="cp">#define M5602_XB_LINE_OF_FRAME_L	0x03</span>
<span class="cp">#define M5602_XB_PIX_OF_LINE_H		0x04</span>
<span class="cp">#define M5602_XB_PIX_OF_LINE_L		0x05</span>
<span class="cp">#define M5602_XB_VSYNC_PARA		0x06</span>
<span class="cp">#define M5602_XB_HSYNC_PARA		0x07</span>
<span class="cp">#define M5602_XB_TEST_MODE_1		0x08</span>
<span class="cp">#define M5602_XB_TEST_MODE_2		0x09</span>
<span class="cp">#define M5602_XB_SIG_INI		0x0a</span>
<span class="cp">#define M5602_XB_DS_PARA		0x0e</span>
<span class="cp">#define M5602_XB_TRIG_PARA		0x0f</span>
<span class="cp">#define M5602_XB_CLK_PD			0x10</span>
<span class="cp">#define M5602_XB_MCU_CLK_CTRL		0x12</span>
<span class="cp">#define M5602_XB_MCU_CLK_DIV		0x13</span>
<span class="cp">#define M5602_XB_SEN_CLK_CTRL		0x14</span>
<span class="cp">#define M5602_XB_SEN_CLK_DIV		0x15</span>
<span class="cp">#define M5602_XB_AUD_CLK_CTRL		0x16</span>
<span class="cp">#define M5602_XB_AUD_CLK_DIV		0x17</span>
<span class="cp">#define M5602_OB_AC_LINK_STATE		0x22</span>
<span class="cp">#define M5602_OB_PCM_SLOT_INDEX		0x24</span>
<span class="cp">#define M5602_OB_GPIO_SLOT_INDEX	0x25</span>
<span class="cp">#define M5602_OB_ACRX_STATUS_ADDRESS_H	0x28</span>
<span class="cp">#define M5602_OB_ACRX_STATUS_DATA_L	0x29</span>
<span class="cp">#define M5602_OB_ACRX_STATUS_DATA_H	0x2a</span>
<span class="cp">#define M5602_OB_ACTX_COMMAND_ADDRESS	0x31</span>
<span class="cp">#define M5602_OB_ACRX_COMMAND_DATA_L	0x32</span>
<span class="cp">#define M5602_OB_ACTX_COMMAND_DATA_H	0X33</span>
<span class="cp">#define M5602_XB_DEVCTR1		0x41</span>
<span class="cp">#define M5602_XB_EPSETR0		0x42</span>
<span class="cp">#define M5602_XB_EPAFCTR		0x47</span>
<span class="cp">#define M5602_XB_EPBFCTR		0x49</span>
<span class="cp">#define M5602_XB_EPEFCTR		0x4f</span>
<span class="cp">#define M5602_XB_TEST_REG		0x53</span>
<span class="cp">#define M5602_XB_ALT2SIZE		0x54</span>
<span class="cp">#define M5602_XB_ALT3SIZE		0x55</span>
<span class="cp">#define M5602_XB_OBSFRAME		0x56</span>
<span class="cp">#define M5602_XB_PWR_CTL		0x59</span>
<span class="cp">#define M5602_XB_ADC_CTRL		0x60</span>
<span class="cp">#define M5602_XB_ADC_DATA		0x61</span>
<span class="cp">#define M5602_XB_MISC_CTRL		0x62</span>
<span class="cp">#define M5602_XB_SNAPSHOT		0x63</span>
<span class="cp">#define M5602_XB_SCRATCH_1		0x64</span>
<span class="cp">#define M5602_XB_SCRATCH_2		0x65</span>
<span class="cp">#define M5602_XB_SCRATCH_3		0x66</span>
<span class="cp">#define M5602_XB_SCRATCH_4		0x67</span>
<span class="cp">#define M5602_XB_I2C_CTRL		0x68</span>
<span class="cp">#define M5602_XB_I2C_CLK_DIV		0x69</span>
<span class="cp">#define M5602_XB_I2C_DEV_ADDR		0x6a</span>
<span class="cp">#define M5602_XB_I2C_REG_ADDR		0x6b</span>
<span class="cp">#define M5602_XB_I2C_DATA		0x6c</span>
<span class="cp">#define M5602_XB_I2C_STATUS		0x6d</span>
<span class="cp">#define M5602_XB_GPIO_DAT_H		0x70</span>
<span class="cp">#define M5602_XB_GPIO_DAT_L		0x71</span>
<span class="cp">#define M5602_XB_GPIO_DIR_H		0x72</span>
<span class="cp">#define M5602_XB_GPIO_DIR_L		0x73</span>
<span class="cp">#define M5602_XB_GPIO_EN_H		0x74</span>
<span class="cp">#define M5602_XB_GPIO_EN_L		0x75</span>
<span class="cp">#define M5602_XB_GPIO_DAT		0x76</span>
<span class="cp">#define M5602_XB_GPIO_DIR		0x77</span>
<span class="cp">#define M5602_XB_SEN_CLK_CONTROL	0x80</span>
<span class="cp">#define M5602_XB_SEN_CLK_DIVISION	0x81</span>
<span class="cp">#define M5602_XB_CPR_CLK_CONTROL	0x82</span>
<span class="cp">#define M5602_XB_CPR_CLK_DIVISION	0x83</span>
<span class="cp">#define M5602_XB_MCU_CLK_CONTROL	0x84</span>
<span class="cp">#define M5602_XB_MCU_CLK_DIVISION	0x85</span>
<span class="cp">#define M5602_XB_DCT_CLK_CONTROL	0x86</span>
<span class="cp">#define M5602_XB_DCT_CLK_DIVISION	0x87</span>
<span class="cp">#define M5602_XB_EC_CLK_CONTROL		0x88</span>
<span class="cp">#define M5602_XB_EC_CLK_DIVISION	0x89</span>
<span class="cp">#define M5602_XB_LBUF_CLK_CONTROL	0x8a</span>
<span class="cp">#define M5602_XB_LBUF_CLK_DIVISION	0x8b</span>

<span class="cp">#define I2C_BUSY 0x80</span>

<span class="cm">/*****************************************************************************/</span>

<span class="cm">/* Driver info */</span>
<span class="cp">#define DRIVER_AUTHOR &quot;ALi m5602 Linux Driver Project&quot;</span>
<span class="cp">#define DRIVER_DESC &quot;ALi m5602 webcam driver&quot;</span>

<span class="cp">#define M5602_ISOC_ENDPOINT_ADDR 0x81</span>
<span class="cp">#define M5602_INTR_ENDPOINT_ADDR 0x82</span>

<span class="cp">#define M5602_URB_MSG_TIMEOUT   5000</span>

<span class="cm">/*****************************************************************************/</span>

<span class="cm">/* A skeleton used for sending messages to the m5602 bridge */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">bridge_urb_skeleton</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x13</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x00</span>
<span class="p">};</span>

<span class="cm">/* A skeleton used for sending messages to the sensor */</span>
<span class="k">static</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">sensor_urb_skeleton</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x23</span><span class="p">,</span> <span class="n">M5602_XB_GPIO_EN_H</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span>
	<span class="mh">0x23</span><span class="p">,</span> <span class="n">M5602_XB_MISC_CTRL</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x80</span><span class="p">,</span>
	<span class="mh">0x13</span><span class="p">,</span> <span class="n">M5602_XB_I2C_DEV_ADDR</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x13</span><span class="p">,</span> <span class="n">M5602_XB_I2C_REG_ADDR</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x13</span><span class="p">,</span> <span class="n">M5602_XB_I2C_DATA</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>
	<span class="mh">0x13</span><span class="p">,</span> <span class="n">M5602_XB_I2C_CTRL</span><span class="p">,</span> <span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x11</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">sd</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">gspca_dev</span> <span class="n">gspca_dev</span><span class="p">;</span>

	<span class="cm">/* A pointer to the currently connected sensor */</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">m5602_sensor</span> <span class="o">*</span><span class="n">sensor</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">sd_desc</span> <span class="o">*</span><span class="n">desc</span><span class="p">;</span>

	<span class="cm">/* Sensor private data */</span>
	<span class="kt">void</span> <span class="o">*</span><span class="n">sensor_priv</span><span class="p">;</span>

	<span class="cm">/* The current frame&#39;s id, used to detect frame boundaries */</span>
	<span class="n">u8</span> <span class="n">frame_id</span><span class="p">;</span>

	<span class="cm">/* The current frame count */</span>
	<span class="n">u32</span> <span class="n">frame_count</span><span class="p">;</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="n">m5602_read_bridge</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">address</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">i2c_data</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">m5602_write_bridge</span><span class="p">(</span>
	<span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">address</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">i2c_data</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">m5602_write_sensor</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">address</span><span class="p">,</span>
		       <span class="n">u8</span> <span class="o">*</span><span class="n">i2c_data</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">len</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">m5602_read_sensor</span><span class="p">(</span><span class="k">struct</span> <span class="n">sd</span> <span class="o">*</span><span class="n">sd</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">address</span><span class="p">,</span>
		      <span class="n">u8</span> <span class="o">*</span><span class="n">i2c_data</span><span class="p">,</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">len</span><span class="p">);</span>

<span class="cp">#endif</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:5}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../../javascript/docco.min.js"></script>
</html>
