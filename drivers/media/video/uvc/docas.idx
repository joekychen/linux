f | uvc_queue.c | s | 9.4K | 299 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1336495579 |  | [media] uvcvideo: Use videobuf2 .get_unmapped_area() implementation  The get_unmapped_area() operation was forgotten during conversion to videobuf2. Fix it.  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | Makefile | g | 240B |  | Alexey Fisher | bug-track@fisher-privat.net | 1323609727 |  | [media] uvcvideo: Add debugfs support  Create a debugfs entry per UVC stream. This will be used to export stream statistics.  Signed-off-by: Alexey Fisher <bug-track@fisher-privat.net> Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> [mchehab@redhat.com: add incude <linux/module.h> to avoid compilation breakage] Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvc_entity.c | s | 3.2K | 103 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1316654287 |  | [media] uvcvideo: Fix crash when linking entities  The uvc_mc_register_entity() function wrongfully selects the media_entity associated with a UVC entity when creating links. This results in access to uninitialized media_entity structures and can hit a BUG_ON statement in media_entity_create_link(). Fix it.  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvc_status.c | s | 5.4K | 193 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1287631098 |  | [media] uvcvideo: Update e-mail address and copyright notices  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvc_ctrl.c | s | 55K | 1914 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1337521278 |  | [media] uvcvideo: Fix V4L2 button controls that share the same UVC control  The Logitech pan/tilt reset UVC control contains two V4L2 button controls to reset pan and tilt. As the UVC control is not marked as auto-update, the button bits are set but never reset. A pan reset that follows a tilt reset would thus reset both pan and tilt.  Fix this by not caching the control value of write-only controls. All standard UVC controls are either readable or auto-update, so this will not cause any regression and will not result in extra USB requests.  Reported-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Acked-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvcvideo.h | s | 19K | 591 | Hans de Goede | hdegoede@redhat.com | 1336419717 |  | [media] uvcvideo: Drop unused ctrl member from struct uvc_control_mapping  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvc_video.c | s | 53K | 1589 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1333977328 |  | [media] uvcvideo: Fix race-related crash in uvc_video_clock_update()  The driver frees the clock samples buffer before stopping the video buffers queue. If a DQBUF call arrives in-between, uvc_video_clock_update() will be called with a NULL clock samples buffer, leading to a crash. This occurs very frequently when using the webcam with the flash browser plugin.  Move clock initialization/cleanup to uvc_video_enable() in order to free the clock samples buffer after the queue is stopped. Make sure the clock is reset at resume time to avoid miscalculating timestamps.  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Cc: stable@vger.kernel.org Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvc_debugfs.c | s | 3.2K | 107 | Alexey Fisher | bug-track@fisher-privat.net | 1323609728 |  | [media] uvcvideo: Extract video stream statistics  Export the statistics through debugfs.  Signed-off-by: Alexey Fisher <bug-track@fisher-privat.net> Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvc_v4l2.c | s | 31K | 1073 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1336495553 |  | [media] uvcvideo: Fix ENUMINPUT handling  Properly validate the user-supplied index against the number of inputs. The code used the pin local variable instead of the index by mistake.  Reported-by: Jozef Vesely <vesely@gjh.sk> Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Cc: stable@vger.kernel.org Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvc_driver.c | s | 65K | 2112 | Andrew Morton | akpm@linux-foundation.org | 1332176914 |  | [media] uvcvideo: uvc_driver.c: use linux/atomic.h  There's no known problem here, but this is one of only two non-arch files in the kernel which use asm/atomic.h instead of linux/atomic.h.  Signed-off-by: Andrew Morton <akpm@linux-foundation.org> Acked-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | uvc_isight.c | s | 3.8K | 119 | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1323609125 |  | [media] uvcvideo: Move fields from uvc_buffer::buf to uvc_buffer  Add mem, length and bytesused fields to the uvc_buffer structure and use them instead of accessing the uvc_buffer::buf m.offset, length and bytesused fields directly. This prepares the driver to the conversion to videobuf2.  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | Kconfig | g | 544B |  | Laurent Pinchart | laurent.pinchart@ideasonboard.com | 1323609186 |  | [media] uvcvideo: Use videobuf2-vmalloc  Replace the current video buffers queue implementation with videobuf2-vmalloc.  Signed-off-by: Laurent Pinchart <laurent.pinchart@ideasonboard.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
