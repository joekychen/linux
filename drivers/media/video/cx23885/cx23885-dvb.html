<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › cx23885 › cx23885-dvb.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>cx23885-dvb.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  Driver for the Conexant CX23885 PCIe bridge</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 2006 Steven Toth &lt;stoth@linuxtv.org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/fs.h&gt;</span>
<span class="cp">#include &lt;linux/kthread.h&gt;</span>
<span class="cp">#include &lt;linux/file.h&gt;</span>
<span class="cp">#include &lt;linux/suspend.h&gt;</span>

<span class="cp">#include &quot;cx23885.h&quot;</span>
<span class="cp">#include &lt;media/v4l2-common.h&gt;</span>

<span class="cp">#include &quot;dvb_ca_en50221.h&quot;</span>
<span class="cp">#include &quot;s5h1409.h&quot;</span>
<span class="cp">#include &quot;s5h1411.h&quot;</span>
<span class="cp">#include &quot;mt2131.h&quot;</span>
<span class="cp">#include &quot;tda8290.h&quot;</span>
<span class="cp">#include &quot;tda18271.h&quot;</span>
<span class="cp">#include &quot;lgdt330x.h&quot;</span>
<span class="cp">#include &quot;xc4000.h&quot;</span>
<span class="cp">#include &quot;xc5000.h&quot;</span>
<span class="cp">#include &quot;max2165.h&quot;</span>
<span class="cp">#include &quot;tda10048.h&quot;</span>
<span class="cp">#include &quot;tuner-xc2028.h&quot;</span>
<span class="cp">#include &quot;tuner-simple.h&quot;</span>
<span class="cp">#include &quot;dib7000p.h&quot;</span>
<span class="cp">#include &quot;dibx000_common.h&quot;</span>
<span class="cp">#include &quot;zl10353.h&quot;</span>
<span class="cp">#include &quot;stv0900.h&quot;</span>
<span class="cp">#include &quot;stv0900_reg.h&quot;</span>
<span class="cp">#include &quot;stv6110.h&quot;</span>
<span class="cp">#include &quot;lnbh24.h&quot;</span>
<span class="cp">#include &quot;cx24116.h&quot;</span>
<span class="cp">#include &quot;cimax2.h&quot;</span>
<span class="cp">#include &quot;lgs8gxx.h&quot;</span>
<span class="cp">#include &quot;netup-eeprom.h&quot;</span>
<span class="cp">#include &quot;netup-init.h&quot;</span>
<span class="cp">#include &quot;lgdt3305.h&quot;</span>
<span class="cp">#include &quot;atbm8830.h&quot;</span>
<span class="cp">#include &quot;ds3000.h&quot;</span>
<span class="cp">#include &quot;cx23885-f300.h&quot;</span>
<span class="cp">#include &quot;altera-ci.h&quot;</span>
<span class="cp">#include &quot;stv0367.h&quot;</span>
<span class="cp">#include &quot;drxk.h&quot;</span>
<span class="cp">#include &quot;mt2063.h&quot;</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">debug</span><span class="p">;</span>

<span class="cp">#define dprintk(level, fmt, arg...)\</span>
<span class="cp">	do { if (debug &gt;= level)\</span>
<span class="cp">		printk(KERN_DEBUG &quot;%s/0: &quot; fmt, dev-&gt;name, ## arg);\</span>
<span class="cp">	} while (0)</span>

<span class="cm">/* ------------------------------------------------------------------ */</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">alt_tuner</span><span class="p">;</span>
<span class="n">module_param</span><span class="p">(</span><span class="n">alt_tuner</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0644</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">alt_tuner</span><span class="p">,</span> <span class="s">&quot;Enable alternate tuner configuration&quot;</span><span class="p">);</span>

<span class="n">DVB_DEFINE_MOD_OPT_ADAPTER_NR</span><span class="p">(</span><span class="n">adapter_nr</span><span class="p">);</span>

<span class="cm">/* ------------------------------------------------------------------ */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dvb_buf_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">videobuf_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span>
			 <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">count</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span> <span class="o">=</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">priv_data</span><span class="p">;</span>

	<span class="n">port</span><span class="o">-&gt;</span><span class="n">ts_packet_size</span>  <span class="o">=</span> <span class="mi">188</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
	<span class="n">port</span><span class="o">-&gt;</span><span class="n">ts_packet_count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>

	<span class="o">*</span><span class="n">size</span>  <span class="o">=</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">ts_packet_size</span> <span class="o">*</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">ts_packet_count</span><span class="p">;</span>
	<span class="o">*</span><span class="n">count</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dvb_buf_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">videobuf_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">videobuf_buffer</span> <span class="o">*</span><span class="n">vb</span><span class="p">,</span> <span class="k">enum</span> <span class="n">v4l2_field</span> <span class="n">field</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span> <span class="o">=</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">priv_data</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">cx23885_buf_prepare</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_buffer</span> <span class="o">*</span><span class="p">)</span><span class="n">vb</span><span class="p">,</span> <span class="n">field</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dvb_buf_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">videobuf_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="k">struct</span> <span class="n">videobuf_buffer</span> <span class="o">*</span><span class="n">vb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span> <span class="o">=</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">priv_data</span><span class="p">;</span>
	<span class="n">cx23885_buf_queue</span><span class="p">(</span><span class="n">port</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_buffer</span> <span class="o">*</span><span class="p">)</span><span class="n">vb</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">dvb_buf_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">videobuf_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span>
			    <span class="k">struct</span> <span class="n">videobuf_buffer</span> <span class="o">*</span><span class="n">vb</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">cx23885_free_buffer</span><span class="p">(</span><span class="n">q</span><span class="p">,</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_buffer</span> <span class="o">*</span><span class="p">)</span><span class="n">vb</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">cx23885_dvb_set_frontend</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">cx23885_dvb_gate_ctrl</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span>  <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">open</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">videobuf_dvb_frontends</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">videobuf_dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">;</span>

	<span class="n">f</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">f</span><span class="o">-&gt;</span><span class="n">gate</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="cm">/* undefined or fe0 */</span>
		<span class="n">fe</span> <span class="o">=</span> <span class="n">videobuf_dvb_get_frontend</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">fe</span> <span class="o">=</span> <span class="n">videobuf_dvb_get_frontend</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">f</span><span class="o">-&gt;</span><span class="n">gate</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fe</span> <span class="o">&amp;&amp;</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">&amp;&amp;</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">)</span>
		<span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">i2c_gate_ctrl</span><span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span> <span class="n">open</span><span class="p">);</span>

	<span class="cm">/*</span>
<span class="cm">	 * FIXME: Improve this path to avoid calling the</span>
<span class="cm">	 * cx23885_dvb_set_frontend() every time it passes here.</span>
<span class="cm">	 */</span>
	<span class="n">cx23885_dvb_set_frontend</span><span class="p">(</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">videobuf_queue_ops</span> <span class="n">dvb_qops</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">buf_setup</span>    <span class="o">=</span> <span class="n">dvb_buf_setup</span><span class="p">,</span>
	<span class="p">.</span><span class="n">buf_prepare</span>  <span class="o">=</span> <span class="n">dvb_buf_prepare</span><span class="p">,</span>
	<span class="p">.</span><span class="n">buf_queue</span>    <span class="o">=</span> <span class="n">dvb_buf_queue</span><span class="p">,</span>
	<span class="p">.</span><span class="n">buf_release</span>  <span class="o">=</span> <span class="n">dvb_buf_release</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1409_config</span> <span class="n">hauppauge_generic_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x32</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1409_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1409_GPIO_ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if</span>        <span class="o">=</span> <span class="mi">44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1409_INVERSION_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1409_DEMODLOCKING</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1409_MPEGTIMING_CONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda10048_config</span> <span class="n">hauppauge_hvr1200_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span>    <span class="o">=</span> <span class="mh">0x10</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>      <span class="o">=</span> <span class="n">TDA10048_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">fwbulkwritelen</span>   <span class="o">=</span> <span class="n">TDA10048_BULKWRITE_200</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>        <span class="o">=</span> <span class="n">TDA10048_INVERSION_ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dtv6_if_freq_khz</span> <span class="o">=</span> <span class="n">TDA10048_IF_3300</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dtv7_if_freq_khz</span> <span class="o">=</span> <span class="n">TDA10048_IF_3800</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dtv8_if_freq_khz</span> <span class="o">=</span> <span class="n">TDA10048_IF_4300</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_freq_khz</span>     <span class="o">=</span> <span class="n">TDA10048_CLK_16000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda10048_config</span> <span class="n">hauppauge_hvr1210_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span>    <span class="o">=</span> <span class="mh">0x10</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>      <span class="o">=</span> <span class="n">TDA10048_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">fwbulkwritelen</span>   <span class="o">=</span> <span class="n">TDA10048_BULKWRITE_200</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>        <span class="o">=</span> <span class="n">TDA10048_INVERSION_ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dtv6_if_freq_khz</span> <span class="o">=</span> <span class="n">TDA10048_IF_3300</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dtv7_if_freq_khz</span> <span class="o">=</span> <span class="n">TDA10048_IF_3500</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dtv8_if_freq_khz</span> <span class="o">=</span> <span class="n">TDA10048_IF_4000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_freq_khz</span>     <span class="o">=</span> <span class="n">TDA10048_CLK_16000</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1409_config</span> <span class="n">hauppauge_ezqam_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x32</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1409_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1409_GPIO_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if</span>        <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1409_INVERSION_ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1409_DEMODLOCKING</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1409_MPEGTIMING_CONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1409_config</span> <span class="n">hauppauge_hvr1800lp_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x32</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1409_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1409_GPIO_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if</span>        <span class="o">=</span> <span class="mi">44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1409_INVERSION_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1409_DEMODLOCKING</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1409_MPEGTIMING_CONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1409_config</span> <span class="n">hauppauge_hvr1500_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x32</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1409_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1409_GPIO_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1409_INVERSION_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1409_DEMODLOCKING</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1409_MPEGTIMING_CONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mt2131_config</span> <span class="n">hauppauge_generic_tunerconfig</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mh">0x61</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lgdt330x_config</span> <span class="n">fusionhdtv_5_express</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x0e</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_chip</span> <span class="o">=</span> <span class="n">LGDT3303</span><span class="p">,</span>
	<span class="p">.</span><span class="n">serial_mpeg</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1409_config</span> <span class="n">hauppauge_hvr1500q_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x32</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1409_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1409_GPIO_ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if</span>        <span class="o">=</span> <span class="mi">44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1409_INVERSION_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1409_DEMODLOCKING</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1409_MPEGTIMING_CONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1409_config</span> <span class="n">dvico_s5h1409_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x32</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1409_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1409_GPIO_ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if</span>        <span class="o">=</span> <span class="mi">44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1409_INVERSION_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1409_DEMODLOCKING</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1409_MPEGTIMING_CONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1411_config</span> <span class="n">dvico_s5h1411_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1411_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1411_GPIO_ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if</span>        <span class="o">=</span> <span class="n">S5H1411_IF_44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsb_if</span>        <span class="o">=</span> <span class="n">S5H1411_IF_44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1411_INVERSION_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1411_DEMODLOCKING</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1411_MPEGTIMING_CONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">s5h1411_config</span> <span class="n">hcw_s5h1411_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mode</span>   <span class="o">=</span> <span class="n">S5H1411_SERIAL_OUTPUT</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio</span>          <span class="o">=</span> <span class="n">S5H1411_GPIO_OFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsb_if</span>        <span class="o">=</span> <span class="n">S5H1411_IF_44000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if</span>        <span class="o">=</span> <span class="n">S5H1411_IF_4000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">inversion</span>     <span class="o">=</span> <span class="n">S5H1411_INVERSION_ON</span><span class="p">,</span>
	<span class="p">.</span><span class="n">status_mode</span>   <span class="o">=</span> <span class="n">S5H1411_DEMODLOCKING</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_timing</span>   <span class="o">=</span> <span class="n">S5H1411_MPEGTIMING_CONTINOUS_NONINVERTING_CLOCK</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc5000_config</span> <span class="n">hauppauge_hvr1500q_tunerconfig</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span>      <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_khz</span>           <span class="o">=</span> <span class="mi">5380</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc5000_config</span> <span class="n">dvico_xc5000_tunerconfig</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span>      <span class="o">=</span> <span class="mh">0x64</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_khz</span>           <span class="o">=</span> <span class="mi">5380</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda829x_config</span> <span class="n">tda829x_no_probe</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">probe_tuner</span> <span class="o">=</span> <span class="n">TDA829X_DONT_PROBE</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda18271_std_map</span> <span class="n">hauppauge_tda18271_std_map</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">atsc_6</span>   <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">5380</span><span class="p">,</span> <span class="p">.</span><span class="n">agc_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">std</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		      <span class="p">.</span><span class="n">if_lvl</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="p">.</span><span class="n">rfagc_top</span> <span class="o">=</span> <span class="mh">0x37</span> <span class="p">},</span>
	<span class="p">.</span><span class="n">qam_6</span>    <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span> <span class="p">.</span><span class="n">agc_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">std</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		      <span class="p">.</span><span class="n">if_lvl</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="p">.</span><span class="n">rfagc_top</span> <span class="o">=</span> <span class="mh">0x37</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda18271_std_map</span> <span class="n">hauppauge_hvr1200_tda18271_std_map</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">dvbt_6</span>   <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">3300</span><span class="p">,</span> <span class="p">.</span><span class="n">agc_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">std</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		      <span class="p">.</span><span class="n">if_lvl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">rfagc_top</span> <span class="o">=</span> <span class="mh">0x37</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">.</span><span class="n">dvbt_7</span>   <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">3800</span><span class="p">,</span> <span class="p">.</span><span class="n">agc_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">std</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		      <span class="p">.</span><span class="n">if_lvl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">rfagc_top</span> <span class="o">=</span> <span class="mh">0x37</span><span class="p">,</span> <span class="p">},</span>
	<span class="p">.</span><span class="n">dvbt_8</span>   <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">4300</span><span class="p">,</span> <span class="p">.</span><span class="n">agc_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">std</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
		      <span class="p">.</span><span class="n">if_lvl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">rfagc_top</span> <span class="o">=</span> <span class="mh">0x37</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda18271_config</span> <span class="n">hauppauge_tda18271_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">std_map</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hauppauge_tda18271_std_map</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gate</span>    <span class="o">=</span> <span class="n">TDA18271_GATE_ANALOG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_opt</span> <span class="o">=</span> <span class="n">TDA18271_OUTPUT_LT_OFF</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda18271_config</span> <span class="n">hauppauge_hvr1200_tuner_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">std_map</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hauppauge_hvr1200_tda18271_std_map</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gate</span>    <span class="o">=</span> <span class="n">TDA18271_GATE_ANALOG</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_opt</span> <span class="o">=</span> <span class="n">TDA18271_OUTPUT_LT_OFF</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda18271_config</span> <span class="n">hauppauge_hvr1210_tuner_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">gate</span>    <span class="o">=</span> <span class="n">TDA18271_GATE_DIGITAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_opt</span> <span class="o">=</span> <span class="n">TDA18271_OUTPUT_LT_OFF</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda18271_std_map</span> <span class="n">hauppauge_hvr127x_std_map</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">atsc_6</span>   <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">3250</span><span class="p">,</span> <span class="p">.</span><span class="n">agc_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">std</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		      <span class="p">.</span><span class="n">if_lvl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">rfagc_top</span> <span class="o">=</span> <span class="mh">0x58</span> <span class="p">},</span>
	<span class="p">.</span><span class="n">qam_6</span>    <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span> <span class="p">.</span><span class="n">agc_mode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="p">.</span><span class="n">std</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		      <span class="p">.</span><span class="n">if_lvl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">.</span><span class="n">rfagc_top</span> <span class="o">=</span> <span class="mh">0x58</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">tda18271_config</span> <span class="n">hauppauge_hvr127x_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">std_map</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hauppauge_hvr127x_std_map</span><span class="p">,</span>
	<span class="p">.</span><span class="n">output_opt</span> <span class="o">=</span> <span class="n">TDA18271_OUTPUT_LT_OFF</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lgdt3305_config</span> <span class="n">hauppauge_lgdt3305_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_addr</span>           <span class="o">=</span> <span class="mh">0x0e</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mpeg_mode</span>          <span class="o">=</span> <span class="n">LGDT3305_MPEG_SERIAL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tpclk_edge</span>         <span class="o">=</span> <span class="n">LGDT3305_TPCLK_FALLING_EDGE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tpvalid_polarity</span>   <span class="o">=</span> <span class="n">LGDT3305_TP_VALID_HIGH</span><span class="p">,</span>
	<span class="p">.</span><span class="n">deny_i2c_rptr</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">spectral_inversion</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">qam_if_khz</span>         <span class="o">=</span> <span class="mi">4000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">vsb_if_khz</span>         <span class="o">=</span> <span class="mi">3250</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_agc_config</span> <span class="n">xc3028_agc_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">BAND_VHF</span> <span class="o">|</span> <span class="n">BAND_UHF</span><span class="p">,</span>	<span class="cm">/* band_caps */</span>

	<span class="cm">/* P_agc_use_sd_mod1=0, P_agc_use_sd_mod2=0, P_agc_freq_pwm_div=0,</span>
<span class="cm">	 * P_agc_inv_pwm1=0, P_agc_inv_pwm2=0,</span>
<span class="cm">	 * P_agc_inh_dc_rv_est=0, P_agc_time_est=3, P_agc_freeze=0,</span>
<span class="cm">	 * P_agc_nb_est=2, P_agc_write=0</span>
<span class="cm">	 */</span>
	<span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">15</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">9</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">|</span>
		<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">2</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="cm">/* setup */</span>

	<span class="mi">712</span><span class="p">,</span>	<span class="cm">/* inv_gain */</span>
	<span class="mi">21</span><span class="p">,</span>	<span class="cm">/* time_stabiliz */</span>

	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* alpha_level */</span>
	<span class="mi">118</span><span class="p">,</span>	<span class="cm">/* thlock */</span>

	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* wbd_inv */</span>
	<span class="mi">2867</span><span class="p">,</span>	<span class="cm">/* wbd_ref */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* wbd_sel */</span>
	<span class="mi">2</span><span class="p">,</span>	<span class="cm">/* wbd_alpha */</span>

	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_max */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_min */</span>
	<span class="mi">39718</span><span class="p">,</span>	<span class="cm">/* agc2_max */</span>
	<span class="mi">9930</span><span class="p">,</span>	<span class="cm">/* agc2_min */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_pt1 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_pt2 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_pt3 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_slope1 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc1_slope2 */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* agc2_pt1 */</span>
	<span class="mi">128</span><span class="p">,</span>	<span class="cm">/* agc2_pt2 */</span>
	<span class="mi">29</span><span class="p">,</span>	<span class="cm">/* agc2_slope1 */</span>
	<span class="mi">29</span><span class="p">,</span>	<span class="cm">/* agc2_slope2 */</span>

	<span class="mi">17</span><span class="p">,</span>	<span class="cm">/* alpha_mant */</span>
	<span class="mi">27</span><span class="p">,</span>	<span class="cm">/* alpha_exp */</span>
	<span class="mi">23</span><span class="p">,</span>	<span class="cm">/* beta_mant */</span>
	<span class="mi">51</span><span class="p">,</span>	<span class="cm">/* beta_exp */</span>

	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* perform_agc_softsplit */</span>
<span class="p">};</span>

<span class="cm">/* PLL Configuration for COFDM BW_MHz = 8.000000</span>
<span class="cm"> * With external clock = 30.000000 */</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">dibx000_bandwidth_config</span> <span class="n">xc3028_bw_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">60000</span><span class="p">,</span>	<span class="cm">/* internal */</span>
	<span class="mi">30000</span><span class="p">,</span>	<span class="cm">/* sampling */</span>
	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* pll_cfg: prediv */</span>
	<span class="mi">8</span><span class="p">,</span>	<span class="cm">/* pll_cfg: ratio */</span>
	<span class="mi">3</span><span class="p">,</span>	<span class="cm">/* pll_cfg: range */</span>
	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* pll_cfg: reset */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* pll_cfg: bypass */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* misc: refdiv */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* misc: bypclk_div */</span>
	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* misc: IO_CLK_en_core */</span>
	<span class="mi">1</span><span class="p">,</span>	<span class="cm">/* misc: ADClkSrc */</span>
	<span class="mi">0</span><span class="p">,</span>	<span class="cm">/* misc: modulo */</span>
	<span class="p">(</span><span class="mi">3</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">524</span> <span class="o">&lt;&lt;</span> <span class="mi">0</span><span class="p">),</span> <span class="cm">/* sad_cfg: refsel, sel, freq_15k */</span>
	<span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">25</span><span class="p">)</span> <span class="o">|</span> <span class="mi">5816102</span><span class="p">,</span> <span class="cm">/* ifreq = 5.200000 MHz */</span>
	<span class="mi">20452225</span><span class="p">,</span> <span class="cm">/* timf */</span>
	<span class="mi">30000000</span>  <span class="cm">/* xtal_hz */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">dib7000p_config</span> <span class="n">hauppauge_hvr1400_dib7000_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">output_mpeg2_in_188_bytes</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">hostbus_diversity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tuner_is_baseband</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">update_lna</span>  <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>

	<span class="p">.</span><span class="n">agc_config_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">xc3028_agc_config</span><span class="p">,</span>
	<span class="p">.</span><span class="n">bw</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">xc3028_bw_config</span><span class="p">,</span>

	<span class="p">.</span><span class="n">gpio_dir</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_DIRECTIONS</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_val</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_VALUES</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gpio_pwm_pos</span> <span class="o">=</span> <span class="n">DIB7000P_GPIO_DEFAULT_PWM_POS</span><span class="p">,</span>

	<span class="p">.</span><span class="n">pwm_freq_div</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_control</span>  <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span>
	<span class="p">.</span><span class="n">spur_protect</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>

	<span class="p">.</span><span class="n">output_mode</span> <span class="o">=</span> <span class="n">OUTMODE_MPEG2_SERIAL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">zl10353_config</span> <span class="n">dvico_fusionhdtv_xc3028</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x0f</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if2</span>           <span class="o">=</span> <span class="mi">45600</span><span class="p">,</span>
	<span class="p">.</span><span class="n">no_tuner</span>      <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">disable_i2c_gate_ctrl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv0900_reg</span> <span class="n">stv0900_ts_regs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">R0900_TSGENERAL</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">R0900_P1_TSSPEED</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">R0900_P2_TSSPEED</span><span class="p">,</span> <span class="mh">0x40</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">R0900_P1_TSCFGM</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">R0900_P2_TSCFGM</span><span class="p">,</span> <span class="mh">0xc0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">R0900_P1_TSCFGH</span><span class="p">,</span> <span class="mh">0xe0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">R0900_P2_TSCFGH</span><span class="p">,</span> <span class="mh">0xe0</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">R0900_P1_TSCFGL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">R0900_P2_TSCFGL</span><span class="p">,</span> <span class="mh">0x20</span> <span class="p">},</span>
	<span class="p">{</span> <span class="mh">0xffff</span><span class="p">,</span> <span class="mh">0xff</span> <span class="p">},</span> <span class="cm">/* terminate */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv0900_config</span> <span class="n">netup_stv0900_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x68</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="cm">/* dual */</span>
	<span class="p">.</span><span class="n">xtal</span> <span class="o">=</span> <span class="mi">8000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clkmode</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="cm">/* 0-CLKI, 2-XTALI, else AUTO */</span>
	<span class="p">.</span><span class="n">diseqc_mode</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span><span class="cm">/* 2/3 PWM */</span>
	<span class="p">.</span><span class="n">ts_config_regs</span> <span class="o">=</span> <span class="n">stv0900_ts_regs</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tun1_maddress</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span><span class="cm">/* 0x60 */</span>
	<span class="p">.</span><span class="n">tun2_maddress</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="cm">/* 0x63 */</span>
	<span class="p">.</span><span class="n">tun1_adc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="cm">/* 1 Vpp */</span>
	<span class="p">.</span><span class="n">tun2_adc</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="cm">/* 1 Vpp */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv6110_config</span> <span class="n">netup_stv6110_tunerconfig_a</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mclk</span> <span class="o">=</span> <span class="mi">16000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gain</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="cm">/* +16 dB  - maximum gain */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">stv6110_config</span> <span class="n">netup_stv6110_tunerconfig_b</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x63</span><span class="p">,</span>
	<span class="p">.</span><span class="n">mclk</span> <span class="o">=</span> <span class="mi">16000000</span><span class="p">,</span>
	<span class="p">.</span><span class="n">clk_div</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">gain</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="cm">/* +16 dB  - maximum gain */</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">cx24116_config</span> <span class="n">tbs_cx24116_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x55</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">ds3000_config</span> <span class="n">tevii_ds3000_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x68</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">cx24116_config</span> <span class="n">dvbworld_cx24116_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lgs8gxx_config</span> <span class="n">mygica_x8506_lgs8gl5_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">prod</span> <span class="o">=</span> <span class="n">LGS8GXX_PROD_LGS8GL5</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">,</span>
	<span class="p">.</span><span class="n">serial_ts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_clk_pol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_clk_gated</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_clk_freq</span> <span class="o">=</span> <span class="mi">30400</span><span class="p">,</span> <span class="cm">/* 30.4 MHz */</span>
	<span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">5380</span><span class="p">,</span> <span class="cm">/* 5.38 MHz */</span>
	<span class="p">.</span><span class="n">if_neg_center</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ext_adc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">adc_signed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_neg_edge</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc5000_config</span> <span class="n">mygica_x8506_xc5000_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_khz</span> <span class="o">=</span> <span class="mi">5380</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">cx23885_dvb_set_frontend</span><span class="p">(</span><span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">dtv_frontend_properties</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe</span><span class="o">-&gt;</span><span class="n">dtv_property_cache</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span> <span class="o">=</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="o">-&gt;</span><span class="n">priv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">board</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1275</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">modulation</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="n">VSB_8</span>:
			<span class="n">cx23885_gpio_clear</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO_5</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="n">QAM_64</span>:
		<span class="k">case</span> <span class="n">QAM_256</span>:
		<span class="nl">default:</span>
			<span class="n">cx23885_gpio_set</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO_5</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_MYGICA_X8506</span>:
	<span class="k">case</span> <span class="n">CX23885_BOARD_MAGICPRO_PROHDTVE2</span>:
		<span class="cm">/* Select Digital TV */</span>
		<span class="n">cx23885_gpio_set</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPIO_0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">lgs8gxx_config</span> <span class="n">magicpro_prohdtve2_lgs8g75_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">prod</span> <span class="o">=</span> <span class="n">LGS8GXX_PROD_LGS8G75</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x19</span><span class="p">,</span>
	<span class="p">.</span><span class="n">serial_ts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_clk_pol</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_clk_gated</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_clk_freq</span> <span class="o">=</span> <span class="mi">30400</span><span class="p">,</span> <span class="cm">/* 30.4 MHz */</span>
	<span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">6500</span><span class="p">,</span> <span class="cm">/* 6.50 MHz */</span>
	<span class="p">.</span><span class="n">if_neg_center</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ext_adc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">adc_signed</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">adc_vpp</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="cm">/* 1.6 Vpp */</span>
	<span class="p">.</span><span class="n">if_neg_edge</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc5000_config</span> <span class="n">magicpro_prohdtve2_xc5000_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
	<span class="p">.</span><span class="n">if_khz</span> <span class="o">=</span> <span class="mi">6500</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">atbm8830_config</span> <span class="n">mygica_x8558pro_atbm8830_cfg1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">prod</span> <span class="o">=</span> <span class="n">ATBM8830_PROD_8830</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x44</span><span class="p">,</span>
	<span class="p">.</span><span class="n">serial_ts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_sampling_edge</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_clk_gated</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">osc_clk_freq</span> <span class="o">=</span> <span class="mi">30400</span><span class="p">,</span> <span class="cm">/* in kHz */</span>
	<span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* zero IF */</span>
	<span class="p">.</span><span class="n">zif_swap_iq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_min</span> <span class="o">=</span> <span class="mh">0x2E</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_max</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_hold_loop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">max2165_config</span> <span class="n">mygic_x8558pro_max2165_cfg1</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="p">.</span><span class="n">osc_clk</span> <span class="o">=</span> <span class="mi">20</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">atbm8830_config</span> <span class="n">mygica_x8558pro_atbm8830_cfg2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">prod</span> <span class="o">=</span> <span class="n">ATBM8830_PROD_8830</span><span class="p">,</span>
	<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x44</span><span class="p">,</span>
	<span class="p">.</span><span class="n">serial_ts</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_sampling_edge</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">ts_clk_gated</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">osc_clk_freq</span> <span class="o">=</span> <span class="mi">30400</span><span class="p">,</span> <span class="cm">/* in kHz */</span>
	<span class="p">.</span><span class="n">if_freq</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="cm">/* zero IF */</span>
	<span class="p">.</span><span class="n">zif_swap_iq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_min</span> <span class="o">=</span> <span class="mh">0x2E</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_max</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">,</span>
	<span class="p">.</span><span class="n">agc_hold_loop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">max2165_config</span> <span class="n">mygic_x8558pro_max2165_cfg2</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="p">.</span><span class="n">osc_clk</span> <span class="o">=</span> <span class="mi">20</span>
<span class="p">};</span>
<span class="k">static</span> <span class="k">struct</span> <span class="n">stv0367_config</span> <span class="n">netup_stv0367_config</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x1c</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal</span> <span class="o">=</span> <span class="mi">27000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">if_khz</span> <span class="o">=</span> <span class="mi">4500</span><span class="p">,</span>
		<span class="p">.</span><span class="n">if_iq_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ts_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clk_pol</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">demod_address</span> <span class="o">=</span> <span class="mh">0x1d</span><span class="p">,</span>
		<span class="p">.</span><span class="n">xtal</span> <span class="o">=</span> <span class="mi">27000000</span><span class="p">,</span>
		<span class="p">.</span><span class="n">if_khz</span> <span class="o">=</span> <span class="mi">4500</span><span class="p">,</span>
		<span class="p">.</span><span class="n">if_iq_mode</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ts_mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">clk_pol</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">xc5000_config</span> <span class="n">netup_xc5000_config</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
		<span class="p">.</span><span class="n">if_khz</span> <span class="o">=</span> <span class="mi">4500</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">i2c_address</span> <span class="o">=</span> <span class="mh">0x64</span><span class="p">,</span>
		<span class="p">.</span><span class="n">if_khz</span> <span class="o">=</span> <span class="mi">4500</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">drxk_config</span> <span class="n">terratec_drxk_config</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">adr</span> <span class="o">=</span> <span class="mh">0x29</span><span class="p">,</span>
		<span class="p">.</span><span class="n">no_i2c_bridge</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">adr</span> <span class="o">=</span> <span class="mh">0x2a</span><span class="p">,</span>
		<span class="p">.</span><span class="n">no_i2c_bridge</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mt2063_config</span> <span class="n">terratec_mt2063_config</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">tuner_address</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">,</span>
	<span class="p">},</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">tuner_address</span> <span class="o">=</span> <span class="mh">0x67</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">netup_altera_fpga_rw</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flag</span><span class="p">,</span> <span class="kt">int</span> <span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">read</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="p">)</span><span class="n">device</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timeout</span> <span class="o">=</span> <span class="n">jiffies</span> <span class="o">+</span> <span class="n">msecs_to_jiffies</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="kt">uint32_t</span> <span class="n">mem</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">mem</span> <span class="o">=</span> <span class="n">cx_read</span><span class="p">(</span><span class="n">MC417_RWD</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">read</span><span class="p">)</span>
		<span class="n">cx_set</span><span class="p">(</span><span class="n">MC417_OEN</span><span class="p">,</span> <span class="n">ALT_DATA</span><span class="p">);</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">cx_clear</span><span class="p">(</span><span class="n">MC417_OEN</span><span class="p">,</span> <span class="n">ALT_DATA</span><span class="p">);</span><span class="cm">/* D0-D7 out */</span>
		<span class="n">mem</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">ALT_DATA</span><span class="p">;</span>
		<span class="n">mem</span> <span class="o">|=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&amp;</span> <span class="n">ALT_DATA</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">flag</span><span class="p">)</span>
		<span class="n">mem</span> <span class="o">|=</span> <span class="n">ALT_AD_RG</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">mem</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">ALT_AD_RG</span><span class="p">;</span>

	<span class="n">mem</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">ALT_CS</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">read</span><span class="p">)</span>
		<span class="n">mem</span> <span class="o">=</span> <span class="p">(</span><span class="n">mem</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ALT_RD</span><span class="p">)</span> <span class="o">|</span> <span class="n">ALT_WR</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">mem</span> <span class="o">=</span> <span class="p">(</span><span class="n">mem</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">ALT_WR</span><span class="p">)</span> <span class="o">|</span> <span class="n">ALT_RD</span><span class="p">;</span>

	<span class="n">cx_write</span><span class="p">(</span><span class="n">MC417_RWD</span><span class="p">,</span> <span class="n">mem</span><span class="p">);</span>  <span class="cm">/* start RW cycle */</span>

	<span class="k">for</span> <span class="p">(;;)</span> <span class="p">{</span>
		<span class="n">mem</span> <span class="o">=</span> <span class="n">cx_read</span><span class="p">(</span><span class="n">MC417_RWD</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">mem</span> <span class="o">&amp;</span> <span class="n">ALT_RDY</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">time_after</span><span class="p">(</span><span class="n">jiffies</span><span class="p">,</span> <span class="n">timeout</span><span class="p">))</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="n">udelay</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">cx_set</span><span class="p">(</span><span class="n">MC417_RWD</span><span class="p">,</span> <span class="n">ALT_RD</span> <span class="o">|</span> <span class="n">ALT_WR</span> <span class="o">|</span> <span class="n">ALT_CS</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">read</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">mem</span> <span class="o">&amp;</span> <span class="n">ALT_DATA</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">dvb_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx23885_i2c</span> <span class="o">*</span><span class="n">i2c_bus</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">i2c_bus2</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">videobuf_dvb_frontend</span> <span class="o">*</span><span class="n">fe0</span><span class="p">,</span> <span class="o">*</span><span class="n">fe1</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">mfe_shared</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* bus not shared by default */</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="cm">/* Get the first frontend */</span>
	<span class="n">fe0</span> <span class="o">=</span> <span class="n">videobuf_dvb_get_frontend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fe0</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="cm">/* init struct videobuf_dvb */</span>
	<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>

	<span class="cm">/* multi-frontend gate control is undefined or defaults to fe0 */</span>
	<span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">.</span><span class="n">gate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="cm">/* Sets the gate control callback to be used by i2c command calls */</span>
	<span class="n">port</span><span class="o">-&gt;</span><span class="n">gate_ctrl</span> <span class="o">=</span> <span class="n">cx23885_dvb_gate_ctrl</span><span class="p">;</span>

	<span class="cm">/* init frontend */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">board</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1250</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1409_attach</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">hauppauge_generic_config</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt2131_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">hauppauge_generic_tunerconfig</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1270</span>:
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1275</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">lgdt3305_attach</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">hauppauge_lgdt3305_config</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda18271_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				   <span class="mh">0x60</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">hauppauge_hvr127x_config</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1255</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1411_attach</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">hcw_s5h1411_config</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda18271_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				   <span class="mh">0x60</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">hauppauge_tda18271_config</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1800</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">alt_tuner</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span>
				<span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1409_attach</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">hauppauge_ezqam_config</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda829x_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">tda829x_no_probe</span><span class="p">);</span>
				<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda18271_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					   <span class="mh">0x60</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">hauppauge_tda18271_config</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="k">case</span> <span class="mi">0</span>:
		<span class="nl">default:</span>
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span>
				<span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1409_attach</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">hauppauge_generic_config</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
				<span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt2131_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
					   <span class="o">&amp;</span><span class="n">hauppauge_generic_tunerconfig</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1800lp</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1409_attach</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">hauppauge_hvr1800lp_config</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt2131_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">hauppauge_generic_tunerconfig</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_DVICO_FUSIONHDTV_5_EXP</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">lgdt330x_attach</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">fusionhdtv_5_express</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">simple_tuner_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span>
				   <span class="n">TUNER_LG_TDVS_H06XF</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1500Q</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1409_attach</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">hauppauge_hvr1500q_config</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc5000_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">hauppauge_hvr1500q_tunerconfig</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1500</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1409_attach</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">hauppauge_hvr1500_config</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">xc2028_config</span> <span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">i2c_adap</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="p">.</span><span class="n">i2c_addr</span>  <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
			<span class="p">};</span>
			<span class="k">static</span> <span class="k">struct</span> <span class="n">xc2028_ctrl</span> <span class="n">ctl</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">fname</span>       <span class="o">=</span> <span class="n">XC2028_DEFAULT_FIRMWARE</span><span class="p">,</span>
				<span class="p">.</span><span class="n">max_len</span>     <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
				<span class="p">.</span><span class="n">demod</span>       <span class="o">=</span> <span class="n">XC3028_FE_OREN538</span><span class="p">,</span>
			<span class="p">};</span>

			<span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc2028_attach</span><span class="p">,</span>
					<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_config</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
				<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctl</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1200</span>:
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1700</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda10048_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">hauppauge_hvr1200_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda829x_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">tda829x_no_probe</span><span class="p">);</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda18271_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				<span class="mh">0x60</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">hauppauge_hvr1200_tuner_config</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1210</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda10048_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">hauppauge_hvr1210_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda18271_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				<span class="mh">0x60</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">hauppauge_hvr1210_tuner_config</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1400</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">dib7000p_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
			<span class="mh">0x12</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hauppauge_hvr1400_dib7000_config</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="o">*</span><span class="n">fe</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">xc2028_config</span> <span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">i2c_adap</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="p">.</span><span class="n">i2c_addr</span>  <span class="o">=</span> <span class="mh">0x64</span><span class="p">,</span>
			<span class="p">};</span>
			<span class="k">static</span> <span class="k">struct</span> <span class="n">xc2028_ctrl</span> <span class="n">ctl</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">fname</span>   <span class="o">=</span> <span class="n">XC3028L_DEFAULT_FIRMWARE</span><span class="p">,</span>
				<span class="p">.</span><span class="n">max_len</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
				<span class="p">.</span><span class="n">demod</span>   <span class="o">=</span> <span class="n">XC3028_FE_DIBCOM52</span><span class="p">,</span>
				<span class="cm">/* This is true for all demods with</span>
<span class="cm">					v36 firmware? */</span>
				<span class="p">.</span><span class="n">type</span>    <span class="o">=</span> <span class="n">XC2028_D2633</span><span class="p">,</span>
			<span class="p">};</span>

			<span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc2028_attach</span><span class="p">,</span>
					<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_config</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
				<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctl</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_DVICO_FUSIONHDTV_7_DUAL_EXP</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>

		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1409_attach</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">dvico_s5h1409_config</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1411_attach</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">dvico_s5h1411_config</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc5000_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				   <span class="o">&amp;</span><span class="n">dvico_xc5000_tunerconfig</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL_EXP</span>: <span class="p">{</span>
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>

		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">zl10353_attach</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">dvico_fusionhdtv_xc3028</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">dvb_frontend</span>      <span class="o">*</span><span class="n">fe</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">xc2028_config</span>	  <span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">i2c_adap</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="p">.</span><span class="n">i2c_addr</span>  <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
			<span class="p">};</span>
			<span class="k">static</span> <span class="k">struct</span> <span class="n">xc2028_ctrl</span> <span class="n">ctl</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">fname</span>       <span class="o">=</span> <span class="n">XC2028_DEFAULT_FIRMWARE</span><span class="p">,</span>
				<span class="p">.</span><span class="n">max_len</span>     <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
				<span class="p">.</span><span class="n">demod</span>       <span class="o">=</span> <span class="n">XC3028_FE_ZARLINK456</span><span class="p">,</span>
			<span class="p">};</span>

			<span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc2028_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_config</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
				<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctl</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H</span>:
	<span class="k">case</span> <span class="n">CX23885_BOARD_COMPRO_VIDEOMATE_E650F</span>:
	<span class="k">case</span> <span class="n">CX23885_BOARD_COMPRO_VIDEOMATE_E800</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">zl10353_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">dvico_fusionhdtv_xc3028</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">dvb_frontend</span>      <span class="o">*</span><span class="n">fe</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">xc2028_config</span>	  <span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">i2c_adap</span>  <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="p">.</span><span class="n">i2c_addr</span>  <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
			<span class="p">};</span>
			<span class="k">static</span> <span class="k">struct</span> <span class="n">xc2028_ctrl</span> <span class="n">ctl</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">fname</span>       <span class="o">=</span> <span class="n">XC2028_DEFAULT_FIRMWARE</span><span class="p">,</span>
				<span class="p">.</span><span class="n">max_len</span>     <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
				<span class="p">.</span><span class="n">demod</span>       <span class="o">=</span> <span class="n">XC3028_FE_ZARLINK456</span><span class="p">,</span>
			<span class="p">};</span>

			<span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc2028_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe</span> <span class="o">!=</span> <span class="nb">NULL</span> <span class="o">&amp;&amp;</span> <span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_config</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
				<span class="n">fe</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">set_config</span><span class="p">(</span><span class="n">fe</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ctl</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H_XC4000</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">zl10353_attach</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">dvico_fusionhdtv_xc3028</span><span class="p">,</span>
					       <span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">dvb_frontend</span>	<span class="o">*</span><span class="n">fe</span><span class="p">;</span>
			<span class="k">struct</span> <span class="n">xc4000_config</span>	<span class="n">cfg</span> <span class="o">=</span> <span class="p">{</span>
				<span class="p">.</span><span class="n">i2c_address</span>	  <span class="o">=</span> <span class="mh">0x61</span><span class="p">,</span>
				<span class="p">.</span><span class="n">default_pm</span>	  <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
				<span class="p">.</span><span class="n">dvb_amplitude</span>	  <span class="o">=</span> <span class="mi">134</span><span class="p">,</span>
				<span class="p">.</span><span class="n">set_smoothedcvbs</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
				<span class="p">.</span><span class="n">if_khz</span>		  <span class="o">=</span> <span class="mi">4560</span>
			<span class="p">};</span>

			<span class="n">fe</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc4000_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cfg</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fe</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;%s/2: xc4000 attach failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
				<span class="k">goto</span> <span class="n">frontend_detach</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_TBS_6920</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">cx24116_attach</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">tbs_cx24116_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">f300_set_voltage</span><span class="p">;</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_TEVII_S470</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">ds3000_attach</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">tevii_ds3000_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">set_voltage</span> <span class="o">=</span> <span class="n">f300_set_voltage</span><span class="p">;</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_DVBWORLD_2005</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">cx24116_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">dvbworld_cx24116_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_NETUP_DUAL_DVBS2_CI</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="k">switch</span> <span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* port B */</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0900_attach</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">netup_stv0900_config</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv6110_attach</span><span class="p">,</span>
						<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">netup_stv6110_tunerconfig_a</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">lnbh24_attach</span><span class="p">,</span>
							<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
							<span class="n">LNBH24_PCL</span> <span class="o">|</span> <span class="n">LNBH24_TTX</span><span class="p">,</span>
							<span class="n">LNBH24_TEN</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">))</span>
						<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span>
							<span class="s">&quot;No LNBH24 found!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="cm">/* port C */</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0900_attach</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">netup_stv0900_config</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv6110_attach</span><span class="p">,</span>
						<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">netup_stv6110_tunerconfig_b</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span> <span class="p">{</span>
					<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">lnbh24_attach</span><span class="p">,</span>
							<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
							<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
							<span class="n">LNBH24_PCL</span> <span class="o">|</span> <span class="n">LNBH24_TTX</span><span class="p">,</span>
							<span class="n">LNBH24_TEN</span><span class="p">,</span> <span class="mh">0x0a</span><span class="p">))</span>
						<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span>
							<span class="s">&quot;No LNBH24 found!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

				<span class="p">}</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_MYGICA_X8506</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">i2c_bus2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">lgs8gxx_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">mygica_x8506_lgs8gl5_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc5000_attach</span><span class="p">,</span>
				<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">i2c_bus2</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">mygica_x8506_xc5000_config</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_MAGICPRO_PROHDTVE2</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">i2c_bus2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">lgs8gxx_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">magicpro_prohdtve2_lgs8g75_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc5000_attach</span><span class="p">,</span>
				<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">i2c_bus2</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">magicpro_prohdtve2_xc5000_config</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1850</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1411_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">hcw_s5h1411_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda18271_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				<span class="mh">0x60</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">hauppauge_tda18271_config</span><span class="p">);</span>

		<span class="n">tda18271_attach</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">ts1</span><span class="p">.</span><span class="n">analog_fe</span><span class="p">,</span>
			<span class="mh">0x60</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">hauppauge_tda18271_config</span><span class="p">);</span>

		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_HAUPPAUGE_HVR1290</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">s5h1411_attach</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">hcw_s5h1411_config</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="n">dvb_attach</span><span class="p">(</span><span class="n">tda18271_attach</span><span class="p">,</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
				<span class="mh">0x60</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">hauppauge_tda18271_config</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_MYGICA_X8558PRO</span>:
		<span class="k">switch</span> <span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* port B */</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">atbm8830_attach</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">mygica_x8558pro_atbm8830_cfg1</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dvb_attach</span><span class="p">(</span><span class="n">max2165_attach</span><span class="p">,</span>
					<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">mygic_x8558pro_max2165_cfg1</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="cm">/* port C */</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">atbm8830_attach</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">mygica_x8558pro_atbm8830_cfg2</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">dvb_attach</span><span class="p">(</span><span class="n">max2165_attach</span><span class="p">,</span>
					<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">mygic_x8558pro_max2165_cfg2</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">mfe_shared</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span><span class="cm">/* MFE */</span>
		<span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">.</span><span class="n">gate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span><span class="cm">/* not clear for me yet */</span>
		<span class="cm">/* ports B, C */</span>
		<span class="cm">/* MFE frontend 1 DVB-T */</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0367ter_attach</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">netup_stv0367_config</span><span class="p">[</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc5000_attach</span><span class="p">,</span>
					<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">netup_xc5000_config</span><span class="p">[</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
				<span class="k">goto</span> <span class="n">frontend_detach</span><span class="p">;</span>
			<span class="cm">/* load xc5000 firmware */</span>
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">tuner_ops</span><span class="p">.</span><span class="n">init</span><span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="cm">/* MFE frontend 2 */</span>
		<span class="n">fe1</span> <span class="o">=</span> <span class="n">videobuf_dvb_get_frontend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe1</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">frontend_detach</span><span class="p">;</span>
		<span class="cm">/* DVB-C init */</span>
		<span class="n">fe1</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">stv0367cab_attach</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">netup_stv0367_config</span><span class="p">[</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">fe1</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">fe1</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">xc5000_attach</span><span class="p">,</span>
					<span class="n">fe1</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">netup_xc5000_config</span><span class="p">[</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
				<span class="k">goto</span> <span class="n">frontend_detach</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_TERRATEC_CINERGY_T_PCIE_DUAL</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
		<span class="n">i2c_bus2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

		<span class="k">switch</span> <span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* port b */</span>
		<span class="k">case</span> <span class="mi">1</span>:
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">drxk_attach</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">terratec_drxk_config</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt2063_attach</span><span class="p">,</span>
						<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">terratec_mt2063_config</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
						<span class="o">&amp;</span><span class="n">i2c_bus2</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span>
					<span class="k">goto</span> <span class="n">frontend_detach</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="cm">/* port c */</span>
		<span class="k">case</span> <span class="mi">2</span>:
			<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">drxk_attach</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">terratec_drxk_config</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dvb_attach</span><span class="p">(</span><span class="n">mt2063_attach</span><span class="p">,</span>
						<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">,</span>
						<span class="o">&amp;</span><span class="n">terratec_mt2063_config</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
						<span class="o">&amp;</span><span class="n">i2c_bus2</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">))</span>
					<span class="k">goto</span> <span class="n">frontend_detach</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_TEVII_S471</span>:
		<span class="n">i2c_bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>

		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span> <span class="o">=</span> <span class="n">dvb_attach</span><span class="p">(</span><span class="n">ds3000_attach</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">tevii_ds3000_config</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">i2c_bus</span><span class="o">-&gt;</span><span class="n">i2c_adap</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: The frontend of your DVB/ATSC card &quot;</span>
			<span class="s">&quot; isn&#39;t supported yet</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="nb">NULL</span> <span class="o">==</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">fe1</span> <span class="o">&amp;&amp;</span> <span class="nb">NULL</span> <span class="o">==</span> <span class="n">fe1</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;%s: frontend initialization failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">frontend_detach</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* define general-purpose callback pointer */</span>
	<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">callback</span> <span class="o">=</span> <span class="n">cx23885_tuner_callback</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fe1</span><span class="p">)</span>
		<span class="n">fe1</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">callback</span> <span class="o">=</span> <span class="n">cx23885_tuner_callback</span><span class="p">;</span>
<span class="cp">#if 0</span><span class="c"></span>
<span class="c">	/* Ensure all frontends negotiate bus access */</span>
<span class="c">	fe0-&gt;dvb.frontend-&gt;ops.ts_bus_ctrl = cx23885_dvb_bus_ctrl;</span>
<span class="c">	if (fe1)</span>
<span class="c">		fe1-&gt;dvb.frontend-&gt;ops.ts_bus_ctrl = cx23885_dvb_bus_ctrl;</span>
<span class="cp">#endif</span>

	<span class="cm">/* Put the analog decoder in standby to keep it quiet */</span>
	<span class="n">call_all</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">core</span><span class="p">,</span> <span class="n">s_power</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">analog_ops</span><span class="p">.</span><span class="n">standby</span><span class="p">)</span>
		<span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="o">-&gt;</span><span class="n">ops</span><span class="p">.</span><span class="n">analog_ops</span><span class="p">.</span><span class="n">standby</span><span class="p">(</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">);</span>

	<span class="cm">/* register everything */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">videobuf_dvb_register_bus</span><span class="p">(</span><span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">,</span> <span class="n">THIS_MODULE</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">pci</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">adapter_nr</span><span class="p">,</span> <span class="n">mfe_shared</span><span class="p">,</span>
					<span class="nb">NULL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">frontend_detach</span><span class="p">;</span>

	<span class="cm">/* init CI &amp; MAC */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">board</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_NETUP_DUAL_DVBS2_CI</span>: <span class="p">{</span>
		<span class="k">static</span> <span class="k">struct</span> <span class="n">netup_card_info</span> <span class="n">cinfo</span><span class="p">;</span>

		<span class="n">netup_get_card_info</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">i2c_adap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cinfo</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">.</span><span class="n">adapter</span><span class="p">.</span><span class="n">proposed_mac</span><span class="p">,</span>
				<span class="n">cinfo</span><span class="p">.</span><span class="n">port</span><span class="p">[</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">].</span><span class="n">mac</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;NetUP Dual DVB-S2 CI card port%d MAC=%pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">.</span><span class="n">adapter</span><span class="p">.</span><span class="n">proposed_mac</span><span class="p">);</span>

		<span class="n">netup_ci_init</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF</span>: <span class="p">{</span>
		<span class="k">struct</span> <span class="n">altera_ci_config</span> <span class="n">netup_ci_cfg</span> <span class="o">=</span> <span class="p">{</span>
			<span class="p">.</span><span class="n">dev</span> <span class="o">=</span> <span class="n">dev</span><span class="p">,</span><span class="cm">/* magic number to identify*/</span>
			<span class="p">.</span><span class="n">adapter</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">.</span><span class="n">adapter</span><span class="p">,</span><span class="cm">/* for CI */</span>
			<span class="p">.</span><span class="n">demux</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">demux</span><span class="p">,</span><span class="cm">/* for hw pid filter */</span>
			<span class="p">.</span><span class="n">fpga_rw</span> <span class="o">=</span> <span class="n">netup_altera_fpga_rw</span><span class="p">,</span>
		<span class="p">};</span>

		<span class="n">altera_ci_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">netup_ci_cfg</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_TEVII_S470</span>: <span class="p">{</span>
		<span class="n">u8</span> <span class="n">eeprom</span><span class="p">[</span><span class="mi">256</span><span class="p">];</span> <span class="cm">/* 24C02 i2c eeprom */</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

		<span class="cm">/* Read entire EEPROM */</span>
		<span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">i2c_client</span><span class="p">.</span><span class="n">addr</span> <span class="o">=</span> <span class="mh">0xa0</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">tveeprom_read</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">i2c_bus</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">i2c_client</span><span class="p">,</span> <span class="n">eeprom</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">eeprom</span><span class="p">));</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;TeVii S470 MAC= %pM</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">eeprom</span> <span class="o">+</span> <span class="mh">0xa0</span><span class="p">);</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">.</span><span class="n">adapter</span><span class="p">.</span><span class="n">proposed_mac</span><span class="p">,</span> <span class="n">eeprom</span> <span class="o">+</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

<span class="nl">frontend_detach:</span>
	<span class="n">port</span><span class="o">-&gt;</span><span class="n">gate_ctrl</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">videobuf_dvb_dealloc_frontends</span><span class="p">(</span><span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">);</span>
	<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">cx23885_dvb_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>

	<span class="k">struct</span> <span class="n">videobuf_dvb_frontend</span> <span class="o">*</span><span class="n">fe0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="cm">/* Here we need to allocate the correct number of frontends,</span>
<span class="cm">	 * as reflected in the cards struct. The reality is that currently</span>
<span class="cm">	 * no cx23885 boards support this - yet. But, if we don&#39;t modify this</span>
<span class="cm">	 * code then the second frontend would never be allocated (later)</span>
<span class="cm">	 * and fail with error before the attach in dvb_register().</span>
<span class="cm">	 * Without these changes we risk an OOPS later. The changes here</span>
<span class="cm">	 * are for safety, and should provide a good foundation for the</span>
<span class="cm">	 * future addition of any multi-frontend cx23885 based boards.</span>
<span class="cm">	 */</span>
	<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s() allocating %d frontend(s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">,</span>
		<span class="n">port</span><span class="o">-&gt;</span><span class="n">num_frontends</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">num_frontends</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">videobuf_dvb_alloc_frontend</span><span class="p">(</span>
			<span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;%s() failed to alloc</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">fe0</span> <span class="o">=</span> <span class="n">videobuf_dvb_get_frontend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">fe0</span><span class="p">)</span>
			<span class="n">err</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

		<span class="n">dprintk</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">__func__</span><span class="p">);</span>
		<span class="n">dprintk</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot; -&gt;probed by Card=%d Name=%s, PCI %02x:%02x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">dev</span><span class="o">-&gt;</span><span class="n">board</span><span class="p">,</span>
			<span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span>
			<span class="n">dev</span><span class="o">-&gt;</span><span class="n">pci_bus</span><span class="p">,</span>
			<span class="n">dev</span><span class="o">-&gt;</span><span class="n">pci_slot</span><span class="p">);</span>

		<span class="n">err</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

		<span class="cm">/* dvb stuff */</span>
		<span class="cm">/* We have to init the queue for each frontend on a port. */</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_INFO</span> <span class="s">&quot;%s: cx23885 based dvb card</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">dev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
		<span class="n">videobuf_queue_sg_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">dvbq</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dvb_qops</span><span class="p">,</span>
			    <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">pci</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">slock</span><span class="p">,</span>
			    <span class="n">V4L2_BUF_TYPE_VIDEO_CAPTURE</span><span class="p">,</span> <span class="n">V4L2_FIELD_TOP</span><span class="p">,</span>
			    <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_buffer</span><span class="p">),</span> <span class="n">port</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">dvb_register</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">printk</span><span class="p">(</span><span class="n">KERN_ERR</span> <span class="s">&quot;%s() dvb_register failed err = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">__func__</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">cx23885_dvb_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">videobuf_dvb_frontend</span> <span class="o">*</span><span class="n">fe0</span><span class="p">;</span>

	<span class="cm">/* FIXME: in an error condition where the we have</span>
<span class="cm">	 * an expected number of frontends (attach problem)</span>
<span class="cm">	 * then this might not clean up correctly, if 1</span>
<span class="cm">	 * is invalid.</span>
<span class="cm">	 * This comment only applies to future boards IF they</span>
<span class="cm">	 * implement MFE support.</span>
<span class="cm">	 */</span>
	<span class="n">fe0</span> <span class="o">=</span> <span class="n">videobuf_dvb_get_frontend</span><span class="p">(</span><span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">fe0</span> <span class="o">&amp;&amp;</span> <span class="n">fe0</span><span class="o">-&gt;</span><span class="n">dvb</span><span class="p">.</span><span class="n">frontend</span><span class="p">)</span>
		<span class="n">videobuf_dvb_unregister_bus</span><span class="p">(</span><span class="o">&amp;</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">frontends</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">board</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_NETUP_DUAL_DVBS2_CI</span>:
		<span class="n">netup_ci_exit</span><span class="p">(</span><span class="n">port</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF</span>:
		<span class="n">altera_ci_release</span><span class="p">(</span><span class="n">port</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">port</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">port</span><span class="o">-&gt;</span><span class="n">gate_ctrl</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
