<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › cx23885 › cx23885.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>cx23885.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  Driver for the Conexant CX23885 PCIe bridge</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 2006 Steven Toth &lt;stoth@linuxtv.org&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute it and/or modify</span>
<span class="cm"> *  it under the terms of the GNU General Public License as published by</span>
<span class="cm"> *  the Free Software Foundation; either version 2 of the License, or</span>
<span class="cm"> *  (at your option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is distributed in the hope that it will be useful,</span>
<span class="cm"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="cm"> *</span>
<span class="cm"> *  GNU General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> *  You should have received a copy of the GNU General Public License</span>
<span class="cm"> *  along with this program; if not, write to the Free Software</span>
<span class="cm"> *  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/pci.h&gt;</span>
<span class="cp">#include &lt;linux/i2c.h&gt;</span>
<span class="cp">#include &lt;linux/i2c-algo-bit.h&gt;</span>
<span class="cp">#include &lt;linux/kdev_t.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>

<span class="cp">#include &lt;media/v4l2-device.h&gt;</span>
<span class="cp">#include &lt;media/tuner.h&gt;</span>
<span class="cp">#include &lt;media/tveeprom.h&gt;</span>
<span class="cp">#include &lt;media/videobuf-dma-sg.h&gt;</span>
<span class="cp">#include &lt;media/videobuf-dvb.h&gt;</span>
<span class="cp">#include &lt;media/rc-core.h&gt;</span>

<span class="cp">#include &quot;btcx-risc.h&quot;</span>
<span class="cp">#include &quot;cx23885-reg.h&quot;</span>
<span class="cp">#include &quot;media/cx2341x.h&quot;</span>

<span class="cp">#include &lt;linux/mutex.h&gt;</span>

<span class="cp">#define CX23885_VERSION &quot;0.0.3&quot;</span>

<span class="cp">#define UNSET (-1U)</span>

<span class="cp">#define CX23885_MAXBOARDS 8</span>

<span class="cm">/* Max number of inputs by card */</span>
<span class="cp">#define MAX_CX23885_INPUT 8</span>
<span class="cp">#define INPUT(nr) (&amp;cx23885_boards[dev-&gt;board].input[nr])</span>
<span class="cp">#define RESOURCE_OVERLAY       1</span>
<span class="cp">#define RESOURCE_VIDEO         2</span>
<span class="cp">#define RESOURCE_VBI           4</span>

<span class="cp">#define BUFFER_TIMEOUT     (HZ)  </span><span class="cm">/* 0.5 seconds */</span><span class="cp"></span>

<span class="cp">#define CX23885_BOARD_NOAUTO               UNSET</span>
<span class="cp">#define CX23885_BOARD_UNKNOWN                  0</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1800lp      1</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1800        2</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1250        3</span>
<span class="cp">#define CX23885_BOARD_DVICO_FUSIONHDTV_5_EXP   4</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1500Q       5</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1500        6</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1200        7</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1700        8</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1400        9</span>
<span class="cp">#define CX23885_BOARD_DVICO_FUSIONHDTV_7_DUAL_EXP 10</span>
<span class="cp">#define CX23885_BOARD_DVICO_FUSIONHDTV_DVB_T_DUAL_EXP 11</span>
<span class="cp">#define CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H 12</span>
<span class="cp">#define CX23885_BOARD_COMPRO_VIDEOMATE_E650F   13</span>
<span class="cp">#define CX23885_BOARD_TBS_6920                 14</span>
<span class="cp">#define CX23885_BOARD_TEVII_S470               15</span>
<span class="cp">#define CX23885_BOARD_DVBWORLD_2005            16</span>
<span class="cp">#define CX23885_BOARD_NETUP_DUAL_DVBS2_CI      17</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1270        18</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1275        19</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1255        20</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1210        21</span>
<span class="cp">#define CX23885_BOARD_MYGICA_X8506             22</span>
<span class="cp">#define CX23885_BOARD_MAGICPRO_PROHDTVE2       23</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1850        24</span>
<span class="cp">#define CX23885_BOARD_COMPRO_VIDEOMATE_E800    25</span>
<span class="cp">#define CX23885_BOARD_HAUPPAUGE_HVR1290        26</span>
<span class="cp">#define CX23885_BOARD_MYGICA_X8558PRO          27</span>
<span class="cp">#define CX23885_BOARD_LEADTEK_WINFAST_PXTV1200 28</span>
<span class="cp">#define CX23885_BOARD_GOTVIEW_X5_3D_HYBRID     29</span>
<span class="cp">#define CX23885_BOARD_NETUP_DUAL_DVB_T_C_CI_RF 30</span>
<span class="cp">#define CX23885_BOARD_LEADTEK_WINFAST_PXDVR3200_H_XC4000 31</span>
<span class="cp">#define CX23885_BOARD_MPX885                   32</span>
<span class="cp">#define CX23885_BOARD_MYGICA_X8507             33</span>
<span class="cp">#define CX23885_BOARD_TERRATEC_CINERGY_T_PCIE_DUAL 34</span>
<span class="cp">#define CX23885_BOARD_TEVII_S471               35</span>

<span class="cp">#define GPIO_0 0x00000001</span>
<span class="cp">#define GPIO_1 0x00000002</span>
<span class="cp">#define GPIO_2 0x00000004</span>
<span class="cp">#define GPIO_3 0x00000008</span>
<span class="cp">#define GPIO_4 0x00000010</span>
<span class="cp">#define GPIO_5 0x00000020</span>
<span class="cp">#define GPIO_6 0x00000040</span>
<span class="cp">#define GPIO_7 0x00000080</span>
<span class="cp">#define GPIO_8 0x00000100</span>
<span class="cp">#define GPIO_9 0x00000200</span>
<span class="cp">#define GPIO_10 0x00000400</span>
<span class="cp">#define GPIO_11 0x00000800</span>
<span class="cp">#define GPIO_12 0x00001000</span>
<span class="cp">#define GPIO_13 0x00002000</span>
<span class="cp">#define GPIO_14 0x00004000</span>
<span class="cp">#define GPIO_15 0x00008000</span>

<span class="cm">/* Currently unsupported by the driver: PAL/H, NTSC/Kr, SECAM B/G/H/LC */</span>
<span class="cp">#define CX23885_NORMS (\</span>
<span class="cp">	V4L2_STD_NTSC_M |  V4L2_STD_NTSC_M_JP |  V4L2_STD_NTSC_443 | \</span>
<span class="cp">	V4L2_STD_PAL_BG |  V4L2_STD_PAL_DK    |  V4L2_STD_PAL_I    | \</span>
<span class="cp">	V4L2_STD_PAL_M  |  V4L2_STD_PAL_N     |  V4L2_STD_PAL_Nc   | \</span>
<span class="cp">	V4L2_STD_PAL_60 |  V4L2_STD_SECAM_L   |  V4L2_STD_SECAM_DK)</span>

<span class="k">struct</span> <span class="n">cx23885_fmt</span> <span class="p">{</span>
	<span class="kt">char</span>  <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u32</span>   <span class="n">fourcc</span><span class="p">;</span>          <span class="cm">/* v4l2 format id */</span>
	<span class="kt">int</span>   <span class="n">depth</span><span class="p">;</span>
	<span class="kt">int</span>   <span class="n">flags</span><span class="p">;</span>
	<span class="n">u32</span>   <span class="n">cxformat</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_ctrl</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">v4l2_queryctrl</span> <span class="n">v</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">off</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">reg</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">mask</span><span class="p">;</span>
	<span class="n">u32</span>                   <span class="n">shift</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_tvnorm</span> <span class="p">{</span>
	<span class="kt">char</span>		<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">v4l2_std_id</span>	<span class="n">id</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">cxiformat</span><span class="p">;</span>
	<span class="n">u32</span>		<span class="n">cxoformat</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_fh</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span>         <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">v4l2_buf_type</span>         <span class="n">type</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">radio</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">resources</span><span class="p">;</span>

	<span class="cm">/* video overlay */</span>
	<span class="k">struct</span> <span class="n">v4l2_window</span>         <span class="n">win</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_clip</span>           <span class="o">*</span><span class="n">clips</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">nclips</span><span class="p">;</span>

	<span class="cm">/* video capture */</span>
	<span class="k">struct</span> <span class="n">cx23885_fmt</span>         <span class="o">*</span><span class="n">fmt</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">;</span>

	<span class="cm">/* vbi capture */</span>
	<span class="k">struct</span> <span class="n">videobuf_queue</span>      <span class="n">vidq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">videobuf_queue</span>      <span class="n">vbiq</span><span class="p">;</span>

	<span class="cm">/* MPEG Encoder specifics ONLY */</span>
	<span class="k">struct</span> <span class="n">videobuf_queue</span>      <span class="n">mpegq</span><span class="p">;</span>
	<span class="n">atomic_t</span>                   <span class="n">v4l_reading</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">cx23885_itype</span> <span class="p">{</span>
	<span class="n">CX23885_VMUX_COMPOSITE1</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_COMPOSITE2</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_COMPOSITE3</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_COMPOSITE4</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_SVIDEO</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_COMPONENT</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_TELEVISION</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_CABLE</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_DVB</span><span class="p">,</span>
	<span class="n">CX23885_VMUX_DEBUG</span><span class="p">,</span>
	<span class="n">CX23885_RADIO</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">enum</span> <span class="n">cx23885_src_sel_type</span> <span class="p">{</span>
	<span class="n">CX23885_SRC_SEL_EXT_656_VIDEO</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">CX23885_SRC_SEL_PARALLEL_MPEG_VIDEO</span>
<span class="p">};</span>

<span class="cm">/* buffer for one video frame */</span>
<span class="k">struct</span> <span class="n">cx23885_buffer</span> <span class="p">{</span>
	<span class="cm">/* common v4l buffer stuff -- must be first */</span>
	<span class="k">struct</span> <span class="n">videobuf_buffer</span> <span class="n">vb</span><span class="p">;</span>

	<span class="cm">/* cx23885 specific */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>           <span class="n">bpl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">btcx_riscmem</span>    <span class="n">risc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx23885_fmt</span>     <span class="o">*</span><span class="n">fmt</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_input</span> <span class="p">{</span>
	<span class="k">enum</span> <span class="n">cx23885_itype</span> <span class="n">type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">vmux</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>    <span class="n">amux</span><span class="p">;</span>
	<span class="n">u32</span>             <span class="n">gpio0</span><span class="p">,</span> <span class="n">gpio1</span><span class="p">,</span> <span class="n">gpio2</span><span class="p">,</span> <span class="n">gpio3</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">typedef</span> <span class="k">enum</span> <span class="p">{</span>
	<span class="n">CX23885_MPEG_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="n">CX23885_MPEG_DVB</span><span class="p">,</span>
	<span class="n">CX23885_ANALOG_VIDEO</span><span class="p">,</span>
	<span class="n">CX23885_MPEG_ENCODER</span><span class="p">,</span>
<span class="p">}</span> <span class="n">port_t</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">cx23885_board</span> <span class="p">{</span>
	<span class="kt">char</span>                    <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">port_t</span>			<span class="n">porta</span><span class="p">,</span> <span class="n">portb</span><span class="p">,</span> <span class="n">portc</span><span class="p">;</span>
	<span class="kt">int</span>		<span class="n">num_fds_portb</span><span class="p">,</span> <span class="n">num_fds_portc</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">tuner_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">radio_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">tuner_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>		<span class="n">radio_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">tuner_bus</span><span class="p">;</span>

	<span class="cm">/* Vendors can and do run the PCIe bridge at different</span>
<span class="cm">	 * clock rates, driven physically by crystals on the PCBs.</span>
<span class="cm">	 * The core has to accommodate this. This allows the user</span>
<span class="cm">	 * to add new boards with new frequencys. The value is</span>
<span class="cm">	 * expressed in Hz.</span>
<span class="cm">	 *</span>
<span class="cm">	 * The core framework will default this value based on</span>
<span class="cm">	 * current designs, but it can vary.</span>
<span class="cm">	 */</span>
	<span class="n">u32</span>			<span class="n">clk_freq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx23885_input</span>    <span class="n">input</span><span class="p">[</span><span class="n">MAX_CX23885_INPUT</span><span class="p">];</span>
	<span class="kt">int</span>			<span class="n">ci_type</span><span class="p">;</span> <span class="cm">/* for NetUP */</span>
	<span class="cm">/* Force bottom field first during DMA (888 workaround) */</span>
	<span class="n">u32</span>                     <span class="n">force_bff</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_subid</span> <span class="p">{</span>
	<span class="n">u16</span>     <span class="n">subvendor</span><span class="p">;</span>
	<span class="n">u16</span>     <span class="n">subdevice</span><span class="p">;</span>
	<span class="n">u32</span>     <span class="n">card</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_i2c</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="kt">int</span>                        <span class="n">nr</span><span class="p">;</span>

	<span class="cm">/* i2c i/o */</span>
	<span class="k">struct</span> <span class="n">i2c_adapter</span>         <span class="n">i2c_adap</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_algo_bit_data</span>   <span class="n">i2c_algo</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">i2c_client</span>          <span class="n">i2c_client</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">i2c_rc</span><span class="p">;</span>

	<span class="cm">/* 885 registers used for raw addess */</span>
	<span class="n">u32</span>                        <span class="n">i2c_period</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_ctrl</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_stat</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_addr</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_rdata</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_wdata</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_dmaqueue</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span>       <span class="n">active</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">list_head</span>       <span class="n">queued</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">timer_list</span>      <span class="n">timeout</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">btcx_riscmem</span>    <span class="n">stopper</span><span class="p">;</span>
	<span class="n">u32</span>                    <span class="n">count</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="kt">int</span>                        <span class="n">nr</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">sram_chno</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">videobuf_dvb_frontends</span> <span class="n">frontends</span><span class="p">;</span>

	<span class="cm">/* dma queues */</span>
	<span class="k">struct</span> <span class="n">cx23885_dmaqueue</span>    <span class="n">mpegq</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">ts_packet_size</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">ts_packet_count</span><span class="p">;</span>

	<span class="kt">int</span>                        <span class="n">width</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">height</span><span class="p">;</span>

	<span class="n">spinlock_t</span>                 <span class="n">slock</span><span class="p">;</span>

	<span class="cm">/* registers */</span>
	<span class="n">u32</span>                        <span class="n">reg_gpcnt</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_gpcnt_ctl</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_dma_ctl</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_lngth</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_hw_sop_ctrl</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_gen_ctrl</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_bd_pkt_status</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_sop_status</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_fifo_ovfl_stat</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_vld_misc</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_ts_clk_en</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_ts_int_msk</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_ts_int_stat</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">reg_src_sel</span><span class="p">;</span>

	<span class="cm">/* Default register vals */</span>
	<span class="kt">int</span>                        <span class="n">pci_irqmask</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">dma_ctl_val</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">ts_int_msk_val</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">gen_ctrl_val</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">ts_clk_en_val</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">src_sel_val</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">vld_misc_val</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">hw_sop_ctrl_val</span><span class="p">;</span>

	<span class="cm">/* Allow a single tsport to have multiple frontends */</span>
	<span class="n">u32</span>                        <span class="n">num_frontends</span><span class="p">;</span>
	<span class="kt">void</span>                <span class="p">(</span><span class="o">*</span><span class="n">gate_ctrl</span><span class="p">)(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span> <span class="kt">int</span> <span class="n">open</span><span class="p">);</span>
	<span class="kt">void</span>                       <span class="o">*</span><span class="n">port_priv</span><span class="p">;</span>

	<span class="cm">/* Workaround for a temp dvb_frontend that the tuner can attached to */</span>
	<span class="k">struct</span> <span class="n">dvb_frontend</span> <span class="n">analog_fe</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_kernel_ir</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span>	<span class="o">*</span><span class="n">cx</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">char</span>			<span class="o">*</span><span class="n">phys</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">rc_dev</span>		<span class="o">*</span><span class="n">rc</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_audio_buffer</span> <span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">bpl</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">btcx_riscmem</span>	<span class="n">risc</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">videobuf_dmabuf</span>	<span class="n">dma</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_audio_dev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">cx23885_dev</span>	<span class="o">*</span><span class="n">dev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">pci_dev</span>		<span class="o">*</span><span class="n">pci</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_card</span>		<span class="o">*</span><span class="n">card</span><span class="p">;</span>

	<span class="n">spinlock_t</span>		<span class="n">lock</span><span class="p">;</span>

	<span class="n">atomic_t</span>		<span class="n">count</span><span class="p">;</span>

	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">dma_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">period_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>		<span class="n">num_periods</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">videobuf_dmabuf</span>	<span class="o">*</span><span class="n">dma_risc</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">cx23885_audio_buffer</span>   <span class="o">*</span><span class="n">buf</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">snd_pcm_substream</span> <span class="o">*</span><span class="n">substream</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="p">{</span>
	<span class="n">atomic_t</span>                   <span class="n">refcount</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_device</span> 	   <span class="n">v4l2_dev</span><span class="p">;</span>

	<span class="cm">/* pci stuff */</span>
	<span class="k">struct</span> <span class="n">pci_dev</span>             <span class="o">*</span><span class="n">pci</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>              <span class="n">pci_rev</span><span class="p">,</span> <span class="n">pci_lat</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">pci_bus</span><span class="p">,</span> <span class="n">pci_slot</span><span class="p">;</span>
	<span class="n">u32</span>                        <span class="n">__iomem</span> <span class="o">*</span><span class="n">lmmio</span><span class="p">;</span>
	<span class="n">u8</span>                         <span class="n">__iomem</span> <span class="o">*</span><span class="n">bmmio</span><span class="p">;</span>
	<span class="kt">int</span>                        <span class="n">pci_irqmask</span><span class="p">;</span>
	<span class="n">spinlock_t</span>		   <span class="n">pci_irqmask_lock</span><span class="p">;</span> <span class="cm">/* protects mask reg too */</span>
	<span class="kt">int</span>                        <span class="n">hwrevision</span><span class="p">;</span>

	<span class="cm">/* This valud is board specific and is used to configure the</span>
<span class="cm">	 * AV core so we see nice clean and stable video and audio. */</span>
	<span class="n">u32</span>                        <span class="n">clk_freq</span><span class="p">;</span>

	<span class="cm">/* I2C adapters: Master 1 &amp; 2 (External) &amp; Master 3 (Internal only) */</span>
	<span class="k">struct</span> <span class="n">cx23885_i2c</span>         <span class="n">i2c_bus</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

	<span class="kt">int</span>                        <span class="n">nr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>               <span class="n">lock</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">mutex</span>               <span class="n">gpio_lock</span><span class="p">;</span>

	<span class="cm">/* board details */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">board</span><span class="p">;</span>
	<span class="kt">char</span>                       <span class="n">name</span><span class="p">[</span><span class="mi">32</span><span class="p">];</span>

	<span class="k">struct</span> <span class="n">cx23885_tsport</span>      <span class="n">ts1</span><span class="p">,</span> <span class="n">ts2</span><span class="p">;</span>

	<span class="cm">/* sram configuration */</span>
	<span class="k">struct</span> <span class="n">sram_channel</span>        <span class="o">*</span><span class="n">sram_channels</span><span class="p">;</span>

	<span class="k">enum</span> <span class="p">{</span>
		<span class="n">CX23885_BRIDGE_UNDEFINED</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
		<span class="n">CX23885_BRIDGE_885</span> <span class="o">=</span> <span class="mi">885</span><span class="p">,</span>
		<span class="n">CX23885_BRIDGE_887</span> <span class="o">=</span> <span class="mi">887</span><span class="p">,</span>
		<span class="n">CX23885_BRIDGE_888</span> <span class="o">=</span> <span class="mi">888</span><span class="p">,</span>
	<span class="p">}</span> <span class="n">bridge</span><span class="p">;</span>

	<span class="cm">/* Analog video */</span>
	<span class="n">u32</span>                        <span class="n">resources</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">input</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">audinput</span><span class="p">;</span> <span class="cm">/* Selectable audio input */</span>
	<span class="n">u32</span>                        <span class="n">tvaudio</span><span class="p">;</span>
	<span class="n">v4l2_std_id</span>                <span class="n">tvnorm</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">tuner_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>              <span class="n">tuner_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">tuner_bus</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">radio_type</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">char</span>              <span class="n">radio_addr</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span>               <span class="n">has_radio</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_subdev</span> 	   <span class="o">*</span><span class="n">sd_cx25840</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	   <span class="n">cx25840_work</span><span class="p">;</span>

	<span class="cm">/* Infrared */</span>
	<span class="k">struct</span> <span class="n">v4l2_subdev</span>         <span class="o">*</span><span class="n">sd_ir</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	   <span class="n">ir_rx_work</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		   <span class="n">ir_rx_notifications</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">work_struct</span>	   <span class="n">ir_tx_work</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span>		   <span class="n">ir_tx_notifications</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">cx23885_kernel_ir</span>   <span class="o">*</span><span class="n">kernel_ir</span><span class="p">;</span>
	<span class="n">atomic_t</span>		   <span class="n">ir_input_stopping</span><span class="p">;</span>

	<span class="cm">/* V4l */</span>
	<span class="n">u32</span>                        <span class="n">freq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span>        <span class="o">*</span><span class="n">video_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span>        <span class="o">*</span><span class="n">vbi_dev</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span>        <span class="o">*</span><span class="n">radio_dev</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">cx23885_dmaqueue</span>    <span class="n">vidq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx23885_dmaqueue</span>    <span class="n">vbiq</span><span class="p">;</span>
	<span class="n">spinlock_t</span>                 <span class="n">slock</span><span class="p">;</span>

	<span class="cm">/* MPEG Encoder ONLY settings */</span>
	<span class="n">u32</span>                        <span class="n">cx23417_mailbox</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx2341x_mpeg_params</span> <span class="n">mpeg_params</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">video_device</span>        <span class="o">*</span><span class="n">v4l_device</span><span class="p">;</span>
	<span class="n">atomic_t</span>                   <span class="n">v4l_reader_count</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cx23885_tvnorm</span>      <span class="n">encodernorm</span><span class="p">;</span>

	<span class="cm">/* Analog raw audio */</span>
	<span class="k">struct</span> <span class="n">cx23885_audio_dev</span>   <span class="o">*</span><span class="n">audio_dev</span><span class="p">;</span>

<span class="p">};</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="nf">to_cx23885</span><span class="p">(</span><span class="k">struct</span> <span class="n">v4l2_device</span> <span class="o">*</span><span class="n">v4l2_dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">container_of</span><span class="p">(</span><span class="n">v4l2_dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">cx23885_dev</span><span class="p">,</span> <span class="n">v4l2_dev</span><span class="p">);</span>
<span class="p">}</span>

<span class="cp">#define call_all(dev, o, f, args...) \</span>
<span class="cp">	v4l2_device_call_all(&amp;dev-&gt;v4l2_dev, 0, o, f, ##args)</span>

<span class="cp">#define CX23885_HW_888_IR  (1 &lt;&lt; 0)</span>
<span class="cp">#define CX23885_HW_AV_CORE (1 &lt;&lt; 1)</span>

<span class="cp">#define call_hw(dev, grpid, o, f, args...) \</span>
<span class="cp">	v4l2_device_call_all(&amp;dev-&gt;v4l2_dev, grpid, o, f, ##args)</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="o">*</span><span class="n">cx23885_find_hw</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">hw</span><span class="p">);</span>

<span class="cp">#define SRAM_CH01  0 </span><span class="cm">/* Video A */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH02  1 </span><span class="cm">/* VBI A */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH03  2 </span><span class="cm">/* Video B */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH04  3 </span><span class="cm">/* Transport via B */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH05  4 </span><span class="cm">/* VBI B */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH06  5 </span><span class="cm">/* Video C */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH07  6 </span><span class="cm">/* Transport via C */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH08  7 </span><span class="cm">/* Audio Internal A */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH09  8 </span><span class="cm">/* Audio Internal B */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH10  9 </span><span class="cm">/* Audio External */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH11 10 </span><span class="cm">/* COMB_3D_N */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH12 11 </span><span class="cm">/* Comb 3D N1 */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH13 12 </span><span class="cm">/* Comb 3D N2 */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH14 13 </span><span class="cm">/* MOE Vid */</span><span class="cp"></span>
<span class="cp">#define SRAM_CH15 14 </span><span class="cm">/* MOE RSLT */</span><span class="cp"></span>

<span class="k">struct</span> <span class="n">sram_channel</span> <span class="p">{</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">cmds_start</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">ctrl_start</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">cdt</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">fifo_start</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">fifo_size</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">ptr1_reg</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">ptr2_reg</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">cnt1_reg</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">cnt2_reg</span><span class="p">;</span>
	<span class="n">u32</span>  <span class="n">jumponly</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* ----------------------------------------------------------- */</span>

<span class="cp">#define cx_read(reg)             readl(dev-&gt;lmmio + ((reg)&gt;&gt;2))</span>
<span class="cp">#define cx_write(reg, value)     writel((value), dev-&gt;lmmio + ((reg)&gt;&gt;2))</span>

<span class="cp">#define cx_andor(reg, mask, value) \</span>
<span class="cp">  writel((readl(dev-&gt;lmmio+((reg)&gt;&gt;2)) &amp; ~(mask)) |\</span>
<span class="cp">  ((value) &amp; (mask)), dev-&gt;lmmio+((reg)&gt;&gt;2))</span>

<span class="cp">#define cx_set(reg, bit)          cx_andor((reg), (bit), (bit))</span>
<span class="cp">#define cx_clear(reg, bit)        cx_andor((reg), (bit), 0)</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx23885-core.c                                              */</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_sram_channel_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">sram_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpl</span><span class="p">,</span> <span class="n">u32</span> <span class="n">risc</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_sram_channel_dump</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">sram_channel</span> <span class="o">*</span><span class="n">ch</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_risc_stopper</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span> <span class="k">struct</span> <span class="n">btcx_riscmem</span> <span class="o">*</span><span class="n">risc</span><span class="p">,</span>
	<span class="n">u32</span> <span class="n">reg</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_risc_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span> <span class="k">struct</span> <span class="n">btcx_riscmem</span> <span class="o">*</span><span class="n">risc</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">scatterlist</span> <span class="o">*</span><span class="n">sglist</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">top_offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bottom_offset</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpl</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">padding</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lines</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_risc_vbibuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">btcx_riscmem</span> <span class="o">*</span><span class="n">risc</span><span class="p">,</span> <span class="k">struct</span> <span class="n">scatterlist</span> <span class="o">*</span><span class="n">sglist</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">top_offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bottom_offset</span><span class="p">,</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpl</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">padding</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lines</span><span class="p">);</span>

<span class="kt">void</span> <span class="n">cx23885_cancel_buffers</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_restart_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">cx23885_dmaqueue</span> <span class="o">*</span><span class="n">q</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_wakeup</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span>
			   <span class="k">struct</span> <span class="n">cx23885_dmaqueue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_gpio_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_gpio_clear</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="n">u32</span> <span class="n">cx23885_gpio_get</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_gpio_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">asoutput</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_irq_add_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_irq_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_irq_disable</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_irq_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx23885-cards.c                                             */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">cx23885_board</span> <span class="n">cx23885_boards</span><span class="p">[];</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cx23885_bcount</span><span class="p">;</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">cx23885_subid</span> <span class="n">cx23885_subids</span><span class="p">[];</span>
<span class="k">extern</span> <span class="k">const</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">cx23885_idcount</span><span class="p">;</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_tuner_callback</span><span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">int</span> <span class="n">component</span><span class="p">,</span>
	<span class="kt">int</span> <span class="n">command</span><span class="p">,</span> <span class="kt">int</span> <span class="n">arg</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_card_list</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span>  <span class="n">cx23885_ir_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_ir_pci_int_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_ir_fini</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_gpio_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_card_setup</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_card_setup_pre_i2c</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_dvb_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_dvb_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">);</span>

<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_buf_prepare</span><span class="p">(</span><span class="k">struct</span> <span class="n">videobuf_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span>
			       <span class="k">struct</span> <span class="n">cx23885_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
			       <span class="k">enum</span> <span class="n">v4l2_field</span> <span class="n">field</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_buf_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_tsport</span> <span class="o">*</span><span class="n">port</span><span class="p">,</span>
			      <span class="k">struct</span> <span class="n">cx23885_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_free_buffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">videobuf_queue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">cx23885_buffer</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx23885-video.c                                             */</span>
<span class="cm">/* Video */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_video_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_video_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_video_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">status</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_video_wakeup</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">cx23885_dmaqueue</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">u32</span> <span class="n">count</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx23885_enum_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_input</span> <span class="o">*</span><span class="n">i</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx23885_set_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx23885_get_input</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">i</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx23885_set_frequency</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_frequency</span> <span class="o">*</span><span class="n">f</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx23885_set_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_control</span> <span class="o">*</span><span class="n">ctl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx23885_get_control</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">v4l2_control</span> <span class="o">*</span><span class="n">ctl</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">cx23885_set_tvnorm</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">v4l2_std_id</span> <span class="n">norm</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx23885-vbi.c                                               */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_vbi_fmt</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">priv</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">v4l2_format</span> <span class="o">*</span><span class="n">f</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_vbi_timeout</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">data</span><span class="p">);</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">videobuf_queue_ops</span> <span class="n">cx23885_vbi_qops</span><span class="p">;</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_restart_vbi_queue</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
	<span class="k">struct</span> <span class="n">cx23885_dmaqueue</span> <span class="o">*</span><span class="n">q</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_vbi_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">status</span><span class="p">);</span>

<span class="cm">/* cx23885-i2c.c                                                */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_i2c_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_i2c_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_i2c</span> <span class="o">*</span><span class="n">bus</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_av_clk</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">int</span> <span class="n">enable</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx23885-417.c                                               */</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_417_register</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_417_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_irq_417</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">status</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_417_check_encoder</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_mc417_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mc417_memory_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">address</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mc417_memory_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">address</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mc417_register_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="n">u16</span> <span class="n">address</span><span class="p">,</span> <span class="n">u32</span> <span class="o">*</span><span class="n">value</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">mc417_register_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span>
				<span class="n">u16</span> <span class="n">address</span><span class="p">,</span> <span class="n">u32</span> <span class="n">value</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mc417_gpio_set</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mc417_gpio_clear</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">mc417_gpio_enable</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">,</span> <span class="kt">int</span> <span class="n">asoutput</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* cx23885-alsa.c                                             */</span>
<span class="k">extern</span> <span class="k">struct</span> <span class="n">cx23885_audio_dev</span> <span class="o">*</span><span class="n">cx23885_audio_register</span><span class="p">(</span>
					<span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">void</span> <span class="n">cx23885_audio_unregister</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_audio_irq</span><span class="p">(</span><span class="k">struct</span> <span class="n">cx23885_dev</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="n">u32</span> <span class="n">status</span><span class="p">,</span> <span class="n">u32</span> <span class="n">mask</span><span class="p">);</span>
<span class="k">extern</span> <span class="kt">int</span> <span class="n">cx23885_risc_databuffer</span><span class="p">(</span><span class="k">struct</span> <span class="n">pci_dev</span> <span class="o">*</span><span class="n">pci</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">btcx_riscmem</span> <span class="o">*</span><span class="n">risc</span><span class="p">,</span>
				   <span class="k">struct</span> <span class="n">scatterlist</span> <span class="o">*</span><span class="n">sglist</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">bpl</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lines</span><span class="p">,</span>
				   <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">lpi</span><span class="p">);</span>

<span class="cm">/* ----------------------------------------------------------- */</span>
<span class="cm">/* tv norms                                                    */</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">norm_maxw</span><span class="p">(</span><span class="n">v4l2_std_id</span> <span class="n">norm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">V4L2_STD_MN</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">V4L2_STD_PAL_Nc</span><span class="p">))</span> <span class="o">?</span> <span class="mi">720</span> <span class="o">:</span> <span class="mi">768</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">norm_maxh</span><span class="p">(</span><span class="n">v4l2_std_id</span> <span class="n">norm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&amp;</span> <span class="n">V4L2_STD_625_50</span><span class="p">)</span> <span class="o">?</span> <span class="mi">576</span> <span class="o">:</span> <span class="mi">480</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kr">inline</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="nf">norm_swidth</span><span class="p">(</span><span class="n">v4l2_std_id</span> <span class="n">norm</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">norm</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">V4L2_STD_MN</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">V4L2_STD_PAL_Nc</span><span class="p">))</span> <span class="o">?</span> <span class="mi">754</span> <span class="o">:</span> <span class="mi">922</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
