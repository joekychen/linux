<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › media › video › smiapp › smiapp.h

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>smiapp.h</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * drivers/media/video/smiapp/smiapp.h</span>
<span class="cm"> *</span>
<span class="cm"> * Generic driver for SMIA/SMIA++ compliant camera modules</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2010--2012 Nokia Corporation</span>
<span class="cm"> * Contact: Sakari Ailus &lt;sakari.ailus@maxwell.research.nokia.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This program is free software; you can redistribute it and/or</span>
<span class="cm"> * modify it under the terms of the GNU General Public License</span>
<span class="cm"> * version 2 as published by the Free Software Foundation.</span>
<span class="cm"> *</span>
<span class="cm"> * This program is distributed in the hope that it will be useful, but</span>
<span class="cm"> * WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="cm"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</span>
<span class="cm"> * General Public License for more details.</span>
<span class="cm"> *</span>
<span class="cm"> * You should have received a copy of the GNU General Public License</span>
<span class="cm"> * along with this program; if not, write to the Free Software</span>
<span class="cm"> * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA</span>
<span class="cm"> * 02110-1301 USA</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#ifndef __SMIAPP_PRIV_H_</span>
<span class="cp">#define __SMIAPP_PRIV_H_</span>

<span class="cp">#include &lt;linux/mutex.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-ctrls.h&gt;</span>
<span class="cp">#include &lt;media/v4l2-subdev.h&gt;</span>
<span class="cp">#include &lt;media/smiapp.h&gt;</span>

<span class="cp">#include &quot;smiapp-pll.h&quot;</span>
<span class="cp">#include &quot;smiapp-reg.h&quot;</span>
<span class="cp">#include &quot;smiapp-regs.h&quot;</span>
<span class="cp">#include &quot;smiapp-quirk.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * Standard SMIA++ constants</span>
<span class="cm"> */</span>
<span class="cp">#define SMIA_VERSION_1			10</span>
<span class="cp">#define SMIAPP_VERSION_0_8		8 </span><span class="cm">/* Draft 0.8 */</span><span class="cp"></span>
<span class="cp">#define SMIAPP_VERSION_0_9		9 </span><span class="cm">/* Draft 0.9 */</span><span class="cp"></span>
<span class="cp">#define SMIAPP_VERSION_1		10</span>

<span class="cp">#define SMIAPP_PROFILE_0		0</span>
<span class="cp">#define SMIAPP_PROFILE_1		1</span>
<span class="cp">#define SMIAPP_PROFILE_2		2</span>

<span class="cp">#define SMIAPP_NVM_PAGE_SIZE		64	</span><span class="cm">/* bytes */</span><span class="cp"></span>

<span class="cp">#define SMIAPP_RESET_DELAY_CLOCKS	2400</span>
<span class="cp">#define SMIAPP_RESET_DELAY(clk)				\</span>
<span class="cp">	(1000 +	(SMIAPP_RESET_DELAY_CLOCKS * 1000	\</span>
<span class="cp">		 + (clk) / 1000 - 1) / ((clk) / 1000))</span>

<span class="cp">#include &quot;smiapp-limits.h&quot;</span>

<span class="k">struct</span> <span class="n">smiapp_quirk</span><span class="p">;</span>

<span class="cp">#define SMIAPP_MODULE_IDENT_FLAG_REV_LE		(1 &lt;&lt; 0)</span>

<span class="k">struct</span> <span class="n">smiapp_module_ident</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">manufacturer_id</span><span class="p">;</span>
	<span class="n">u16</span> <span class="n">model_id</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">revision_number_major</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">flags</span><span class="p">;</span>

	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">smiapp_quirk</span> <span class="o">*</span><span class="n">quirk</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">smiapp_module_info</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">manufacturer_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">model_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">revision_number_major</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">revision_number_minor</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">module_year</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">module_month</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">module_day</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">sensor_manufacturer_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sensor_model_id</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sensor_revision_number</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">sensor_firmware_version</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">smia_version</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">smiapp_version</span><span class="p">;</span>

	<span class="n">u32</span> <span class="n">smiapp_profile</span><span class="p">;</span>

	<span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">smiapp_quirk</span> <span class="o">*</span><span class="n">quirk</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SMIAPP_IDENT_FQ(manufacturer, model, rev, fl, _name, _quirk)	\</span>
<span class="cp">	{ .manufacturer_id = manufacturer,				\</span>
<span class="cp">	  .model_id = model,						\</span>
<span class="cp">	  .revision_number_major = rev,					\</span>
<span class="cp">	  .flags = fl,							\</span>
<span class="cp">	  .name = _name,						\</span>
<span class="cp">	  .quirk = _quirk, }</span>

<span class="cp">#define SMIAPP_IDENT_LQ(manufacturer, model, rev, _name, _quirk)	\</span>
<span class="cp">	{ .manufacturer_id = manufacturer,				\</span>
<span class="cp">	  .model_id = model,						\</span>
<span class="cp">	  .revision_number_major = rev,					\</span>
<span class="cp">	  .flags = SMIAPP_MODULE_IDENT_FLAG_REV_LE,			\</span>
<span class="cp">	  .name = _name,						\</span>
<span class="cp">	  .quirk = _quirk, }</span>

<span class="cp">#define SMIAPP_IDENT_L(manufacturer, model, rev, _name)			\</span>
<span class="cp">	{ .manufacturer_id = manufacturer,				\</span>
<span class="cp">	  .model_id = model,						\</span>
<span class="cp">	  .revision_number_major = rev,					\</span>
<span class="cp">	  .flags = SMIAPP_MODULE_IDENT_FLAG_REV_LE,			\</span>
<span class="cp">	  .name = _name, }</span>

<span class="cp">#define SMIAPP_IDENT_Q(manufacturer, model, rev, _name, _quirk)		\</span>
<span class="cp">	{ .manufacturer_id = manufacturer,				\</span>
<span class="cp">	  .model_id = model,						\</span>
<span class="cp">	  .revision_number_major = rev,					\</span>
<span class="cp">	  .flags = 0,							\</span>
<span class="cp">	  .name = _name,						\</span>
<span class="cp">	  .quirk = _quirk, }</span>

<span class="cp">#define SMIAPP_IDENT(manufacturer, model, rev, _name)			\</span>
<span class="cp">	{ .manufacturer_id = manufacturer,				\</span>
<span class="cp">	  .model_id = model,						\</span>
<span class="cp">	  .revision_number_major = rev,					\</span>
<span class="cp">	  .flags = 0,							\</span>
<span class="cp">	  .name = _name, }</span>

<span class="k">struct</span> <span class="n">smiapp_reg_limits</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">addr</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">what</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">extern</span> <span class="k">struct</span> <span class="n">smiapp_reg_limits</span> <span class="n">smiapp_reg_limits</span><span class="p">[];</span>

<span class="k">struct</span> <span class="n">smiapp_csi_data_format</span> <span class="p">{</span>
	<span class="n">u32</span> <span class="n">code</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">width</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">compressed</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">pixel_order</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define SMIAPP_SUBDEVS			3</span>

<span class="cp">#define SMIAPP_PA_PAD_SRC		0</span>
<span class="cp">#define SMIAPP_PAD_SINK			0</span>
<span class="cp">#define SMIAPP_PAD_SRC			1</span>
<span class="cp">#define SMIAPP_PADS			2</span>

<span class="k">struct</span> <span class="n">smiapp_binning_subtype</span> <span class="p">{</span>
	<span class="n">u8</span> <span class="n">horizontal</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">vertical</span><span class="o">:</span><span class="mi">4</span><span class="p">;</span>
<span class="p">}</span> <span class="n">__packed</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">smiapp_subdev</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">v4l2_subdev</span> <span class="n">sd</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">media_pad</span> <span class="n">pads</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">v4l2_rect</span> <span class="n">sink_fmt</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_rect</span> <span class="n">crop</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
	<span class="k">struct</span> <span class="n">v4l2_rect</span> <span class="n">compose</span><span class="p">;</span> <span class="cm">/* compose on sink */</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">sink_pad</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">source_pad</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">npads</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">smiapp_sensor</span> <span class="o">*</span><span class="n">sensor</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl_handler</span> <span class="n">ctrl_handler</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/*</span>
<span class="cm"> * struct smiapp_sensor - Main device structure</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">smiapp_sensor</span> <span class="p">{</span>
	<span class="cm">/*</span>
<span class="cm">	 * &quot;mutex&quot; is used to serialise access to all fields here</span>
<span class="cm">	 * except v4l2_ctrls at the end of the struct. &quot;mutex&quot; is also</span>
<span class="cm">	 * used to serialise access to file handle specific</span>
<span class="cm">	 * information. The exception to this rule is the power_mutex</span>
<span class="cm">	 * below.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">mutex</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * power_mutex is used to serialise power management related</span>
<span class="cm">	 * activities. Acquiring &quot;mutex&quot; at that time isn&#39;t necessary</span>
<span class="cm">	 * since there are no other users anyway.</span>
<span class="cm">	 */</span>
	<span class="k">struct</span> <span class="n">mutex</span> <span class="n">power_mutex</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">smiapp_subdev</span> <span class="n">ssds</span><span class="p">[</span><span class="n">SMIAPP_SUBDEVS</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">ssds_used</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">smiapp_subdev</span> <span class="o">*</span><span class="n">src</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">smiapp_subdev</span> <span class="o">*</span><span class="n">binner</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">smiapp_subdev</span> <span class="o">*</span><span class="n">scaler</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">smiapp_subdev</span> <span class="o">*</span><span class="n">pixel_array</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">smiapp_platform_data</span> <span class="o">*</span><span class="n">platform_data</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">regulator</span> <span class="o">*</span><span class="n">vana</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">clk</span> <span class="o">*</span><span class="n">ext_clk</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">limits</span><span class="p">[</span><span class="n">SMIAPP_LIMIT_LAST</span><span class="p">];</span>
	<span class="n">u8</span> <span class="n">nbinning_subtypes</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">smiapp_binning_subtype</span> <span class="n">binning_subtypes</span><span class="p">[</span><span class="n">SMIAPP_BINNING_SUBTYPES</span><span class="p">];</span>
	<span class="n">u32</span> <span class="n">mbus_frame_fmts</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">smiapp_csi_data_format</span> <span class="o">*</span><span class="n">csi_format</span><span class="p">;</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">smiapp_csi_data_format</span> <span class="o">*</span><span class="n">internal_csi_format</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">default_mbus_frame_fmts</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">default_pixel_order</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">binning_horizontal</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">binning_vertical</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">scale_m</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">scaling_mode</span><span class="p">;</span>

	<span class="n">u8</span> <span class="n">hvflip_inv_mask</span><span class="p">;</span> <span class="cm">/* H/VFLIP inversion due to sensor orientation */</span>
	<span class="n">u8</span> <span class="n">flash_capability</span><span class="p">;</span>
	<span class="n">u8</span> <span class="n">frame_skip</span><span class="p">;</span>

	<span class="kt">int</span> <span class="n">power_count</span><span class="p">;</span>

	<span class="n">bool</span> <span class="n">streaming</span><span class="p">;</span>
	<span class="n">bool</span> <span class="n">dev_init_done</span><span class="p">;</span>

	<span class="n">u8</span> <span class="o">*</span><span class="n">nvm</span><span class="p">;</span>		<span class="cm">/* nvm memory buffer */</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">nvm_size</span><span class="p">;</span>	<span class="cm">/* bytes */</span>

	<span class="k">struct</span> <span class="n">smiapp_module_info</span> <span class="n">minfo</span><span class="p">;</span>

	<span class="k">struct</span> <span class="n">smiapp_pll</span> <span class="n">pll</span><span class="p">;</span>

	<span class="cm">/* Pixel array controls */</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">analog_gain</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">exposure</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">hflip</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">vflip</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">vblank</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">hblank</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">pixel_rate_parray</span><span class="p">;</span>
	<span class="cm">/* src controls */</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">link_freq</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">v4l2_ctrl</span> <span class="o">*</span><span class="n">pixel_rate_csi</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define to_smiapp_subdev(_sd)				\</span>
<span class="cp">	container_of(_sd, struct smiapp_subdev, sd)</span>

<span class="cp">#define to_smiapp_sensor(_sd)	\</span>
<span class="cp">	(to_smiapp_subdev(_sd)-&gt;sensor)</span>

<span class="cp">#endif </span><span class="cm">/* __SMIAPP_PRIV_H_ */</span><span class="cp"></span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
