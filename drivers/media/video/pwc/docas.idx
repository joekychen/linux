f | pwc-dec23.h | s | 2.0K | 46 | Hans de Goede | hdegoede@redhat.com | 1326720478 |  | [media] pwc: Use one shared usb command buffer  The pwc driver used to: 1. kmalloc a buffer 2. memcpy data to send over usb there 3. do the usb_control_msg call (which does not work with data on the stack) 4. free the buffer  For every usb command send. This patch changes the code to instead malloc a buffer for this purpose once and use it everywhere.  [mchehab@redhat.com: Fix a compilation breakage with allyesconfig:  drivers/media/video/pwc/pwc-ctrl.c: In function ‘pwc_get_cmos_sensor’:  drivers/media/video/pwc/pwc-ctrl.c:546:3: warning: passing argument 4 of ‘recv_control_msg’ makes integer from pointer without a cast [en$  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: expected ‘int’ but argument is of type ‘unsigned char *’  drivers/media/video/pwc/pwc-ctrl.c:546:3: error: too many arguments to function ‘recv_control_msg’  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: declared here]  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | Makefile | g | 161B |  | Trent Piepho | xyzzy@speakeasy.org | 1172072111 |  | V4L/DVB (5166): Remove obsolete alias defines of CONFIG_* settings  The out of tree v4l-dvb build system didn't always override the kernel's configuration settings with v4l-dvb's settings correctly.  To work around this, makefiles would define some new macro based on the setting of a config variable.  e.g. the pwc Makefile would define CONFIG_PWC_DEBUG if CONFIG_USB_PWC_DEBUG (which is defined via Kconfig) was set. The v4l-dvb build system should now always override correctly, and this is no longer necessary.  This patch gets ride of these extra defines and just uses the CONFIG_* settings directly.  Signed-off-by: Trent Piepho <xyzzy@speakeasy.org> Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>
f | pwc-timon.h | s | 2.4K | 46 | Hans de Goede | hdegoede@redhat.com | 1325853965 |  | [media] pwc: Remove driver specific ioctls  This stems from the v4l1 era, with v4l2 everything can be done with standardized v4l2 API calls.  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-kiara.c | s | 34K | 876 | Hans de Goede | hdegoede@redhat.com | 1311800137 |  | [media] pwc: clean-up header files  Remove unused pwc-ioctl.h (the copy in include/media is used everywhere) Remove almost empty pwc-uncompress.h, move single define to pwc.h  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-dec1.c | s | 1.3K | 26 | Hans de Goede | hdegoede@redhat.com | 1326720478 |  | [media] pwc: Use one shared usb command buffer  The pwc driver used to: 1. kmalloc a buffer 2. memcpy data to send over usb there 3. do the usb_control_msg call (which does not work with data on the stack) 4. free the buffer  For every usb command send. This patch changes the code to instead malloc a buffer for this purpose once and use it everywhere.  [mchehab@redhat.com: Fix a compilation breakage with allyesconfig:  drivers/media/video/pwc/pwc-ctrl.c: In function ‘pwc_get_cmos_sensor’:  drivers/media/video/pwc/pwc-ctrl.c:546:3: warning: passing argument 4 of ‘recv_control_msg’ makes integer from pointer without a cast [en$  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: expected ‘int’ but argument is of type ‘unsigned char *’  drivers/media/video/pwc/pwc-ctrl.c:546:3: error: too many arguments to function ‘recv_control_msg’  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: declared here]  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-dec23.c | s | 18K | 597 | Hans de Goede | hdegoede@redhat.com | 1326720478 |  | [media] pwc: Use one shared usb command buffer  The pwc driver used to: 1. kmalloc a buffer 2. memcpy data to send over usb there 3. do the usb_control_msg call (which does not work with data on the stack) 4. free the buffer  For every usb command send. This patch changes the code to instead malloc a buffer for this purpose once and use it everywhere.  [mchehab@redhat.com: Fix a compilation breakage with allyesconfig:  drivers/media/video/pwc/pwc-ctrl.c: In function ‘pwc_get_cmos_sensor’:  drivers/media/video/pwc/pwc-ctrl.c:546:3: warning: passing argument 4 of ‘recv_control_msg’ makes integer from pointer without a cast [en$  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: expected ‘int’ but argument is of type ‘unsigned char *’  drivers/media/video/pwc/pwc-ctrl.c:546:3: error: too many arguments to function ‘recv_control_msg’  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: declared here]  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-misc.c | s | 2.8K | 75 | Hans de Goede | hdegoede@redhat.com | 1326719306 |  | [media] pwc: Fix pixfmt handling  Before this patch various code in the mode setting patch checked pdev->pixfmt, but that was not set until the mode setting succeeded, so it was looking at the old pixfmt! This patch fixes this by making the pixfmt a parameter to set_video_mode, and setting it from set_video_mode on success.  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-kiara.h | s | 1.7K | 35 | Hans de Goede | hdegoede@redhat.com | 1325853965 |  | [media] pwc: Remove driver specific ioctls  This stems from the v4l1 era, with v4l2 everything can be done with standardized v4l2 API calls.  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-v4l.c | s | 31K | 1004 | Hans de Goede | hdegoede@redhat.com | 1336998119 |  | [media] pwc: Fix locking  My last locking rework for pwc mistakenly assumed that videbuf2 does its own locking, but it does not! This patch fixes the missing locking by moving over the the video_device lock, and introducing a separate lock for the videobuf2_queue.  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-uncompress.c | s | 3.1K | 89 | Hans de Goede | hdegoede@redhat.com | 1325854006 |  | [media] pwc: Remove software emulation of arbritary resolutions  The pwc driver claims to support any resolution between 160x120 and 640x480, but emulates this by simply drawing a black border around the image. Userspace can draw its own black border if it really wants one.  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc.h | s | 13K | 337 | Hans de Goede | hdegoede@redhat.com | 1336998119 |  | [media] pwc: Fix locking  My last locking rework for pwc mistakenly assumed that videbuf2 does its own locking, but it does not! This patch fixes the missing locking by moving over the the video_device lock, and introducing a separate lock for the videobuf2_queue.  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | philips.txt | g | 9.4K |  | Daniel Mack | daniel@caiaq.de | 1265710436 |  | tree-wide: Assorted spelling fixes  In particular, several occurances of funny versions of 'success', 'unknown', 'therefore', 'acknowledge', 'argument', 'achieve', 'address', 'beginning', 'desirable', 'separate' and 'necessary' are fixed.  Signed-off-by: Daniel Mack <daniel@caiaq.de> Cc: Joe Perches <joe@perches.com> Cc: Junio C Hamano <gitster@pobox.com> Signed-off-by: Jiri Kosina <jkosina@suse.cz>
f | pwc-if.c | s | 36K | 1139 | Hans Verkuil | hans.verkuil@cisco.com | 1337018810 |  | [media] v4l2-dev: rename two functions  Rename the function v4l2_dont_use_lock to v4l2_disable_ioctl_locking, and rename v4l2_dont_use_cmd to v4l2_disable_ioctl.  Signed-off-by: Hans Verkuil <hans.verkuil@cisco.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-dec1.h | s | 1.3K | 29 | Hans de Goede | hdegoede@redhat.com | 1326720478 |  | [media] pwc: Use one shared usb command buffer  The pwc driver used to: 1. kmalloc a buffer 2. memcpy data to send over usb there 3. do the usb_control_msg call (which does not work with data on the stack) 4. free the buffer  For every usb command send. This patch changes the code to instead malloc a buffer for this purpose once and use it everywhere.  [mchehab@redhat.com: Fix a compilation breakage with allyesconfig:  drivers/media/video/pwc/pwc-ctrl.c: In function ‘pwc_get_cmos_sensor’:  drivers/media/video/pwc/pwc-ctrl.c:546:3: warning: passing argument 4 of ‘recv_control_msg’ makes integer from pointer without a cast [en$  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: expected ‘int’ but argument is of type ‘unsigned char *’  drivers/media/video/pwc/pwc-ctrl.c:546:3: error: too many arguments to function ‘recv_control_msg’  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: declared here]  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | Kconfig | g | 1.5K |  | Hans de Goede | hdegoede@redhat.com | 1311800023 |  | [media] pwc: Replace private buffer management code with videobuf2  Looking at the pwc buffer management code has made it clear to me it needed some serious fixing. Not only was there a ton of code duplication even internally to pwc (read and mmap wait for frame code was duplicated), the code also was outright buggy. With the worst offender being dqbuf, which just round robin returned all the mmap buffers, without paying any attention to them being queued by the app with qbuf or not. And qbuf itself was a noop.  So I set out to fix this and already had some cleanups in place when I read Jonathan Corbet's lwn article on videobuf2, this inspired me to just rip out the buffer management code and replace it with videobuf2, greatly reducing the amount of code, and fixing all bugs in one go:  Many thanks to Jonathan for the timely article on this !  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-timon.c | s | 66K | 1435 | Luc Saillard | luc@saillard.org | 1177699550 |  | V4L/DVB (5547): Add ENUM_FRAMESIZES and ENUM_FRAMEINTERVALS ioctls  This patch add support for the VIDIOC_ENUM_FRAMESIZES and VIDIOC_ENUM_FRAMEINTERVALS ioctl. * check if the maximum native framesize for raw mode is correct * raw mode framerates for all three chipset types  Signed-off-by: Gregor Jasny <gjasny@web.de> Signed-off-by: Luc Saillard <luc@saillard.org> Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>
f | pwc-ctrl.c | s | 14K | 460 | Hans de Goede | hdegoede@redhat.com | 1326720478 |  | [media] pwc: Use one shared usb command buffer  The pwc driver used to: 1. kmalloc a buffer 2. memcpy data to send over usb there 3. do the usb_control_msg call (which does not work with data on the stack) 4. free the buffer  For every usb command send. This patch changes the code to instead malloc a buffer for this purpose once and use it everywhere.  [mchehab@redhat.com: Fix a compilation breakage with allyesconfig:  drivers/media/video/pwc/pwc-ctrl.c: In function ‘pwc_get_cmos_sensor’:  drivers/media/video/pwc/pwc-ctrl.c:546:3: warning: passing argument 4 of ‘recv_control_msg’ makes integer from pointer without a cast [en$  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: expected ‘int’ but argument is of type ‘unsigned char *’  drivers/media/video/pwc/pwc-ctrl.c:546:3: error: too many arguments to function ‘recv_control_msg’  drivers/media/video/pwc/pwc-ctrl.c:107:12: note: declared here]  Signed-off-by: Hans de Goede <hdegoede@redhat.com> Signed-off-by: Mauro Carvalho Chehab <mchehab@redhat.com>
f | pwc-nala.h | s | 1.2K | 66 | Mauro Carvalho Chehab | mchehab@infradead.org | 1143289763 |  | V4L/DVB (3599b): Whitespace cleanups under drivers/media  Signed-off-by: Mauro Carvalho Chehab <mchehab@infradead.org>
