<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › hid › hid-lg.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>hid-lg.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  HID driver for some logitech &quot;special&quot; devices</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 1999 Andreas Gal</span>
<span class="cm"> *  Copyright (c) 2000-2005 Vojtech Pavlik &lt;vojtech@suse.cz&gt;</span>
<span class="cm"> *  Copyright (c) 2005 Michael Haboustak &lt;mike-@cinci.rr.com&gt; for Concept2, Inc</span>
<span class="cm"> *  Copyright (c) 2006-2007 Jiri Kosina</span>
<span class="cm"> *  Copyright (c) 2007 Paul Walmsley</span>
<span class="cm"> *  Copyright (c) 2008 Jiri Slaby</span>
<span class="cm"> *  Copyright (c) 2010 Hendrik Iben</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms of the GNU General Public License as published by the Free</span>
<span class="cm"> * Software Foundation; either version 2 of the License, or (at your option)</span>
<span class="cm"> * any later version.</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/device.h&gt;</span>
<span class="cp">#include &lt;linux/hid.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/random.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/wait.h&gt;</span>

<span class="cp">#include &quot;hid-ids.h&quot;</span>
<span class="cp">#include &quot;hid-lg.h&quot;</span>

<span class="cp">#define LG_RDESC		0x001</span>
<span class="cp">#define LG_BAD_RELATIVE_KEYS	0x002</span>
<span class="cp">#define LG_DUPLICATE_USAGES	0x004</span>
<span class="cp">#define LG_EXPANDED_KEYMAP	0x010</span>
<span class="cp">#define LG_IGNORE_DOUBLED_WHEEL	0x020</span>
<span class="cp">#define LG_WIRELESS		0x040</span>
<span class="cp">#define LG_INVERT_HWHEEL	0x080</span>
<span class="cp">#define LG_NOGET		0x100</span>
<span class="cp">#define LG_FF			0x200</span>
<span class="cp">#define LG_FF2			0x400</span>
<span class="cp">#define LG_RDESC_REL_ABS	0x800</span>
<span class="cp">#define LG_FF3			0x1000</span>
<span class="cp">#define LG_FF4			0x2000</span>

<span class="cm">/* Size of the original descriptor of the Driving Force Pro wheel */</span>
<span class="cp">#define DFP_RDESC_ORIG_SIZE	97</span>

<span class="cm">/* Fixed report descriptor for Logitech Driving Force Pro wheel controller</span>
<span class="cm"> *</span>
<span class="cm"> * The original descriptor hides the separate throttle and brake axes in</span>
<span class="cm"> * a custom vendor usage page, providing only a combined value as</span>
<span class="cm"> * GenericDesktop.Y.</span>
<span class="cm"> * This descriptor removes the combined Y axis and instead reports</span>
<span class="cm"> * separate throttle (Y) and brake (RZ).</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">__u8</span> <span class="n">dfp_rdesc_fixed</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
<span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*  Usage Page (Desktop),                   */</span>
<span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>         <span class="cm">/*  Usage (Joystik),                        */</span>
<span class="mh">0xA1</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*  Collection (Application),               */</span>
<span class="mh">0xA1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>         <span class="cm">/*      Collection (Logical),               */</span>
<span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Report Count (1),               */</span>
<span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span>         <span class="cm">/*          Report Size (14),               */</span>
<span class="mh">0x14</span><span class="p">,</span>               <span class="cm">/*          Logical Minimum (0),            */</span>
<span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span>   <span class="cm">/*          Logical Maximum (16383),        */</span>
<span class="mh">0x34</span><span class="p">,</span>               <span class="cm">/*          Physical Minimum (0),           */</span>
<span class="mh">0x46</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x3F</span><span class="p">,</span>   <span class="cm">/*          Physical Maximum (16383),       */</span>
<span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x30</span><span class="p">,</span>         <span class="cm">/*          Usage (X),                      */</span>
<span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>         <span class="cm">/*          Input (Variable),               */</span>
<span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span>         <span class="cm">/*          Report Count (14),              */</span>
<span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Report Size (1),                */</span>
<span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Logical Maximum (1),            */</span>
<span class="mh">0x45</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Physical Maximum (1),           */</span>
<span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span>         <span class="cm">/*          Usage Page (Button),            */</span>
<span class="mh">0x19</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Usage Minimum (01h),            */</span>
<span class="mh">0x29</span><span class="p">,</span> <span class="mh">0x0E</span><span class="p">,</span>         <span class="cm">/*          Usage Maximum (0Eh),            */</span>
<span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>         <span class="cm">/*          Input (Variable),               */</span>
<span class="mh">0x05</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Usage Page (Desktop),           */</span>
<span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Report Count (1),               */</span>
<span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span>         <span class="cm">/*          Report Size (4),                */</span>
<span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span>         <span class="cm">/*          Logical Maximum (7),            */</span>
<span class="mh">0x46</span><span class="p">,</span> <span class="mh">0x3B</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>   <span class="cm">/*          Physical Maximum (315),         */</span>
<span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span>         <span class="cm">/*          Unit (Degrees),                 */</span>
<span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span>         <span class="cm">/*          Usage (Hat Switch),             */</span>
<span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x42</span><span class="p">,</span>         <span class="cm">/*          Input (Variable, Nullstate),    */</span>
<span class="mh">0x65</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>         <span class="cm">/*          Unit,                           */</span>
<span class="mh">0x26</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>   <span class="cm">/*          Logical Maximum (255),          */</span>
<span class="mh">0x46</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span>   <span class="cm">/*          Physical Maximum (255),         */</span>
<span class="mh">0x75</span><span class="p">,</span> <span class="mh">0x08</span><span class="p">,</span>         <span class="cm">/*          Report Size (8),                */</span>
<span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Input (Constant),               */</span>
<span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x31</span><span class="p">,</span>         <span class="cm">/*          Usage (Y),                      */</span>
<span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>         <span class="cm">/*          Input (Variable),               */</span>
<span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span>         <span class="cm">/*          Usage (Rz),                     */</span>
<span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>         <span class="cm">/*          Input (Variable),               */</span>
<span class="mh">0x81</span><span class="p">,</span> <span class="mh">0x01</span><span class="p">,</span>         <span class="cm">/*          Input (Constant),               */</span>
<span class="mh">0xC0</span><span class="p">,</span>               <span class="cm">/*      End Collection,                     */</span>
<span class="mh">0xA1</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>         <span class="cm">/*      Collection (Logical),               */</span>
<span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>         <span class="cm">/*          Usage (02h),                    */</span>
<span class="mh">0x95</span><span class="p">,</span> <span class="mh">0x07</span><span class="p">,</span>         <span class="cm">/*          Report Count (7),               */</span>
<span class="mh">0x91</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>         <span class="cm">/*          Output (Variable),              */</span>
<span class="mh">0xC0</span><span class="p">,</span>               <span class="cm">/*      End Collection,                     */</span>
<span class="mh">0xC0</span>                <span class="cm">/*  End Collection                          */</span>
<span class="p">};</span>


<span class="cm">/*</span>
<span class="cm"> * Certain Logitech keyboards send in report #3 keys which are far</span>
<span class="cm"> * above the logical maximum described in descriptor. This extends</span>
<span class="cm"> * the original value of 0x28c of logical maximum to 0x104d</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="n">__u8</span> <span class="o">*</span><span class="nf">lg_report_fixup</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">rdesc</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">int</span> <span class="o">*</span><span class="n">rsize</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="n">drv_data</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="p">)</span><span class="n">hid_get_drvdata</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_RDESC</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">rsize</span> <span class="o">&gt;=</span> <span class="mi">90</span> <span class="o">&amp;&amp;</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">83</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x26</span> <span class="o">&amp;&amp;</span>
			<span class="n">rdesc</span><span class="p">[</span><span class="mi">84</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x8c</span> <span class="o">&amp;&amp;</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">85</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x02</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_info</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span>
			 <span class="s">&quot;fixing up Logitech keyboard report descriptor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rdesc</span><span class="p">[</span><span class="mi">84</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">89</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x4d</span><span class="p">;</span>
		<span class="n">rdesc</span><span class="p">[</span><span class="mi">85</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">90</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_RDESC_REL_ABS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">rsize</span> <span class="o">&gt;=</span> <span class="mi">50</span> <span class="o">&amp;&amp;</span>
			<span class="n">rdesc</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x81</span> <span class="o">&amp;&amp;</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x06</span> <span class="o">&amp;&amp;</span>
			<span class="n">rdesc</span><span class="p">[</span><span class="mi">49</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x81</span> <span class="o">&amp;&amp;</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x06</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_info</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span>
			 <span class="s">&quot;fixing up rel/abs in Logitech report descriptor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rdesc</span><span class="p">[</span><span class="mi">33</span><span class="p">]</span> <span class="o">=</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x02</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_FF4</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">rsize</span> <span class="o">&gt;=</span> <span class="mi">101</span> <span class="o">&amp;&amp;</span>
			<span class="n">rdesc</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x95</span> <span class="o">&amp;&amp;</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">42</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x0B</span> <span class="o">&amp;&amp;</span>
			<span class="n">rdesc</span><span class="p">[</span><span class="mi">47</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x05</span> <span class="o">&amp;&amp;</span> <span class="n">rdesc</span><span class="p">[</span><span class="mi">48</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0x09</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_info</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="s">&quot;fixing up Logitech Speed Force Wireless button descriptor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">rdesc</span><span class="p">[</span><span class="mi">41</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x05</span><span class="p">;</span>
		<span class="n">rdesc</span><span class="p">[</span><span class="mi">42</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x09</span><span class="p">;</span>
		<span class="n">rdesc</span><span class="p">[</span><span class="mi">47</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x95</span><span class="p">;</span>
		<span class="n">rdesc</span><span class="p">[</span><span class="mi">48</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0x0B</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">USB_DEVICE_ID_LOGITECH_DFP_WHEEL</span>:
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">rsize</span> <span class="o">==</span> <span class="n">DFP_RDESC_ORIG_SIZE</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_info</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span>
				<span class="s">&quot;fixing up Logitech Driving Force Pro report descriptor</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="n">rdesc</span> <span class="o">=</span> <span class="n">dfp_rdesc_fixed</span><span class="p">;</span>
			<span class="o">*</span><span class="n">rsize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dfp_rdesc_fixed</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">rdesc</span><span class="p">;</span>
<span class="p">}</span>

<span class="cp">#define lg_map_key_clear(c)	hid_map_usage_clear(hi, usage, bit, max, \</span>
<span class="cp">		EV_KEY, (c))</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lg_ultrax_remote_mapping</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hi</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">usage</span><span class="o">-&gt;</span><span class="n">hid</span> <span class="o">&amp;</span> <span class="n">HID_USAGE_PAGE</span><span class="p">)</span> <span class="o">!=</span> <span class="n">HID_UP_LOGIVENDOR</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">set_bit</span><span class="p">(</span><span class="n">EV_REP</span><span class="p">,</span> <span class="n">hi</span><span class="o">-&gt;</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">evbit</span><span class="p">);</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">usage</span><span class="o">-&gt;</span><span class="n">hid</span> <span class="o">&amp;</span> <span class="n">HID_USAGE</span><span class="p">)</span> <span class="p">{</span>
	<span class="cm">/* Reported on Logitech Ultra X Media Remote */</span>
	<span class="k">case</span> <span class="mh">0x004</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_AGAIN</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x00d</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_HOME</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x024</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_SHUFFLE</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x025</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_TV</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x026</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_MENU</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x031</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_AUDIO</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x032</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_TEXT</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x033</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_LAST</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x047</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_MP3</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x048</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_DVD</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x049</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_MEDIA</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x04a</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_VIDEO</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x04b</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_ANGLE</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x04c</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_LANGUAGE</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x04d</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_SUBTITLE</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x051</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_RED</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x052</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_CLOSE</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lg_dinovo_mapping</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hi</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">usage</span><span class="o">-&gt;</span><span class="n">hid</span> <span class="o">&amp;</span> <span class="n">HID_USAGE_PAGE</span><span class="p">)</span> <span class="o">!=</span> <span class="n">HID_UP_LOGIVENDOR</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">usage</span><span class="o">-&gt;</span><span class="n">hid</span> <span class="o">&amp;</span> <span class="n">HID_USAGE</span><span class="p">)</span> <span class="p">{</span>

	<span class="k">case</span> <span class="mh">0x00d</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_MEDIA</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lg_wireless_mapping</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hi</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">usage</span><span class="o">-&gt;</span><span class="n">hid</span> <span class="o">&amp;</span> <span class="n">HID_USAGE_PAGE</span><span class="p">)</span> <span class="o">!=</span> <span class="n">HID_UP_CONSUMER</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">usage</span><span class="o">-&gt;</span><span class="n">hid</span> <span class="o">&amp;</span> <span class="n">HID_USAGE</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x1001</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_MESSENGER</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1003</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_SOUND</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1004</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_VIDEO</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1005</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_AUDIO</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x100a</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_DOCUMENTS</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="cm">/* The following two entries are Playlist 1 and 2 on the MX3200 */</span>
	<span class="k">case</span> <span class="mh">0x100f</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_FN_1</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1010</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_FN_2</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1011</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PREVIOUSSONG</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1012</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_NEXTSONG</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1013</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_CAMERA</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1014</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_MESSENGER</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1015</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_RECORD</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1016</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PLAYER</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1017</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_EJECTCD</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1018</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_MEDIA</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1019</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PROG1</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x101a</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PROG2</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x101b</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PROG3</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x101c</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_CYCLEWINDOWS</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x101f</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_ZOOMIN</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1020</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_ZOOMOUT</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1021</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_ZOOMRESET</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1023</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_CLOSE</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1027</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_MENU</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="cm">/* this one is marked as &#39;Rotate&#39; */</span>
	<span class="k">case</span> <span class="mh">0x1028</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_ANGLE</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1029</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_SHUFFLE</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x102a</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_BACK</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x102b</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_CYCLEWINDOWS</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x102d</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_WWW</span><span class="p">);</span>			<span class="k">break</span><span class="p">;</span>
	<span class="cm">/* The following two are &#39;Start/answer call&#39; and &#39;End/reject call&#39;</span>
<span class="cm">	   on the MX3200 */</span>
	<span class="k">case</span> <span class="mh">0x1031</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_OK</span><span class="p">);</span>			<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1032</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_CANCEL</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1041</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_BATTERY</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1042</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_WORDPROCESSOR</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1043</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_SPREADSHEET</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1044</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PRESENTATION</span><span class="p">);</span>	<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1045</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_UNDO</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1046</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_REDO</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1047</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PRINT</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1048</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_SAVE</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x1049</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PROG1</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x104a</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PROG2</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x104b</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PROG3</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="mh">0x104c</span>: <span class="n">lg_map_key_clear</span><span class="p">(</span><span class="n">KEY_PROG4</span><span class="p">);</span>		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lg_input_mapping</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hi</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* extended mapping for certain Logitech hardware (Logitech cordless</span>
<span class="cm">	   desktop LX500) */</span>
	<span class="k">static</span> <span class="k">const</span> <span class="n">u8</span> <span class="n">e_keymap</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		  <span class="mi">0</span><span class="p">,</span><span class="mi">216</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">213</span><span class="p">,</span><span class="mi">175</span><span class="p">,</span><span class="mi">156</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>
		<span class="mi">144</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">212</span><span class="p">,</span>
		<span class="mi">174</span><span class="p">,</span><span class="mi">167</span><span class="p">,</span><span class="mi">152</span><span class="p">,</span><span class="mi">161</span><span class="p">,</span><span class="mi">112</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">154</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>
		  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>
		  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>
		  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>
		  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span><span class="mi">183</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span><span class="mi">185</span><span class="p">,</span><span class="mi">186</span><span class="p">,</span><span class="mi">187</span><span class="p">,</span>
		<span class="mi">188</span><span class="p">,</span><span class="mi">189</span><span class="p">,</span><span class="mi">190</span><span class="p">,</span><span class="mi">191</span><span class="p">,</span><span class="mi">192</span><span class="p">,</span><span class="mi">193</span><span class="p">,</span><span class="mi">194</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span>
	<span class="p">};</span>
	<span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="n">drv_data</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="p">)</span><span class="n">hid_get_drvdata</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">hid</span> <span class="o">=</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">hid</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">==</span> <span class="n">USB_DEVICE_ID_LOGITECH_RECEIVER</span> <span class="o">&amp;&amp;</span>
			<span class="n">lg_ultrax_remote_mapping</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">max</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">==</span> <span class="n">USB_DEVICE_ID_DINOVO_MINI</span> <span class="o">&amp;&amp;</span>
			<span class="n">lg_dinovo_mapping</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">max</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_WIRELESS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">lg_wireless_mapping</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">max</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">hid</span> <span class="o">&amp;</span> <span class="n">HID_USAGE_PAGE</span><span class="p">)</span> <span class="o">!=</span> <span class="n">HID_UP_BUTTON</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">hid</span> <span class="o">&amp;=</span> <span class="n">HID_USAGE</span><span class="p">;</span>

	<span class="cm">/* Special handling for Logitech Cordless Desktop */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">application</span> <span class="o">==</span> <span class="n">HID_GD_MOUSE</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_IGNORE_DOUBLED_WHEEL</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				<span class="p">(</span><span class="n">hid</span> <span class="o">==</span> <span class="mi">7</span> <span class="o">||</span> <span class="n">hid</span> <span class="o">==</span> <span class="mi">8</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_EXPANDED_KEYMAP</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				<span class="n">hid</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">e_keymap</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				<span class="n">e_keymap</span><span class="p">[</span><span class="n">hid</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_map_usage</span><span class="p">(</span><span class="n">hi</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">max</span><span class="p">,</span> <span class="n">EV_KEY</span><span class="p">,</span>
					<span class="n">e_keymap</span><span class="p">[</span><span class="n">hid</span><span class="p">]);</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lg_input_mapped</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hi</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span>
		<span class="kt">unsigned</span> <span class="kt">long</span> <span class="o">**</span><span class="n">bit</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">max</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="n">drv_data</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="p">)</span><span class="n">hid_get_drvdata</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_BAD_RELATIVE_KEYS</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_KEY</span> <span class="o">&amp;&amp;</span>
			<span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HID_MAIN_ITEM_RELATIVE</span><span class="p">))</span>
		<span class="n">field</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HID_MAIN_ITEM_RELATIVE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_DUPLICATE_USAGES</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">usage</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_KEY</span> <span class="o">||</span>
			 <span class="n">usage</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_REL</span> <span class="o">||</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">EV_ABS</span><span class="p">))</span>
		<span class="n">clear_bit</span><span class="p">(</span><span class="n">usage</span><span class="o">-&gt;</span><span class="n">code</span><span class="p">,</span> <span class="o">*</span><span class="n">bit</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lg_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="n">drv_data</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="p">)</span><span class="n">hid_get_drvdata</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_INVERT_HWHEEL</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">code</span> <span class="o">==</span> <span class="n">REL_HWHEEL</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">input_event</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">hidinput</span><span class="o">-&gt;</span><span class="n">input</span><span class="p">,</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">,</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">code</span><span class="p">,</span>
				<span class="o">-</span><span class="n">value</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">lg_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">connect_mask</span> <span class="o">=</span> <span class="n">HID_CONNECT_DEFAULT</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="n">drv_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">drv_data</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">lg_drv_data</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">drv_data</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="s">&quot;Insufficient memory, cannot allocate driver data</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">=</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">driver_data</span><span class="p">;</span>
	
	<span class="n">hid_set_drvdata</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">drv_data</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_NOGET</span><span class="p">)</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">|=</span> <span class="n">HID_QUIRK_NOGET</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_parse</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="s">&quot;parse failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err_free</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">LG_FF</span> <span class="o">|</span> <span class="n">LG_FF2</span> <span class="o">|</span> <span class="n">LG_FF3</span> <span class="o">|</span> <span class="n">LG_FF4</span><span class="p">))</span>
		<span class="n">connect_mask</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HID_CONNECT_FF</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_hw_start</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">connect_mask</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="s">&quot;hw start failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err_free</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Setup wireless link with Logitech Wii wheel */</span>
	<span class="k">if</span><span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">==</span> <span class="n">USB_DEVICE_ID_LOGITECH_WII_WHEEL</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">buf</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0xAF</span><span class="p">,</span>  <span class="mh">0x01</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mh">0x00</span> <span class="p">};</span>

		<span class="n">ret</span> <span class="o">=</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">hid_output_raw_report</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">HID_FEATURE_REPORT</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/* insert a little delay of 10 jiffies ~ 40ms */</span>
			<span class="n">wait_queue_head_t</span> <span class="n">wait</span><span class="p">;</span>
			<span class="n">init_waitqueue_head</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">wait</span><span class="p">);</span>
			<span class="n">wait_event_interruptible_timeout</span><span class="p">(</span><span class="n">wait</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

			<span class="cm">/* Select random Address */</span>
			<span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xB2</span><span class="p">;</span>
			<span class="n">get_random_bytes</span><span class="p">(</span><span class="o">&amp;</span><span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">2</span><span class="p">);</span>

			<span class="n">ret</span> <span class="o">=</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">hid_output_raw_report</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">buf</span><span class="p">),</span> <span class="n">HID_FEATURE_REPORT</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_FF</span><span class="p">)</span>
		<span class="n">lgff_init</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_FF2</span><span class="p">)</span>
		<span class="n">lg2ff_init</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_FF3</span><span class="p">)</span>
		<span class="n">lg3ff_init</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_FF4</span><span class="p">)</span>
		<span class="n">lg4ff_init</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">err_free:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">drv_data</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">lg_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="n">drv_data</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">lg_drv_data</span> <span class="o">*</span><span class="p">)</span><span class="n">hid_get_drvdata</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">drv_data</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">LG_FF4</span><span class="p">)</span>
		<span class="n">lg4ff_deinit</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>

	<span class="n">hid_hw_stop</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">drv_data</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="n">lg_devices</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MX3000_RECEIVER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_RDESC</span> <span class="o">|</span> <span class="n">LG_WIRELESS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_S510_RECEIVER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_RDESC</span> <span class="o">|</span> <span class="n">LG_WIRELESS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_S510_RECEIVER_2</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_RDESC</span> <span class="o">|</span> <span class="n">LG_WIRELESS</span> <span class="p">},</span>

	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RECEIVER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_BAD_RELATIVE_KEYS</span> <span class="p">},</span>

	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DINOVO_DESKTOP</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_DUPLICATE_USAGES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DINOVO_EDGE</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_DUPLICATE_USAGES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DINOVO_MINI</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_DUPLICATE_USAGES</span> <span class="p">},</span>

	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_ELITE_KBD</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_IGNORE_DOUBLED_WHEEL</span> <span class="o">|</span> <span class="n">LG_EXPANDED_KEYMAP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_CORDLESS_DESKTOP_LX500</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_IGNORE_DOUBLED_WHEEL</span> <span class="o">|</span> <span class="n">LG_EXPANDED_KEYMAP</span> <span class="p">},</span>

	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_EXTREME_3D</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_NOGET</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_WHEEL</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_NOGET</span> <span class="o">|</span> <span class="n">LG_FF4</span> <span class="p">},</span>

	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RUMBLEPAD_CORD</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RUMBLEPAD</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RUMBLEPAD2_2</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_WINGMAN_F3D</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_FORCE3D_PRO</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_MOMO_WHEEL</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_MOMO_WHEEL2</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_G25_WHEEL</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_DFGT_WHEEL</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_G27_WHEEL</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_DFP_WHEEL</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_NOGET</span> <span class="o">|</span> <span class="n">LG_FF4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_WII_WHEEL</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF4</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_WINGMAN_FFG</span> <span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RUMBLEPAD2</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF2</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_FLIGHT_SYSTEM_G940</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_FF3</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SPACENAVIGATOR</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_RDESC_REL_ABS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SPACETRAVELLER</span><span class="p">),</span>
		<span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">LG_RDESC_REL_ABS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">lg_devices</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">hid_driver</span> <span class="n">lg_driver</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;logitech&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">id_table</span> <span class="o">=</span> <span class="n">lg_devices</span><span class="p">,</span>
	<span class="p">.</span><span class="n">report_fixup</span> <span class="o">=</span> <span class="n">lg_report_fixup</span><span class="p">,</span>
	<span class="p">.</span><span class="n">input_mapping</span> <span class="o">=</span> <span class="n">lg_input_mapping</span><span class="p">,</span>
	<span class="p">.</span><span class="n">input_mapped</span> <span class="o">=</span> <span class="n">lg_input_mapped</span><span class="p">,</span>
	<span class="p">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">lg_event</span><span class="p">,</span>
	<span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">lg_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">lg_remove</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">lg_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">hid_register_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lg_driver</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">lg_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hid_unregister_driver</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lg_driver</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">lg_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">lg_exit</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
