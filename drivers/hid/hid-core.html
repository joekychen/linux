<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › hid › hid-core.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>hid-core.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> *  HID support for Linux</span>
<span class="cm"> *</span>
<span class="cm"> *  Copyright (c) 1999 Andreas Gal</span>
<span class="cm"> *  Copyright (c) 2000-2005 Vojtech Pavlik &lt;vojtech@suse.cz&gt;</span>
<span class="cm"> *  Copyright (c) 2005 Michael Haboustak &lt;mike-@cinci.rr.com&gt; for Concept2, Inc</span>
<span class="cm"> *  Copyright (c) 2006-2012 Jiri Kosina</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * This program is free software; you can redistribute it and/or modify it</span>
<span class="cm"> * under the terms of the GNU General Public License as published by the Free</span>
<span class="cm"> * Software Foundation; either version 2 of the License, or (at your option)</span>
<span class="cm"> * any later version.</span>
<span class="cm"> */</span>

<span class="cp">#define pr_fmt(fmt) KBUILD_MODNAME &quot;: &quot; fmt</span>

<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/init.h&gt;</span>
<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/list.h&gt;</span>
<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/spinlock.h&gt;</span>
<span class="cp">#include &lt;asm/unaligned.h&gt;</span>
<span class="cp">#include &lt;asm/byteorder.h&gt;</span>
<span class="cp">#include &lt;linux/input.h&gt;</span>
<span class="cp">#include &lt;linux/wait.h&gt;</span>
<span class="cp">#include &lt;linux/vmalloc.h&gt;</span>
<span class="cp">#include &lt;linux/sched.h&gt;</span>
<span class="cp">#include &lt;linux/semaphore.h&gt;</span>

<span class="cp">#include &lt;linux/hid.h&gt;</span>
<span class="cp">#include &lt;linux/hiddev.h&gt;</span>
<span class="cp">#include &lt;linux/hid-debug.h&gt;</span>
<span class="cp">#include &lt;linux/hidraw.h&gt;</span>

<span class="cp">#include &quot;hid-ids.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * Version Information</span>
<span class="cm"> */</span>

<span class="cp">#define DRIVER_DESC &quot;HID core driver&quot;</span>
<span class="cp">#define DRIVER_LICENSE &quot;GPL&quot;</span>

<span class="kt">int</span> <span class="n">hid_debug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="n">hid_debug</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0600</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="s">&quot;toggle HID debugging messages&quot;</span><span class="p">);</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_debug</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">hid_ignore_special_drivers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">module_param_named</span><span class="p">(</span><span class="n">ignore_special_drivers</span><span class="p">,</span> <span class="n">hid_ignore_special_drivers</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="mo">0600</span><span class="p">);</span>
<span class="n">MODULE_PARM_DESC</span><span class="p">(</span><span class="n">debug</span><span class="p">,</span> <span class="s">&quot;Ignore any special drivers and handle all devices by generic driver&quot;</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Register a new report for a device.</span>
<span class="cm"> */</span>

<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="nf">hid_register_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">device</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">type</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_report_enum</span> <span class="o">*</span><span class="n">report_enum</span> <span class="o">=</span> <span class="n">device</span><span class="o">-&gt;</span><span class="n">report_enum</span> <span class="o">+</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">report_id_hash</span><span class="p">[</span><span class="n">id</span><span class="p">])</span>
		<span class="k">return</span> <span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">report_id_hash</span><span class="p">[</span><span class="n">id</span><span class="p">];</span>

	<span class="n">report</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_report</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">report</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">numbered</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="n">report</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
	<span class="n">report</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">report</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">report</span><span class="o">-&gt;</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">;</span>
	<span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">report_id_hash</span><span class="p">[</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">report</span><span class="p">;</span>

	<span class="n">list_add_tail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">report_list</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">report</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_register_report</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Register a new field for this report.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="nf">hid_register_field</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">usages</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">values</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">maxfield</span> <span class="o">==</span> <span class="n">HID_MAX_FIELDS</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;too many fields in report</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">field</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">((</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_field</span><span class="p">)</span> <span class="o">+</span>
			 <span class="n">usages</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_usage</span><span class="p">)</span> <span class="o">+</span>
			 <span class="n">values</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="p">)),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">field</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">field</span><span class="o">-&gt;</span><span class="n">index</span> <span class="o">=</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">maxfield</span><span class="o">++</span><span class="p">;</span>
	<span class="n">report</span><span class="o">-&gt;</span><span class="n">field</span><span class="p">[</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="p">)(</span><span class="n">field</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span> <span class="o">=</span> <span class="p">(</span><span class="n">s32</span> <span class="o">*</span><span class="p">)(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span> <span class="o">+</span> <span class="n">usages</span><span class="p">);</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">report</span> <span class="o">=</span> <span class="n">report</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">field</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Open a collection. The type/usage is pushed on the stack.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">open_collection</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_collection</span> <span class="o">*</span><span class="n">collection</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">usage</span><span class="p">;</span>

	<span class="n">usage</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span> <span class="o">==</span> <span class="n">HID_COLLECTION_STACK_SIZE</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;collection stack overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">maxcollection</span> <span class="o">==</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection_size</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">collection</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_collection</span><span class="p">)</span> <span class="o">*</span>
				<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">collection</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;failed to reallocate collection array</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="n">collection</span><span class="p">,</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_collection</span><span class="p">)</span> <span class="o">*</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection_size</span><span class="p">);</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">collection</span> <span class="o">+</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection_size</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
			<span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_collection</span><span class="p">)</span> <span class="o">*</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection_size</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span><span class="p">);</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span> <span class="o">=</span> <span class="n">collection</span><span class="p">;</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection_size</span> <span class="o">*=</span> <span class="mi">2</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack</span><span class="p">[</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">maxcollection</span><span class="p">;</span>

	<span class="n">collection</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span> <span class="o">+</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">maxcollection</span><span class="o">++</span><span class="p">;</span>
	<span class="n">collection</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">collection</span><span class="o">-&gt;</span><span class="n">usage</span> <span class="o">=</span> <span class="n">usage</span><span class="p">;</span>
	<span class="n">collection</span><span class="o">-&gt;</span><span class="n">level</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">HID_COLLECTION_APPLICATION</span><span class="p">)</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">maxapplication</span><span class="o">++</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Close a collection.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">close_collection</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;collection stack underflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span><span class="o">--</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Climb up the stack, search for the specified collection type</span>
<span class="cm"> * and return the usage.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">unsigned</span> <span class="nf">hid_lookup_collection</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">type</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_collection</span> <span class="o">*</span><span class="n">collection</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">n</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">unsigned</span> <span class="n">index</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">collection</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">type</span> <span class="o">==</span> <span class="n">type</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">collection</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">usage</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span> <span class="cm">/* we know nothing about this usage type */</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Add a usage to the temporary parser table.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_add_usage</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">usage</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_index</span> <span class="o">&gt;=</span> <span class="n">HID_MAX_USAGES</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;usage index exceeded</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage</span><span class="p">[</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">usage</span><span class="p">;</span>
	<span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">collection_index</span><span class="p">[</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_index</span><span class="p">]</span> <span class="o">=</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span> <span class="o">?</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack</span><span class="p">[</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_index</span><span class="o">++</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Register a new field for this report.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_add_field</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">report_type</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">flags</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">usages</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">offset</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">report</span> <span class="o">=</span> <span class="n">hid_register_report</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="n">report_type</span><span class="p">,</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">report</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;hid_register_report failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Handle both signed and unsigned cases properly */</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_minimum</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_maximum</span> <span class="o">&lt;</span>
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_minimum</span><span class="p">)</span> <span class="o">||</span>
		<span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_minimum</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">__u32</span><span class="p">)</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_maximum</span> <span class="o">&lt;</span>
		<span class="p">(</span><span class="n">__u32</span><span class="p">)</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_minimum</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;logical range invalid 0x%x 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_minimum</span><span class="p">,</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_maximum</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">offset</span> <span class="o">=</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
	<span class="n">report</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">+=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_size</span> <span class="o">*</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_count</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_index</span><span class="p">)</span> <span class="cm">/* Ignore padding fields */</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">usages</span> <span class="o">=</span> <span class="n">max_t</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_index</span><span class="p">,</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_count</span><span class="p">);</span>

	<span class="n">field</span> <span class="o">=</span> <span class="n">hid_register_field</span><span class="p">(</span><span class="n">report</span><span class="p">,</span> <span class="n">usages</span><span class="p">,</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_count</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">field</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">field</span><span class="o">-&gt;</span><span class="n">physical</span> <span class="o">=</span> <span class="n">hid_lookup_collection</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">HID_COLLECTION_PHYSICAL</span><span class="p">);</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">logical</span> <span class="o">=</span> <span class="n">hid_lookup_collection</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">HID_COLLECTION_LOGICAL</span><span class="p">);</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">application</span> <span class="o">=</span> <span class="n">hid_lookup_collection</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">HID_COLLECTION_APPLICATION</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">usages</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
		<span class="cm">/* Duplicate the last usage we parsed if we have excess values */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_index</span><span class="p">)</span>
			<span class="n">j</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">hid</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
		<span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">collection_index</span> <span class="o">=</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">collection_index</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
	<span class="p">}</span>

	<span class="n">field</span><span class="o">-&gt;</span><span class="n">maxusage</span> <span class="o">=</span> <span class="n">usages</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">=</span> <span class="n">flags</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">report_offset</span> <span class="o">=</span> <span class="n">offset</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">report_type</span> <span class="o">=</span> <span class="n">report_type</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">report_size</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_size</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">report_count</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_count</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">logical_minimum</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_minimum</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">logical_maximum</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_maximum</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">physical_minimum</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">physical_minimum</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">physical_maximum</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">physical_maximum</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">unit_exponent</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">unit_exponent</span><span class="p">;</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">unit</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">unit</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Read data value from item.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">item_udata</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_item</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">1</span>: <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">u8</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>: <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">u16</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>: <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">u32</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">s32</span> <span class="nf">item_sdata</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_item</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">1</span>: <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">s8</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">2</span>: <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">s16</span><span class="p">;</span>
	<span class="k">case</span> <span class="mi">4</span>: <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">s32</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Process a global item.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_parser_global</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_item</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_PUSH</span>:

		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global_stack_ptr</span> <span class="o">==</span> <span class="n">HID_GLOBAL_STACK_SIZE</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;global environment stack overflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">memcpy</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global_stack</span> <span class="o">+</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global_stack_ptr</span><span class="o">++</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_global</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_POP</span>:

		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global_stack_ptr</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;global environment stack underflow</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">,</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">global_stack</span> <span class="o">+</span>
			<span class="o">--</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global_stack_ptr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_global</span><span class="p">));</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_USAGE_PAGE</span>:
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">usage_page</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_LOGICAL_MINIMUM</span>:
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_minimum</span> <span class="o">=</span> <span class="n">item_sdata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_LOGICAL_MAXIMUM</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_minimum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_maximum</span> <span class="o">=</span> <span class="n">item_sdata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">logical_maximum</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_PHYSICAL_MINIMUM</span>:
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">physical_minimum</span> <span class="o">=</span> <span class="n">item_sdata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_PHYSICAL_MAXIMUM</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">physical_minimum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">physical_maximum</span> <span class="o">=</span> <span class="n">item_sdata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">physical_maximum</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_UNIT_EXPONENT</span>:
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">unit_exponent</span> <span class="o">=</span> <span class="n">item_sdata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_UNIT</span>:
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">unit</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_REPORT_SIZE</span>:
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_size</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_size</span> <span class="o">&gt;</span> <span class="mi">96</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;invalid report_size %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_size</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_REPORT_COUNT</span>:
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_count</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_count</span> <span class="o">&gt;</span> <span class="n">HID_MAX_USAGES</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;invalid report_count %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
					<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_count</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_GLOBAL_ITEM_TAG_REPORT_ID</span>:
		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_id</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">report_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;report_id 0 is invalid</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;unknown global tag 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Process a local item.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_parser_local</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_item</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__u32</span> <span class="n">data</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">n</span><span class="p">;</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HID_LOCAL_ITEM_TAG_DELIMITER</span>:

		<span class="k">if</span> <span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">{</span>
			<span class="cm">/*</span>
<span class="cm">			 * We treat items before the first delimiter</span>
<span class="cm">			 * as global to all usage sets (branch 0).</span>
<span class="cm">			 * In the moment we process only these global</span>
<span class="cm">			 * items and the first delimiter set.</span>
<span class="cm">			 */</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_depth</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;nested delimiters</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_depth</span><span class="o">++</span><span class="p">;</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_branch</span><span class="o">++</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_depth</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;bogus close delimiter</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_depth</span><span class="o">--</span><span class="p">;</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_LOCAL_ITEM_TAG_USAGE</span>:

		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_branch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;alternative usage ignored</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">usage_page</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">;</span>

		<span class="k">return</span> <span class="n">hid_add_usage</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

	<span class="k">case</span> <span class="n">HID_LOCAL_ITEM_TAG_USAGE_MINIMUM</span>:

		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_branch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;alternative usage ignored</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">usage_page</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">;</span>

		<span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_minimum</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">HID_LOCAL_ITEM_TAG_USAGE_MAXIMUM</span>:

		<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_branch</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;alternative usage ignored</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span>
			<span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">global</span><span class="p">.</span><span class="n">usage_page</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">+</span> <span class="n">data</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">usage_minimum</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">data</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">hid_add_usage</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;hid_add_usage failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="nl">default:</span>

		<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;unknown local item tag 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">);</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Process a main item.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_parser_main</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_item</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">__u32</span> <span class="n">data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">data</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">HID_MAIN_ITEM_TAG_BEGIN_COLLECTION</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">open_collection</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">data</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HID_MAIN_ITEM_TAG_END_COLLECTION</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">close_collection</span><span class="p">(</span><span class="n">parser</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HID_MAIN_ITEM_TAG_INPUT</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_add_field</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">HID_INPUT_REPORT</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HID_MAIN_ITEM_TAG_OUTPUT</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_add_field</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">HID_OUTPUT_REPORT</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">HID_MAIN_ITEM_TAG_FEATURE</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_add_field</span><span class="p">(</span><span class="n">parser</span><span class="p">,</span> <span class="n">HID_FEATURE_REPORT</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;unknown main item tag 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">));</span>	<span class="cm">/* Reset the local parser environment */</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Process a reserved item.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_parser_reserved</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_item</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;reserved item type, tag 0x%x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Free a report and all registered fields. The field-&gt;usage and</span>
<span class="cm"> * field-&gt;value table&#39;s are allocated behind the field, so we need</span>
<span class="cm"> * only to free(field) itself.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_free_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">n</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">maxfield</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">field</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">report</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Close report. This function returns the device</span>
<span class="cm"> * state to the point prior to hid_open_report().</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_close_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">device</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">HID_REPORT_TYPES</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">hid_report_enum</span> <span class="o">*</span><span class="n">report_enum</span> <span class="o">=</span> <span class="n">device</span><span class="o">-&gt;</span><span class="n">report_enum</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>

		<span class="k">for</span> <span class="p">(</span><span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">256</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span> <span class="o">=</span> <span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">report_id_hash</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">report</span><span class="p">)</span>
				<span class="n">hid_free_report</span><span class="p">(</span><span class="n">report</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">report_enum</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">report_enum</span><span class="p">));</span>
		<span class="n">INIT_LIST_HEAD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">report_list</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">rdesc</span><span class="p">);</span>
	<span class="n">device</span><span class="o">-&gt;</span><span class="n">rdesc</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">device</span><span class="o">-&gt;</span><span class="n">rsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">kfree</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span><span class="p">);</span>
	<span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">device</span><span class="o">-&gt;</span><span class="n">collection_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">device</span><span class="o">-&gt;</span><span class="n">maxcollection</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">device</span><span class="o">-&gt;</span><span class="n">maxapplication</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">device</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HID_STAT_PARSED</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Free a device structure, all reports, and all fields.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_device_release</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_device</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>

	<span class="n">hid_close_report</span><span class="p">(</span><span class="n">hid</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">dev_rdesc</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">hid</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Fetch a report description item from the data stream. We support long</span>
<span class="cm"> * items, though they are not used yet.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="n">u8</span> <span class="o">*</span><span class="nf">fetch_item</span><span class="p">(</span><span class="n">__u8</span> <span class="o">*</span><span class="n">start</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">end</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_item</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u8</span> <span class="n">b</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="n">start</span><span class="o">++</span><span class="p">;</span>

	<span class="n">item</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span>  <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">15</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span> <span class="o">==</span> <span class="n">HID_ITEM_TAG_LONG</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">item</span><span class="o">-&gt;</span><span class="n">format</span> <span class="o">=</span> <span class="n">HID_ITEM_FORMAT_LONG</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="o">*</span><span class="n">start</span><span class="o">++</span><span class="p">;</span>
		<span class="n">item</span><span class="o">-&gt;</span><span class="n">tag</span>  <span class="o">=</span> <span class="o">*</span><span class="n">start</span><span class="o">++</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

		<span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">longdata</span> <span class="o">=</span> <span class="n">start</span><span class="p">;</span>
		<span class="n">start</span> <span class="o">+=</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">start</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">item</span><span class="o">-&gt;</span><span class="n">format</span> <span class="o">=</span> <span class="n">HID_ITEM_FORMAT_SHORT</span><span class="p">;</span>
	<span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="mi">3</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">0</span>:
		<span class="k">return</span> <span class="n">start</span><span class="p">;</span>

	<span class="k">case</span> <span class="mi">1</span>:
		<span class="k">if</span> <span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">u8</span> <span class="o">=</span> <span class="o">*</span><span class="n">start</span><span class="o">++</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">start</span><span class="p">;</span>

	<span class="k">case</span> <span class="mi">2</span>:
		<span class="k">if</span> <span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">u16</span> <span class="o">=</span> <span class="n">get_unaligned_le16</span><span class="p">(</span><span class="n">start</span><span class="p">);</span>
		<span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">__u8</span> <span class="o">*</span><span class="p">)((</span><span class="n">__le16</span> <span class="o">*</span><span class="p">)</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">start</span><span class="p">;</span>

	<span class="k">case</span> <span class="mi">3</span>:
		<span class="n">item</span><span class="o">-&gt;</span><span class="n">size</span><span class="o">++</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="n">item</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">.</span><span class="n">u32</span> <span class="o">=</span> <span class="n">get_unaligned_le32</span><span class="p">(</span><span class="n">start</span><span class="p">);</span>
		<span class="n">start</span> <span class="o">=</span> <span class="p">(</span><span class="n">__u8</span> <span class="o">*</span><span class="p">)((</span><span class="n">__le32</span> <span class="o">*</span><span class="p">)</span><span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">start</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_scan_usage</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="n">u32</span> <span class="n">usage</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">usage</span> <span class="o">==</span> <span class="n">HID_DG_CONTACTID</span><span class="p">)</span>
		<span class="n">hid</span><span class="o">-&gt;</span><span class="n">group</span> <span class="o">=</span> <span class="n">HID_GROUP_MULTITOUCH</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Scan a report descriptor before the device is added to the bus.</span>
<span class="cm"> * Sets device groups and other properties that determine what driver</span>
<span class="cm"> * to load.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_scan_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">page</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">delim</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">start</span> <span class="o">=</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">dev_rdesc</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">dev_rsize</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">u</span><span class="p">,</span> <span class="n">u_min</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">u_max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_item</span> <span class="n">item</span><span class="p">;</span>

	<span class="n">hid</span><span class="o">-&gt;</span><span class="n">group</span> <span class="o">=</span> <span class="n">HID_GROUP_GENERIC</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">((</span><span class="n">start</span> <span class="o">=</span> <span class="n">fetch_item</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">format</span> <span class="o">!=</span> <span class="n">HID_ITEM_FORMAT_SHORT</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">HID_ITEM_TYPE_GLOBAL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">tag</span> <span class="o">==</span> <span class="n">HID_GLOBAL_ITEM_TAG_USAGE_PAGE</span><span class="p">)</span>
				<span class="n">page</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">item</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mi">16</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">HID_ITEM_TYPE_LOCAL</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">delim</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="n">u</span> <span class="o">=</span> <span class="n">item_udata</span><span class="p">(</span><span class="o">&amp;</span><span class="n">item</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">size</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span>
				<span class="n">u</span> <span class="o">+=</span> <span class="n">page</span><span class="p">;</span>
			<span class="k">switch</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">tag</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">case</span> <span class="n">HID_LOCAL_ITEM_TAG_DELIMITER</span>:
				<span class="n">delim</span> <span class="o">+=</span> <span class="o">!!</span><span class="n">u</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">HID_LOCAL_ITEM_TAG_USAGE</span>:
				<span class="n">hid_scan_usage</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">HID_LOCAL_ITEM_TAG_USAGE_MINIMUM</span>:
				<span class="n">u_min</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="k">case</span> <span class="n">HID_LOCAL_ITEM_TAG_USAGE_MAXIMUM</span>:
				<span class="n">u_max</span> <span class="o">=</span> <span class="n">u</span><span class="p">;</span>
				<span class="k">for</span> <span class="p">(</span><span class="n">u</span> <span class="o">=</span> <span class="n">u_min</span><span class="p">;</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="n">u_max</span><span class="p">;</span> <span class="n">u</span><span class="o">++</span><span class="p">)</span>
					<span class="n">hid_scan_usage</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">u</span><span class="p">);</span>
				<span class="k">break</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_parse_report - parse device report</span>
<span class="cm"> *</span>
<span class="cm"> * @device: hid device</span>
<span class="cm"> * @start: report start</span>
<span class="cm"> * @size: report size</span>
<span class="cm"> *</span>
<span class="cm"> * Allocate the device report as read by the bus driver. This function should</span>
<span class="cm"> * only be called from parse() in ll drivers.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">hid_parse_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">start</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">size</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hid</span><span class="o">-&gt;</span><span class="n">dev_rdesc</span> <span class="o">=</span> <span class="n">kmemdup</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">dev_rdesc</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">hid</span><span class="o">-&gt;</span><span class="n">dev_rsize</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_parse_report</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * hid_open_report - open a driver-specific device report</span>
<span class="cm"> *</span>
<span class="cm"> * @device: hid device</span>
<span class="cm"> *</span>
<span class="cm"> * Parse a report description into a hid_device structure. Reports are</span>
<span class="cm"> * enumerated, fields are attached to these reports.</span>
<span class="cm"> * 0 returned on success, otherwise nonzero error value.</span>
<span class="cm"> *</span>
<span class="cm"> * This function (or the equivalent hid_parse() macro) should only be</span>
<span class="cm"> * called from probe() in drivers, before starting the device.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">hid_open_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">device</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_item</span> <span class="n">item</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">start</span><span class="p">;</span>
	<span class="n">__u8</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">int</span> <span class="p">(</span><span class="o">*</span><span class="n">dispatch_type</span><span class="p">[])(</span><span class="k">struct</span> <span class="n">hid_parser</span> <span class="o">*</span><span class="n">parser</span><span class="p">,</span>
				      <span class="k">struct</span> <span class="n">hid_item</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">hid_parser_main</span><span class="p">,</span>
		<span class="n">hid_parser_global</span><span class="p">,</span>
		<span class="n">hid_parser_local</span><span class="p">,</span>
		<span class="n">hid_parser_reserved</span>
	<span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">WARN_ON</span><span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">HID_STAT_PARSED</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>

	<span class="n">start</span> <span class="o">=</span> <span class="n">device</span><span class="o">-&gt;</span><span class="n">dev_rdesc</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">WARN_ON</span><span class="p">(</span><span class="o">!</span><span class="n">start</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="n">size</span> <span class="o">=</span> <span class="n">device</span><span class="o">-&gt;</span><span class="n">dev_rsize</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">report_fixup</span><span class="p">)</span>
		<span class="n">start</span> <span class="o">=</span> <span class="n">device</span><span class="o">-&gt;</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">report_fixup</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">size</span><span class="p">);</span>

	<span class="n">device</span><span class="o">-&gt;</span><span class="n">rdesc</span> <span class="o">=</span> <span class="n">kmemdup</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">rdesc</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
	<span class="n">device</span><span class="o">-&gt;</span><span class="n">rsize</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">parser</span> <span class="o">=</span> <span class="n">vzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_parser</span><span class="p">));</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">parser</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">parser</span><span class="o">-&gt;</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">;</span>

	<span class="n">end</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">size</span><span class="p">;</span>

	<span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span> <span class="o">=</span> <span class="n">kcalloc</span><span class="p">(</span><span class="n">HID_DEFAULT_NUM_COLLECTIONS</span><span class="p">,</span>
				     <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_collection</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">device</span><span class="o">-&gt;</span><span class="n">collection</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">device</span><span class="o">-&gt;</span><span class="n">collection_size</span> <span class="o">=</span> <span class="n">HID_DEFAULT_NUM_COLLECTIONS</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">((</span><span class="n">start</span> <span class="o">=</span> <span class="n">fetch_item</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">))</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">item</span><span class="p">.</span><span class="n">format</span> <span class="o">!=</span> <span class="n">HID_ITEM_FORMAT_SHORT</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;unexpected long global item</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">dispatch_type</span><span class="p">[</span><span class="n">item</span><span class="p">.</span><span class="n">type</span><span class="p">](</span><span class="n">parser</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;item %u %u %u %u parsing failed</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">item</span><span class="p">.</span><span class="n">format</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">item</span><span class="p">.</span><span class="n">size</span><span class="p">,</span>
				<span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">item</span><span class="p">.</span><span class="n">type</span><span class="p">,</span> <span class="p">(</span><span class="kt">unsigned</span><span class="p">)</span><span class="n">item</span><span class="p">.</span><span class="n">tag</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">==</span> <span class="n">end</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">collection_stack_ptr</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">hid_err</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;unbalanced collection at end of report description</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">parser</span><span class="o">-&gt;</span><span class="n">local</span><span class="p">.</span><span class="n">delimiter_depth</span><span class="p">)</span> <span class="p">{</span>
				<span class="n">hid_err</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;unbalanced delimiter at end of report description</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
				<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">vfree</span><span class="p">(</span><span class="n">parser</span><span class="p">);</span>
			<span class="n">device</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">|=</span> <span class="n">HID_STAT_PARSED</span><span class="p">;</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">hid_err</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;item fetching failed at offset %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">));</span>
<span class="nl">err:</span>
	<span class="n">vfree</span><span class="p">(</span><span class="n">parser</span><span class="p">);</span>
	<span class="n">hid_close_report</span><span class="p">(</span><span class="n">device</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_open_report</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Convert a signed n-bit integer to signed 32-bit integer. Common</span>
<span class="cm"> * cases are done through the compiler, the screwed things has to be</span>
<span class="cm"> * done by hand.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="n">s32</span> <span class="nf">snto32</span><span class="p">(</span><span class="n">__u32</span> <span class="n">value</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mi">8</span>:  <span class="k">return</span> <span class="p">((</span><span class="n">__s8</span><span class="p">)</span><span class="n">value</span><span class="p">);</span>
	<span class="k">case</span> <span class="mi">16</span>: <span class="k">return</span> <span class="p">((</span><span class="n">__s16</span><span class="p">)</span><span class="n">value</span><span class="p">);</span>
	<span class="k">case</span> <span class="mi">32</span>: <span class="k">return</span> <span class="p">((</span><span class="n">__s32</span><span class="p">)</span><span class="n">value</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">?</span> <span class="n">value</span> <span class="o">|</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">:</span> <span class="n">value</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Convert a signed 32-bit integer to a signed n-bit integer.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="n">u32</span> <span class="nf">s32ton</span><span class="p">(</span><span class="n">__s32</span> <span class="n">value</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">s32</span> <span class="n">a</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">a</span> <span class="o">&amp;&amp;</span> <span class="n">a</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">value</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Extract/implement a data field from/to a little endian report (bit array).</span>
<span class="cm"> *</span>
<span class="cm"> * Code sort-of follows HID spec:</span>
<span class="cm"> *     http://www.usb.org/developers/devclass_docs/HID1_11.pdf</span>
<span class="cm"> *</span>
<span class="cm"> * While the USB HID spec allows unlimited length bit fields in &quot;report</span>
<span class="cm"> * descriptors&quot;, most devices never use more than 16 bits.</span>
<span class="cm"> * One model of UPS is claimed to report &quot;LINEV&quot; as a 32-bit field.</span>
<span class="cm"> * Search linux-kernel and linux-usb-devel archives for &quot;hid-core extract&quot;.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="n">__u32</span> <span class="nf">extract</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">report</span><span class="p">,</span>
		     <span class="kt">unsigned</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u64</span> <span class="n">x</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">)</span>
		<span class="n">hid_warn</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="s">&quot;extract() called with n (%d) &gt; 32! (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">n</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">);</span>

	<span class="n">report</span> <span class="o">+=</span> <span class="n">offset</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>  <span class="cm">/* adjust byte index */</span>
	<span class="n">offset</span> <span class="o">&amp;=</span> <span class="mi">7</span><span class="p">;</span>            <span class="cm">/* now only need bit offset into one byte */</span>
	<span class="n">x</span> <span class="o">=</span> <span class="n">get_unaligned_le64</span><span class="p">(</span><span class="n">report</span><span class="p">);</span>
	<span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;&gt;</span> <span class="n">offset</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">((</span><span class="mi">1ULL</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>  <span class="cm">/* extract bit field */</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">u32</span><span class="p">)</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * &quot;implement&quot; : set bits in a little endian bit stream.</span>
<span class="cm"> * Same concepts as &quot;extract&quot; (see comments above).</span>
<span class="cm"> * The data mangled in the bit stream remains in little endian</span>
<span class="cm"> * order the whole time. It make more sense to talk about</span>
<span class="cm"> * endianness of register values by considering a register</span>
<span class="cm"> * a &quot;cached&quot; copy of the little endiad bit stream.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">implement</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">report</span><span class="p">,</span>
		      <span class="kt">unsigned</span> <span class="n">offset</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">n</span><span class="p">,</span> <span class="n">__u32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u64</span> <span class="n">x</span><span class="p">;</span>
	<span class="n">u64</span> <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1ULL</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">32</span><span class="p">)</span>
		<span class="n">hid_warn</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="s">&quot;%s() called with n (%d) &gt; 32! (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">__func__</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">)</span>
		<span class="n">hid_warn</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="s">&quot;%s() called with too large value %d! (%s)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">__func__</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">current</span><span class="o">-&gt;</span><span class="n">comm</span><span class="p">);</span>
	<span class="n">WARN_ON</span><span class="p">(</span><span class="n">value</span> <span class="o">&gt;</span> <span class="n">m</span><span class="p">);</span>
	<span class="n">value</span> <span class="o">&amp;=</span> <span class="n">m</span><span class="p">;</span>

	<span class="n">report</span> <span class="o">+=</span> <span class="n">offset</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">;</span>
	<span class="n">offset</span> <span class="o">&amp;=</span> <span class="mi">7</span><span class="p">;</span>

	<span class="n">x</span> <span class="o">=</span> <span class="n">get_unaligned_le64</span><span class="p">(</span><span class="n">report</span><span class="p">);</span>
	<span class="n">x</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="n">m</span> <span class="o">&lt;&lt;</span> <span class="n">offset</span><span class="p">);</span>
	<span class="n">x</span> <span class="o">|=</span> <span class="p">((</span><span class="n">u64</span><span class="p">)</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">offset</span><span class="p">;</span>
	<span class="n">put_unaligned_le64</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">report</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Search an array for a value.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">search</span><span class="p">(</span><span class="n">__s32</span> <span class="o">*</span><span class="n">array</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">value</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">while</span> <span class="p">(</span><span class="n">n</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">array</span><span class="o">++</span> <span class="o">==</span> <span class="n">value</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_match_report - check if driver&#39;s raw_event should be called</span>
<span class="cm"> *</span>
<span class="cm"> * @hid: hid device</span>
<span class="cm"> * @report_type: type to match against</span>
<span class="cm"> *</span>
<span class="cm"> * compare hid-&gt;driver-&gt;report_table-&gt;report_type to report-&gt;type</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_match_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_report_id</span> <span class="o">*</span><span class="n">id</span> <span class="o">=</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">report_table</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">id</span><span class="p">)</span> <span class="cm">/* NULL means all */</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(;</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">report_type</span> <span class="o">!=</span> <span class="n">HID_TERMINATOR</span><span class="p">;</span> <span class="n">id</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">report_type</span> <span class="o">==</span> <span class="n">HID_ANY_ID</span> <span class="o">||</span>
				<span class="n">id</span><span class="o">-&gt;</span><span class="n">report_type</span> <span class="o">==</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_match_usage - check if driver&#39;s event should be called</span>
<span class="cm"> *</span>
<span class="cm"> * @hid: hid device</span>
<span class="cm"> * @usage: usage to match against</span>
<span class="cm"> *</span>
<span class="cm"> * compare hid-&gt;driver-&gt;usage_table-&gt;usage_{type,code} to</span>
<span class="cm"> * usage-&gt;usage_{type,code}</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_match_usage</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_usage_id</span> <span class="o">*</span><span class="n">id</span> <span class="o">=</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">driver</span><span class="o">-&gt;</span><span class="n">usage_table</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">id</span><span class="p">)</span> <span class="cm">/* NULL means all */</span>
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(;</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">usage_type</span> <span class="o">!=</span> <span class="n">HID_ANY_ID</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">id</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">((</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">usage_hid</span> <span class="o">==</span> <span class="n">HID_ANY_ID</span> <span class="o">||</span>
				<span class="n">id</span><span class="o">-&gt;</span><span class="n">usage_hid</span> <span class="o">==</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">hid</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				<span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">usage_type</span> <span class="o">==</span> <span class="n">HID_ANY_ID</span> <span class="o">||</span>
				<span class="n">id</span><span class="o">-&gt;</span><span class="n">usage_type</span> <span class="o">==</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">type</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
				<span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">usage_code</span> <span class="o">==</span> <span class="n">HID_ANY_ID</span> <span class="o">||</span>
				 <span class="n">id</span><span class="o">-&gt;</span><span class="n">usage_code</span> <span class="o">==</span> <span class="n">usage</span><span class="o">-&gt;</span><span class="n">code</span><span class="p">))</span>
			<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_process_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hid_usage</span> <span class="o">*</span><span class="n">usage</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">value</span><span class="p">,</span> <span class="kt">int</span> <span class="n">interrupt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span> <span class="o">=</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">hid_dump_input</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hdrv</span> <span class="o">&amp;&amp;</span> <span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">event</span> <span class="o">&amp;&amp;</span> <span class="n">hid_match_usage</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">usage</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
				<span class="n">hid_err</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="s">&quot;%s&#39;s event failed with %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
						<span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
			<span class="k">return</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_INPUT</span><span class="p">)</span>
		<span class="n">hidinput_hid_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_HIDDEV</span> <span class="o">&amp;&amp;</span> <span class="n">interrupt</span> <span class="o">&amp;&amp;</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">hiddev_hid_event</span><span class="p">)</span>
		<span class="n">hid</span><span class="o">-&gt;</span><span class="n">hiddev_hid_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">usage</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Analyse a received field, and fetch the data from it. The field</span>
<span class="cm"> * content is stored for next report processing (we do differential</span>
<span class="cm"> * reporting to the layer).</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_input_field</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span>
			    <span class="n">__u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">interrupt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">n</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">count</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_size</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">min</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">logical_minimum</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="n">max</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">logical_maximum</span><span class="p">;</span>
	<span class="n">__s32</span> <span class="o">*</span><span class="n">value</span><span class="p">;</span>

	<span class="n">value</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">__s32</span><span class="p">)</span> <span class="o">*</span> <span class="n">count</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">value</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

		<span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span>
			<span class="n">snto32</span><span class="p">(</span><span class="n">extract</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span>
			       <span class="n">size</span><span class="p">)</span> <span class="o">:</span>
			<span class="n">extract</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>

		<span class="cm">/* Ignore report if ErrorRollOver */</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">flags</span> <span class="o">&amp;</span> <span class="n">HID_MAIN_ITEM_VARIABLE</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		    <span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max</span> <span class="o">&amp;&amp;</span>
		    <span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">min</span><span class="p">].</span><span class="n">hid</span> <span class="o">==</span> <span class="n">HID_UP_KEYBOARD</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">exit</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">HID_MAIN_ITEM_VARIABLE</span> <span class="o">&amp;</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">flags</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_process_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">interrupt</span><span class="p">);</span>
			<span class="k">continue</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min</span> <span class="o">&amp;&amp;</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max</span>
			<span class="o">&amp;&amp;</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">[</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">min</span><span class="p">].</span><span class="n">hid</span>
			<span class="o">&amp;&amp;</span> <span class="n">search</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">count</span><span class="p">))</span>
				<span class="n">hid_process_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">[</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">min</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">interrupt</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min</span> <span class="o">&amp;&amp;</span> <span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">max</span>
			<span class="o">&amp;&amp;</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">min</span><span class="p">].</span><span class="n">hid</span>
			<span class="o">&amp;&amp;</span> <span class="n">search</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">count</span><span class="p">))</span>
				<span class="n">hid_process_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span><span class="p">[</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">min</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">interrupt</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">count</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">__s32</span><span class="p">));</span>
<span class="nl">exit:</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Output the field into the report.</span>
<span class="cm"> */</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_output_field</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span>
			     <span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">count</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_count</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_offset</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_size</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="n">n</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">count</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">logical_minimum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>	<span class="cm">/* signed values */</span>
			<span class="n">implement</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
				  <span class="n">s32ton</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">size</span><span class="p">));</span>
		<span class="k">else</span>				<span class="cm">/* unsigned values */</span>
			<span class="n">implement</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">offset</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
				  <span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">[</span><span class="n">n</span><span class="p">]);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Create a report.</span>
<span class="cm"> */</span>

<span class="kt">void</span> <span class="nf">hid_output_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">,</span> <span class="n">__u8</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">n</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="o">*</span><span class="n">data</span><span class="o">++</span> <span class="o">=</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">;</span>

	<span class="n">memset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">((</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">maxfield</span><span class="p">;</span> <span class="n">n</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hid_output_field</span><span class="p">(</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">field</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">data</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_output_report</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Set a field value. The report this field belongs to has to be</span>
<span class="cm"> * created and transferred to the device, to set this value in the</span>
<span class="cm"> * device.</span>
<span class="cm"> */</span>

<span class="kt">int</span> <span class="nf">hid_set_field</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_field</span> <span class="o">*</span><span class="n">field</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">offset</span><span class="p">,</span> <span class="n">__s32</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="n">size</span> <span class="o">=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_size</span><span class="p">;</span>

	<span class="n">hid_dump_input</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">usage</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">offset</span> <span class="o">&gt;=</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_count</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;offset (%d) exceeds report_count (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">offset</span><span class="p">,</span> <span class="n">field</span><span class="o">-&gt;</span><span class="n">report_count</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">logical_minimum</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="o">!=</span> <span class="n">snto32</span><span class="p">(</span><span class="n">s32ton</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">size</span><span class="p">),</span> <span class="n">size</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">hid_err</span><span class="p">(</span><span class="n">field</span><span class="o">-&gt;</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">device</span><span class="p">,</span> <span class="s">&quot;value %d is out of range</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">field</span><span class="o">-&gt;</span><span class="n">value</span><span class="p">[</span><span class="n">offset</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_set_field</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="nf">hid_get_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_report_enum</span> <span class="o">*</span><span class="n">report_enum</span><span class="p">,</span>
		<span class="k">const</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>	<span class="cm">/* Normally report number is 0 */</span>

	<span class="cm">/* Device uses numbered reports, data[0] is report number */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">numbered</span><span class="p">)</span>
		<span class="n">n</span> <span class="o">=</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>

	<span class="n">report</span> <span class="o">=</span> <span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">report_id_hash</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">report</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;undefined report_id %u received</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">report</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hid_report_raw_event</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span>
		<span class="kt">int</span> <span class="n">interrupt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_report_enum</span> <span class="o">*</span><span class="n">report_enum</span> <span class="o">=</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">report_enum</span> <span class="o">+</span> <span class="n">type</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rsize</span><span class="p">,</span> <span class="n">csize</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
	<span class="n">u8</span> <span class="o">*</span><span class="n">cdata</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">report</span> <span class="o">=</span> <span class="n">hid_get_report</span><span class="p">(</span><span class="n">report_enum</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">report</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">numbered</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">cdata</span><span class="o">++</span><span class="p">;</span>
		<span class="n">csize</span><span class="o">--</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">rsize</span> <span class="o">=</span> <span class="p">((</span><span class="n">report</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">rsize</span> <span class="o">&gt;</span> <span class="n">HID_MAX_BUFFER_SIZE</span><span class="p">)</span>
		<span class="n">rsize</span> <span class="o">=</span> <span class="n">HID_MAX_BUFFER_SIZE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">csize</span> <span class="o">&lt;</span> <span class="n">rsize</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;report %d is too short, (%d &lt; %d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span>
				<span class="n">csize</span><span class="p">,</span> <span class="n">rsize</span><span class="p">);</span>
		<span class="n">memset</span><span class="p">(</span><span class="n">cdata</span> <span class="o">+</span> <span class="n">csize</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">rsize</span> <span class="o">-</span> <span class="n">csize</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_HIDDEV</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">hiddev_report_event</span><span class="p">)</span>
		<span class="n">hid</span><span class="o">-&gt;</span><span class="n">hiddev_report_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">report</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_HIDRAW</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">hidraw_report_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">a</span> <span class="o">&lt;</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">maxfield</span><span class="p">;</span> <span class="n">a</span><span class="o">++</span><span class="p">)</span>
		<span class="n">hid_input_field</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">report</span><span class="o">-&gt;</span><span class="n">field</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">cdata</span><span class="p">,</span> <span class="n">interrupt</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_INPUT</span><span class="p">)</span>
		<span class="n">hidinput_report_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">report</span><span class="p">);</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_report_raw_event</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * hid_input_report - report data from lower layer (usb, bt...)</span>
<span class="cm"> *</span>
<span class="cm"> * @hid: hid device</span>
<span class="cm"> * @type: HID report type (HID_*_REPORT)</span>
<span class="cm"> * @data: report contents</span>
<span class="cm"> * @size: size of data parameter</span>
<span class="cm"> * @interrupt: distinguish between interrupt and control transfers</span>
<span class="cm"> *</span>
<span class="cm"> * This is data entry for lower layers.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">hid_input_report</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">,</span> <span class="n">u8</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="kt">int</span> <span class="n">interrupt</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_report_enum</span> <span class="o">*</span><span class="n">report_enum</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_report</span> <span class="o">*</span><span class="n">report</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hid</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">down_trylock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">driver_lock</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">unlock</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">report_enum</span> <span class="o">=</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">report_enum</span> <span class="o">+</span> <span class="n">type</span><span class="p">;</span>
	<span class="n">hdrv</span> <span class="o">=</span> <span class="n">hid</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dbg_hid</span><span class="p">(</span><span class="s">&quot;empty report</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">unlock</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">buf</span> <span class="o">=</span> <span class="n">kmalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="o">*</span> <span class="n">HID_DEBUG_BUFSIZE</span><span class="p">,</span> <span class="n">GFP_ATOMIC</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">buf</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">nomem</span><span class="p">;</span>

	<span class="cm">/* dump the report */</span>
	<span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">HID_DEBUG_BUFSIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
			<span class="s">&quot;</span><span class="se">\n</span><span class="s">report (size %u) (%snumbered) = &quot;</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">report_enum</span><span class="o">-&gt;</span><span class="n">numbered</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot;un&quot;</span><span class="p">);</span>
	<span class="n">hid_debug_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">HID_DEBUG_BUFSIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
				<span class="s">&quot; %02x&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="n">hid_debug_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">hid_debug_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">buf</span><span class="p">);</span>

<span class="nl">nomem:</span>
	<span class="n">report</span> <span class="o">=</span> <span class="n">hid_get_report</span><span class="p">(</span><span class="n">report_enum</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">report</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">unlock</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hdrv</span> <span class="o">&amp;&amp;</span> <span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">raw_event</span> <span class="o">&amp;&amp;</span> <span class="n">hid_match_report</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">report</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">raw_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">report</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">ret</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
			<span class="k">goto</span> <span class="n">unlock</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_report_raw_event</span><span class="p">(</span><span class="n">hid</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">interrupt</span><span class="p">);</span>

<span class="nl">unlock:</span>
	<span class="n">up</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">driver_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_input_report</span><span class="p">);</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">hid_match_one_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">bus</span> <span class="o">==</span> <span class="n">HID_BUS_ANY</span> <span class="o">||</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">bus</span> <span class="o">==</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">group</span> <span class="o">==</span> <span class="n">HID_GROUP_ANY</span> <span class="o">||</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">group</span> <span class="o">==</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">group</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">vendor</span> <span class="o">==</span> <span class="n">HID_ANY_ID</span> <span class="o">||</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">vendor</span> <span class="o">==</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">vendor</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
		<span class="p">(</span><span class="n">id</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">==</span> <span class="n">HID_ANY_ID</span> <span class="o">||</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">==</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="nf">hid_match_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span>
		<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">for</span> <span class="p">(;</span> <span class="n">id</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">;</span> <span class="n">id</span><span class="o">++</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hid_match_one_id</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">id</span><span class="p">))</span>
			<span class="k">return</span> <span class="n">id</span><span class="p">;</span>

	<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="n">hid_hiddev_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MGE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MGE_UPS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MGE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MGE_UPS1</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">hid_hiddev</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="o">!!</span><span class="n">hid_match_id</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">hid_hiddev_list</span><span class="p">);</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">ssize_t</span>
<span class="nf">read_report_descriptor</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">filp</span><span class="p">,</span> <span class="k">struct</span> <span class="n">kobject</span> <span class="o">*</span><span class="n">kobj</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">bin_attribute</span> <span class="o">*</span><span class="n">attr</span><span class="p">,</span>
		<span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span> <span class="n">loff_t</span> <span class="n">off</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">kobj</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device</span><span class="p">,</span> <span class="n">kobj</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_device</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">off</span> <span class="o">&gt;=</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">rsize</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">off</span> <span class="o">+</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">rsize</span><span class="p">)</span>
		<span class="n">count</span> <span class="o">=</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">rsize</span> <span class="o">-</span> <span class="n">off</span><span class="p">;</span>

	<span class="n">memcpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">rdesc</span> <span class="o">+</span> <span class="n">off</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">bin_attribute</span> <span class="n">dev_bin_attr_report_desc</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">attr</span> <span class="o">=</span> <span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;report_descriptor&quot;</span><span class="p">,</span> <span class="p">.</span><span class="n">mode</span> <span class="o">=</span> <span class="mo">0444</span> <span class="p">},</span>
	<span class="p">.</span><span class="n">read</span> <span class="o">=</span> <span class="n">read_report_descriptor</span><span class="p">,</span>
	<span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">HID_MAX_DESCRIPTOR_SIZE</span><span class="p">,</span>
<span class="p">};</span>

<span class="kt">int</span> <span class="nf">hid_connect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">connect_mask</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">types</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;Device&quot;</span><span class="p">,</span> <span class="s">&quot;Pointer&quot;</span><span class="p">,</span> <span class="s">&quot;Mouse&quot;</span><span class="p">,</span> <span class="s">&quot;Device&quot;</span><span class="p">,</span>
		<span class="s">&quot;Joystick&quot;</span><span class="p">,</span> <span class="s">&quot;Gamepad&quot;</span><span class="p">,</span> <span class="s">&quot;Keyboard&quot;</span><span class="p">,</span> <span class="s">&quot;Keypad&quot;</span><span class="p">,</span>
		<span class="s">&quot;Multi-Axis Controller&quot;</span>
	<span class="p">};</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">type</span><span class="p">,</span> <span class="o">*</span><span class="n">bus</span><span class="p">;</span>
	<span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">64</span><span class="p">];</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">HID_QUIRK_HIDDEV_FORCE</span><span class="p">)</span>
		<span class="n">connect_mask</span> <span class="o">|=</span> <span class="p">(</span><span class="n">HID_CONNECT_HIDDEV_FORCE</span> <span class="o">|</span> <span class="n">HID_CONNECT_HIDDEV</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">HID_QUIRK_HIDINPUT_FORCE</span><span class="p">)</span>
		<span class="n">connect_mask</span> <span class="o">|=</span> <span class="n">HID_CONNECT_HIDINPUT_FORCE</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">bus</span> <span class="o">!=</span> <span class="n">BUS_USB</span><span class="p">)</span>
		<span class="n">connect_mask</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HID_CONNECT_HIDDEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hid_hiddev</span><span class="p">(</span><span class="n">hdev</span><span class="p">))</span>
		<span class="n">connect_mask</span> <span class="o">|=</span> <span class="n">HID_CONNECT_HIDDEV_FORCE</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">connect_mask</span> <span class="o">&amp;</span> <span class="n">HID_CONNECT_HIDINPUT</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">hidinput_connect</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span>
				<span class="n">connect_mask</span> <span class="o">&amp;</span> <span class="n">HID_CONNECT_HIDINPUT_FORCE</span><span class="p">))</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">|=</span> <span class="n">HID_CLAIMED_INPUT</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">connect_mask</span> <span class="o">&amp;</span> <span class="n">HID_CONNECT_HIDDEV</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">hiddev_connect</span> <span class="o">&amp;&amp;</span>
			<span class="o">!</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">hiddev_connect</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span>
				<span class="n">connect_mask</span> <span class="o">&amp;</span> <span class="n">HID_CONNECT_HIDDEV_FORCE</span><span class="p">))</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">|=</span> <span class="n">HID_CLAIMED_HIDDEV</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">((</span><span class="n">connect_mask</span> <span class="o">&amp;</span> <span class="n">HID_CONNECT_HIDRAW</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">hidraw_connect</span><span class="p">(</span><span class="n">hdev</span><span class="p">))</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">|=</span> <span class="n">HID_CLAIMED_HIDRAW</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">hid_err</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="s">&quot;claimed by neither input, hiddev nor hidraw</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">((</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_INPUT</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
			<span class="p">(</span><span class="n">connect_mask</span> <span class="o">&amp;</span> <span class="n">HID_CONNECT_FF</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ff_init</span><span class="p">)</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ff_init</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>

	<span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_INPUT</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;input&quot;</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_HIDDEV</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%shiddev%d&quot;</span><span class="p">,</span> <span class="n">len</span> <span class="o">?</span> <span class="s">&quot;,&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
				<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_HIDRAW</span><span class="p">)</span>
		<span class="n">len</span> <span class="o">+=</span> <span class="n">sprintf</span><span class="p">(</span><span class="n">buf</span> <span class="o">+</span> <span class="n">len</span><span class="p">,</span> <span class="s">&quot;%shidraw%d&quot;</span><span class="p">,</span> <span class="n">len</span> <span class="o">?</span> <span class="s">&quot;,&quot;</span> <span class="o">:</span> <span class="s">&quot;&quot;</span><span class="p">,</span>
				<span class="p">((</span><span class="k">struct</span> <span class="n">hidraw</span> <span class="o">*</span><span class="p">)</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">hidraw</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">minor</span><span class="p">);</span>

	<span class="n">type</span> <span class="o">=</span> <span class="s">&quot;Device&quot;</span><span class="p">;</span>
	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">maxcollection</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">hid_collection</span> <span class="o">*</span><span class="n">col</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">collection</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">col</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">HID_COLLECTION_APPLICATION</span> <span class="o">&amp;&amp;</span>
		   <span class="p">(</span><span class="n">col</span><span class="o">-&gt;</span><span class="n">usage</span> <span class="o">&amp;</span> <span class="n">HID_USAGE_PAGE</span><span class="p">)</span> <span class="o">==</span> <span class="n">HID_UP_GENDESK</span> <span class="o">&amp;&amp;</span>
		   <span class="p">(</span><span class="n">col</span><span class="o">-&gt;</span><span class="n">usage</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">types</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">type</span> <span class="o">=</span> <span class="n">types</span><span class="p">[</span><span class="n">col</span><span class="o">-&gt;</span><span class="n">usage</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">];</span>
			<span class="k">break</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">BUS_USB</span>:
		<span class="n">bus</span> <span class="o">=</span> <span class="s">&quot;USB&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">BUS_BLUETOOTH</span>:
		<span class="n">bus</span> <span class="o">=</span> <span class="s">&quot;BLUETOOTH&quot;</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">bus</span> <span class="o">=</span> <span class="s">&quot;&lt;UNKNOWN&gt;&quot;</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">device_create_bin_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev_bin_attr_report_desc</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">hid_warn</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span>
			 <span class="s">&quot;can&#39;t create sysfs report descriptor attribute err: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>

	<span class="n">hid_info</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="s">&quot;%s: %s HID v%x.%02x %s [%s] on %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		 <span class="n">buf</span><span class="p">,</span> <span class="n">bus</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">&gt;&gt;</span> <span class="mi">8</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">version</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span>
		 <span class="n">type</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">phys</span><span class="p">);</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_connect</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">hid_disconnect</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">device_remove_bin_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev_bin_attr_report_desc</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_INPUT</span><span class="p">)</span>
		<span class="n">hidinput_disconnect</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_HIDDEV</span><span class="p">)</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">hiddev_disconnect</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_HIDRAW</span><span class="p">)</span>
		<span class="n">hidraw_disconnect</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_disconnect</span><span class="p">);</span>

<span class="cm">/* a list of devices for which there is a specialized driver on HID bus */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="n">hid_have_special_driver</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_A4TECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_A4TECH_WCP32PU</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_A4TECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_A4TECH_X5_005D</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_A4TECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_A4TECH_RP_649</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ACRUX</span><span class="p">,</span> <span class="mh">0x0802</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ATV_IRCONTROL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_IRCONTROL4</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_MIGHTYMOUSE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_MAGICMOUSE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_MAGICTRACKPAD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_FOUNTAIN_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_FOUNTAIN_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER3_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER3_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER3_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_MINI_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_MINI_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_MINI_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_HF_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_HF_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_HF_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_WIRELESS_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_WIRELESS_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_WIRELESS_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING2_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING2_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING2_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING3_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING3_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING3_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4A_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4A_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4A_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5A_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5A_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5A_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_REVB_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_REVB_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_REVB_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6A_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6A_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6A_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_WIRELESS_2009_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_WIRELESS_2009_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_WIRELESS_2009_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_ALU_WIRELESS_2011_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_FOUNTAIN_TP_ONLY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER1_TP_ONLY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AUREAL</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AUREAL_W01RN</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_BELKIN</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_FLIP_KVM</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_BTC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_BTC_EMPREX_REMOTE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_BTC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_BTC_EMPREX_REMOTE_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CHERRY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CHERRY_CYMOTION</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CHERRY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CHERRY_CYMOTION_SOLAR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CHICONY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CHICONY_TACTICAL_PAD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CHICONY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CHICONY_WIRELESS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CHICONY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CHICONY_WIRELESS2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CREATIVELABS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PRODIKEYS_PCMIDI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CYPRESS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CYPRESS_BARCODE_1</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CYPRESS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CYPRESS_BARCODE_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CYPRESS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CYPRESS_BARCODE_3</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CYPRESS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CYPRESS_MOUSE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_DRAGONRISE</span><span class="p">,</span> <span class="mh">0x0006</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_DRAGONRISE</span><span class="p">,</span> <span class="mh">0x0011</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ELECOM</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ELECOM_BM084</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_EMS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_EMS_TRIO_LINKER_PLUS_II</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_EZKEY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_BTC_8193</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GAMERON</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GAMERON_DUAL_PSX_ADAPTOR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GAMERON</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GAMERON_DUAL_PCS_ADAPTOR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GREENASIA</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GREENASIA</span><span class="p">,</span> <span class="mh">0x0012</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GYRATION</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GYRATION_REMOTE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GYRATION</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GYRATION_REMOTE_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GYRATION</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GYRATION_REMOTE_3</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_HOLTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_HOLTEK_ON_LINE_GRIP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KENSINGTON</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KS_SLIMBLADE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KEYTOUCH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KEYTOUCH_IEC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KYE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KYE_ERGO_525V</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KYE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KYE_EASYPEN_I405X</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KYE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KYE_MOUSEPEN_I608X</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KYE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KYE_EASYPEN_M610X</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LABTEC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LABTEC_WIRELESS_KEYBOARD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LCPOWER</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LCPOWER_LC1000</span> <span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MX3000_RECEIVER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_S510_RECEIVER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_S510_RECEIVER_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RECEIVER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DINOVO_DESKTOP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DINOVO_EDGE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DINOVO_MINI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_ELITE_KBD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_CORDLESS_DESKTOP_LX500</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_EXTREME_3D</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_WHEEL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RUMBLEPAD_CORD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RUMBLEPAD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RUMBLEPAD2_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_WINGMAN_F3D</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_WINGMAN_FFG</span> <span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_FORCE3D_PRO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_FLIGHT_SYSTEM_G940</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_MOMO_WHEEL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_MOMO_WHEEL2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_DFP_WHEEL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_DFGT_WHEEL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_G25_WHEEL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_G27_WHEEL</span><span class="p">)</span> <span class="p">},</span>
<span class="cp">#if IS_ENABLED(CONFIG_HID_LOGITECH_DJ)</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_UNIFYING_RECEIVER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_UNIFYING_RECEIVER_2</span><span class="p">)</span> <span class="p">},</span>
<span class="cp">#endif</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_WII_WHEEL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LOGITECH_RUMBLEPAD2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SPACETRAVELLER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LOGITECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SPACENAVIGATOR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROCHIP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PICOLCD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROCHIP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PICOLCD_BOOTLOADER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROSOFT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MS_COMFORT_MOUSE_4500</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROSOFT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SIDEWINDER_GV</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROSOFT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MS_NE4K</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROSOFT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MS_LK6K</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROSOFT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MS_PRESENTER_8K_USB</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROSOFT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MS_DIGITAL_MEDIA_3K</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROSOFT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WIRELESS_OPTICAL_DESKTOP_3_0</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MONTEREY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GENIUS_KB29E</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_1</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_3</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_4</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_5</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_6</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_7</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_8</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_9</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_10</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_11</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_12</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_13</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_14</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_15</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_16</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_17</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NTRIG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NTRIG_TOUCH_SCREEN_18</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ORTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ORTEK_PKB1700</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ORTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ORTEK_WKB2000</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_PETALYNX</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PETALYNX_MAXTER_REMOTE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_PRIMAX</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PRIMAX_KEYBOARD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_QUANTA</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PIXART_IMAGING_INC_OPTICAL_TOUCH_SCREEN</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ROCCAT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ROCCAT_KONE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ROCCAT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ROCCAT_ARVO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ROCCAT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ROCCAT_ISKU</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ROCCAT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ROCCAT_KONEPLUS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ROCCAT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ROCCAT_KOVAPLUS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ROCCAT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ROCCAT_PYRA_WIRED</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ROCCAT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ROCCAT_PYRA_WIRELESS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SAITEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SAITEK_PS1000</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SAMSUNG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SAMSUNG_IR_REMOTE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SAMSUNG</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SAMSUNG_WIRELESS_KBD_MOUSE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SKYCABLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SKYCABLE_WIRELESS_PRESENTER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SONY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SONY_PS3_CONTROLLER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SONY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SONY_NAVIGATION_CONTROLLER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SONY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SONY_PS3_CONTROLLER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SONY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SONY_VAIO_VGX_MOUSE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SUNPLUS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SUNPLUS_WDESKTOP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_THRUSTMASTER</span><span class="p">,</span> <span class="mh">0xb300</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_THRUSTMASTER</span><span class="p">,</span> <span class="mh">0xb304</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_THRUSTMASTER</span><span class="p">,</span> <span class="mh">0xb323</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_THRUSTMASTER</span><span class="p">,</span> <span class="mh">0xb324</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_THRUSTMASTER</span><span class="p">,</span> <span class="mh">0xb651</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_THRUSTMASTER</span><span class="p">,</span> <span class="mh">0xb653</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_THRUSTMASTER</span><span class="p">,</span> <span class="mh">0xb654</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_THRUSTMASTER</span><span class="p">,</span> <span class="mh">0xb65a</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_TIVO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_TIVO_SLIDE_BT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_TIVO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_TIVO_SLIDE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_TOPSEED</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_TOPSEED_CYBERLINK</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_TOPSEED2</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_TOPSEED2_RF_COMBO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_TWINHAN</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_TWINHAN_IR_REMOTE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_UCLOGIC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_UCLOGIC_TABLET_PF1209</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_UCLOGIC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_UCLOGIC_TABLET_WP4030U</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_UCLOGIC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_UCLOGIC_TABLET_WP5540U</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_UCLOGIC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_UCLOGIC_TABLET_WP8060U</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_UCLOGIC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_UCLOGIC_TABLET_WP1062</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_UCLOGIC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_UCLOGIC_WIRELESS_TABLET_TWHL850</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SMARTJOY_PLUS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SUPER_JOY_BOX_3</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DUAL_USB_JOYPAD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP_LTD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SUPER_JOY_BOX_3_PRO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP_LTD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SUPER_DUAL_BOX_PRO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP_LTD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SUPER_JOY_BOX_5_PRO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WACOM</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WACOM_GRAPHIRE_BLUETOOTH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WACOM</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WACOM_INTUOS4_BLUETOOTH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WALTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WALTOP_SLIM_TABLET_5_8_INCH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WALTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WALTOP_SLIM_TABLET_12_1_INCH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WALTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WALTOP_Q_PAD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WALTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WALTOP_PID_0038</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WALTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WALTOP_MEDIA_TABLET_10_6_INCH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WALTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WALTOP_MEDIA_TABLET_14_1_INCH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WALTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_WALTOP_SIRIUS_BATTERY_FREE_TABLET</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_X_TENSIONS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SPEEDLINK_VAD_CEZANNE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ZEROPLUS</span><span class="p">,</span> <span class="mh">0x0005</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ZEROPLUS</span><span class="p">,</span> <span class="mh">0x0030</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ZYDACRON</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ZYDACRON_REMOTE_CONTROL</span><span class="p">)</span> <span class="p">},</span>

	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROSOFT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MS_PRESENTER_8K_BT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NINTENDO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_NINTENDO_WIIMOTE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">hid_dynid</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">list_head</span> <span class="n">list</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">hid_device_id</span> <span class="n">id</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * store_new_id - add a new HID device ID to this driver and re-probe devices</span>
<span class="cm"> * @driver: target device driver</span>
<span class="cm"> * @buf: buffer for scanning device ID data</span>
<span class="cm"> * @count: input size</span>
<span class="cm"> *</span>
<span class="cm"> * Adds a new dynamic hid device ID to this driver,</span>
<span class="cm"> * and causes the driver to probe for all devices again.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">store_new_id</span><span class="p">(</span><span class="k">struct</span> <span class="n">device_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">,</span>
		<span class="kt">size_t</span> <span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_driver</span><span class="p">,</span> <span class="n">driver</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">hid_dynid</span> <span class="o">*</span><span class="n">dynid</span><span class="p">;</span>
	<span class="n">__u32</span> <span class="n">bus</span><span class="p">,</span> <span class="n">vendor</span><span class="p">,</span> <span class="n">product</span><span class="p">;</span>
	<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">driver_data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%x %x %x %lx&quot;</span><span class="p">,</span>
			<span class="o">&amp;</span><span class="n">bus</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vendor</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">product</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">driver_data</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>

	<span class="n">dynid</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">dynid</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">dynid</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">dynid</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">bus</span> <span class="o">=</span> <span class="n">bus</span><span class="p">;</span>
	<span class="n">dynid</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">HID_GROUP_ANY</span><span class="p">;</span>
	<span class="n">dynid</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">vendor</span> <span class="o">=</span> <span class="n">vendor</span><span class="p">;</span>
	<span class="n">dynid</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">product</span> <span class="o">=</span> <span class="n">product</span><span class="p">;</span>
	<span class="n">dynid</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">.</span><span class="n">driver_data</span> <span class="o">=</span> <span class="n">driver_data</span><span class="p">;</span>

	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_lock</span><span class="p">);</span>
	<span class="n">list_add_tail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dynid</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_list</span><span class="p">);</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_lock</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">driver_attach</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span> <span class="o">?</span> <span class="o">:</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">static</span> <span class="n">DRIVER_ATTR</span><span class="p">(</span><span class="n">new_id</span><span class="p">,</span> <span class="n">S_IWUSR</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">store_new_id</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_free_dynids</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_dynid</span> <span class="o">*</span><span class="n">dynid</span><span class="p">,</span> <span class="o">*</span><span class="n">n</span><span class="p">;</span>

	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_lock</span><span class="p">);</span>
	<span class="n">list_for_each_entry_safe</span><span class="p">(</span><span class="n">dynid</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_list</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">list_del</span><span class="p">(</span><span class="o">&amp;</span><span class="n">dynid</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">);</span>
		<span class="n">kfree</span><span class="p">(</span><span class="n">dynid</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_lock</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="nf">hid_match_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">,</span>
		<span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_dynid</span> <span class="o">*</span><span class="n">dynid</span><span class="p">;</span>

	<span class="n">spin_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_lock</span><span class="p">);</span>
	<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">dynid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_list</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hid_match_one_id</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dynid</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">))</span> <span class="p">{</span>
			<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_lock</span><span class="p">);</span>
			<span class="k">return</span> <span class="o">&amp;</span><span class="n">dynid</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="n">spin_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_lock</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">hid_match_id</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">id_table</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_bus_match</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_driver</span> <span class="o">*</span><span class="n">drv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">drv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_driver</span><span class="p">,</span> <span class="n">driver</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_device</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">hid_match_device</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">hdrv</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_device_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">,</span>
			<span class="k">struct</span> <span class="n">hid_driver</span><span class="p">,</span> <span class="n">driver</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_device</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
	<span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="o">*</span><span class="n">id</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">down_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver_lock</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINTR</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">id</span> <span class="o">=</span> <span class="n">hid_match_device</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">hdrv</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">id</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>
			<span class="k">goto</span> <span class="n">unlock</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver</span> <span class="o">=</span> <span class="n">hdrv</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">probe</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">probe</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>
		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="cm">/* default probe */</span>
			<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_open_report</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
				<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_hw_start</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">HID_CONNECT_DEFAULT</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">hid_close_report</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
			<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="nl">unlock:</span>
	<span class="n">up</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_device_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_device</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
	<span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">down_interruptible</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver_lock</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EINTR</span><span class="p">;</span>

	<span class="n">hdrv</span> <span class="o">=</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdrv</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">)</span>
			<span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
		<span class="k">else</span> <span class="cm">/* default remove */</span>
			<span class="n">hid_hw_stop</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
		<span class="n">hid_close_report</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">up</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver_lock</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">ssize_t</span> <span class="nf">modalias_show</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span>
			     <span class="kt">char</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_device</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">len</span><span class="p">;</span>

	<span class="n">len</span> <span class="o">=</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">PAGE_SIZE</span><span class="p">,</span> <span class="s">&quot;hid:b%04Xg%04Xv%08Xp%08X</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
		       <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">group</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">vendor</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span><span class="p">);</span>

	<span class="k">return</span> <span class="p">(</span><span class="n">len</span> <span class="o">&gt;=</span> <span class="n">PAGE_SIZE</span><span class="p">)</span> <span class="o">?</span> <span class="p">(</span><span class="n">PAGE_SIZE</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="n">len</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">device_attribute</span> <span class="n">hid_dev_attrs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">__ATTR_RO</span><span class="p">(</span><span class="n">modalias</span><span class="p">),</span>
	<span class="n">__ATTR_NULL</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">hid_uevent</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">kobj_uevent_env</span> <span class="o">*</span><span class="n">env</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="k">struct</span> <span class="n">hid_device</span><span class="p">,</span> <span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">add_uevent_var</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;HID_ID=%04X:%08X:%08X&quot;</span><span class="p">,</span>
			<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">vendor</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">add_uevent_var</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;HID_NAME=%s&quot;</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">add_uevent_var</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;HID_PHYS=%s&quot;</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">phys</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">add_uevent_var</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;HID_UNIQ=%s&quot;</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">uniq</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">add_uevent_var</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="s">&quot;MODALIAS=hid:b%04Xg%04Xv%08Xp%08X&quot;</span><span class="p">,</span>
			   <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">group</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">vendor</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">bus_type</span> <span class="n">hid_bus_type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">name</span>		<span class="o">=</span> <span class="s">&quot;hid&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">dev_attrs</span>	<span class="o">=</span> <span class="n">hid_dev_attrs</span><span class="p">,</span>
	<span class="p">.</span><span class="n">match</span>		<span class="o">=</span> <span class="n">hid_bus_match</span><span class="p">,</span>
	<span class="p">.</span><span class="n">probe</span>		<span class="o">=</span> <span class="n">hid_device_probe</span><span class="p">,</span>
	<span class="p">.</span><span class="n">remove</span>		<span class="o">=</span> <span class="n">hid_device_remove</span><span class="p">,</span>
	<span class="p">.</span><span class="n">uevent</span>		<span class="o">=</span> <span class="n">hid_uevent</span><span class="p">,</span>
<span class="p">};</span>

<span class="cm">/* a list of devices that shouldn&#39;t be handled by HID core at all */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="n">hid_ignore_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ACECAD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ACECAD_FLAIR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ACECAD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ACECAD_302</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ADS_TECH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ADS_TECH_RADIO_SI470X</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AIPTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AIPTEK_01</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AIPTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AIPTEK_10</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AIPTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AIPTEK_20</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AIPTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AIPTEK_21</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AIPTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AIPTEK_22</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AIPTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AIPTEK_23</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AIPTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AIPTEK_24</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AIRCABLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AIRCABLE1</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ALCOR</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ALCOR_USBRS232</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ASUSTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ASUSTEK_LCM</span><span class="p">)},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ASUSTEK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ASUSTEK_LCM2</span><span class="p">)},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AVERMEDIA</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AVER_FM_MR800</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_AXENTIA</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_AXENTIA_FM_RADIO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_BERKSHIRE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_BERKSHIRE_PCWD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CIDC</span><span class="p">,</span> <span class="mh">0x0103</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CYGNAL</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CYGNAL_RADIO_SI470X</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CMEDIA</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CM109</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CYPRESS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CYPRESS_HIDCOM</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_CYPRESS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_CYPRESS_ULTRAMOUSE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_DEALEXTREAME</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DEALEXTREAME_RADIO_SI4701</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_DELORME</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DELORME_EARTHMATE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_DELORME</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DELORME_EM_LT20</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_DREAM_CHEEKY</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_DREAM_CHEEKY</span><span class="p">,</span> <span class="mh">0x000a</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ESSENTIAL_REALITY</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ESSENTIAL_REALITY_P5</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ETT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_TC5UH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ETT</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_TC4UM</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GENERAL_TOUCH</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GENERAL_TOUCH</span><span class="p">,</span> <span class="mh">0x0002</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GENERAL_TOUCH</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GLAB</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_4_PHIDGETSERVO_30</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GLAB</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_1_PHIDGETSERVO_30</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GLAB</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_0_0_4_IF_KIT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GLAB</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_0_16_16_IF_KIT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GLAB</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_8_8_8_IF_KIT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GLAB</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_0_8_7_IF_KIT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GLAB</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_0_8_8_IF_KIT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GLAB</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PHIDGET_MOTORCONTROL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GOTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SUPER_Q2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GOTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GOGOPEN</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GOTOP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PENPOWER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GRETAGMACBETH</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GRETAGMACBETH_HUEY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GRIFFIN</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_POWERMATE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GRIFFIN</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SOUNDKNOB</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_90</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_100</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_101</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_103</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_104</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_105</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_106</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_107</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_108</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_200</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_201</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_202</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_203</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_204</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_205</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_206</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_207</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_300</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_301</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_302</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_303</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_304</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_305</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_306</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_307</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_308</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_309</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_400</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_401</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_402</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_403</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_404</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_405</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_500</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_501</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_502</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_503</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_504</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_1000</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_1001</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_1002</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_1003</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_1004</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_1005</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_1006</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_GTCO</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_GTCO_1007</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_IMATION</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_DISC_STAKKA</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KBGEAR</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KBGEAR_JAMSTUDIO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KWORLD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KWORLD_RADIO_FM700</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KYE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_KYE_GPEN_560</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_BLUETOOTH_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_KYE</span><span class="p">,</span> <span class="mh">0x0058</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_CASSY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_CASSY2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_POCKETCASSY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_POCKETCASSY2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MOBILECASSY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MOBILECASSY2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MICROCASSYVOLTAGE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MICROCASSYCURRENT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MICROCASSYTIME</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MICROCASSYTEMPERATURE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MICROCASSYPH</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_JWM</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_DMMP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_UMIP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_UMIC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_UMIB</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_XRAY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_XRAY2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_VIDEOCOM</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MOTOR</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_COM3LAB</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_TELEPORT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_NETWORKANALYSER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_POWERCONTROL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MACHINETEST</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MOSTANALYSER</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MOSTANALYSER2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_ABSESP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_AUTODATABUS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_MCT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_HYBRID</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_LD</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_LD_HEATCONTROL</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MCC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MCC_PMD1024LS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MCC</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_MCC_PMD1208LS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROCHIP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PICKIT1</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_MICROCHIP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PICKIT2</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_NATIONAL_SEMICONDUCTOR</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_N_S_HARMONY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">100</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">108</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">118</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">200</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">300</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">400</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_ONTRAK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_ONTRAK_ADU100</span> <span class="o">+</span> <span class="mi">500</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_PANJIT</span><span class="p">,</span> <span class="mh">0x0001</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_PANJIT</span><span class="p">,</span> <span class="mh">0x0002</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_PANJIT</span><span class="p">,</span> <span class="mh">0x0003</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_PANJIT</span><span class="p">,</span> <span class="mh">0x0004</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_PHILIPS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_PHILIPS_IEEE802154_DONGLE</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_POWERCOM</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_POWERCOM_UPS</span><span class="p">)</span> <span class="p">},</span>
<span class="cp">#if defined(CONFIG_MOUSE_SYNAPTICS_USB) || defined(CONFIG_MOUSE_SYNAPTICS_USB_MODULE)</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SYNAPTICS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SYNAPTICS_TP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SYNAPTICS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SYNAPTICS_INT_TP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SYNAPTICS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SYNAPTICS_CPAD</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SYNAPTICS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SYNAPTICS_STICK</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SYNAPTICS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SYNAPTICS_WP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SYNAPTICS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SYNAPTICS_COMP_TP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SYNAPTICS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SYNAPTICS_WTP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_SYNAPTICS</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_SYNAPTICS_DPAD</span><span class="p">)</span> <span class="p">},</span>
<span class="cp">#endif</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_VERNIER</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_VERNIER_LABPRO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_VERNIER</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_VERNIER_GOTEMP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_VERNIER</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_VERNIER_SKIP</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_VERNIER</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_VERNIER_CYCLOPS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_VERNIER</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_VERNIER_LCSPEC</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WACOM</span><span class="p">,</span> <span class="n">HID_ANY_ID</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_4_PHIDGETSERVO_20</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_1_PHIDGETSERVO_20</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_WISEGROUP</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_8_8_4_IF_KIT</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_YEALINK</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_YEALINK_P1K_P4K_B2K</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="cm">/**</span>
<span class="cm"> * hid_mouse_ignore_list - mouse devices which should not be handled by the hid layer</span>
<span class="cm"> *</span>
<span class="cm"> * There are composite devices for which we want to ignore only a certain</span>
<span class="cm"> * interface. This is a list of devices for which only the mouse interface will</span>
<span class="cm"> * be ignored. This allows a dedicated driver to take care of the interface.</span>
<span class="cm"> */</span>
<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">hid_device_id</span> <span class="n">hid_mouse_ignore_list</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="cm">/* appletouch driver */</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_FOUNTAIN_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_FOUNTAIN_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER3_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER3_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER3_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_HF_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_HF_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER4_HF_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING2_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING2_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING2_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING3_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING3_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING3_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4A_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4A_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING4A_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5A_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5A_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING5A_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6A_ANSI</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6A_ISO</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_WELLSPRING6A_JIS</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_FOUNTAIN_TP_ONLY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="n">HID_USB_DEVICE</span><span class="p">(</span><span class="n">USB_VENDOR_ID_APPLE</span><span class="p">,</span> <span class="n">USB_DEVICE_ID_APPLE_GEYSER1_TP_ONLY</span><span class="p">)</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">hid_ignore</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">vendor</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">USB_VENDOR_ID_CODEMERCS</span>:
		<span class="cm">/* ignore all Code Mercenaries IOWarrior devices */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">&gt;=</span> <span class="n">USB_DEVICE_ID_CODEMERCS_IOW_FIRST</span> <span class="o">&amp;&amp;</span>
				<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">&lt;=</span> <span class="n">USB_DEVICE_ID_CODEMERCS_IOW_LAST</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">USB_VENDOR_ID_LOGITECH</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">&gt;=</span> <span class="n">USB_DEVICE_ID_LOGITECH_HARMONY_FIRST</span> <span class="o">&amp;&amp;</span>
				<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">&lt;=</span> <span class="n">USB_DEVICE_ID_LOGITECH_HARMONY_LAST</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
		<span class="cm">/*</span>
<span class="cm">		 * The Keene FM transmitter USB device has the same USB ID as</span>
<span class="cm">		 * the Logitech AudioHub Speaker, but it should ignore the hid.</span>
<span class="cm">		 * Check if the name is that of the Keene device.</span>
<span class="cm">		 * For reference: the name of the AudioHub is</span>
<span class="cm">		 * &quot;HOLTEK  AudioHub Speaker&quot;.</span>
<span class="cm">		 */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">==</span> <span class="n">USB_DEVICE_ID_LOGITECH_AUDIOHUB</span> <span class="o">&amp;&amp;</span>
			<span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;HOLTEK  B-LINK USB Audio  &quot;</span><span class="p">))</span>
				<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">USB_VENDOR_ID_SOUNDGRAPH</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">&gt;=</span> <span class="n">USB_DEVICE_ID_SOUNDGRAPH_IMON_FIRST</span> <span class="o">&amp;&amp;</span>
		    <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">&lt;=</span> <span class="n">USB_DEVICE_ID_SOUNDGRAPH_IMON_LAST</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">USB_VENDOR_ID_HANWANG</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">&gt;=</span> <span class="n">USB_DEVICE_ID_HANWANG_TABLET_FIRST</span> <span class="o">&amp;&amp;</span>
		    <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">&lt;=</span> <span class="n">USB_DEVICE_ID_HANWANG_TABLET_LAST</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
		<span class="k">break</span><span class="p">;</span>
	<span class="k">case</span> <span class="n">USB_VENDOR_ID_JESS</span>:
		<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span> <span class="o">==</span> <span class="n">USB_DEVICE_ID_JESS_YUREX</span> <span class="o">&amp;&amp;</span>
				<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">HID_TYPE_USBNONE</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="k">break</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">HID_TYPE_USBMOUSE</span> <span class="o">&amp;&amp;</span>
			<span class="n">hid_match_id</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">hid_mouse_ignore_list</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>

	<span class="k">return</span> <span class="o">!!</span><span class="n">hid_match_id</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">hid_ignore_list</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">hid_add_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="n">atomic_t</span> <span class="n">id</span> <span class="o">=</span> <span class="n">ATOMIC_INIT</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">WARN_ON</span><span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">HID_STAT_ADDED</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">EBUSY</span><span class="p">;</span>

	<span class="cm">/* we need to kill them here, otherwise they will stay allocated to</span>
<span class="cm">	 * wait for coming driver */</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">HID_QUIRK_NO_IGNORE</span><span class="p">)</span>
            <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">hid_ignore</span><span class="p">(</span><span class="n">hdev</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">quirks</span> <span class="o">&amp;</span> <span class="n">HID_QUIRK_IGNORE</span><span class="p">)))</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Read the device report descriptor once and use as template</span>
<span class="cm">	 * for the driver-specific modifications.</span>
<span class="cm">	 */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">ll_driver</span><span class="o">-&gt;</span><span class="n">parse</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev_rdesc</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="n">ENODEV</span><span class="p">;</span>

	<span class="cm">/*</span>
<span class="cm">	 * Scan generic devices for group information</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hid_ignore_special_drivers</span> <span class="o">||</span>
	    <span class="o">!</span><span class="n">hid_match_id</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">hid_have_special_driver</span><span class="p">))</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">hid_scan_report</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
			<span class="n">hid_warn</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="s">&quot;bad device descriptor (%d)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="cm">/* XXX hack, any other cleaner solution after the driver core</span>
<span class="cm">	 * is converted to allow more than 20 bytes as the device name? */</span>
	<span class="n">dev_set_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;%04X:%04X:%04X.%04X&quot;</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">bus</span><span class="p">,</span>
		     <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">vendor</span><span class="p">,</span> <span class="n">hdev</span><span class="o">-&gt;</span><span class="n">product</span><span class="p">,</span> <span class="n">atomic_inc_return</span><span class="p">(</span><span class="o">&amp;</span><span class="n">id</span><span class="p">));</span>

	<span class="n">hid_debug_register</span><span class="p">(</span><span class="n">hdev</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">));</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">device_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">|=</span> <span class="n">HID_STAT_ADDED</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">hid_debug_unregister</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_add_device</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * hid_allocate_device - allocate new hid device descriptor</span>
<span class="cm"> *</span>
<span class="cm"> * Allocate and initialize hid device, so that hid_destroy_device might be</span>
<span class="cm"> * used to free it.</span>
<span class="cm"> *</span>
<span class="cm"> * New hid_device pointer is returned on success, otherwise ERR_PTR encoded</span>
<span class="cm"> * error value.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="nf">hid_allocate_device</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">ENOMEM</span><span class="p">;</span>

	<span class="n">hdev</span> <span class="o">=</span> <span class="n">kzalloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="o">*</span><span class="n">hdev</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ERR_PTR</span><span class="p">(</span><span class="n">ret</span><span class="p">);</span>

	<span class="n">device_initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">release</span> <span class="o">=</span> <span class="n">hid_device_release</span><span class="p">;</span>
	<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hid_bus_type</span><span class="p">;</span>

	<span class="n">hid_close_report</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>

	<span class="n">init_waitqueue_head</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">debug_wait</span><span class="p">);</span>
	<span class="n">INIT_LIST_HEAD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">debug_list</span><span class="p">);</span>
	<span class="n">sema_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">driver_lock</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">hdev</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_allocate_device</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">hid_remove_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">&amp;</span> <span class="n">HID_STAT_ADDED</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">device_del</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
		<span class="n">hid_debug_unregister</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
		<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">status</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">HID_STAT_ADDED</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">kfree</span><span class="p">(</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev_rdesc</span><span class="p">);</span>
	<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev_rdesc</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev_rsize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * hid_destroy_device - free previously allocated device</span>
<span class="cm"> *</span>
<span class="cm"> * @hdev: hid device</span>
<span class="cm"> *</span>
<span class="cm"> * If you allocate hid_device through hid_allocate_device, you should ever</span>
<span class="cm"> * free by this function.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">hid_destroy_device</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hdev</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hid_remove_device</span><span class="p">(</span><span class="n">hdev</span><span class="p">);</span>
	<span class="n">put_device</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_destroy_device</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">__hid_register_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span><span class="p">,</span> <span class="k">struct</span> <span class="n">module</span> <span class="o">*</span><span class="n">owner</span><span class="p">,</span>
		<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">mod_name</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
	<span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">.</span><span class="n">bus</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">hid_bus_type</span><span class="p">;</span>
	<span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span><span class="p">;</span>
	<span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">.</span><span class="n">mod_name</span> <span class="o">=</span> <span class="n">mod_name</span><span class="p">;</span>

	<span class="n">INIT_LIST_HEAD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_list</span><span class="p">);</span>
	<span class="n">spin_lock_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">dyn_lock</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">driver_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">driver_create_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">driver_attr_new_id</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="n">driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">__hid_register_driver</span><span class="p">);</span>

<span class="kt">void</span> <span class="nf">hid_unregister_driver</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_driver</span> <span class="o">*</span><span class="n">hdrv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">driver_remove_file</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">driver_attr_new_id</span><span class="p">);</span>
	<span class="n">driver_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hdrv</span><span class="o">-&gt;</span><span class="n">driver</span><span class="p">);</span>
	<span class="n">hid_free_dynids</span><span class="p">(</span><span class="n">hdrv</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_unregister_driver</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">hid_check_keys_pressed</span><span class="p">(</span><span class="k">struct</span> <span class="n">hid_device</span> <span class="o">*</span><span class="n">hid</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">hid_input</span> <span class="o">*</span><span class="n">hidinput</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">claimed</span> <span class="o">&amp;</span> <span class="n">HID_CLAIMED_INPUT</span><span class="p">))</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">hidinput</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">hid</span><span class="o">-&gt;</span><span class="n">inputs</span><span class="p">,</span> <span class="n">list</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">BITS_TO_LONGS</span><span class="p">(</span><span class="n">KEY_MAX</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">hidinput</span><span class="o">-&gt;</span><span class="n">input</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">hid_check_keys_pressed</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="n">__init</span> <span class="nf">hid_init</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">hid_debug</span><span class="p">)</span>
		<span class="n">pr_warn</span><span class="p">(</span><span class="s">&quot;hid_debug is now used solely for parser and driver debugging.</span><span class="se">\n</span><span class="s">&quot;</span>
			<span class="s">&quot;debugfs is now used for inspecting the device (report descriptor, reports)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">bus_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hid_bus_type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">pr_err</span><span class="p">(</span><span class="s">&quot;can&#39;t register hid bus</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">hidraw_init</span><span class="p">();</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err_bus</span><span class="p">;</span>

	<span class="n">hid_debug_init</span><span class="p">();</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">err_bus:</span>
	<span class="n">bus_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hid_bus_type</span><span class="p">);</span>
<span class="nl">err:</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="n">__exit</span> <span class="nf">hid_exit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">hid_debug_exit</span><span class="p">();</span>
	<span class="n">hidraw_exit</span><span class="p">();</span>
	<span class="n">bus_unregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hid_bus_type</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">module_init</span><span class="p">(</span><span class="n">hid_init</span><span class="p">);</span>
<span class="n">module_exit</span><span class="p">(</span><span class="n">hid_exit</span><span class="p">);</span>

<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Andreas Gal&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Vojtech Pavlik&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Jiri Kosina&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="n">DRIVER_LICENSE</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
