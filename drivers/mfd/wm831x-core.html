<!DOCTYPE html>
<html><head><title>joekychen/linux » drivers › mfd › wm831x-core.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../index.html"></a><h1>wm831x-core.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * wm831x-core.c  --  Device access for Wolfson WM831x PMICs</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright 2009 Wolfson Microelectronics PLC.</span>
<span class="cm"> *</span>
<span class="cm"> * Author: Mark Brown &lt;broonie@opensource.wolfsonmicro.com&gt;</span>
<span class="cm"> *</span>
<span class="cm"> *  This program is free software; you can redistribute  it and/or modify it</span>
<span class="cm"> *  under  the terms of  the GNU General  Public License as published by the</span>
<span class="cm"> *  Free Software Foundation;  either version 2 of the  License, or (at your</span>
<span class="cm"> *  option) any later version.</span>
<span class="cm"> *</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/kernel.h&gt;</span>
<span class="cp">#include &lt;linux/module.h&gt;</span>
<span class="cp">#include &lt;linux/bcd.h&gt;</span>
<span class="cp">#include &lt;linux/delay.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/core.h&gt;</span>
<span class="cp">#include &lt;linux/slab.h&gt;</span>
<span class="cp">#include &lt;linux/err.h&gt;</span>

<span class="cp">#include &lt;linux/mfd/wm831x/core.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/wm831x/pdata.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/wm831x/irq.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/wm831x/auxadc.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/wm831x/otp.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/wm831x/pmu.h&gt;</span>
<span class="cp">#include &lt;linux/mfd/wm831x/regulator.h&gt;</span>

<span class="cm">/* Current settings - values are 2*2^(reg_val/4) microamps.  These are</span>
<span class="cm"> * exported since they are used by multiple drivers.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="n">wm831x_isinkv_values</span><span class="p">[</span><span class="n">WM831X_ISINK_MAX_ISEL</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="mi">2</span><span class="p">,</span>
	<span class="mi">2</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">3</span><span class="p">,</span>
	<span class="mi">4</span><span class="p">,</span>
	<span class="mi">5</span><span class="p">,</span>
	<span class="mi">6</span><span class="p">,</span>
	<span class="mi">7</span><span class="p">,</span>
	<span class="mi">8</span><span class="p">,</span>
	<span class="mi">10</span><span class="p">,</span>
	<span class="mi">11</span><span class="p">,</span>
	<span class="mi">13</span><span class="p">,</span>
	<span class="mi">16</span><span class="p">,</span>
	<span class="mi">19</span><span class="p">,</span>
	<span class="mi">23</span><span class="p">,</span>
	<span class="mi">27</span><span class="p">,</span>
	<span class="mi">32</span><span class="p">,</span>
	<span class="mi">38</span><span class="p">,</span>
	<span class="mi">45</span><span class="p">,</span>
	<span class="mi">54</span><span class="p">,</span>
	<span class="mi">64</span><span class="p">,</span>
	<span class="mi">76</span><span class="p">,</span>
	<span class="mi">91</span><span class="p">,</span>
	<span class="mi">108</span><span class="p">,</span>
	<span class="mi">128</span><span class="p">,</span>
	<span class="mi">152</span><span class="p">,</span>
	<span class="mi">181</span><span class="p">,</span>
	<span class="mi">215</span><span class="p">,</span>
	<span class="mi">256</span><span class="p">,</span>
	<span class="mi">304</span><span class="p">,</span>
	<span class="mi">362</span><span class="p">,</span>
	<span class="mi">431</span><span class="p">,</span>
	<span class="mi">512</span><span class="p">,</span>
	<span class="mi">609</span><span class="p">,</span>
	<span class="mi">724</span><span class="p">,</span>
	<span class="mi">861</span><span class="p">,</span>
	<span class="mi">1024</span><span class="p">,</span>
	<span class="mi">1218</span><span class="p">,</span>
	<span class="mi">1448</span><span class="p">,</span>
	<span class="mi">1722</span><span class="p">,</span>
	<span class="mi">2048</span><span class="p">,</span>
	<span class="mi">2435</span><span class="p">,</span>
	<span class="mi">2896</span><span class="p">,</span>
	<span class="mi">3444</span><span class="p">,</span>
	<span class="mi">4096</span><span class="p">,</span>
	<span class="mi">4871</span><span class="p">,</span>
	<span class="mi">5793</span><span class="p">,</span>
	<span class="mi">6889</span><span class="p">,</span>
	<span class="mi">8192</span><span class="p">,</span>
	<span class="mi">9742</span><span class="p">,</span>
	<span class="mi">11585</span><span class="p">,</span>
	<span class="mi">13777</span><span class="p">,</span>
	<span class="mi">16384</span><span class="p">,</span>
	<span class="mi">19484</span><span class="p">,</span>
	<span class="mi">23170</span><span class="p">,</span>
	<span class="mi">27554</span><span class="p">,</span>
<span class="p">};</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_isinkv_values</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wm831x_reg_locked</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">locked</span><span class="p">)</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WM831X_WATCHDOG</span>:
	<span class="k">case</span> <span class="n">WM831X_DC4_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_ON_PIN_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_BACKUP_CHARGER_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_CONTROL_2</span>:
		<span class="k">return</span> <span class="mi">1</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * wm831x_reg_unlock: Unlock user keyed registers</span>
<span class="cm"> *</span>
<span class="cm"> * The WM831x has a user key preventing writes to particularly</span>
<span class="cm"> * critical registers.  This function locks those registers,</span>
<span class="cm"> * allowing writes to them.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">wm831x_reg_lock</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_reg_write</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_SECURITY_KEY</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_vdbg</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Registers locked</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>
		<span class="n">WARN_ON</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">locked</span><span class="p">);</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">locked</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to lock registers: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
	<span class="p">}</span>

<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_reg_lock</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * wm831x_reg_unlock: Unlock user keyed registers</span>
<span class="cm"> *</span>
<span class="cm"> * The WM831x has a user key preventing writes to particularly</span>
<span class="cm"> * critical registers.  This function locks those registers,</span>
<span class="cm"> * preventing spurious writes.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">wm831x_reg_unlock</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="cm">/* 0x9716 is the value required to unlock the registers */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_reg_write</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_SECURITY_KEY</span><span class="p">,</span> <span class="mh">0x9716</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_vdbg</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Registers unlocked</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>

		<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>
		<span class="n">WARN_ON</span><span class="p">(</span><span class="o">!</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">locked</span><span class="p">);</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">locked</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
		<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_reg_unlock</span><span class="p">);</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wm831x_reg_readable</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WM831X_RESET_ID</span>:
	<span class="k">case</span> <span class="n">WM831X_REVISION</span>:
	<span class="k">case</span> <span class="n">WM831X_PARENT_ID</span>:
	<span class="k">case</span> <span class="n">WM831X_SYSVDD_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_THERMAL_MONITORING</span>:
	<span class="k">case</span> <span class="n">WM831X_POWER_STATE</span>:
	<span class="k">case</span> <span class="n">WM831X_WATCHDOG</span>:
	<span class="k">case</span> <span class="n">WM831X_ON_PIN_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_RESET_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_CONTROL_INTERFACE</span>:
	<span class="k">case</span> <span class="n">WM831X_SECURITY_KEY</span>:
	<span class="k">case</span> <span class="n">WM831X_SOFTWARE_SCRATCH</span>:
	<span class="k">case</span> <span class="n">WM831X_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO_LEVEL</span>:
	<span class="k">case</span> <span class="n">WM831X_SYSTEM_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_ON_SOURCE</span>:
	<span class="k">case</span> <span class="n">WM831X_OFF_SOURCE</span>:
	<span class="k">case</span> <span class="n">WM831X_SYSTEM_INTERRUPTS</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_1</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_2</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_3</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_4</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_5</span>:
	<span class="k">case</span> <span class="n">WM831X_IRQ_CONFIG</span>:
	<span class="k">case</span> <span class="n">WM831X_SYSTEM_INTERRUPTS_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_1_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_2_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_3_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_4_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_5_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_WRITE_COUNTER</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_TIME_1</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_TIME_2</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_ALARM_1</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_ALARM_2</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_TRIM</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_DATA_X</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_DATA_Y</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_DATA_Z</span>:
	<span class="k">case</span> <span class="n">WM831X_AUXADC_DATA</span>:
	<span class="k">case</span> <span class="n">WM831X_AUXADC_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_AUXADC_SOURCE</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_1</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_2</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_3</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_4</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO1_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO2_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO3_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO4_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO5_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO6_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO7_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO8_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO9_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO10_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO11_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO12_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO13_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO14_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO15_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO16_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_BACKUP_CHARGER_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_STATUS_LED_1</span>:
	<span class="k">case</span> <span class="n">WM831X_STATUS_LED_2</span>:
	<span class="k">case</span> <span class="n">WM831X_CURRENT_SINK_1</span>:
	<span class="k">case</span> <span class="n">WM831X_CURRENT_SINK_2</span>:
	<span class="k">case</span> <span class="n">WM831X_DCDC_ENABLE</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO_ENABLE</span>:
	<span class="k">case</span> <span class="n">WM831X_DCDC_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_DCDC_UV_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO_UV_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_ON_CONFIG</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_DVS_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_ON_CONFIG</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_DVS_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_ON_CONFIG</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC4_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC4_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_EPE1_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_EPE2_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO1_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO1_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO1_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO2_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO2_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO2_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO3_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO3_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO3_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO4_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO4_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO4_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO5_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO5_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO5_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO6_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO6_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO6_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO7_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO7_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO7_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO8_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO8_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO8_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO9_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO9_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO9_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO10_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO10_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO10_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO11_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO11_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_POWER_GOOD_SOURCE_1</span>:
	<span class="k">case</span> <span class="n">WM831X_POWER_GOOD_SOURCE_2</span>:
	<span class="k">case</span> <span class="n">WM831X_CLOCK_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_CLOCK_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_3</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_4</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_5</span>:
	<span class="k">case</span> <span class="n">WM831X_UNIQUE_ID_1</span>:
	<span class="k">case</span> <span class="n">WM831X_UNIQUE_ID_2</span>:
	<span class="k">case</span> <span class="n">WM831X_UNIQUE_ID_3</span>:
	<span class="k">case</span> <span class="n">WM831X_UNIQUE_ID_4</span>:
	<span class="k">case</span> <span class="n">WM831X_UNIQUE_ID_5</span>:
	<span class="k">case</span> <span class="n">WM831X_UNIQUE_ID_6</span>:
	<span class="k">case</span> <span class="n">WM831X_UNIQUE_ID_7</span>:
	<span class="k">case</span> <span class="n">WM831X_UNIQUE_ID_8</span>:
	<span class="k">case</span> <span class="n">WM831X_FACTORY_OTP_ID</span>:
	<span class="k">case</span> <span class="n">WM831X_FACTORY_OTP_1</span>:
	<span class="k">case</span> <span class="n">WM831X_FACTORY_OTP_2</span>:
	<span class="k">case</span> <span class="n">WM831X_FACTORY_OTP_3</span>:
	<span class="k">case</span> <span class="n">WM831X_FACTORY_OTP_4</span>:
	<span class="k">case</span> <span class="n">WM831X_FACTORY_OTP_5</span>:
	<span class="k">case</span> <span class="n">WM831X_CUSTOMER_OTP_ID</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO1_2_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO3_4_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO5_6_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO7_8_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO9_10_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO11_EPE_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO1_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO2_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO3_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO4_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO5_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO6_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DBE_CHECK_DATA</span>:
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wm831x_reg_writeable</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span> <span class="o">=</span> <span class="n">dev_get_drvdata</span><span class="p">(</span><span class="n">dev</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">wm831x_reg_locked</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">reg</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WM831X_SYSVDD_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_THERMAL_MONITORING</span>:
	<span class="k">case</span> <span class="n">WM831X_POWER_STATE</span>:
	<span class="k">case</span> <span class="n">WM831X_WATCHDOG</span>:
	<span class="k">case</span> <span class="n">WM831X_ON_PIN_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_RESET_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_CONTROL_INTERFACE</span>:
	<span class="k">case</span> <span class="n">WM831X_SECURITY_KEY</span>:
	<span class="k">case</span> <span class="n">WM831X_SOFTWARE_SCRATCH</span>:
	<span class="k">case</span> <span class="n">WM831X_OTP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO_LEVEL</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_1</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_2</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_3</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_4</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_5</span>:
	<span class="k">case</span> <span class="n">WM831X_IRQ_CONFIG</span>:
	<span class="k">case</span> <span class="n">WM831X_SYSTEM_INTERRUPTS_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_1_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_2_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_3_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_4_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_5_MASK</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_TIME_1</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_TIME_2</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_ALARM_1</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_ALARM_2</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_TRIM</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_AUXADC_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_AUXADC_SOURCE</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_1</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_2</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_3</span>:
	<span class="k">case</span> <span class="n">WM831X_COMPARATOR_4</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO1_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO2_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO3_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO4_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO5_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO6_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO7_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO8_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO9_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO10_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO11_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO12_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO13_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO14_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO15_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO16_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_BACKUP_CHARGER_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_STATUS_LED_1</span>:
	<span class="k">case</span> <span class="n">WM831X_STATUS_LED_2</span>:
	<span class="k">case</span> <span class="n">WM831X_CURRENT_SINK_1</span>:
	<span class="k">case</span> <span class="n">WM831X_CURRENT_SINK_2</span>:
	<span class="k">case</span> <span class="n">WM831X_DCDC_ENABLE</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO_ENABLE</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_ON_CONFIG</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC1_DVS_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_ON_CONFIG</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC2_DVS_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_ON_CONFIG</span>:
	<span class="k">case</span> <span class="n">WM831X_DC3_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC4_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_DC4_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_EPE1_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_EPE2_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO1_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO1_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO1_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO2_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO2_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO2_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO3_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO3_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO3_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO4_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO4_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO4_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO5_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO5_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO5_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO6_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO6_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO6_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO7_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO7_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO7_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO8_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO8_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO8_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO9_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO9_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO9_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO10_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO10_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO10_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO11_ON_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO11_SLEEP_CONTROL</span>:
	<span class="k">case</span> <span class="n">WM831X_POWER_GOOD_SOURCE_1</span>:
	<span class="k">case</span> <span class="n">WM831X_POWER_GOOD_SOURCE_2</span>:
	<span class="k">case</span> <span class="n">WM831X_CLOCK_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_CLOCK_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_1</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_2</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_3</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_4</span>:
	<span class="k">case</span> <span class="n">WM831X_FLL_CONTROL_5</span>:
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">bool</span> <span class="nf">wm831x_reg_volatile</span><span class="p">(</span><span class="k">struct</span> <span class="n">device</span> <span class="o">*</span><span class="n">dev</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WM831X_SYSTEM_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_ON_SOURCE</span>:
	<span class="k">case</span> <span class="n">WM831X_OFF_SOURCE</span>:
	<span class="k">case</span> <span class="n">WM831X_GPIO_LEVEL</span>:
	<span class="k">case</span> <span class="n">WM831X_SYSTEM_INTERRUPTS</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_1</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_2</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_3</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_4</span>:
	<span class="k">case</span> <span class="n">WM831X_INTERRUPT_STATUS_5</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_TIME_1</span>:
	<span class="k">case</span> <span class="n">WM831X_RTC_TIME_2</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_DATA_X</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_DATA_Y</span>:
	<span class="k">case</span> <span class="n">WM831X_TOUCH_DATA_Z</span>:
	<span class="k">case</span> <span class="n">WM831X_AUXADC_DATA</span>:
	<span class="k">case</span> <span class="n">WM831X_CHARGER_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_DCDC_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_DCDC_UV_STATUS</span>:
	<span class="k">case</span> <span class="n">WM831X_LDO_UV_STATUS</span>:
		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * wm831x_reg_read: Read a single WM831x register.</span>
<span class="cm"> *</span>
<span class="cm"> * @wm831x: Device to read from.</span>
<span class="cm"> * @reg: Register to read.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">wm831x_reg_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">val</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">regmap_read</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="k">return</span> <span class="n">val</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_reg_read</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * wm831x_bulk_read: Read multiple WM831x registers</span>
<span class="cm"> *</span>
<span class="cm"> * @wm831x: Device to read from</span>
<span class="cm"> * @reg: First register</span>
<span class="cm"> * @count: Number of registers</span>
<span class="cm"> * @buf: Buffer to fill.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">wm831x_bulk_read</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span>
		     <span class="kt">int</span> <span class="n">count</span><span class="p">,</span> <span class="n">u16</span> <span class="o">*</span><span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">regmap_bulk_read</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_bulk_read</span><span class="p">);</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">wm831x_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span>
			<span class="kt">int</span> <span class="n">bytes</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">src</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">u16</span> <span class="o">*</span><span class="n">buf</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bytes</span> <span class="o">%</span> <span class="mi">2</span><span class="p">);</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">bytes</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">);</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">bytes</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">wm831x_reg_locked</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">reg</span><span class="p">))</span>
			<span class="k">return</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>

		<span class="n">dev_vdbg</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Write %04x to R%d(0x%x)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">reg</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">reg</span> <span class="o">+</span> <span class="n">i</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">regmap_write</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">,</span> <span class="n">reg</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/**</span>
<span class="cm"> * wm831x_reg_write: Write a single WM831x register.</span>
<span class="cm"> *</span>
<span class="cm"> * @wm831x: Device to write to.</span>
<span class="cm"> * @reg: Register to write to.</span>
<span class="cm"> * @val: Value to write.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">wm831x_reg_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span>
		     <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_write</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">val</span><span class="p">);</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_reg_write</span><span class="p">);</span>

<span class="cm">/**</span>
<span class="cm"> * wm831x_set_bits: Set the value of a bitfield in a WM831x register</span>
<span class="cm"> *</span>
<span class="cm"> * @wm831x: Device to write to.</span>
<span class="cm"> * @reg: Register to write to.</span>
<span class="cm"> * @mask: Mask of bits to set.</span>
<span class="cm"> * @val: Value to set (unshifted)</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">wm831x_set_bits</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">reg</span><span class="p">,</span>
		    <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">mask</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">;</span>

	<span class="n">mutex_lock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">wm831x_reg_locked</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">reg</span><span class="p">))</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">regmap_update_bits</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">regmap</span><span class="p">,</span> <span class="n">reg</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">val</span><span class="p">);</span>
	<span class="k">else</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EPERM</span><span class="p">;</span>

	<span class="n">mutex_unlock</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_set_bits</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_io_parent</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="mh">0xffffffff</span><span class="p">,</span>
	<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_dcdc1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_DC1_CONTROL_1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_DC1_DVS_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;HC&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_HC_DC1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_HC_DC1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_dcdc2_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_DC2_CONTROL_1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_DC2_DVS_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;HC&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_HC_DC2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_HC_DC2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_dcdc3_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_DC3_CONTROL_1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_DC3_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_dcdc4_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_DC4_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_DC4_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm8320_dcdc4_buck_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_DC4_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM832X_DC4_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_DC4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_gpio_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_GPIO_1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_GPIO_16</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_isink1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_CURRENT_SINK_1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_CURRENT_SINK_1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CS1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CS1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_isink2_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_CURRENT_SINK_2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_CURRENT_SINK_2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CS2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CS2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO1_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO1_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo2_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO2_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO2_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo3_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO3_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO3_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo4_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO4_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO4_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo5_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO5_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO5_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo6_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO6_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO6_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo7_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO7_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO7_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo8_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO8_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO8_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo9_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO9_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO9_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo10_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO10_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO10_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span>  <span class="o">=</span> <span class="s">&quot;UV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_UV_LDO10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_ldo11_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_LDO11_ON_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_LDO11_SLEEP_CONTROL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_on_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_ON</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_ON</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>


<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_power_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;SYSLO&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_PPM_SYSLO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_PPM_SYSLO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PWR SRC&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_PPM_PWR_SRC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_PPM_PWR_SRC</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;USB CURR&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_PPM_USB_CURR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_PPM_USB_CURR</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;BATT HOT&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_BATT_HOT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_BATT_HOT</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;BATT COLD&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_BATT_COLD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_BATT_COLD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;BATT FAIL&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_BATT_FAIL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_BATT_FAIL</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;OV&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_OV</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_OV</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;END&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_END</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_END</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;TO&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_TO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_TO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;MODE&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_MODE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_MODE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;START&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_START</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_CHG_START</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_rtc_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;PER&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_RTC_PER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_RTC_PER</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ALM&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_RTC_ALM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_RTC_ALM</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_status1_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_STATUS_LED_1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_STATUS_LED_1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_status2_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">wm831x_io_parent</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_STATUS_LED_2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_STATUS_LED_2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IO</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_touch_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;TCHPD&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_TCHPD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_TCHPD</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;TCHDATA&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_TCHDATA</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_TCHDATA</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">resource</span> <span class="n">wm831x_wdt_resources</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">WM831X_IRQ_WDOG_TO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">end</span>   <span class="o">=</span> <span class="n">WM831X_IRQ_WDOG_TO</span><span class="p">,</span>
		<span class="p">.</span><span class="n">flags</span> <span class="o">=</span> <span class="n">IORESOURCE_IRQ</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mfd_cell</span> <span class="n">wm8310_devs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-backup&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckp&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc3_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc3_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-boostp&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc4_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc4_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-clk&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-epe&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-epe&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-gpio&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_gpio_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_gpio_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-hwmon&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-isink&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_isink1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_isink1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-isink&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_isink2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_isink2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo3_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo3_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo4_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo4_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo5_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo5_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo6_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo6_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo7_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo7_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo8_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo8_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo9_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo9_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo10_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo10_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-alive-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo11_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo11_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-on&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_on_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_on_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-power&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_power_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_power_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-status&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_status1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_status1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-status&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_status2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_status2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-watchdog&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_wdt_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_wdt_resources</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mfd_cell</span> <span class="n">wm8311_devs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-backup&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckp&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc3_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc3_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-boostp&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc4_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc4_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-clk&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-epe&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-epe&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-gpio&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_gpio_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_gpio_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-hwmon&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-isink&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_isink1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_isink1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-isink&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_isink2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_isink2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo3_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo3_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo4_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo4_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo5_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo5_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo7_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo7_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-alive-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo11_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo11_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-on&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_on_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_on_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-power&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_power_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_power_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-status&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_status1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_status1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-status&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_status2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_status2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-watchdog&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_wdt_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_wdt_resources</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mfd_cell</span> <span class="n">wm8312_devs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-backup&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckp&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc3_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc3_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-boostp&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc4_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc4_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-clk&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-epe&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-epe&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-gpio&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_gpio_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_gpio_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-hwmon&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-isink&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_isink1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_isink1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-isink&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_isink2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_isink2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo3_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo3_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo4_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo4_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo5_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo5_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo6_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo6_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo7_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo7_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo8_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo8_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo9_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo9_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo10_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo10_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-alive-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo11_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo11_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-on&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_on_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_on_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-power&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_power_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_power_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-status&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_status1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_status1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-status&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_status2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_status2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-watchdog&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_wdt_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_wdt_resources</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mfd_cell</span> <span class="n">wm8320_devs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-backup&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckv&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckp&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_dcdc3_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_dcdc3_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-buckp&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm8320_dcdc4_buck_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm8320_dcdc4_buck_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-clk&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-gpio&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_gpio_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_gpio_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-hwmon&quot;</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo3_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo3_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo4_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo4_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo5_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo5_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo6_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo6_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo7_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo7_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo8_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo8_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo9_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo9_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-aldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo10_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo10_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-alive-ldo&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_ldo11_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_ldo11_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-on&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_on_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_on_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-status&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_status1_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_status1_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-status&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_status2_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_status2_resources</span><span class="p">,</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-watchdog&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_wdt_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_wdt_resources</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mfd_cell</span> <span class="n">touch_devs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-touch&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_touch_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_touch_resources</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mfd_cell</span> <span class="n">rtc_devs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-rtc&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">num_resources</span> <span class="o">=</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm831x_rtc_resources</span><span class="p">),</span>
		<span class="p">.</span><span class="n">resources</span> <span class="o">=</span> <span class="n">wm831x_rtc_resources</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">mfd_cell</span> <span class="n">backlight_devs</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;wm831x-backlight&quot;</span><span class="p">,</span>
	<span class="p">},</span>
<span class="p">};</span>

<span class="k">struct</span> <span class="n">regmap_config</span> <span class="n">wm831x_regmap_config</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">reg_bits</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
	<span class="p">.</span><span class="n">val_bits</span> <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>

	<span class="p">.</span><span class="n">cache_type</span> <span class="o">=</span> <span class="n">REGCACHE_RBTREE</span><span class="p">,</span>

	<span class="p">.</span><span class="n">max_register</span> <span class="o">=</span> <span class="n">WM831X_DBE_CHECK_DATA</span><span class="p">,</span>
	<span class="p">.</span><span class="n">readable_reg</span> <span class="o">=</span> <span class="n">wm831x_reg_readable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">writeable_reg</span> <span class="o">=</span> <span class="n">wm831x_reg_writeable</span><span class="p">,</span>
	<span class="p">.</span><span class="n">volatile_reg</span> <span class="o">=</span> <span class="n">wm831x_reg_volatile</span><span class="p">,</span>
<span class="p">};</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_regmap_config</span><span class="p">);</span>

<span class="cm">/*</span>
<span class="cm"> * Instantiate the generic non-control parts of the device.</span>
<span class="cm"> */</span>
<span class="kt">int</span> <span class="nf">wm831x_device_init</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">irq</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">wm831x_pdata</span> <span class="o">*</span><span class="n">pdata</span> <span class="o">=</span> <span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">platform_data</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">rev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">;</span>
	<span class="k">enum</span> <span class="n">wm831x_parent</span> <span class="n">parent</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">ret</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>

	<span class="n">mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">io_lock</span><span class="p">);</span>
	<span class="n">mutex_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">key_lock</span><span class="p">);</span>
	<span class="n">dev_set_drvdata</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x</span><span class="p">);</span>
	<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">soft_shutdown</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">soft_shutdown</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_reg_read</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_PARENT_ID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to read parent ID: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="mh">0x6204</span>:
	<span class="k">case</span> <span class="mh">0x6246</span>:
		<span class="k">break</span><span class="p">;</span>
	<span class="nl">default:</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Device is not a WM831x: ID %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_reg_read</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_REVISION</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to read revision: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="n">rev</span> <span class="o">=</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&amp;</span> <span class="n">WM831X_PARENT_REV_MASK</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">WM831X_PARENT_REV_SHIFT</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_reg_read</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_RESET_ID</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to read device ID: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Some engineering samples do not have the ID set, rely on</span>
<span class="cm">	 * the device being registered correctly.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Device is an engineering sample</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">id</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">switch</span> <span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WM8310</span>:
		<span class="n">parent</span> <span class="o">=</span> <span class="n">WM8310</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">num_gpio</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">charger_irq_wake</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rev</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">has_gpio_ena</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">has_cs_sts</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;WM8310 revision %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">rev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8311</span>:
		<span class="n">parent</span> <span class="o">=</span> <span class="n">WM8311</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">num_gpio</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">charger_irq_wake</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rev</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">has_gpio_ena</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">has_cs_sts</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;WM8311 revision %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">rev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8312</span>:
		<span class="n">parent</span> <span class="o">=</span> <span class="n">WM8312</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">num_gpio</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">charger_irq_wake</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">rev</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">has_gpio_ena</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
			<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">has_cs_sts</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
		<span class="p">}</span>

		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;WM8312 revision %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">rev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8320</span>:
		<span class="n">parent</span> <span class="o">=</span> <span class="n">WM8320</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">num_gpio</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;WM8320 revision %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">rev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8321</span>:
		<span class="n">parent</span> <span class="o">=</span> <span class="n">WM8321</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">num_gpio</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;WM8321 revision %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">rev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8325</span>:
		<span class="n">parent</span> <span class="o">=</span> <span class="n">WM8325</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">num_gpio</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;WM8325 revision %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">rev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8326</span>:
		<span class="n">parent</span> <span class="o">=</span> <span class="n">WM8326</span><span class="p">;</span>
		<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">num_gpio</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;WM8326 revision %c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="n">rev</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Unknown WM831x device %04x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* This will need revisiting in future but is OK for all</span>
<span class="cm">	 * current parts.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="o">!=</span> <span class="n">id</span><span class="p">)</span>
		<span class="n">dev_warn</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Device was registered as a WM%lx</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">id</span><span class="p">);</span>

	<span class="cm">/* Bootstrap the user key */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_reg_read</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_SECURITY_KEY</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to read security key: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_warn</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Security key had non-zero value %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
			 <span class="n">ret</span><span class="p">);</span>
		<span class="n">wm831x_reg_write</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_SECURITY_KEY</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">locked</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span> <span class="o">&amp;&amp;</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">pre_init</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">pre_init</span><span class="p">(</span><span class="n">wm831x</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;pre_init() failed: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">gpio_defaults</span><span class="p">);</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">gpio_defaults</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
				<span class="k">continue</span><span class="p">;</span>

			<span class="n">wm831x_reg_write</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span>
					 <span class="n">WM831X_GPIO1_CONTROL</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span>
					 <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">gpio_defaults</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="cm">/* Multiply by 10 as we have many subdevices of the same type */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span> <span class="o">&amp;&amp;</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">wm831x_num</span><span class="p">)</span>
		<span class="n">wm831x_num</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">wm831x_num</span> <span class="o">*</span> <span class="mi">10</span><span class="p">;</span>
	<span class="k">else</span>
		<span class="n">wm831x_num</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_irq_init</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">irq</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">err</span><span class="p">;</span>

	<span class="n">wm831x_auxadc_init</span><span class="p">(</span><span class="n">wm831x</span><span class="p">);</span>

	<span class="cm">/* The core device is up, instantiate the subdevices. */</span>
	<span class="k">switch</span> <span class="p">(</span><span class="n">parent</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">case</span> <span class="n">WM8310</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mfd_add_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">,</span>
				      <span class="n">wm8310_devs</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm8310_devs</span><span class="p">),</span>
				      <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8311</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mfd_add_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">,</span>
				      <span class="n">wm8311_devs</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm8311_devs</span><span class="p">),</span>
				      <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pdata</span> <span class="o">||</span> <span class="o">!</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">disable_touch</span><span class="p">)</span>
			<span class="n">mfd_add_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">,</span>
					<span class="n">touch_devs</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">touch_devs</span><span class="p">),</span>
					<span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8312</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mfd_add_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">,</span>
				      <span class="n">wm8312_devs</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm8312_devs</span><span class="p">),</span>
				      <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pdata</span> <span class="o">||</span> <span class="o">!</span><span class="n">pdata</span><span class="o">-&gt;</span><span class="n">disable_touch</span><span class="p">)</span>
			<span class="n">mfd_add_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">,</span>
					<span class="n">touch_devs</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">touch_devs</span><span class="p">),</span>
					<span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="k">case</span> <span class="n">WM8320</span>:
	<span class="k">case</span> <span class="n">WM8321</span>:
	<span class="k">case</span> <span class="n">WM8325</span>:
	<span class="k">case</span> <span class="n">WM8326</span>:
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mfd_add_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">,</span>
				      <span class="n">wm8320_devs</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">wm8320_devs</span><span class="p">),</span>
				      <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">break</span><span class="p">;</span>

	<span class="nl">default:</span>
		<span class="cm">/* If this happens the bus probe function is buggy */</span>
		<span class="n">BUG</span><span class="p">();</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to add children</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err_irq</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* The RTC can only be used if the 32.768kHz crystal is</span>
<span class="cm">	 * enabled; this can&#39;t be controlled by software at runtime.</span>
<span class="cm">	 */</span>
	<span class="n">ret</span> <span class="o">=</span> <span class="n">wm831x_reg_read</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_CLOCK_CONTROL_2</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to read clock status: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
		<span class="k">goto</span> <span class="n">err_irq</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&amp;</span> <span class="n">WM831X_XTAL_ENA</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mfd_add_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">,</span>
				      <span class="n">rtc_devs</span><span class="p">,</span> <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">rtc_devs</span><span class="p">),</span>
				      <span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to add RTC: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">err_irq</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;32.768kHz clock disabled, no RTC</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span> <span class="o">&amp;&amp;</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">backlight</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/* Treat errors as non-critical */</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">mfd_add_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">wm831x_num</span><span class="p">,</span> <span class="n">backlight_devs</span><span class="p">,</span>
				      <span class="n">ARRAY_SIZE</span><span class="p">(</span><span class="n">backlight_devs</span><span class="p">),</span> <span class="nb">NULL</span><span class="p">,</span>
				      <span class="mi">0</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Failed to add backlight: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				<span class="n">ret</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="n">wm831x_otp_init</span><span class="p">(</span><span class="n">wm831x</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pdata</span> <span class="o">&amp;&amp;</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">post_init</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">pdata</span><span class="o">-&gt;</span><span class="n">post_init</span><span class="p">(</span><span class="n">wm831x</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ret</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_err</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;post_init() failed: %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">ret</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">err_irq</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>

<span class="nl">err_irq:</span>
	<span class="n">wm831x_irq_exit</span><span class="p">(</span><span class="n">wm831x</span><span class="p">);</span>
<span class="nl">err:</span>
	<span class="n">mfd_remove_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wm831x_device_exit</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">wm831x_otp_exit</span><span class="p">(</span><span class="n">wm831x</span><span class="p">);</span>
	<span class="n">mfd_remove_devices</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">);</span>
	<span class="n">free_irq</span><span class="p">(</span><span class="n">wm831x_irq</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_IRQ_AUXADC_DATA</span><span class="p">),</span> <span class="n">wm831x</span><span class="p">);</span>
	<span class="n">wm831x_irq_exit</span><span class="p">(</span><span class="n">wm831x</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">wm831x_device_suspend</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">reg</span><span class="p">,</span> <span class="n">mask</span><span class="p">;</span>

	<span class="cm">/* If the charger IRQs are a wake source then make sure we ack</span>
<span class="cm">	 * them even if they&#39;re not actively being used (eg, no power</span>
<span class="cm">	 * driver or no IRQ line wired up) then acknowledge the</span>
<span class="cm">	 * interrupts otherwise suspend won&#39;t last very long.</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">charger_irq_wake</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">reg</span> <span class="o">=</span> <span class="n">wm831x_reg_read</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_INTERRUPT_STATUS_2_MASK</span><span class="p">);</span>

		<span class="n">mask</span> <span class="o">=</span> <span class="n">WM831X_CHG_BATT_HOT_EINT</span> <span class="o">|</span>
			<span class="n">WM831X_CHG_BATT_COLD_EINT</span> <span class="o">|</span>
			<span class="n">WM831X_CHG_BATT_FAIL_EINT</span> <span class="o">|</span>
			<span class="n">WM831X_CHG_OV_EINT</span> <span class="o">|</span> <span class="n">WM831X_CHG_END_EINT</span> <span class="o">|</span>
			<span class="n">WM831X_CHG_TO_EINT</span> <span class="o">|</span> <span class="n">WM831X_CHG_MODE_EINT</span> <span class="o">|</span>
			<span class="n">WM831X_CHG_START_EINT</span><span class="p">;</span>

		<span class="cm">/* If any of the interrupts are masked read the statuses */</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span>
			<span class="n">reg</span> <span class="o">=</span> <span class="n">wm831x_reg_read</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span>
					      <span class="n">WM831X_INTERRUPT_STATUS_2</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">reg</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span>
				 <span class="s">&quot;Acknowledging masked charger IRQs: %x</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span>
				 <span class="n">reg</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">);</span>
			<span class="n">wm831x_reg_write</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_INTERRUPT_STATUS_2</span><span class="p">,</span>
					 <span class="n">reg</span> <span class="o">&amp;</span> <span class="n">mask</span><span class="p">);</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">wm831x_device_shutdown</span><span class="p">(</span><span class="k">struct</span> <span class="n">wm831x</span> <span class="o">*</span><span class="n">wm831x</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">soft_shutdown</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">dev_info</span><span class="p">(</span><span class="n">wm831x</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="s">&quot;Initiating shutdown...</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
		<span class="n">wm831x_set_bits</span><span class="p">(</span><span class="n">wm831x</span><span class="p">,</span> <span class="n">WM831X_POWER_STATE</span><span class="p">,</span> <span class="n">WM831X_CHIP_ON</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="n">EXPORT_SYMBOL_GPL</span><span class="p">(</span><span class="n">wm831x_device_shutdown</span><span class="p">);</span>

<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">&quot;Core support for the WM831X AudioPlus PMIC&quot;</span><span class="p">);</span>
<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">&quot;GPL&quot;</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">&quot;Mark Brown&quot;</span><span class="p">);</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:2}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../javascript/docco.min.js"></script>
</html>
