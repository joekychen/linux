d | adc |  | 3 items |  | Maxime Ripard | maxime.ripard@free-electrons.com | 1337027133 |  | IIO: AT91: Add DT support to at91_adc driver  Signed-off-by: Maxime Ripard <maxime.ripard@free-electrons.com> Acked-by: Nicolas Ferre <nicolas.ferre@atmel.com> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | industrialio-core.c | s | 22K | 802 | Lars-Peter Clausen | lars@metafoo.de | 1338869731 |  | iio: Fix potential use after free  There is no guarantee that the last reference to the iio device has already been dropped when iio_device_free is called. This means that we can up calling iio_dev_release after iio_device_free which will lead to a use after free. As the general rule the struct containing the device should always be freed in the release callback.  This is what this patch does, it moves freeing the iio device struct as well as releasing the idr reference to the release callback. To ensure that the device is not freed before calling iio_device_free the device_unregister call in iio_device_unregister is broken apart. iio_device_unregister will now only call device_del to remove the device from the system and iio_device_free will call put_device to drop the reference we obtained in iio_devce_alloc.  We also have to take care that calling iio_device_free without having called iio_device_register still works (i.e. this can happen if something failed during device initialization). For this to work properly two minor changes were necessary: channel_attr_list needs to be initialized in iio_device_alloc and we have to check whether the chrdev has been registered before releasing it in iio_device_release.  This change also brings iio_device_unregister and iio_device_free more in sync with iio_device_register and iio_device_alloc which call device_add and device_initialize respectively.  Signed-off-by: Lars-Peter Clausen <lars@metafoo.de> Acked-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | Makefile | g | 349B |  | Maxime Ripard | maxime.ripard@free-electrons.com | 1337027049 |  | ARM: AT91: IIO: Add AT91 ADC driver.  Add the ADC driver for Atmel's AT91SAM9G20-EK, AT91SAM9M10G45-EK and AT91SAM9X5 family boards.  It has support for both software and hardware triggers.  Signed-off-by: Maxime Ripard <maxime.ripard@free-electrons.com> Acked-by: Nicolas Ferre <nicolas.ferre@atmel.com> Acked-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | iio_core_trigger.h | s | 1.3K | 36 | Jonathan Cameron | jic23@kernel.org | 1335377498 |  | IIO: Move the core files to drivers/iio  Take the core support + the kfifo buffer implentation out of staging.  Whilst we are far from done in improving this subsystem it is now at a stage where the userspae interfaces (provided by the core) can be considered stable.  Drivers will follow over a longer time scale.  Signed-off-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | industrialio-trigger.c | s | 12K | 444 | Lars-Peter Clausen | lars@metafoo.de | 1337027865 |  | iio: Use dev_to_iio_dev()  Replace open-coded instances of getting a iio_dev struct from a device struct with dev_to_iio_dev().  Signed-off-by: Lars-Peter Clausen <lars@metafoo.de> Acked-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | Kconfig | g | 1.4K |  | Jiri Kosina | jkosina@suse.cz | 1339720126 |  | iio: drop wrong reference from Kconfig  The documentation lives in drivers/staging/iio/Documentation, but according to Jonathan it's obsolete and needs fixing.  Signed-off-by: Jiri Kosina <jkosina@suse.cz> Acked-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | industrialio-event.c | s | 11K | 393 | Lars-Peter Clausen | lars@metafoo.de | 1337027865 |  | iio: Use dev_to_iio_dev()  Replace open-coded instances of getting a iio_dev struct from a device struct with dev_to_iio_dev().  Signed-off-by: Lars-Peter Clausen <lars@metafoo.de> Acked-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
d | amplifiers |  | 3 items |  | Michael Hennerich | michael.hennerich@analog.com | 1337026539 |  | iio: amplifiers: New driver for AD8366 Dual-Digital Variable Gain Amplifier  Changes since V1:  Apply review feedback: 	Introduce and use IIO_CHAN_INFO_HARDWAREGAIN 	Introduce and use Use IIO_VAL_INT_PLUS_MICRO_DB  Modify out of staging include paths. Convert to new iio core API naming.  Changes since V2:  more sanity checking in write_raw  Signed-off-by: Michael Hennerich <michael.hennerich@analog.com> Acked-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | industrialio-buffer.c | s | 18K | 672 | Lars-Peter Clausen | lars@metafoo.de | 1337027865 |  | iio: Use dev_to_iio_dev()  Replace open-coded instances of getting a iio_dev struct from a device struct with dev_to_iio_dev().  Signed-off-by: Lars-Peter Clausen <lars@metafoo.de> Acked-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | inkern.c | s | 6.6K | 248 | Greg Kroah-Hartman | gregkh@linuxfoundation.org | 1335984487 |  | Merge 3.4-rc5 into staging-next  This resolves the conflict in: 	drivers/staging/vt6656/ioctl.c  Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | kfifo_buf.c | s | 3.3K | 125 | Jonathan Cameron | jic23@kernel.org | 1335377498 |  | IIO: Move the core files to drivers/iio  Take the core support + the kfifo buffer implentation out of staging.  Whilst we are far from done in improving this subsystem it is now at a stage where the userspae interfaces (provided by the core) can be considered stable.  Drivers will follow over a longer time scale.  Signed-off-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
f | iio_core.h | s | 1.6K | 48 | Jonathan Cameron | jic23@kernel.org | 1335377498 |  | IIO: Move the core files to drivers/iio  Take the core support + the kfifo buffer implentation out of staging.  Whilst we are far from done in improving this subsystem it is now at a stage where the userspae interfaces (provided by the core) can be considered stable.  Drivers will follow over a longer time scale.  Signed-off-by: Jonathan Cameron <jic23@kernel.org> Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
