f | ab8500_charger.c | s | 74K | 2467 | Lee Jones | lee.jones@linaro.org | 1336218950 |  | ab8500: Clean up probe routines  These patches clean up some ugliness and brings the variable initialisation formatting more into line with other drivers.  Signed-off-by: Lee Jones <lee.jones@linaro.org> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | Makefile | g | 2.0K |  | Linus Torvalds | torvalds@linux-foundation.org | 1333148942 |  | 
f | tosa_battery.c | s | 11K | 372 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | intel_mid_battery.c | s | 21K | 688 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | charger-manager.c | s | 36K | 1253 | Chanwoo Choi | cw00.choi@samsung.com | 1336272718 |  | charger-manager: Provide cm_notify_event function for in-kernel use  By using cm_notify_event function, charger driver can report several charger events (e.g. battery full and external power in/out, etc) to Charger-Manager. Charger-Manager can properly and immediately control chargers by the reported event.  Signed-off-by: MyungJoo Ham <myungjoo.ham@samsung.com> Signed-off-by: Donggeun Kim <dg77.kim@samsung.com> Signed-off-by: Kyungmin Park <kyungmin.park@samsung.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | max8998_charger.c | s | 5.6K | 188 | Paul Gortmaker | paul.gortmaker@windriver.com | 1330475516 |  | includecheck: delete any duplicate instances of module.h  Different tree maintainers picked up independently generated trivial compile fixes based on linux-next testing, resulting in some cases where a file would have got more than one addition of module.h once everything was all merged together.  Delete any duplicates so includecheck isn't complaining about anything related to module.h/export.h changes.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | collie_battery.c | s | 9.3K | 326 | Anton Vorontsov | cbouatmailru@gmail.com | 1326214511 |  | Merge git://git.infradead.org/users/cbou/battery-urgent
f | wm8350_power.c | s | 14K | 455 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | ds2781_battery.c | s | 21K | 711 | Axel Lin | axel.lin@gmail.com | 1336273121 |  | ds2781_battery: Use DS2781_PARAM_EEPROM_SIZE and DS2781_USER_EEPROM_SIZE  Since we have defined DS2781_PARAM_EEPROM_SIZE and DS2781_USER_EEPROM_SIZE, use them to simplify the code.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Evgeniy Polyakov <zbr@ioremap.net> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | abx500_chargalg.c | s | 53K | 1730 | Anton Vorontsov | anton.vorontsov@linaro.org | 1332780074 |  | ab8500: Turn unneeded global symbols into local ones  The patch fixes the following sparse warning:  drivers/power/ab8500_charger.c:1619:6: warning: symbol 'ab8500_charger_detect_usb_type_work' was not declared. Should it be static? drivers/power/abx500_chargalg.c:1709:24: warning: symbol 'abx500_chargalg_sysfs_ops' was not declared. Should it be static? drivers/power/ab8500_fg.c:2328:24: warning: symbol 'ab8500_fg_sysfs_ops' was not declared. Should it be static?  Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | pda_power.c | s | 11K | 439 | Heikki Krogerus | heikki.krogerus@linux.intel.com | 1329134001 |  | power_supply: Convert all users to new usb_phy  Use the new usb_phy_* functions instead of the old otg_* ones.  Signed-off-by: Heikki Krogerus <heikki.krogerus@linux.intel.com> Acked-by: Anton Vorontsov <cbouatmailru@gmail.com> Reviewed-by: Marek Vasut <marek.vasut@gmail.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | pcf50633-charger.c | s | 12K | 403 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | ab8500_fg.c | s | 66K | 2273 | Lee Jones | lee.jones@linaro.org | 1336218950 |  | ab8500: Clean up probe routines  These patches clean up some ugliness and brings the variable initialisation formatting more into line with other drivers.  Signed-off-by: Lee Jones <lee.jones@linaro.org> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | max8903_charger.c | s | 9.1K | 324 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | gpio-charger.c | s | 4.9K | 155 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | max17040_battery.c | s | 6.8K | 238 | Axel Lin | axel.lin@gmail.com | 1332780082 |  | power_supply: Convert i2c drivers to module_i2c_driver  Factor out some boilerplate code for i2c driver registration into module_i2c_driver.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Cc: Woogyom Kim <milo.kim@ti.com> Cc: Daniel Jeong <daniel.jeong@ti.com> Cc: Minkyu Kang <mk7.kang@samsung.com> Cc: Peter Edwards <sweetlilmre@gmail.com> Acked-by: Milo(Woogyom) Kim <milo.kim@ti.com> Acked-by: Rhyland Klein <rklein@nvidia.com> Acked-by: Ryan Mallon <rmallon@gmail.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | ab8500_btemp.c | s | 29K | 986 | Lee Jones | lee.jones@linaro.org | 1336218950 |  | ab8500: Clean up probe routines  These patches clean up some ugliness and brings the variable initialisation formatting more into line with other drivers.  Signed-off-by: Lee Jones <lee.jones@linaro.org> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | twl4030_charger.c | s | 14K | 481 | Heikki Krogerus | heikki.krogerus@linux.intel.com | 1329134001 |  | power_supply: Convert all users to new usb_phy  Use the new usb_phy_* functions instead of the old otg_* ones.  Signed-off-by: Heikki Krogerus <heikki.krogerus@linux.intel.com> Acked-by: Anton Vorontsov <cbouatmailru@gmail.com> Reviewed-by: Marek Vasut <marek.vasut@gmail.com> Signed-off-by: Felipe Balbi <balbi@ti.com>
f | da9052-battery.c | s | 15K | 566 | Axel Lin | axel.lin@gmail.com | 1332780077 |  | da9052-battery: Convert to use module_platform_driver  Use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | lp8727_charger.c | s | 11K | 413 | Axel Lin | axel.lin@gmail.com | 1332780082 |  | power_supply: Convert i2c drivers to module_i2c_driver  Factor out some boilerplate code for i2c driver registration into module_i2c_driver.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Cc: Woogyom Kim <milo.kim@ti.com> Cc: Daniel Jeong <daniel.jeong@ti.com> Cc: Minkyu Kang <mk7.kang@samsung.com> Cc: Peter Edwards <sweetlilmre@gmail.com> Acked-by: Milo(Woogyom) Kim <milo.kim@ti.com> Acked-by: Rhyland Klein <rklein@nvidia.com> Acked-by: Ryan Mallon <rmallon@gmail.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | max17042_battery.c | s | 23K | 727 | Ramakrishna Pallala | ramakrishna.pallala@intel.com | 1336274891 |  | max17042_battery: Add support for max17047/50 chip  max17047 is improved version of max17042 chip. It has few HW bug fixes with minor changes in register set.  max17050 is same as max17047 chip except its silicon packging. So from driver's point of view there is no difference btw max1047 and max1050.  This patch adds the support to dynamically detect the chip type and adds steps to initialize the max17047 chip.  Signed-off-by: Ramakrishna Pallala <ramakrishna.pallala@intel.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | ds2780_battery.c | s | 21K | 708 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | jz4740-battery.c | s | 11K | 365 | Axel Lin | axel.lin@gmail.com | 1325815037 |  | jz4740-battery: Fix signedness bug  wait_for_completion_interruptible_timeout() may return negative value. In this case, checking if (t > 0)  will return true if t is unsigned.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Lars-Peter Clausen <lars@metafoo.de> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | wm831x_backup.c | s | 5.5K | 193 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | ds2760_battery.c | s | 18K | 531 | Rusty Russell | rusty@rustcorp.com.au | 1326409340 |  | module_param: make bool parameters really bool (drivers & misc)  module_param(bool) used to counter-intuitively take an int.  In fddd5201 (mid-2009) we allowed bool or int/unsigned int using a messy trick.  It's time to remove the int/unsigned int option.  For this version it'll simply give a warning, but it'll break next kernel version.  Acked-by: Mauro Carvalho Chehab <mchehab@redhat.com> Signed-off-by: Rusty Russell <rusty@rustcorp.com.au>
f | wm97xx_battery.c | s | 7.1K | 256 | Axel Lin | axel.lin@gmail.com | 1325811630 |  | wm97xx_battery: Use DEFINE_MUTEX() for work_lock  work_lock can be initialized automatically with DEFINE_MUTEX() rather than explicitly calling mutex_init().  This patch also removes an unused bat_lock mutex.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | olpc_battery.c | s | 15K | 545 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | test_power.c | s | 11K | 354 | John Stultz | john.stultz@linaro.org | 1305905108 |  | power: Make test_power driver more dynamic.  In 2008 Masashi YOKOTA <yokota@pylone.jp> created the virtual battery driver found here: http://downloads.pylone.jp/src/virtual_battery/virtual_battery-0.0.1.tar.bz2  It found use out of tree, but was never merged upstream. Since then the test_power driver has been merged, which provides very similar functionality.  This patch extends the test_power driver to be more dynamic at runtime, by merging portions of the Virtual Battery Driver by Masashi YOKOTA.  With this patch, I can tweak the values in: /sys/module/test_power/parameters/* and watch the behavior of the gnome power managment daemon or other battery UI software.  CC: Anton Vorontsov <cbouatmailru@gmail.com> CC: Akihiro MAEDA <sola.1980.a@gmail.com> CC: Masashi YOKOTA <yokota@pylone.jp> Signed-off-by: John Stultz <john.stultz@linaro.org> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | Kconfig | g | 8.9K |  | Ramakrishna Pallala | ramakrishna.pallala@intel.com | 1336274891 |  | max17042_battery: Add support for max17047/50 chip  max17047 is improved version of max17042 chip. It has few HW bug fixes with minor changes in register set.  max17050 is same as max17047 chip except its silicon packging. So from driver's point of view there is no difference btw max1047 and max1050.  This patch adds the support to dynamically detect the chip type and adds steps to initialize the max17047 chip.  Signed-off-by: Ramakrishna Pallala <ramakrishna.pallala@intel.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | sbs-battery.c | s | 20K | 720 | Nikolaus Voss | n.voss@weinmann.de | 1336273507 |  | sbs-battery.c: Capacity attr = remaining relative capacity  Currently, the capacity exported by this driver refers to reg 0x0e, which is the absolute state of charge which according to SBS refers to the design capacity/ energy of the battery. It can be > 100 % and drops below 100 % for a fully charged battery with the battery aging.  This is not what the user exspects of a remaining capacity indication between 0 and 100 % with 100 % referring to a fully charged battery. This is provided by SBS reg 0x0d, which is the relative state of charge referring to the full charge capacity.  Signed-off-by: Nikolaus Voss <n.voss@weinmann.de> Acked-by: Rhyland Klein <rklein@nvidia.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | power_supply_core.c | s | 5.9K | 201 | Anton Vorontsov | cbouatmailru@gmail.com | 1325935491 |  | power_supply: Drop usage of nowarn variant of sysfs_create_link()  The function is not exported to modules, plus we do want to catch anyone who tries to create complex hierarchy (in that case we'd need to change 'powers' symlink to a directory, probably under a different name to not break ABI).  This patch fixes the following build error:   ERROR: "sysfs_create_link_nowarn" [drivers/power/power_supply.ko] undefined!  Reported-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | ds2782_battery.c | s | 9.3K | 342 | Axel Lin | axel.lin@gmail.com | 1332780082 |  | power_supply: Convert i2c drivers to module_i2c_driver  Factor out some boilerplate code for i2c driver registration into module_i2c_driver.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Cc: Woogyom Kim <milo.kim@ti.com> Cc: Daniel Jeong <daniel.jeong@ti.com> Cc: Minkyu Kang <mk7.kang@samsung.com> Cc: Peter Edwards <sweetlilmre@gmail.com> Acked-by: Milo(Woogyom) Kim <milo.kim@ti.com> Acked-by: Rhyland Klein <rklein@nvidia.com> Acked-by: Ryan Mallon <rmallon@gmail.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | bq27x00_battery.c | s | 21K | 749 | Jiri Kosina | jkosina@suse.cz | 1333914532 |  | Merge branch 'master' into for-next  Merge with latest Linus' tree, as I have incoming patches that fix code that is newer than current HEAD of for-next.  Conflicts: 	drivers/net/ethernet/realtek/r8169.c
f | z2_battery.c | s | 7.8K | 270 | Axel Lin | axel.lin@gmail.com | 1332780082 |  | power_supply: Convert i2c drivers to module_i2c_driver  Factor out some boilerplate code for i2c driver registration into module_i2c_driver.  Signed-off-by: Axel Lin <axel.lin@gmail.com> Cc: Woogyom Kim <milo.kim@ti.com> Cc: Daniel Jeong <daniel.jeong@ti.com> Cc: Minkyu Kang <mk7.kang@samsung.com> Cc: Peter Edwards <sweetlilmre@gmail.com> Acked-by: Milo(Woogyom) Kim <milo.kim@ti.com> Acked-by: Rhyland Klein <rklein@nvidia.com> Acked-by: Ryan Mallon <rmallon@gmail.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | max8997_charger.c | s | 5.3K | 181 | Jonghwan Choi | jhbird.choi@samsung.com | 1325811565 |  | max8997_charger: Remove duplicate module.h  module.h was included twice.  Signed-off-by: Jonghwan Choi <jhbird.choi@samsung.com> Acked-by: MyungJoo Ham <myungjoo.ham@samsung.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | power_supply_leds.c | s | 4.8K | 149 | Paul Gortmaker | paul.gortmaker@windriver.com | 1331490457 |  | device.h: cleanup users outside of linux/include (C files)  For files that are actively using linux/device.h, make sure that they call it out.  This will allow us to clean up some of the implicit uses of linux/device.h within include/* without introducing build regressions.  Yes, this was created by "cheating" -- i.e. the headers were cleaned up, and then the fallout was found and fixed, and then the two commits were reordered.  This ensures we don't introduce build regressions into the git history.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | power_supply_sysfs.c | s | 8.2K | 264 | Ramakrishna Pallala | ramakrishna.pallala@intel.com | 1336189469 |  | power_supply: Add voltage_ocv property and use it for max17042 driver  This adds a new sysfs file called 'voltage_ocv' which gives the Open Circuit Voltage of the battery.  This property can be used for platform shutdown policies and can be useful for initial capacity estimations.  Note: This patch is generated against linux-next branch.  Signed-off-by: Ramakrishna Pallala <ramakrishna.pallala@intel.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | s3c_adc_battery.c | s | 11K | 383 | Heiko Stübner | heiko@sntech.de | 1325816015 |  | s3c_adc_battery: Average over more than one adc sample  Some sources for adc battery information provide only inaccurate results where the read value differs from the real value with positive and negative offsets. For such sources it can be more accurate to collect two or more value sample and use the average of all collected values.  This patch adds pdata options volt_samples, current_samples and backup_volt_samples to specifiy the number of samples to collect, reads the specified number of samples and calculates the average of those. For unset sample-number-values a default of 1 is assumed.  Signed-off-by: Heiko Stuebner <heiko@sntech.de> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | wm831x_power.c | s | 17K | 567 | Mark Brown | broonie@opensource.wolfsonmicro.com | 1337527627 |  | mfd: Convert wm831x to irq_domain  The modern idiom is to use irq_domain to allocate interrupts. This is useful partly to allow further infrastructure to be based on the domains and partly because it makes it much easier to allocate virtual interrupts to devices as we don't need to allocate a contiguous range of interrupt numbers.  Convert the wm831x driver over to this infrastructure, using a legacy IRQ mapping if an irq_base is specified in platform data and otherwise using a linear mapping, always registering the interrupts even if they won't ever be used. Only boards which need to use the GPIOs as interrupts should need to use an irq_base.  This means that we can't use the MFD irq_base management since the unless we're using an explicit irq_base from platform data we can't rely on a linear mapping of interrupts.  Instead we need to map things via the irq_domain - provide a conveniencem function wm831x_irq() to save a small amount of typing when doing so. Looking at this I couldn't clearly see anything the MFD core could do to make this nicer.  Since we're not supporting device tree yet there's no meaningful advantage if we don't do this conversion in one, the fact that the interrupt resources are used for repeated IP blocks makes accessor functions for the irq_domain more trouble to do than they're worth.  Signed-off-by: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Samuel Ortiz <sameo@linux.intel.com>
f | pmu_battery.c | s | 5.3K | 187 | Tejun Heo | tj@kernel.org | 1269954152 |  | include cleanup: Update gfp.h and slab.h includes to prepare for breaking implicit slab.h inclusion from percpu.h  percpu.h is included by sched.h and module.h and thus ends up being included when building most .c files.  percpu.h includes slab.h which in turn includes gfp.h making everything defined by the two files universally available and complicating inclusion dependencies.  percpu.h -> slab.h dependency is about to be removed.  Prepare for this change by updating users of gfp and slab facilities include those headers directly instead of assuming availability.  As this conversion needs to touch large number of source files, the following script is used as the basis of conversion.    http://userweb.kernel.org/~tj/misc/slabh-sweep.py  The script does the followings.  * Scan files for gfp and slab usages and update includes such that   only the necessary includes are there.  ie. if only gfp is used,   gfp.h, if slab is used, slab.h.  * When the script inserts a new include, it looks at the include   blocks and try to put the new include such that its order conforms   to its surrounding.  It's put in the include block which contains   core kernel includes, in the same order that the rest are ordered -   alphabetical, Christmas tree, rev-Xmas-tree or at the end if there   doesn't seem to be any matching order.  * If the script can't find a place to put a new include (mostly   because the file doesn't have fitting include block), it prints out   an error message indicating which .h file needs to be added to the   file.  The conversion was done in the following steps.  1. The initial automatic conversion of all .c files updated slightly    over 4000 files, deleting around 700 includes and adding ~480 gfp.h    and ~3000 slab.h inclusions.  The script emitted errors for ~400    files.  2. Each error was manually checked.  Some didn't need the inclusion,    some needed manual addition while adding it to implementation .h or    embedding .c file was more appropriate for others.  This step added    inclusions to around 150 files.  3. The script was run again and the output was compared to the edits    from #2 to make sure no file was left behind.  4. Several build tests were done and a couple of problems were fixed.    e.g. lib/decompress_*.c used malloc/free() wrappers around slab    APIs requiring slab.h to be added manually.  5. The script was run on all .h files but without automatically    editing them as sprinkling gfp.h and slab.h inclusions around .h    files could easily lead to inclusion dependency hell.  Most gfp.h    inclusion directives were ignored as stuff from gfp.h was usually    wildly available and often used in preprocessor macros.  Each    slab.h inclusion directive was examined and added manually as    necessary.  6. percpu.h was updated not to include slab.h.  7. Build test were done on the following configurations and failures    were fixed.  CONFIG_GCOV_KERNEL was turned off for all tests (as my    distributed build env didn't work with gcov compiles) and a few    more options had to be turned off depending on archs to make things    build (like ipr on powerpc/64 which failed due to missing writeq).     * x86 and x86_64 UP and SMP allmodconfig and a custom test config.    * powerpc and powerpc64 SMP allmodconfig    * sparc and sparc64 SMP allmodconfig    * ia64 SMP allmodconfig    * s390 SMP allmodconfig    * alpha SMP allmodconfig    * um on x86_64 SMP allmodconfig  8. percpu.h modifications were reverted so that it could be applied as    a separate patch and serve as bisection point.  Given the fact that I had only a couple of failures from tests on step 6, I'm fairly confident about the coverage of this conversion patch. If there is a breakage, it's likely to be something in one of the arch headers which should be easily discoverable easily on most builds of the specific arch.  Signed-off-by: Tejun Heo <tj@kernel.org> Guess-its-ok-by: Christoph Lameter <cl@linux-foundation.org> Cc: Ingo Molnar <mingo@redhat.com> Cc: Lee Schermerhorn <Lee.Schermerhorn@hp.com>
f | smb347-charger.c | s | 27K | 980 | Mika Westerberg | mika.westerberg@linux.intel.com | 1337386548 |  | smb347-charger: Include missing <linux/err.h>  Without the include we get build errors like:  drivers/power/smb347-charger.c: In function 'smb347_probe': drivers/power/smb347-charger.c:1039:2: error: implicit declaration of function 'IS_ERR' [-Werror=implicit-function-declaration] drivers/power/smb347-charger.c:1040:3: error: implicit declaration of function 'PTR_ERR' [-Werror=implicit-function-declaration]  Reported-by: Stephen Rothwell <sfr@canb.auug.org.au> Signed-off-by: Mika Westerberg <mika.westerberg@linux.intel.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | isp1704_charger.c | s | 12K | 422 | Dan Carpenter | dan.carpenter@oracle.com | 1336273355 |  | isp1704_charger: Use after free on probe error  We can't use "isp" after freeing it.  Signed-off-by: Dan Carpenter <dan.carpenter@oracle.com> Reviewed-by: Felipe Contreras <felipe.contreras@gmail.com> Signed-off-by: Anton Vorontsov <anton.vorontsov@linaro.org>
f | max8925_power.c | s | 13K | 482 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
f | power_supply.h | s | 1.1K | 31 | Paul Gortmaker | paul.gortmaker@windriver.com | 1331490457 |  | device.h: cleanup users outside of linux/include (C files)  For files that are actively using linux/device.h, make sure that they call it out.  This will allow us to clean up some of the implicit uses of linux/device.h within include/* without introducing build regressions.  Yes, this was created by "cheating" -- i.e. the headers were cleaned up, and then the fallout was found and fixed, and then the two commits were reordered.  This ensures we don't introduce build regressions into the git history.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | apm_power.c | s | 10K | 320 | Paul Gortmaker | paul.gortmaker@windriver.com | 1331490457 |  | device.h: cleanup users outside of linux/include (C files)  For files that are actively using linux/device.h, make sure that they call it out.  This will allow us to clean up some of the implicit uses of linux/device.h within include/* without introducing build regressions.  Yes, this was created by "cheating" -- i.e. the headers were cleaned up, and then the fallout was found and fixed, and then the two commits were reordered.  This ensures we don't introduce build regressions into the git history.  Signed-off-by: Paul Gortmaker <paul.gortmaker@windriver.com>
f | da9030_battery.c | s | 15K | 500 | Axel Lin | axel.lin@gmail.com | 1325653927 |  | power_supply: Convert drivers/power/* to use module_platform_driver()  This patch converts the drivers in drivers/power/* to use the module_platform_driver() macro which makes the code smaller and a bit simpler.  Cc: Mike Rapoport <mike@compulab.co.il> Cc: Lars-Peter Clausen <lars@metafoo.de> Cc: Nithish Mahalingam <nithish.mahalingam@intel.com> Cc: MyungJoo Ham <myungjoo.ham@samsung.com> Cc: Haojian Zhuang <haojian.zhuang@marvell.com> Cc: Balaji Rao <balajirrao@openmoko.org> Cc: Mark Brown <broonie@opensource.wolfsonmicro.com> Signed-off-by: Axel Lin <axel.lin@gmail.com> Acked-by: Clifton Barnes <cabarnes@indesign-llc.com> Signed-off-by: Anton Vorontsov <cbouatmailru@gmail.com>
