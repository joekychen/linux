<!DOCTYPE html>
<html><head><title>joekychen/linux » mm › prio_tree.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../index.html"></a><h1>prio_tree.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cm">/*</span>
<span class="cm"> * mm/prio_tree.c - priority search tree for mapping-&gt;i_mmap</span>
<span class="cm"> *</span>
<span class="cm"> * Copyright (C) 2004, Rajesh Venkatasubramanian &lt;vrajesh@umich.edu&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * This file is released under the GPL v2.</span>
<span class="cm"> *</span>
<span class="cm"> * Based on the radix priority search tree proposed by Edward M. McCreight</span>
<span class="cm"> * SIAM Journal of Computing, vol. 14, no.2, pages 257-276, May 1985</span>
<span class="cm"> *</span>
<span class="cm"> * 02Feb2004	Initial version</span>
<span class="cm"> */</span>

<span class="cp">#include &lt;linux/mm.h&gt;</span>
<span class="cp">#include &lt;linux/prio_tree.h&gt;</span>
<span class="cp">#include &lt;linux/prefetch.h&gt;</span>

<span class="cm">/*</span>
<span class="cm"> * See lib/prio_tree.c for details on the general radix priority search tree</span>
<span class="cm"> * code.</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * The following #defines are mirrored from lib/prio_tree.c. They&#39;re only used</span>
<span class="cm"> * for debugging, and should be removed (along with the debugging code using</span>
<span class="cm"> * them) when switching also VMAs to the regular prio_tree code.</span>
<span class="cm"> */</span>

<span class="cp">#define RADIX_INDEX(vma)  ((vma)-&gt;vm_pgoff)</span>
<span class="cp">#define VMA_SIZE(vma)	  (((vma)-&gt;vm_end - (vma)-&gt;vm_start) &gt;&gt; PAGE_SHIFT)</span>
<span class="cm">/* avoid overflow */</span>
<span class="cp">#define HEAP_INDEX(vma)   ((vma)-&gt;vm_pgoff + (VMA_SIZE(vma) - 1))</span>

<span class="cm">/*</span>
<span class="cm"> * Radix priority search tree for address_space-&gt;i_mmap</span>
<span class="cm"> *</span>
<span class="cm"> * For each vma that map a unique set of file pages i.e., unique [radix_index,</span>
<span class="cm"> * heap_index] value, we have a corresponding priority search tree node. If</span>
<span class="cm"> * multiple vmas have identical [radix_index, heap_index] value, then one of</span>
<span class="cm"> * them is used as a tree node and others are stored in a vm_set list. The tree</span>
<span class="cm"> * node points to the first vma (head) of the list using vm_set.head.</span>
<span class="cm"> *</span>
<span class="cm"> * prio_tree_root</span>
<span class="cm"> *      |</span>
<span class="cm"> *      A       vm_set.head</span>
<span class="cm"> *     / \      /</span>
<span class="cm"> *    L   R -&gt; H-I-J-K-M-N-O-P-Q-S</span>
<span class="cm"> *    ^   ^    &lt;-- vm_set.list --&gt;</span>
<span class="cm"> *  tree nodes</span>
<span class="cm"> *</span>
<span class="cm"> * We need some way to identify whether a vma is a tree node, head of a vm_set</span>
<span class="cm"> * list, or just a member of a vm_set list. We cannot use vm_flags to store</span>
<span class="cm"> * such information. The reason is, in the above figure, it is possible that</span>
<span class="cm"> * vm_flags&#39; of R and H are covered by the different mmap_sems. When R is</span>
<span class="cm"> * removed under R-&gt;mmap_sem, H replaces R as a tree node. Since we do not hold</span>
<span class="cm"> * H-&gt;mmap_sem, we cannot use H-&gt;vm_flags for marking that H is a tree node now.</span>
<span class="cm"> * That&#39;s why some trick involving shared.vm_set.parent is used for identifying</span>
<span class="cm"> * tree nodes and list head nodes.</span>
<span class="cm"> *</span>
<span class="cm"> * vma radix priority search tree node rules:</span>
<span class="cm"> *</span>
<span class="cm"> * vma-&gt;shared.vm_set.parent != NULL    ==&gt; a tree node</span>
<span class="cm"> *      vma-&gt;shared.vm_set.head != NULL ==&gt; list of others mapping same range</span>
<span class="cm"> *      vma-&gt;shared.vm_set.head == NULL ==&gt; no others map the same range</span>
<span class="cm"> *</span>
<span class="cm"> * vma-&gt;shared.vm_set.parent == NULL</span>
<span class="cm"> * 	vma-&gt;shared.vm_set.head != NULL ==&gt; list head of vmas mapping same range</span>
<span class="cm"> * 	vma-&gt;shared.vm_set.head == NULL ==&gt; a list node</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm"> * Add a new vma known to map the same set of pages as the old vma:</span>
<span class="cm"> * useful for fork&#39;s dup_mmap as well as vma_prio_tree_insert below.</span>
<span class="cm"> * Note that it just happens to work correctly on i_mmap_nonlinear too.</span>
<span class="cm"> */</span>
<span class="kt">void</span> <span class="nf">vma_prio_tree_add</span><span class="p">(</span><span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">old</span><span class="p">)</span>
<span class="p">{</span>
	<span class="cm">/* Leave these BUG_ONs till prio_tree patch stabilizes */</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">RADIX_INDEX</span><span class="p">(</span><span class="n">vma</span><span class="p">)</span> <span class="o">!=</span> <span class="n">RADIX_INDEX</span><span class="p">(</span><span class="n">old</span><span class="p">));</span>
	<span class="n">BUG_ON</span><span class="p">(</span><span class="n">HEAP_INDEX</span><span class="p">(</span><span class="n">vma</span><span class="p">)</span> <span class="o">!=</span> <span class="n">HEAP_INDEX</span><span class="p">(</span><span class="n">old</span><span class="p">));</span>

	<span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">old</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">parent</span><span class="p">)</span>
		<span class="n">list_add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">old</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
	<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">old</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">)</span>
		<span class="n">list_add_tail</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">,</span>
				<span class="o">&amp;</span><span class="n">old</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
	<span class="k">else</span> <span class="p">{</span>
		<span class="n">INIT_LIST_HEAD</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
		<span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">old</span><span class="p">;</span>
		<span class="n">old</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">vma</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">vma_prio_tree_insert</span><span class="p">(</span><span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">prio_tree_root</span> <span class="o">*</span><span class="n">root</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">prio_tree_node</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">old</span><span class="p">;</span>

	<span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">ptr</span> <span class="o">=</span> <span class="n">raw_prio_tree_insert</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">prio_tree_node</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ptr</span> <span class="o">!=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">prio_tree_node</span> <span class="o">*</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">prio_tree_node</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">old</span> <span class="o">=</span> <span class="n">prio_tree_entry</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vm_area_struct</span><span class="p">,</span>
					<span class="n">shared</span><span class="p">.</span><span class="n">prio_tree_node</span><span class="p">);</span>
		<span class="n">vma_prio_tree_add</span><span class="p">(</span><span class="n">vma</span><span class="p">,</span> <span class="n">old</span><span class="p">);</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">vma_prio_tree_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">,</span>
			  <span class="k">struct</span> <span class="n">prio_tree_root</span> <span class="o">*</span><span class="n">root</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">node</span><span class="p">,</span> <span class="o">*</span><span class="n">head</span><span class="p">,</span> <span class="o">*</span><span class="n">new_head</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">parent</span><span class="p">)</span>
			<span class="n">list_del_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
		<span class="k">else</span>
			<span class="n">raw_prio_tree_remove</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">prio_tree_node</span><span class="p">);</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="cm">/* Leave this BUG_ON till prio_tree patch stabilizes */</span>
		<span class="n">BUG_ON</span><span class="p">(</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">!=</span> <span class="n">vma</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">parent</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">head</span> <span class="o">=</span> <span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">new_head</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span>
					<span class="n">head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">next</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">vm_area_struct</span><span class="p">,</span>
					<span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
				<span class="n">list_del_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="n">new_head</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

			<span class="n">raw_prio_tree_replace</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">prio_tree_node</span><span class="p">,</span>
					<span class="o">&amp;</span><span class="n">head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">prio_tree_node</span><span class="p">);</span>
			<span class="n">head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">new_head</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="n">new_head</span><span class="p">)</span>
				<span class="n">new_head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">head</span><span class="p">;</span>

		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
			<span class="n">node</span> <span class="o">=</span> <span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">;</span>
			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">list_empty</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">))</span> <span class="p">{</span>
				<span class="n">new_head</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span>
					<span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">next</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">vm_area_struct</span><span class="p">,</span>
					<span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
				<span class="n">list_del_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
				<span class="n">node</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">new_head</span><span class="p">;</span>
				<span class="n">new_head</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="n">node</span><span class="p">;</span>
			<span class="p">}</span> <span class="k">else</span>
				<span class="n">node</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="cm">/*</span>
<span class="cm"> * Helper function to enumerate vmas that map a given file page or a set of</span>
<span class="cm"> * contiguous file pages. The function returns vmas that at least map a single</span>
<span class="cm"> * page in the given range of contiguous file pages.</span>
<span class="cm"> */</span>
<span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="nf">vma_prio_tree_next</span><span class="p">(</span><span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">vma</span><span class="p">,</span>
					<span class="k">struct</span> <span class="n">prio_tree_iter</span> <span class="o">*</span><span class="n">iter</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">prio_tree_node</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">vm_area_struct</span> <span class="o">*</span><span class="n">next</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">vma</span><span class="p">)</span> <span class="p">{</span>
		<span class="cm">/*</span>
<span class="cm">		 * First call is with NULL vma</span>
<span class="cm">		 */</span>
		<span class="n">ptr</span> <span class="o">=</span> <span class="n">prio_tree_next</span><span class="p">(</span><span class="n">iter</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">next</span> <span class="o">=</span> <span class="n">prio_tree_entry</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vm_area_struct</span><span class="p">,</span>
						<span class="n">shared</span><span class="p">.</span><span class="n">prio_tree_node</span><span class="p">);</span>
			<span class="n">prefetch</span><span class="p">(</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">next</span><span class="p">;</span>
		<span class="p">}</span> <span class="k">else</span>
			<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">parent</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">next</span> <span class="o">=</span> <span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">;</span>
			<span class="n">prefetch</span><span class="p">(</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">next</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">next</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">next</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">vma</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">next</span><span class="p">,</span>
				<span class="k">struct</span> <span class="n">vm_area_struct</span><span class="p">,</span> <span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">prefetch</span><span class="p">(</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">list</span><span class="p">.</span><span class="n">next</span><span class="p">);</span>
			<span class="k">return</span> <span class="n">next</span><span class="p">;</span>
		<span class="p">}</span>
	<span class="p">}</span>

	<span class="n">ptr</span> <span class="o">=</span> <span class="n">prio_tree_next</span><span class="p">(</span><span class="n">iter</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">next</span> <span class="o">=</span> <span class="n">prio_tree_entry</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="k">struct</span> <span class="n">vm_area_struct</span><span class="p">,</span>
					<span class="n">shared</span><span class="p">.</span><span class="n">prio_tree_node</span><span class="p">);</span>
		<span class="n">prefetch</span><span class="p">(</span><span class="n">next</span><span class="o">-&gt;</span><span class="n">shared</span><span class="p">.</span><span class="n">vm_set</span><span class="p">.</span><span class="n">head</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">next</span><span class="p">;</span>
	<span class="p">}</span> <span class="k">else</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:1}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../javascript/docco.min.js"></script>
</html>
