<!DOCTYPE html>
<html><head><title>joekychen/linux » tools › power › cpupower › bench › cpufreq-bench_plot.sh

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>cpufreq-bench_plot.sh</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="c">#!/bin/bash</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2, or (at your option)
any later version.</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA
02110-1301, USA.</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>Author/Copyright(c): 2009, Thomas Renninger <a href="&#x6D;&#97;&#x69;&#108;&#x74;&#x6F;:&#116;&#x72;&#x65;&#x6E;n&#x40;&#115;&#117;&#x73;&#x65;&#x2E;&#x64;&#101;">&#116;&#x72;&#x65;&#x6E;n&#x40;&#115;&#117;&#x73;&#x65;&#x2E;&#x64;&#101;</a>, Novell Inc.</p></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>Helper script to easily create nice plots of your cpufreq-bench results</p></td><td class="code"><div class="highlight"><pre><span class="nv">dir</span><span class="o">=</span><span class="sb">`</span>mktemp -d<span class="sb">`</span>
<span class="nv">output_file</span><span class="o">=</span><span class="s2">&quot;cpufreq-bench.png&quot;</span>
<span class="nv">global_title</span><span class="o">=</span><span class="s2">&quot;cpufreq-bench plot&quot;</span>
<span class="nv">picture_type</span><span class="o">=</span><span class="s2">&quot;jpeg&quot;</span>
file<span class="o">[</span>0<span class="o">]=</span><span class="s2">&quot;&quot;</span>

<span class="k">function </span>usage<span class="o">()</span>
<span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;cpufreq-bench_plot.sh [OPTIONS] logfile [measure_title] [logfile [measure_title]] ...]&quot;</span>
    <span class="nb">echo</span>
<span class="nb">    echo</span> <span class="s2">&quot;Options&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;   -o output_file&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;   -t global_title&quot;</span>
    <span class="nb">echo</span> <span class="s2">&quot;   -p picture_type [jpeg|gif|png|postscript|...]&quot;</span>
    <span class="nb">exit </span>1
<span class="o">}</span>

<span class="k">if</span> <span class="o">[</span> <span class="nv">$# </span>-eq 0 <span class="o">]</span>;<span class="k">then</span>
<span class="k">	</span><span class="nb">echo</span> <span class="s2">&quot;No benchmark results file provided&quot;</span>
	<span class="nb">echo</span>
<span class="nb">	</span>usage
<span class="k">fi</span>

<span class="k">while </span><span class="nb">getopts </span>o:t:p: name ; <span class="k">do</span>
<span class="k">    case</span> <span class="nv">$name</span> in
	o<span class="o">)</span>
	    <span class="nv">output_file</span><span class="o">=</span><span class="s2">&quot;$OPTARG&quot;</span>.<span class="nv">$picture_type</span>
	    ;;
	t<span class="o">)</span>
	    <span class="nv">global_title</span><span class="o">=</span><span class="s2">&quot;$OPTARG&quot;</span>
	    ;;
	p<span class="o">)</span>
	    <span class="nv">picture_type</span><span class="o">=</span><span class="s2">&quot;$OPTARG&quot;</span>
	    ;;
        ?<span class="o">)</span>
	    usage
	    ;;
    <span class="k">esac</span>
<span class="k">done</span>
<span class="nb">shift</span> <span class="k">$((</span><span class="nv">$OPTIND</span> <span class="o">-</span><span class="m">1</span><span class="k">))</span>

<span class="nv">plots</span><span class="o">=</span>0
<span class="k">while</span> <span class="o">[</span> <span class="s2">&quot;$1&quot;</span> <span class="o">]</span>;<span class="k">do</span>
<span class="k">    if</span> <span class="o">[</span> ! -f <span class="s2">&quot;$1&quot;</span> <span class="o">]</span>;<span class="k">then</span>
<span class="k">	</span><span class="nb">echo</span> <span class="s2">&quot;File $1 does not exist&quot;</span>
	usage
    <span class="k">fi</span>
<span class="k">    </span>file<span class="o">[</span><span class="nv">$plots</span><span class="o">]=</span><span class="s2">&quot;$1&quot;</span>
    title<span class="o">[</span><span class="nv">$plots</span><span class="o">]=</span><span class="s2">&quot;$2&quot;</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>echo "File: ${file[$plots]} - ${title[plots]}"</p></td><td class="code"><div class="highlight"><pre>    <span class="nb">shift</span>;<span class="nb">shift</span>
<span class="nb">    </span><span class="nv">plots</span><span class="o">=</span><span class="k">$((</span>plots <span class="o">+</span> <span class="m">1</span><span class="k">))</span>
<span class="k">done</span>

<span class="nb">echo</span> <span class="s2">&quot;set terminal $picture_type&quot;</span>	&gt;&gt; <span class="nv">$dir</span>/plot_script.gpl
<span class="nb">echo</span> <span class="s2">&quot;set output \&quot;$output_file\&quot;&quot;</span>	&gt;&gt; <span class="nv">$dir</span>/plot_script.gpl
<span class="nb">echo</span> <span class="s2">&quot;set title \&quot;$global_title\&quot;&quot;</span>	&gt;&gt; <span class="nv">$dir</span>/plot_script.gpl
<span class="nb">echo</span> <span class="s2">&quot;set xlabel \&quot;sleep/load time\&quot;&quot;</span>	&gt;&gt; <span class="nv">$dir</span>/plot_script.gpl
<span class="nb">echo</span> <span class="s2">&quot;set ylabel \&quot;Performance (%)\&quot;&quot;</span>	&gt;&gt; <span class="nv">$dir</span>/plot_script.gpl

<span class="k">for</span><span class="o">((</span><span class="nv">plot</span><span class="o">=</span>0;plot&lt;<span class="nv">$plots</span>;plot++<span class="o">))</span>;<span class="k">do</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Sanity check</p>

<h5>I am to dump to get this redirected to stderr/stdout in one awk call...</h5></td><td class="code"><div class="highlight"><pre>    cat <span class="k">${</span><span class="nv">file</span><span class="p">[</span><span class="nv">$plot</span><span class="p">]</span><span class="k">}</span> |grep -v <span class="s2">&quot;^#&quot;</span> |awk <span class="s1">&#39;{if ($2 != $3) printf(&quot;Error in measure %d:Load time %s does not equal sleep time %s, plot will not be correct\n&quot;, $1, $2, $3); ERR=1}&#39;</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><h5>I am to dump to get this redirected in one awk call...</h5></td><td class="code"><div class="highlight"><pre></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Parse out load time (which must be equal to sleep time for a plot), divide it by 1000
to get ms and parse out the performance in percentage and write it to a temp file for plotting</p></td><td class="code"><div class="highlight"><pre>    cat <span class="k">${</span><span class="nv">file</span><span class="p">[</span><span class="nv">$plot</span><span class="p">]</span><span class="k">}</span> |grep -v <span class="s2">&quot;^#&quot;</span> |awk <span class="s1">&#39;{printf &quot;%lu %.1f\n&quot;,$2/1000, $6}&#39;</span> &gt;<span class="nv">$dir</span>/data_<span class="nv">$plot</span>

    <span class="k">if</span> <span class="o">[</span> <span class="nv">$plot</span> -eq 0 <span class="o">]</span>;<span class="k">then</span>
<span class="k">	</span><span class="nb">echo</span> -n <span class="s2">&quot;plot &quot;</span> &gt;&gt; <span class="nv">$dir</span>/plot_script.gpl
    <span class="k">fi</span>
<span class="k">    </span><span class="nb">echo</span> -n <span class="s2">&quot;\&quot;$dir/data_$plot\&quot; title \&quot;${title[$plot]}\&quot; with lines&quot;</span> &gt;&gt; <span class="nv">$dir</span>/plot_script.gpl
    <span class="k">if</span> <span class="o">[</span> <span class="k">$((</span><span class="nv">$plot</span> <span class="o">+</span> <span class="m">1</span><span class="k">))</span> -ne <span class="nv">$plots</span> <span class="o">]</span>;<span class="k">then</span>
<span class="k">	</span><span class="nb">echo</span> -n <span class="s2">&quot;, &quot;</span> &gt;&gt; <span class="nv">$dir</span>/plot_script.gpl
    <span class="k">fi</span>
<span class="k">done</span>
<span class="nb">echo</span> &gt;&gt; <span class="nv">$dir</span>/plot_script.gpl

gnuplot <span class="nv">$dir</span>/plot_script.gpl
rm -r <span class="nv">$dir</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
