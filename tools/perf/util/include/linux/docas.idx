f | bitops.h | s | 3.5K | 135 | David Ahern | dsahern@gmail.com | 1339424401 |  | perf tools: Fix endianity swapping for adds_features bitmask  Based on Jiri's latest attempt: https://lkml.org/lkml/2012/5/16/61  Basically, adds_features should be byte swapped assuming unsigned longs are either 8-bytes (u64) or 4-bytes (u32).      Fixes 32-bit ppc dumping 64-bit x86 feature data:      ========      captured on: Sun May 20 19:23:23 2012      hostname : nxos-vdc-dev3      os release : 3.4.0-rc7+      perf version : 3.4.rc4.137.g978da3      arch : x86_64      nrcpus online : 16      nrcpus avail : 16      cpudesc : Intel(R) Xeon(R) CPU E5540 @ 2.53GHz      cpuid : GenuineIntel,6,26,5      total memory : 24680324 kB     ...  Verified 64-bit x86 can still dump feature data for 32-bit ppc.  Signed-off-by: David Ahern <dsahern@gmail.com> Reviewed-by: Jiri Olsa <jolsa@redhat.com> Cc: Corey Ashford <cjashfor@linux.vnet.ibm.com> Cc: Frederic Weisbecker <fweisbec@gmail.com> Cc: Paul Mackerras <paulus@samba.org> Cc: Peter Zijlstra <peterz@infradead.org> Link: http://lkml.kernel.org/r/4FBBB539.5010805@gmail.com Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
f | types.h | s | 333B | 15 | Ingo Molnar | mingo@elte.hu | 1281642600 |  | perf: Add back list_head data types  This commit:   de5d9bf: Move list types from <linux/list.h> to <linux/types.h>.  Moved the list head data types out of list.h, breaking the build. Add them to the perf types.h as well.  Cc: Arnaldo Carvalho de Melo <acme@redhat.com> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: Frederic Weisbecker <fweisbec@gmail.com> Cc: Paul Mackerras <paulus@samba.org> Cc: Steven Rostedt <rostedt@goodmis.org> LKML-Reference: <new-submission> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | compiler.h | s | 258B | 11 | Josh Boyer | jwboyer@redhat.com | 1313663093 |  | perf tools: Fix build against newer glibc  Upstream glibc commit 295e904 added a definition for __attribute_const__ to cdefs.h.  This causes the following error when building perf:  util/include/linux/compiler.h:8:0: error: "__attribute_const__" redefined [-Werror] /usr/include/sys/cdefs.h:226:0: note: this is the location of the previous definition  Wrap __attribute_const__ in #ifndef as we do for __always_inline.  Cc: Ingo Molnar <mingo@elte.hu> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Link: http://lkml.kernel.org/r/20110818113720.GL2227@zod.bos.redhat.com Signed-off-by: Josh Boyer <jwboyer@redhat.com> Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
f | hash.h | s | 92B | 4 | Hitoshi Mitake | mitake@dcl.info.waseda.ac.jp | 1264922873 |  | perf: Add util/include/linuxhash.h to include hash.h of kernel  linux/hash.h, hash header of kernel, is also useful for perf.  util/include/linuxhash.h includes linux/hash.h, so we can use hash facilities (e.g. hash_long()) in perf now.  Signed-off-by: Hitoshi Mitake <mitake@dcl.info.waseda.ac.jp> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: Paul Mackerras <paulus@samba.org> Cc: Frederic Weisbecker <fweisbec@gmail.com> LKML-Reference: <1264851813-8413-3-git-send-email-mitake@dcl.info.waseda.ac.jp> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | bitmap.h | s | 1.1K | 38 | Jiri Olsa | jolsa@redhat.com | 1329182890 |  | perf tools: Add bitmap_or function into bitmap object  Adding implementation os bitmap_or function to the bitmap object. It is stolen from the kernel lib/bitmap.o object.  It is used in upcomming patches.  Cc: Corey Ashford <cjashfor@linux.vnet.ibm.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: Paul Mackerras <paulus@samba.org> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Link: http://lkml.kernel.org/r/1327674868-10486-5-git-send-email-jolsa@redhat.com Signed-off-by: Jiri Olsa <jolsa@redhat.com> Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
f | const.h | s | 45B | 1 | Arnaldo Carvalho de Melo | acme@redhat.com | 1306419389 |  | perf tools: Fix build on older systems  Where /usr/include/linux/const.h is not present, e.g. RHEL5.  Reported-by: Srikar Dronamraju <srikar@linux.vnet.ibm.com> Cc: Srikar Dronamraju <srikar@linux.vnet.ibm.com> Cc: Frederic Weisbecker <fweisbec@gmail.com> Cc: Ingo Molnar <mingo@elte.hu> Cc: Mike Galbraith <efault@gmx.de> Cc: Paul Mackerras <paulus@samba.org> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Stephane Eranian <eranian@google.com> Cc: Tom Zanussi <tzanussi@gmail.com> Link: http://lkml.kernel.org/n/tip-ypcw2mu0w7dl1rrc6ncz3pee@git.kernel.org Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
f | rbtree.h | s | 46B | 1 | Arnaldo Carvalho de Melo | acme@redhat.com | 1246480642 |  | perf_counter tools: Share rbtree.with the kernel  The tools/perf/util/rbtree.c copy already drifted by three csets:   4b324126e0c6c3a5080ca3ec0981e8766ed6f1ee  4c60117811171d867d4f27f17ea07d7419d45dae  16c047add3ceaf0ab882e3e094d1ec904d02312d  So remove the copy and use the lib/rbtree.c directly, sharing the source code while still generating a separate object file, since tools/perf uses a far more agressive -O6 switch.  Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com> Cc: Mike Galbraith <efault@gmx.de> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Paul Mackerras <paulus@samba.org> Cc: Frederic Weisbecker <fweisbec@gmail.com> LKML-Reference: <20090701152837.GG15682@ghostprotocols.net> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | linkage.h | s | 232B | 8 | Hitoshi Mitake | mitake@dcl.info.waseda.ac.jp | 1290755757 |  | perf bench: Add feature that measures the performance of the arch/x86/lib/memcpy_64.S memcpy routines via 'perf bench mem'  This patch ports arch/x86/lib/memcpy_64.S to perf bench mem memcpy for benchmarking memcpy() in userland with tricky and dirty way.  util/include/asm/cpufeature.h, util/include/asm/dwarf2.h, and util/include/linux/linkage.h are mostly dummy files with small wrappers, so that we are able to include memcpy_64.S unmodified.  Signed-off-by: Hitoshi Mitake <mitake@dcl.info.waseda.ac.jp> Cc: h.mitake@gmail.com Cc: Miao Xie <miaox@cn.fujitsu.com> Cc: Ma Ling <ling.ma@intel.com> Cc: Zhao Yakui <yakui.zhao@intel.com> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: Arnaldo Carvalho de Melo <acme@redhat.com> Cc: Paul Mackerras <paulus@samba.org> Cc: Frederic Weisbecker <fweisbec@gmail.com> Cc: Steven Rostedt <rostedt@goodmis.org> Cc: Andi Kleen <andi@firstfloor.org> LKML-Reference: <1290668693-27068-2-git-send-email-mitake@dcl.info.waseda.ac.jp> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | list.h | s | 874B | 26 | Linus Torvalds | torvalds@linux-foundation.org | 1306167952 |  | Merge branch 'perf-urgent-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/linux-2.6-tip  * 'perf-urgent-for-linus' of git://git.kernel.org/pub/scm/linux/kernel/git/tip/linux-2.6-tip:   perf tools: Fix sample size bit operations   perf tools: Fix ommitted mmap data update on remap   watchdog: Change the default timeout and configure nmi watchdog period based on watchdog_thresh   watchdog: Disable watchdog when thresh is zero   watchdog: Only disable/enable watchdog if neccessary   watchdog: Fix rounding bug in get_sample_period()   perf tools: Propagate event parse error handling   perf tools: Robustify dynamic sample content fetch   perf tools: Pre-check sample size before parsing   perf tools: Move evlist sample helpers to evlist area   perf tools: Remove junk code in mmap size handling   perf tools: Check we are able to read the event size on mmap
f | poison.h | s | 46B | 1 | Arnaldo Carvalho de Melo | acme@redhat.com | 1246480643 |  | perf_counter tools: Share list.h with the kernel  The copy we were using came from another copy I did for the dwarves (pahole) package, that came from the kernel years ago.  The only function that is used by the perf tools and that isn't in the kernel is list_del_range, that I'm leaving in the perf tools only for now.  Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com> Cc: Frederic Weisbecker <fweisbec@gmail.com> Cc: Mike Galbraith <efault@gmx.de> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Paul Mackerras <paulus@samba.org> LKML-Reference: <20090701174608.GA5823@ghostprotocols.net> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | string.h | s | 20B | 1 | Arnaldo Carvalho de Melo | acme@redhat.com | 1256000374 |  | perf tools: Add missing tools/perf/util/include/string.h  To cure a bunch of:  In file included from util/include/linux/bitmap.h:1,                  from util/header.h:8,                  from builtin-trace.c:7: util/include/../../../../include/linux/bitmap.h:8:26: error: linux/string.h: No such file or directory make: *** [builtin-trace.o] Error 1 make: *** Waiting for unfinished jobs....  Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com> Acked-by: Frederic Weisbecker <fweisbec@gmail.com> Cc: Steven Rostedt <srostedt@redhat.com> Cc: Peter Zijlstra <peterz@infradead.org> LKML-Reference: <1255972296-11500-1-git-send-email-acme@redhat.com> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | export.h | s | 93B | 4 | Jiri Olsa | jolsa@redhat.com | 1332775197 |  | perf tools: Switch module.h into export.h  When merged to Linus's latest tree the perf build is broken due to following change in lib/rbtree.c object:    lib: reduce the use of module.h wherever possible   commit 8bc3bcc93a2b4e47d5d410146f6546bca6171663   Author: Paul Gortmaker <paul.gortmaker@windriver.com>   Date:   Wed Nov 16 21:29:17 2011 -0500  We need to move module.h header into export.h.  Signed-off-by: Jiri Olsa <jolsa@redhat.com> Cc: acme@redhat.com Cc: a.p.zijlstra@chello.nl Cc: paulus@samba.org Cc: cjashfor@linux.vnet.ibm.com Cc: fweisbec@gmail.com Link: http://lkml.kernel.org/r/1332753425-3299-1-git-send-email-jolsa@redhat.com Signed-off-by: Ingo Molnar <mingo@kernel.org>
f | kernel.h | s | 2.6K | 90 | Arnaldo Carvalho de Melo | acme@redhat.com | 1274121818 |  | perf options: Check v type in OPT_U?INTEGER  To avoid problems like the one fixed by Stephane Eranian in 3de29ca, now we'll got this instead:  	bench/sched-messaging.c:259: error: negative width in bit-field ‘<anonymous>’ 	bench/sched-messaging.c:261: error: negative width in bit-field ‘<anonymous>’  Which is rather cryptic, but is how BUILD_BUG_ON_ZERO works, so kernel hackers should be already used to this.  With it in place found some problems, fixed by changing the affected variables to sensible types or changed some OPT_INTEGER to OPT_UINTEGER.  Next csets will go thru converting each of the remaining OPT_ so that review can be made easier by grouping changes per type per patch.  Cc: Frédéric Weisbecker <fweisbec@gmail.com> Cc: Mike Galbraith <efault@gmx.de> Cc: Paul Mackerras <paulus@samba.org> Cc: Peter Zijlstra <a.p.zijlstra@chello.nl> Cc: Stephane Eranian <eranian@google.com> Cc: Tom Zanussi <tzanussi@gmail.com> LKML-Reference: <new-submission> Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com>
f | ctype.h | s | 21B | 1 | Frederic Weisbecker | fweisbec@gmail.com | 1257921019 |  | perf tools: Bring linear set of section headers for features  Build a set of section headers for features right after the datas. Each implemented feature will have one of such section header that provides the offset and the size of the data manipulated by the feature.  The trace informations have moved after the data and are recorded on exit time.  The new layout is as follows:   -----------------------                              ___  [ magic               ]      ||  [ header size         ]      ||  [ attr size           ]      ||  [ attr content offset ]      ||  [ attr content size   ]      ||  [ data offset         ]  File Headers  [ data size           ]      ||  [ event_types offset  ]      ||  [ event_types size    ]      ||  [ feature bitmap      ]      v   [ attr section        ]  [ events section      ]                               ___  [         X           ]      ||  [         X           ]      ||  [         X           ]    Datas  [         X           ]      ||  [         X           ]      v                               ___  [ Feature 1 offset    ]      ||  [ Feature 1 size      ] Features headers  [ Feature 2 offset    ]      ||  [ Feature 2 size      ]      v   [ Feature 1 content   ]  [ Feature 2 content   ]  -----------------------  We have as many feature's section headers as we have features in use for the current file.  Say Feat 1 and Feat 3 are used by the file, but not Feat 2. Then the feature headers will be like follows:  [ Feature 1 offset    ]      || [ Feature 1 size      ] Features headers [ Feature 3 offset    ]      || [ Feature 3 size      ]      v  There is no hole to cover Feature 2 that is not in use here. We only need to cover the needed headers in order, from the lowest feature bit to the highest.  Currently we have two features: HEADER_TRACE_INFO and HEADER_BUILD_ID. Both have their contents that follow the feature headers. Putting the contents right after the feature headers is not mandatory though. While we keep the feature headers right after the data and in order, their offsets can point everywhere. We have just put the two above feature contents in the end of the file for convenience.  The purpose of this layout change is to have a file format that scales while keeping it simple: having such linear feature headers is less error prone wrt forward/backward compatibility as the content of a feature can be put anywhere, its location can even change by the time, it's fine because its headers will tell where it is. And we know how to find these headers, following the above rules.  Signed-off-by: Frederic Weisbecker <fweisbec@gmail.com> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Arnaldo Carvalho de Melo <acme@redhat.com> Cc: Mike Galbraith <efault@gmx.de> Cc: Paul Mackerras <paulus@samba.org> Cc: Hitoshi Mitake <mitake@dcl.info.waseda.ac.jp> LKML-Reference: <1257911467-28276-6-git-send-email-fweisbec@gmail.com> Signed-off-by: Ingo Molnar <mingo@elte.hu>
f | prefetch.h | s | 134B | 4 | Arnaldo Carvalho de Melo | acme@redhat.com | 1246480643 |  | perf_counter tools: Share list.h with the kernel  The copy we were using came from another copy I did for the dwarves (pahole) package, that came from the kernel years ago.  The only function that is used by the perf tools and that isn't in the kernel is list_del_range, that I'm leaving in the perf tools only for now.  Signed-off-by: Arnaldo Carvalho de Melo <acme@redhat.com> Cc: Frederic Weisbecker <fweisbec@gmail.com> Cc: Mike Galbraith <efault@gmx.de> Cc: Peter Zijlstra <peterz@infradead.org> Cc: Paul Mackerras <paulus@samba.org> LKML-Reference: <20090701174608.GA5823@ghostprotocols.net> Signed-off-by: Ingo Molnar <mingo@elte.hu>
