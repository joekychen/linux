<!DOCTYPE html>
<html><head><title>joekychen/linux » tools › perf › util › python.c

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../index.html"></a><h1>python.c</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;Python.h&gt;</span>
<span class="cp">#include &lt;structmember.h&gt;</span>
<span class="cp">#include &lt;inttypes.h&gt;</span>
<span class="cp">#include &lt;poll.h&gt;</span>
<span class="cp">#include &quot;evlist.h&quot;</span>
<span class="cp">#include &quot;evsel.h&quot;</span>
<span class="cp">#include &quot;event.h&quot;</span>
<span class="cp">#include &quot;cpumap.h&quot;</span>
<span class="cp">#include &quot;thread_map.h&quot;</span>

<span class="cm">/* Define PyVarObject_HEAD_INIT for python 2.5 */</span>
<span class="cp">#ifndef PyVarObject_HEAD_INIT</span>
<span class="cp"># define PyVarObject_HEAD_INIT(type, size) PyObject_HEAD_INIT(type) size,</span>
<span class="cp">#endif</span>

<span class="k">struct</span> <span class="n">throttle_event</span> <span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_event_header</span> <span class="n">header</span><span class="p">;</span>
	<span class="n">u64</span>			 <span class="n">time</span><span class="p">;</span>
	<span class="n">u64</span>			 <span class="n">id</span><span class="p">;</span>
	<span class="n">u64</span>			 <span class="n">stream_id</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">PyMODINIT_FUNC</span> <span class="n">initperf</span><span class="p">(</span><span class="kt">void</span><span class="p">);</span>

<span class="cp">#define member_def(type, member, ptype, help) \</span>
<span class="cp">	{ #member, ptype, \</span>
<span class="cp">	  offsetof(struct pyrf_event, event) + offsetof(struct type, member), \</span>
<span class="cp">	  0, help }</span>

<span class="cp">#define sample_member_def(name, member, ptype, help) \</span>
<span class="cp">	{ #name, ptype, \</span>
<span class="cp">	  offsetof(struct pyrf_event, sample) + offsetof(struct perf_sample, member), \</span>
<span class="cp">	  0, help }</span>

<span class="k">struct</span> <span class="n">pyrf_event</span> <span class="p">{</span>
	<span class="n">PyObject_HEAD</span>
	<span class="k">struct</span> <span class="n">perf_sample</span> <span class="n">sample</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">perf_event</span>   <span class="n">event</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#define sample_members \</span>
<span class="cp">	sample_member_def(sample_ip, ip, T_ULONGLONG, &quot;event type&quot;),			 \</span>
<span class="cp">	sample_member_def(sample_pid, pid, T_INT, &quot;event pid&quot;),			 \</span>
<span class="cp">	sample_member_def(sample_tid, tid, T_INT, &quot;event tid&quot;),			 \</span>
<span class="cp">	sample_member_def(sample_time, time, T_ULONGLONG, &quot;event timestamp&quot;),		 \</span>
<span class="cp">	sample_member_def(sample_addr, addr, T_ULONGLONG, &quot;event addr&quot;),		 \</span>
<span class="cp">	sample_member_def(sample_id, id, T_ULONGLONG, &quot;event id&quot;),			 \</span>
<span class="cp">	sample_member_def(sample_stream_id, stream_id, T_ULONGLONG, &quot;event stream id&quot;), \</span>
<span class="cp">	sample_member_def(sample_period, period, T_ULONGLONG, &quot;event period&quot;),		 \</span>
<span class="cp">	sample_member_def(sample_cpu, cpu, T_UINT, &quot;event cpu&quot;),</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_mmap_event__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf mmap event object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyMemberDef</span> <span class="n">pyrf_mmap_event__members</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">sample_members</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">perf_event_header</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event type&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">mmap_event</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event pid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">mmap_event</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event tid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">mmap_event</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;start of the map&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">mmap_event</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;map length&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">mmap_event</span><span class="p">,</span> <span class="n">pgoff</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;page offset&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">mmap_event</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">T_STRING_INPLACE</span><span class="p">,</span> <span class="s">&quot;backing store&quot;</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_mmap_event__repr</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PyObject</span> <span class="o">*</span><span class="n">ret</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">asprintf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;{ type: mmap, pid: %u, tid: %u, start: %#&quot;</span> <span class="n">PRIx64</span> <span class="s">&quot;, &quot;</span>
			 <span class="s">&quot;length: %#&quot;</span> <span class="n">PRIx64</span> <span class="s">&quot;, offset: %#&quot;</span> <span class="n">PRIx64</span> <span class="s">&quot;, &quot;</span>
			 <span class="s">&quot;filename: %s }&quot;</span><span class="p">,</span>
		     <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">mmap</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span> <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">mmap</span><span class="p">.</span><span class="n">tid</span><span class="p">,</span>
		     <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">mmap</span><span class="p">.</span><span class="n">start</span><span class="p">,</span> <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">mmap</span><span class="p">.</span><span class="n">len</span><span class="p">,</span>
		     <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">mmap</span><span class="p">.</span><span class="n">pgoff</span><span class="p">,</span> <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">mmap</span><span class="p">.</span><span class="n">filename</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">PyErr_NoMemory</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">PyString_FromString</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
		<span class="n">free</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_mmap_event__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.mmap_event&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_mmap_event__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_members</span>	<span class="o">=</span> <span class="n">pyrf_mmap_event__members</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_repr</span>	<span class="o">=</span> <span class="p">(</span><span class="n">reprfunc</span><span class="p">)</span><span class="n">pyrf_mmap_event__repr</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_task_event__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf task (fork/exit) event object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyMemberDef</span> <span class="n">pyrf_task_event__members</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">sample_members</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">perf_event_header</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event type&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">fork_event</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event pid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">fork_event</span><span class="p">,</span> <span class="n">ppid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event ppid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">fork_event</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event tid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">fork_event</span><span class="p">,</span> <span class="n">ptid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event ptid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">fork_event</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;timestamp&quot;</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_task_event__repr</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">PyString_FromFormat</span><span class="p">(</span><span class="s">&quot;{ type: %s, pid: %u, ppid: %u, tid: %u, &quot;</span>
				   <span class="s">&quot;ptid: %u, time: %&quot;</span> <span class="n">PRIu64</span> <span class="s">&quot;}&quot;</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">PERF_RECORD_FORK</span> <span class="o">?</span> <span class="s">&quot;fork&quot;</span> <span class="o">:</span> <span class="s">&quot;exit&quot;</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">fork</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">fork</span><span class="p">.</span><span class="n">ppid</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">fork</span><span class="p">.</span><span class="n">tid</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">fork</span><span class="p">.</span><span class="n">ptid</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">fork</span><span class="p">.</span><span class="n">time</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_task_event__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.task_event&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_task_event__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_members</span>	<span class="o">=</span> <span class="n">pyrf_task_event__members</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_repr</span>	<span class="o">=</span> <span class="p">(</span><span class="n">reprfunc</span><span class="p">)</span><span class="n">pyrf_task_event__repr</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_comm_event__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf comm event object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyMemberDef</span> <span class="n">pyrf_comm_event__members</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">sample_members</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">perf_event_header</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event type&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">comm_event</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event pid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">comm_event</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event tid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">comm_event</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">T_STRING_INPLACE</span><span class="p">,</span> <span class="s">&quot;process name&quot;</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_comm_event__repr</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">PyString_FromFormat</span><span class="p">(</span><span class="s">&quot;{ type: comm, pid: %u, tid: %u, comm: %s }&quot;</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="n">tid</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="n">comm</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_comm_event__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.comm_event&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_comm_event__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_members</span>	<span class="o">=</span> <span class="n">pyrf_comm_event__members</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_repr</span>	<span class="o">=</span> <span class="p">(</span><span class="n">reprfunc</span><span class="p">)</span><span class="n">pyrf_comm_event__repr</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_throttle_event__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf throttle event object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyMemberDef</span> <span class="n">pyrf_throttle_event__members</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">sample_members</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">perf_event_header</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event type&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">throttle_event</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;timestamp&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">throttle_event</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;event id&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">throttle_event</span><span class="p">,</span> <span class="n">stream_id</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;event stream id&quot;</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_throttle_event__repr</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">throttle_event</span> <span class="o">*</span><span class="n">te</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">throttle_event</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">header</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">PyString_FromFormat</span><span class="p">(</span><span class="s">&quot;{ type: %sthrottle, time: %&quot;</span> <span class="n">PRIu64</span> <span class="s">&quot;, id: %&quot;</span> <span class="n">PRIu64</span>
				   <span class="s">&quot;, stream_id: %&quot;</span> <span class="n">PRIu64</span> <span class="s">&quot; }&quot;</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">header</span><span class="p">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">PERF_RECORD_THROTTLE</span> <span class="o">?</span> <span class="s">&quot;&quot;</span> <span class="o">:</span> <span class="s">&quot;un&quot;</span><span class="p">,</span>
				   <span class="n">te</span><span class="o">-&gt;</span><span class="n">time</span><span class="p">,</span> <span class="n">te</span><span class="o">-&gt;</span><span class="n">id</span><span class="p">,</span> <span class="n">te</span><span class="o">-&gt;</span><span class="n">stream_id</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_throttle_event__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.throttle_event&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_throttle_event__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_members</span>	<span class="o">=</span> <span class="n">pyrf_throttle_event__members</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_repr</span>	<span class="o">=</span> <span class="p">(</span><span class="n">reprfunc</span><span class="p">)</span><span class="n">pyrf_throttle_event__repr</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_lost_event__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf lost event object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyMemberDef</span> <span class="n">pyrf_lost_event__members</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">sample_members</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">lost_event</span><span class="p">,</span> <span class="n">id</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;event id&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">lost_event</span><span class="p">,</span> <span class="n">lost</span><span class="p">,</span> <span class="n">T_ULONGLONG</span><span class="p">,</span> <span class="s">&quot;number of lost events&quot;</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_lost_event__repr</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PyObject</span> <span class="o">*</span><span class="n">ret</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">asprintf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;{ type: lost, id: %#&quot;</span> <span class="n">PRIx64</span> <span class="s">&quot;, &quot;</span>
			 <span class="s">&quot;lost: %#&quot;</span> <span class="n">PRIx64</span> <span class="s">&quot; }&quot;</span><span class="p">,</span>
		     <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">lost</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">lost</span><span class="p">.</span><span class="n">lost</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">PyErr_NoMemory</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">PyString_FromString</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
		<span class="n">free</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_lost_event__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.lost_event&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_lost_event__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_members</span>	<span class="o">=</span> <span class="n">pyrf_lost_event__members</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_repr</span>	<span class="o">=</span> <span class="p">(</span><span class="n">reprfunc</span><span class="p">)</span><span class="n">pyrf_lost_event__repr</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_read_event__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf read event object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyMemberDef</span> <span class="n">pyrf_read_event__members</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">sample_members</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">read_event</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event pid&quot;</span><span class="p">),</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">read_event</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event tid&quot;</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_read_event__repr</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="n">PyString_FromFormat</span><span class="p">(</span><span class="s">&quot;{ type: read, pid: %u, tid: %u }&quot;</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">pid</span><span class="p">,</span>
				   <span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">tid</span><span class="p">);</span>
	<span class="cm">/*</span>
<span class="cm"> 	 * FIXME: return the array of read values,</span>
<span class="cm"> 	 * making this method useful ;-)</span>
<span class="cm"> 	 */</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_read_event__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.read_event&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_read_event__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_members</span>	<span class="o">=</span> <span class="n">pyrf_read_event__members</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_repr</span>	<span class="o">=</span> <span class="p">(</span><span class="n">reprfunc</span><span class="p">)</span><span class="n">pyrf_read_event__repr</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_sample_event__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf sample event object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyMemberDef</span> <span class="n">pyrf_sample_event__members</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">sample_members</span>
	<span class="n">member_def</span><span class="p">(</span><span class="n">perf_event_header</span><span class="p">,</span> <span class="n">type</span><span class="p">,</span> <span class="n">T_UINT</span><span class="p">,</span> <span class="s">&quot;event type&quot;</span><span class="p">),</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_sample_event__repr</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PyObject</span> <span class="o">*</span><span class="n">ret</span><span class="p">;</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">asprintf</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="s">&quot;{ type: sample }&quot;</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">PyErr_NoMemory</span><span class="p">();</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">ret</span> <span class="o">=</span> <span class="n">PyString_FromString</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
		<span class="n">free</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_sample_event__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.sample_event&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_sample_event__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_members</span>	<span class="o">=</span> <span class="n">pyrf_sample_event__members</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_repr</span>	<span class="o">=</span> <span class="p">(</span><span class="n">reprfunc</span><span class="p">)</span><span class="n">pyrf_sample_event__repr</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_event__setup_types</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>
	<span class="n">pyrf_mmap_event__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span>
	<span class="n">pyrf_task_event__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span>
	<span class="n">pyrf_comm_event__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span>
	<span class="n">pyrf_lost_event__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span>
	<span class="n">pyrf_read_event__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span>
	<span class="n">pyrf_sample_event__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span>
	<span class="n">pyrf_throttle_event__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span> <span class="n">PyType_GenericNew</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_mmap_event__type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_lost_event__type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_task_event__type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_comm_event__type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_throttle_event__type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_read_event__type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
	<span class="n">err</span> <span class="o">=</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_sample_event__type</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">out</span><span class="p">;</span>
<span class="nl">out:</span>
	<span class="k">return</span> <span class="n">err</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="o">*</span><span class="n">pyrf_event__type</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">[</span><span class="n">PERF_RECORD_MMAP</span><span class="p">]</span>	 <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_mmap_event__type</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_RECORD_LOST</span><span class="p">]</span>	 <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_lost_event__type</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_RECORD_COMM</span><span class="p">]</span>	 <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_comm_event__type</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_RECORD_EXIT</span><span class="p">]</span>	 <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_task_event__type</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_RECORD_THROTTLE</span><span class="p">]</span>	 <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_throttle_event__type</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_RECORD_UNTHROTTLE</span><span class="p">]</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_throttle_event__type</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_RECORD_FORK</span><span class="p">]</span>	 <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_task_event__type</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_RECORD_READ</span><span class="p">]</span>	 <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_read_event__type</span><span class="p">,</span>
	<span class="p">[</span><span class="n">PERF_RECORD_SAMPLE</span><span class="p">]</span>	 <span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_sample_event__type</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_event__new</span><span class="p">(</span><span class="k">union</span> <span class="n">perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span><span class="p">;</span>
	<span class="n">PyTypeObject</span> <span class="o">*</span><span class="n">ptype</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">type</span> <span class="o">&lt;</span> <span class="n">PERF_RECORD_MMAP</span> <span class="o">||</span>
	    <span class="n">event</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">type</span> <span class="o">&gt;</span> <span class="n">PERF_RECORD_SAMPLE</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">ptype</span> <span class="o">=</span> <span class="n">pyrf_event__type</span><span class="p">[</span><span class="n">event</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">type</span><span class="p">];</span>
	<span class="n">pevent</span> <span class="o">=</span> <span class="n">PyObject_New</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span><span class="p">,</span> <span class="n">ptype</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pevent</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pevent</span><span class="o">-&gt;</span><span class="n">event</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">event</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">.</span><span class="n">size</span><span class="p">);</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="p">)</span><span class="n">pevent</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">pyrf_cpu_map</span> <span class="p">{</span>
	<span class="n">PyObject_HEAD</span>

	<span class="k">struct</span> <span class="n">cpu_map</span> <span class="o">*</span><span class="n">cpus</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_cpu_map__init</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_cpu_map</span> <span class="o">*</span><span class="n">pcpus</span><span class="p">,</span>
			      <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kwlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;cpustr&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
	<span class="kt">char</span> <span class="o">*</span><span class="n">cpustr</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s">&quot;|s&quot;</span><span class="p">,</span>
					 <span class="n">kwlist</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">cpustr</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">pcpus</span><span class="o">-&gt;</span><span class="n">cpus</span> <span class="o">=</span> <span class="n">cpu_map__new</span><span class="p">(</span><span class="n">cpustr</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pcpus</span><span class="o">-&gt;</span><span class="n">cpus</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">pyrf_cpu_map__delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_cpu_map</span> <span class="o">*</span><span class="n">pcpus</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">cpu_map__delete</span><span class="p">(</span><span class="n">pcpus</span><span class="o">-&gt;</span><span class="n">cpus</span><span class="p">);</span>
	<span class="n">pcpus</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_free</span><span class="p">((</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="n">pcpus</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">Py_ssize_t</span> <span class="nf">pyrf_cpu_map__length</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pyrf_cpu_map</span> <span class="o">*</span><span class="n">pcpus</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">pcpus</span><span class="o">-&gt;</span><span class="n">cpus</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_cpu_map__item</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pyrf_cpu_map</span> <span class="o">*</span><span class="n">pcpus</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">pcpus</span><span class="o">-&gt;</span><span class="n">cpus</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">Py_BuildValue</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="n">pcpus</span><span class="o">-&gt;</span><span class="n">cpus</span><span class="o">-&gt;</span><span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PySequenceMethods</span> <span class="n">pyrf_cpu_map__sequence_methods</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">sq_length</span> <span class="o">=</span> <span class="n">pyrf_cpu_map__length</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sq_item</span>   <span class="o">=</span> <span class="n">pyrf_cpu_map__item</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_cpu_map__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;cpu map object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_cpu_map__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.cpu_map&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_cpu_map</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_dealloc</span>	<span class="o">=</span> <span class="p">(</span><span class="n">destructor</span><span class="p">)</span><span class="n">pyrf_cpu_map__delete</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_cpu_map__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_as_sequence</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_cpu_map__sequence_methods</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_init</span>	<span class="o">=</span> <span class="p">(</span><span class="n">initproc</span><span class="p">)</span><span class="n">pyrf_cpu_map__init</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_cpu_map__setup_types</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pyrf_cpu_map__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span> <span class="n">PyType_GenericNew</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_cpu_map__type</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">pyrf_thread_map</span> <span class="p">{</span>
	<span class="n">PyObject_HEAD</span>

	<span class="k">struct</span> <span class="n">thread_map</span> <span class="o">*</span><span class="n">threads</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_thread_map__init</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_thread_map</span> <span class="o">*</span><span class="n">pthreads</span><span class="p">,</span>
				 <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kwlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;pid&quot;</span><span class="p">,</span> <span class="s">&quot;tid&quot;</span><span class="p">,</span> <span class="s">&quot;uid&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
	<span class="kt">int</span> <span class="n">pid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tid</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">UINT_MAX</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s">&quot;|iii&quot;</span><span class="p">,</span>
					 <span class="n">kwlist</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">tid</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">uid</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">pthreads</span><span class="o">-&gt;</span><span class="n">threads</span> <span class="o">=</span> <span class="n">thread_map__new</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="n">tid</span><span class="p">,</span> <span class="n">uid</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">pthreads</span><span class="o">-&gt;</span><span class="n">threads</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">pyrf_thread_map__delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_thread_map</span> <span class="o">*</span><span class="n">pthreads</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">thread_map__delete</span><span class="p">(</span><span class="n">pthreads</span><span class="o">-&gt;</span><span class="n">threads</span><span class="p">);</span>
	<span class="n">pthreads</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_free</span><span class="p">((</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="n">pthreads</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">Py_ssize_t</span> <span class="nf">pyrf_thread_map__length</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pyrf_thread_map</span> <span class="o">*</span><span class="n">pthreads</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">pthreads</span><span class="o">-&gt;</span><span class="n">threads</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_thread_map__item</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pyrf_thread_map</span> <span class="o">*</span><span class="n">pthreads</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">pthreads</span><span class="o">-&gt;</span><span class="n">threads</span><span class="o">-&gt;</span><span class="n">nr</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">Py_BuildValue</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="n">pthreads</span><span class="o">-&gt;</span><span class="n">threads</span><span class="o">-&gt;</span><span class="n">map</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PySequenceMethods</span> <span class="n">pyrf_thread_map__sequence_methods</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">sq_length</span> <span class="o">=</span> <span class="n">pyrf_thread_map__length</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sq_item</span>   <span class="o">=</span> <span class="n">pyrf_thread_map__item</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_thread_map__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;thread map object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_thread_map__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.thread_map&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_thread_map</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_dealloc</span>	<span class="o">=</span> <span class="p">(</span><span class="n">destructor</span><span class="p">)</span><span class="n">pyrf_thread_map__delete</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_thread_map__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_as_sequence</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_thread_map__sequence_methods</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_init</span>	<span class="o">=</span> <span class="p">(</span><span class="n">initproc</span><span class="p">)</span><span class="n">pyrf_thread_map__init</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_thread_map__setup_types</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pyrf_thread_map__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span> <span class="n">PyType_GenericNew</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_thread_map__type</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">pyrf_evsel</span> <span class="p">{</span>
	<span class="n">PyObject_HEAD</span>

	<span class="k">struct</span> <span class="n">perf_evsel</span> <span class="n">evsel</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_evsel__init</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evsel</span> <span class="o">*</span><span class="n">pevsel</span><span class="p">,</span>
			    <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_event_attr</span> <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">PERF_TYPE_HARDWARE</span><span class="p">,</span>
		<span class="p">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">PERF_COUNT_HW_CPU_CYCLES</span><span class="p">,</span>
		<span class="p">.</span><span class="n">sample_type</span> <span class="o">=</span> <span class="n">PERF_SAMPLE_PERIOD</span> <span class="o">|</span> <span class="n">PERF_SAMPLE_TID</span><span class="p">,</span>
	<span class="p">};</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kwlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
		<span class="s">&quot;type&quot;</span><span class="p">,</span>
		<span class="s">&quot;config&quot;</span><span class="p">,</span>
		<span class="s">&quot;sample_freq&quot;</span><span class="p">,</span>
		<span class="s">&quot;sample_period&quot;</span><span class="p">,</span>
		<span class="s">&quot;sample_type&quot;</span><span class="p">,</span>
		<span class="s">&quot;read_format&quot;</span><span class="p">,</span>
		<span class="s">&quot;disabled&quot;</span><span class="p">,</span>
		<span class="s">&quot;inherit&quot;</span><span class="p">,</span>
		<span class="s">&quot;pinned&quot;</span><span class="p">,</span>
		<span class="s">&quot;exclusive&quot;</span><span class="p">,</span>
		<span class="s">&quot;exclude_user&quot;</span><span class="p">,</span>
		<span class="s">&quot;exclude_kernel&quot;</span><span class="p">,</span>
		<span class="s">&quot;exclude_hv&quot;</span><span class="p">,</span>
		<span class="s">&quot;exclude_idle&quot;</span><span class="p">,</span>
		<span class="s">&quot;mmap&quot;</span><span class="p">,</span>
		<span class="s">&quot;comm&quot;</span><span class="p">,</span>
		<span class="s">&quot;freq&quot;</span><span class="p">,</span>
		<span class="s">&quot;inherit_stat&quot;</span><span class="p">,</span>
		<span class="s">&quot;enable_on_exec&quot;</span><span class="p">,</span>
		<span class="s">&quot;task&quot;</span><span class="p">,</span>
		<span class="s">&quot;watermark&quot;</span><span class="p">,</span>
		<span class="s">&quot;precise_ip&quot;</span><span class="p">,</span>
		<span class="s">&quot;mmap_data&quot;</span><span class="p">,</span>
		<span class="s">&quot;sample_id_all&quot;</span><span class="p">,</span>
		<span class="s">&quot;wakeup_events&quot;</span><span class="p">,</span>
		<span class="s">&quot;bp_type&quot;</span><span class="p">,</span>
		<span class="s">&quot;bp_addr&quot;</span><span class="p">,</span>
		<span class="s">&quot;bp_len&quot;</span><span class="p">,</span>
		 <span class="nb">NULL</span>
	<span class="p">};</span>
	<span class="n">u64</span> <span class="n">sample_period</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="n">u32</span> <span class="n">disabled</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">inherit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">pinned</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">exclusive</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">exclude_user</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">exclude_kernel</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">exclude_hv</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">exclude_idle</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">mmap</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">comm</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">freq</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
	    <span class="n">inherit_stat</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">enable_on_exec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">task</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">watermark</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">precise_ip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">mmap_data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
	    <span class="n">sample_id_all</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span>
					 <span class="s">&quot;|iKiKKiiiiiiiiiiiiiiiiiiiiiKK&quot;</span><span class="p">,</span> <span class="n">kwlist</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">type</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">config</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">sample_freq</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">sample_period</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">sample_type</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">read_format</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">disabled</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">inherit</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">pinned</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exclusive</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exclude_user</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">exclude_kernel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exclude_hv</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">exclude_idle</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">mmap</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">comm</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">freq</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">inherit_stat</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">enable_on_exec</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">task</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">watermark</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">precise_ip</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mmap_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sample_id_all</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">wakeup_events</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">bp_type</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">bp_addr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">.</span><span class="n">bp_len</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">idx</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="cm">/* union... */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">sample_period</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">attr</span><span class="p">.</span><span class="n">sample_freq</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span> <span class="cm">/* FIXME: throw right exception */</span>
		<span class="n">attr</span><span class="p">.</span><span class="n">sample_period</span> <span class="o">=</span> <span class="n">sample_period</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="cm">/* Bitfields */</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">disabled</span>	    <span class="o">=</span> <span class="n">disabled</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">inherit</span>	    <span class="o">=</span> <span class="n">inherit</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">pinned</span>	    <span class="o">=</span> <span class="n">pinned</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">exclusive</span>	    <span class="o">=</span> <span class="n">exclusive</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">exclude_user</span>   <span class="o">=</span> <span class="n">exclude_user</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">exclude_kernel</span> <span class="o">=</span> <span class="n">exclude_kernel</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">exclude_hv</span>	    <span class="o">=</span> <span class="n">exclude_hv</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">exclude_idle</span>   <span class="o">=</span> <span class="n">exclude_idle</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">mmap</span>	    <span class="o">=</span> <span class="n">mmap</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">comm</span>	    <span class="o">=</span> <span class="n">comm</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">freq</span>	    <span class="o">=</span> <span class="n">freq</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">inherit_stat</span>   <span class="o">=</span> <span class="n">inherit_stat</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">enable_on_exec</span> <span class="o">=</span> <span class="n">enable_on_exec</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">task</span>	    <span class="o">=</span> <span class="n">task</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">watermark</span>	    <span class="o">=</span> <span class="n">watermark</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">precise_ip</span>	    <span class="o">=</span> <span class="n">precise_ip</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">mmap_data</span>	    <span class="o">=</span> <span class="n">mmap_data</span><span class="p">;</span>
	<span class="n">attr</span><span class="p">.</span><span class="n">sample_id_all</span>  <span class="o">=</span> <span class="n">sample_id_all</span><span class="p">;</span>

	<span class="n">perf_evsel__init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pevsel</span><span class="o">-&gt;</span><span class="n">evsel</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">attr</span><span class="p">,</span> <span class="n">idx</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">pyrf_evsel__delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evsel</span> <span class="o">*</span><span class="n">pevsel</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">perf_evsel__exit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pevsel</span><span class="o">-&gt;</span><span class="n">evsel</span><span class="p">);</span>
	<span class="n">pevsel</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_free</span><span class="p">((</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="n">pevsel</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_evsel__open</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evsel</span> <span class="o">*</span><span class="n">pevsel</span><span class="p">,</span>
				  <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_evsel</span> <span class="o">*</span><span class="n">evsel</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pevsel</span><span class="o">-&gt;</span><span class="n">evsel</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cpu_map</span> <span class="o">*</span><span class="n">cpus</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">thread_map</span> <span class="o">*</span><span class="n">threads</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="n">PyObject</span> <span class="o">*</span><span class="n">pcpus</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">pthreads</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">group</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inherit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kwlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;cpus&quot;</span><span class="p">,</span> <span class="s">&quot;threads&quot;</span><span class="p">,</span> <span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="s">&quot;inherit&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s">&quot;|OOii&quot;</span><span class="p">,</span> <span class="n">kwlist</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">pcpus</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pthreads</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">group</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">inherit</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pthreads</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">threads</span> <span class="o">=</span> <span class="p">((</span><span class="k">struct</span> <span class="n">pyrf_thread_map</span> <span class="o">*</span><span class="p">)</span><span class="n">pthreads</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">threads</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">pcpus</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="n">cpus</span> <span class="o">=</span> <span class="p">((</span><span class="k">struct</span> <span class="n">pyrf_cpu_map</span> <span class="o">*</span><span class="p">)</span><span class="n">pcpus</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">cpus</span><span class="p">;</span>

	<span class="n">evsel</span><span class="o">-&gt;</span><span class="n">attr</span><span class="p">.</span><span class="n">inherit</span> <span class="o">=</span> <span class="n">inherit</span><span class="p">;</span>
	<span class="cm">/*</span>
<span class="cm">	 * This will group just the fds for this single evsel, to group</span>
<span class="cm">	 * multiple events, use evlist.open().</span>
<span class="cm">	 */</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">perf_evsel__open</span><span class="p">(</span><span class="n">evsel</span><span class="p">,</span> <span class="n">cpus</span><span class="p">,</span> <span class="n">threads</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PyErr_SetFromErrno</span><span class="p">(</span><span class="n">PyExc_OSError</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="n">Py_None</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Py_None</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyMethodDef</span> <span class="n">pyrf_evsel__methods</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">ml_name</span>  <span class="o">=</span> <span class="s">&quot;open&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_meth</span>  <span class="o">=</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span><span class="n">pyrf_evsel__open</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_flags</span> <span class="o">=</span> <span class="n">METH_VARARGS</span> <span class="o">|</span> <span class="n">METH_KEYWORDS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_doc</span>	  <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;open the event selector file descriptor table.&quot;</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">ml_name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_evsel__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf event selector list object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_evsel__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.evsel&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evsel</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_dealloc</span>	<span class="o">=</span> <span class="p">(</span><span class="n">destructor</span><span class="p">)</span><span class="n">pyrf_evsel__delete</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_evsel__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_methods</span>	<span class="o">=</span> <span class="n">pyrf_evsel__methods</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_init</span>	<span class="o">=</span> <span class="p">(</span><span class="n">initproc</span><span class="p">)</span><span class="n">pyrf_evsel__init</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_evsel__setup_types</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pyrf_evsel__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span> <span class="n">PyType_GenericNew</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_evsel__type</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="p">{</span>
	<span class="n">PyObject_HEAD</span>

	<span class="k">struct</span> <span class="n">perf_evlist</span> <span class="n">evlist</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_evlist__init</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span><span class="p">,</span>
			     <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span> <span class="n">__used</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PyObject</span> <span class="o">*</span><span class="n">pcpus</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="o">*</span><span class="n">pthreads</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">cpu_map</span> <span class="o">*</span><span class="n">cpus</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">thread_map</span> <span class="o">*</span><span class="n">threads</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTuple</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;OO&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pcpus</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pthreads</span><span class="p">))</span>
		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

	<span class="n">threads</span> <span class="o">=</span> <span class="p">((</span><span class="k">struct</span> <span class="n">pyrf_thread_map</span> <span class="o">*</span><span class="p">)</span><span class="n">pthreads</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">threads</span><span class="p">;</span>
	<span class="n">cpus</span> <span class="o">=</span> <span class="p">((</span><span class="k">struct</span> <span class="n">pyrf_cpu_map</span> <span class="o">*</span><span class="p">)</span><span class="n">pcpus</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">cpus</span><span class="p">;</span>
	<span class="n">perf_evlist__init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">,</span> <span class="n">cpus</span><span class="p">,</span> <span class="n">threads</span><span class="p">);</span>
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">pyrf_evlist__delete</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">perf_evlist__exit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">);</span>
	<span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">ob_type</span><span class="o">-&gt;</span><span class="n">tp_free</span><span class="p">((</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="n">pevlist</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_evlist__mmap</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span><span class="p">,</span>
				   <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_evlist</span> <span class="o">*</span><span class="n">evlist</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kwlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;pages&quot;</span><span class="p">,</span> <span class="s">&quot;overwrite&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
	<span class="kt">int</span> <span class="n">pages</span> <span class="o">=</span> <span class="mi">128</span><span class="p">,</span> <span class="n">overwrite</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s">&quot;|ii&quot;</span><span class="p">,</span> <span class="n">kwlist</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">pages</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">overwrite</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">perf_evlist__mmap</span><span class="p">(</span><span class="n">evlist</span><span class="p">,</span> <span class="n">pages</span><span class="p">,</span> <span class="n">overwrite</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PyErr_SetFromErrno</span><span class="p">(</span><span class="n">PyExc_OSError</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="n">Py_None</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Py_None</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_evlist__poll</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span><span class="p">,</span>
				   <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_evlist</span> <span class="o">*</span><span class="n">evlist</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kwlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;timeout&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
	<span class="kt">int</span> <span class="n">timeout</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s">&quot;|i&quot;</span><span class="p">,</span> <span class="n">kwlist</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">timeout</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">n</span> <span class="o">=</span> <span class="n">poll</span><span class="p">(</span><span class="n">evlist</span><span class="o">-&gt;</span><span class="n">pollfd</span><span class="p">,</span> <span class="n">evlist</span><span class="o">-&gt;</span><span class="n">nr_fds</span><span class="p">,</span> <span class="n">timeout</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PyErr_SetFromErrno</span><span class="p">(</span><span class="n">PyExc_OSError</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">Py_BuildValue</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_evlist__get_pollfd</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span><span class="p">,</span>
					 <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span> <span class="n">__used</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span> <span class="n">__used</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_evlist</span> <span class="o">*</span><span class="n">evlist</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">;</span>
        <span class="n">PyObject</span> <span class="o">*</span><span class="n">list</span> <span class="o">=</span> <span class="n">PyList_New</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">evlist</span><span class="o">-&gt;</span><span class="n">nr_fds</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PyObject</span> <span class="o">*</span><span class="n">file</span><span class="p">;</span>
		<span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fdopen</span><span class="p">(</span><span class="n">evlist</span><span class="o">-&gt;</span><span class="n">pollfd</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">fd</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">free_list</span><span class="p">;</span>

		<span class="n">file</span> <span class="o">=</span> <span class="n">PyFile_FromFile</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="s">&quot;perf&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">file</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">free_list</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">PyList_Append</span><span class="p">(</span><span class="n">list</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
			<span class="n">Py_DECREF</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
			<span class="k">goto</span> <span class="n">free_list</span><span class="p">;</span>
		<span class="p">}</span>
			
		<span class="n">Py_DECREF</span><span class="p">(</span><span class="n">file</span><span class="p">);</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="n">list</span><span class="p">;</span>
<span class="nl">free_list:</span>
	<span class="k">return</span> <span class="n">PyErr_NoMemory</span><span class="p">();</span>
<span class="p">}</span>


<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_evlist__add</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span><span class="p">,</span>
				  <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span> <span class="n">__used</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_evlist</span> <span class="o">*</span><span class="n">evlist</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">;</span>
	<span class="n">PyObject</span> <span class="o">*</span><span class="n">pevsel</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">perf_evsel</span> <span class="o">*</span><span class="n">evsel</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTuple</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="s">&quot;O&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pevsel</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="n">pevsel</span><span class="p">);</span>
	<span class="n">evsel</span> <span class="o">=</span> <span class="o">&amp;</span><span class="p">((</span><span class="k">struct</span> <span class="n">pyrf_evsel</span> <span class="o">*</span><span class="p">)</span><span class="n">pevsel</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">evsel</span><span class="p">;</span>
	<span class="n">evsel</span><span class="o">-&gt;</span><span class="n">idx</span> <span class="o">=</span> <span class="n">evlist</span><span class="o">-&gt;</span><span class="n">nr_entries</span><span class="p">;</span>
	<span class="n">perf_evlist__add</span><span class="p">(</span><span class="n">evlist</span><span class="p">,</span> <span class="n">evsel</span><span class="p">);</span>

	<span class="k">return</span> <span class="n">Py_BuildValue</span><span class="p">(</span><span class="s">&quot;i&quot;</span><span class="p">,</span> <span class="n">evlist</span><span class="o">-&gt;</span><span class="n">nr_entries</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_evlist__read_on_cpu</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span><span class="p">,</span>
					  <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_evlist</span> <span class="o">*</span><span class="n">evlist</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">;</span>
	<span class="k">union</span> <span class="n">perf_event</span> <span class="o">*</span><span class="n">event</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">sample_id_all</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">cpu</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kwlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;cpu&quot;</span><span class="p">,</span> <span class="s">&quot;sample_id_all&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>
	<span class="kt">int</span> <span class="n">err</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s">&quot;i|i&quot;</span><span class="p">,</span> <span class="n">kwlist</span><span class="p">,</span>
					 <span class="o">&amp;</span><span class="n">cpu</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">sample_id_all</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">event</span> <span class="o">=</span> <span class="n">perf_evlist__mmap_read</span><span class="p">(</span><span class="n">evlist</span><span class="p">,</span> <span class="n">cpu</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">event</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
		<span class="k">struct</span> <span class="n">perf_evsel</span> <span class="o">*</span><span class="n">first</span><span class="p">;</span>
		<span class="n">PyObject</span> <span class="o">*</span><span class="n">pyevent</span> <span class="o">=</span> <span class="n">pyrf_event__new</span><span class="p">(</span><span class="n">event</span><span class="p">);</span>
		<span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="n">pevent</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_event</span> <span class="o">*</span><span class="p">)</span><span class="n">pyevent</span><span class="p">;</span>

		<span class="k">if</span> <span class="p">(</span><span class="n">pyevent</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">PyErr_NoMemory</span><span class="p">();</span>

		<span class="n">first</span> <span class="o">=</span> <span class="n">list_entry</span><span class="p">(</span><span class="n">evlist</span><span class="o">-&gt;</span><span class="n">entries</span><span class="p">.</span><span class="n">next</span><span class="p">,</span> <span class="k">struct</span> <span class="n">perf_evsel</span><span class="p">,</span> <span class="n">node</span><span class="p">);</span>
		<span class="n">err</span> <span class="o">=</span> <span class="n">perf_event__parse_sample</span><span class="p">(</span><span class="n">event</span><span class="p">,</span> <span class="n">first</span><span class="o">-&gt;</span><span class="n">attr</span><span class="p">.</span><span class="n">sample_type</span><span class="p">,</span>
					       <span class="n">perf_evsel__sample_size</span><span class="p">(</span><span class="n">first</span><span class="p">),</span>
					       <span class="n">sample_id_all</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pevent</span><span class="o">-&gt;</span><span class="n">sample</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">PyErr_Format</span><span class="p">(</span><span class="n">PyExc_OSError</span><span class="p">,</span>
					    <span class="s">&quot;perf: can&#39;t parse sample, err=%d&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">);</span>
		<span class="k">return</span> <span class="n">pyevent</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="n">Py_None</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Py_None</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_evlist__open</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span><span class="p">,</span>
				   <span class="n">PyObject</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">PyObject</span> <span class="o">*</span><span class="n">kwargs</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">perf_evlist</span> <span class="o">*</span><span class="n">evlist</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">group</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">static</span> <span class="kt">char</span> <span class="o">*</span><span class="n">kwlist</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span> <span class="s">&quot;group&quot;</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">};</span>

	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">PyArg_ParseTupleAndKeywords</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">,</span> <span class="s">&quot;|OOii&quot;</span><span class="p">,</span> <span class="n">kwlist</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">group</span><span class="p">))</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">perf_evlist__open</span><span class="p">(</span><span class="n">evlist</span><span class="p">,</span> <span class="n">group</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">PyErr_SetFromErrno</span><span class="p">(</span><span class="n">PyExc_OSError</span><span class="p">);</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="n">Py_None</span><span class="p">);</span>
	<span class="k">return</span> <span class="n">Py_None</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyMethodDef</span> <span class="n">pyrf_evlist__methods</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">ml_name</span>  <span class="o">=</span> <span class="s">&quot;mmap&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_meth</span>  <span class="o">=</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span><span class="n">pyrf_evlist__mmap</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_flags</span> <span class="o">=</span> <span class="n">METH_VARARGS</span> <span class="o">|</span> <span class="n">METH_KEYWORDS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_doc</span>	  <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;mmap the file descriptor table.&quot;</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">ml_name</span>  <span class="o">=</span> <span class="s">&quot;open&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_meth</span>  <span class="o">=</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span><span class="n">pyrf_evlist__open</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_flags</span> <span class="o">=</span> <span class="n">METH_VARARGS</span> <span class="o">|</span> <span class="n">METH_KEYWORDS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_doc</span>	  <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;open the file descriptors.&quot;</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">ml_name</span>  <span class="o">=</span> <span class="s">&quot;poll&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_meth</span>  <span class="o">=</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span><span class="n">pyrf_evlist__poll</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_flags</span> <span class="o">=</span> <span class="n">METH_VARARGS</span> <span class="o">|</span> <span class="n">METH_KEYWORDS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_doc</span>	  <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;poll the file descriptor table.&quot;</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">ml_name</span>  <span class="o">=</span> <span class="s">&quot;get_pollfd&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_meth</span>  <span class="o">=</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span><span class="n">pyrf_evlist__get_pollfd</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_flags</span> <span class="o">=</span> <span class="n">METH_VARARGS</span> <span class="o">|</span> <span class="n">METH_KEYWORDS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_doc</span>	  <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;get the poll file descriptor table.&quot;</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">ml_name</span>  <span class="o">=</span> <span class="s">&quot;add&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_meth</span>  <span class="o">=</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span><span class="n">pyrf_evlist__add</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_flags</span> <span class="o">=</span> <span class="n">METH_VARARGS</span> <span class="o">|</span> <span class="n">METH_KEYWORDS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_doc</span>	  <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;adds an event selector to the list.&quot;</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="p">{</span>
		<span class="p">.</span><span class="n">ml_name</span>  <span class="o">=</span> <span class="s">&quot;read_on_cpu&quot;</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_meth</span>  <span class="o">=</span> <span class="p">(</span><span class="n">PyCFunction</span><span class="p">)</span><span class="n">pyrf_evlist__read_on_cpu</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_flags</span> <span class="o">=</span> <span class="n">METH_VARARGS</span> <span class="o">|</span> <span class="n">METH_KEYWORDS</span><span class="p">,</span>
		<span class="p">.</span><span class="n">ml_doc</span>	  <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;reads an event.&quot;</span><span class="p">)</span>
	<span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">ml_name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">}</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">Py_ssize_t</span> <span class="nf">pyrf_evlist__length</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">.</span><span class="n">nr_entries</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PyObject</span> <span class="o">*</span><span class="nf">pyrf_evlist__item</span><span class="p">(</span><span class="n">PyObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">Py_ssize_t</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">struct</span> <span class="n">pyrf_evlist</span> <span class="o">*</span><span class="n">pevlist</span> <span class="o">=</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>
	<span class="k">struct</span> <span class="n">perf_evsel</span> <span class="o">*</span><span class="n">pos</span><span class="p">;</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">.</span><span class="n">nr_entries</span><span class="p">)</span>
		<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>

	<span class="n">list_for_each_entry</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">pevlist</span><span class="o">-&gt;</span><span class="n">evlist</span><span class="p">.</span><span class="n">entries</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">--</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">Py_BuildValue</span><span class="p">(</span><span class="s">&quot;O&quot;</span><span class="p">,</span> <span class="n">container_of</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="k">struct</span> <span class="n">pyrf_evsel</span><span class="p">,</span> <span class="n">evsel</span><span class="p">));</span>
<span class="p">}</span>

<span class="k">static</span> <span class="n">PySequenceMethods</span> <span class="n">pyrf_evlist__sequence_methods</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">.</span><span class="n">sq_length</span> <span class="o">=</span> <span class="n">pyrf_evlist__length</span><span class="p">,</span>
	<span class="p">.</span><span class="n">sq_item</span>   <span class="o">=</span> <span class="n">pyrf_evlist__item</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">char</span> <span class="n">pyrf_evlist__doc</span><span class="p">[]</span> <span class="o">=</span> <span class="n">PyDoc_STR</span><span class="p">(</span><span class="s">&quot;perf event selector list object.&quot;</span><span class="p">);</span>

<span class="k">static</span> <span class="n">PyTypeObject</span> <span class="n">pyrf_evlist__type</span> <span class="o">=</span> <span class="p">{</span>
	<span class="n">PyVarObject_HEAD_INIT</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
	<span class="p">.</span><span class="n">tp_name</span>	<span class="o">=</span> <span class="s">&quot;perf.evlist&quot;</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_basicsize</span>	<span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">pyrf_evlist</span><span class="p">),</span>
	<span class="p">.</span><span class="n">tp_dealloc</span>	<span class="o">=</span> <span class="p">(</span><span class="n">destructor</span><span class="p">)</span><span class="n">pyrf_evlist__delete</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_flags</span>	<span class="o">=</span> <span class="n">Py_TPFLAGS_DEFAULT</span><span class="o">|</span><span class="n">Py_TPFLAGS_BASETYPE</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_as_sequence</span>	<span class="o">=</span> <span class="o">&amp;</span><span class="n">pyrf_evlist__sequence_methods</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_doc</span>		<span class="o">=</span> <span class="n">pyrf_evlist__doc</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_methods</span>	<span class="o">=</span> <span class="n">pyrf_evlist__methods</span><span class="p">,</span>
	<span class="p">.</span><span class="n">tp_init</span>	<span class="o">=</span> <span class="p">(</span><span class="n">initproc</span><span class="p">)</span><span class="n">pyrf_evlist__init</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">pyrf_evlist__setup_types</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">pyrf_evlist__type</span><span class="p">.</span><span class="n">tp_new</span> <span class="o">=</span> <span class="n">PyType_GenericNew</span><span class="p">;</span>
	<span class="k">return</span> <span class="n">PyType_Ready</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_evlist__type</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">struct</span> <span class="p">{</span>
	<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
	<span class="kt">int</span>	    <span class="n">value</span><span class="p">;</span>
<span class="p">}</span> <span class="n">perf__constants</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="s">&quot;TYPE_HARDWARE&quot;</span><span class="p">,</span>   <span class="n">PERF_TYPE_HARDWARE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TYPE_SOFTWARE&quot;</span><span class="p">,</span>   <span class="n">PERF_TYPE_SOFTWARE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TYPE_TRACEPOINT&quot;</span><span class="p">,</span> <span class="n">PERF_TYPE_TRACEPOINT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TYPE_HW_CACHE&quot;</span><span class="p">,</span>   <span class="n">PERF_TYPE_HW_CACHE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TYPE_RAW&quot;</span><span class="p">,</span>	     <span class="n">PERF_TYPE_RAW</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;TYPE_BREAKPOINT&quot;</span><span class="p">,</span> <span class="n">PERF_TYPE_BREAKPOINT</span> <span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CPU_CYCLES&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_CPU_CYCLES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_INSTRUCTIONS&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_INSTRUCTIONS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_REFERENCES&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_CACHE_REFERENCES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_MISSES&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_CACHE_MISSES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_BRANCH_INSTRUCTIONS&quot;</span><span class="p">,</span> <span class="n">PERF_COUNT_HW_BRANCH_INSTRUCTIONS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_BRANCH_MISSES&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_BRANCH_MISSES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_BUS_CYCLES&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_BUS_CYCLES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_L1D&quot;</span><span class="p">,</span>		  <span class="n">PERF_COUNT_HW_CACHE_L1D</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_L1I&quot;</span><span class="p">,</span>		  <span class="n">PERF_COUNT_HW_CACHE_L1I</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_LL&quot;</span><span class="p">,</span>	  	  <span class="n">PERF_COUNT_HW_CACHE_LL</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_DTLB&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_CACHE_DTLB</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_ITLB&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_CACHE_ITLB</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_BPU&quot;</span><span class="p">,</span>		  <span class="n">PERF_COUNT_HW_CACHE_BPU</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_OP_READ&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_CACHE_OP_READ</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_OP_WRITE&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_CACHE_OP_WRITE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_OP_PREFETCH&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_CACHE_OP_PREFETCH</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_RESULT_ACCESS&quot;</span><span class="p">,</span> <span class="n">PERF_COUNT_HW_CACHE_RESULT_ACCESS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_CACHE_RESULT_MISS&quot;</span><span class="p">,</span>   <span class="n">PERF_COUNT_HW_CACHE_RESULT_MISS</span> <span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;COUNT_HW_STALLED_CYCLES_FRONTEND&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_STALLED_CYCLES_FRONTEND</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_HW_STALLED_CYCLES_BACKEND&quot;</span><span class="p">,</span>	  <span class="n">PERF_COUNT_HW_STALLED_CYCLES_BACKEND</span> <span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;COUNT_SW_CPU_CLOCK&quot;</span><span class="p">,</span>	       <span class="n">PERF_COUNT_SW_CPU_CLOCK</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_SW_TASK_CLOCK&quot;</span><span class="p">,</span>       <span class="n">PERF_COUNT_SW_TASK_CLOCK</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_SW_PAGE_FAULTS&quot;</span><span class="p">,</span>      <span class="n">PERF_COUNT_SW_PAGE_FAULTS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_SW_CONTEXT_SWITCHES&quot;</span><span class="p">,</span> <span class="n">PERF_COUNT_SW_CONTEXT_SWITCHES</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_SW_CPU_MIGRATIONS&quot;</span><span class="p">,</span>   <span class="n">PERF_COUNT_SW_CPU_MIGRATIONS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_SW_PAGE_FAULTS_MIN&quot;</span><span class="p">,</span>  <span class="n">PERF_COUNT_SW_PAGE_FAULTS_MIN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_SW_PAGE_FAULTS_MAJ&quot;</span><span class="p">,</span>  <span class="n">PERF_COUNT_SW_PAGE_FAULTS_MAJ</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_SW_ALIGNMENT_FAULTS&quot;</span><span class="p">,</span> <span class="n">PERF_COUNT_SW_ALIGNMENT_FAULTS</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;COUNT_SW_EMULATION_FAULTS&quot;</span><span class="p">,</span> <span class="n">PERF_COUNT_SW_EMULATION_FAULTS</span> <span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;SAMPLE_IP&quot;</span><span class="p">,</span>	      <span class="n">PERF_SAMPLE_IP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_TID&quot;</span><span class="p">,</span>	      <span class="n">PERF_SAMPLE_TID</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_TIME&quot;</span><span class="p">,</span>      <span class="n">PERF_SAMPLE_TIME</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_ADDR&quot;</span><span class="p">,</span>      <span class="n">PERF_SAMPLE_ADDR</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_READ&quot;</span><span class="p">,</span>      <span class="n">PERF_SAMPLE_READ</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_CALLCHAIN&quot;</span><span class="p">,</span> <span class="n">PERF_SAMPLE_CALLCHAIN</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_ID&quot;</span><span class="p">,</span>	      <span class="n">PERF_SAMPLE_ID</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_CPU&quot;</span><span class="p">,</span>	      <span class="n">PERF_SAMPLE_CPU</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_PERIOD&quot;</span><span class="p">,</span>    <span class="n">PERF_SAMPLE_PERIOD</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_STREAM_ID&quot;</span><span class="p">,</span> <span class="n">PERF_SAMPLE_STREAM_ID</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;SAMPLE_RAW&quot;</span><span class="p">,</span>	      <span class="n">PERF_SAMPLE_RAW</span> <span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;FORMAT_TOTAL_TIME_ENABLED&quot;</span><span class="p">,</span> <span class="n">PERF_FORMAT_TOTAL_TIME_ENABLED</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;FORMAT_TOTAL_TIME_RUNNING&quot;</span><span class="p">,</span> <span class="n">PERF_FORMAT_TOTAL_TIME_RUNNING</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;FORMAT_ID&quot;</span><span class="p">,</span>		       <span class="n">PERF_FORMAT_ID</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;FORMAT_GROUP&quot;</span><span class="p">,</span>	       <span class="n">PERF_FORMAT_GROUP</span> <span class="p">},</span>

	<span class="p">{</span> <span class="s">&quot;RECORD_MMAP&quot;</span><span class="p">,</span>       <span class="n">PERF_RECORD_MMAP</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RECORD_LOST&quot;</span><span class="p">,</span>       <span class="n">PERF_RECORD_LOST</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RECORD_COMM&quot;</span><span class="p">,</span>       <span class="n">PERF_RECORD_COMM</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RECORD_EXIT&quot;</span><span class="p">,</span>       <span class="n">PERF_RECORD_EXIT</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RECORD_THROTTLE&quot;</span><span class="p">,</span>   <span class="n">PERF_RECORD_THROTTLE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RECORD_UNTHROTTLE&quot;</span><span class="p">,</span> <span class="n">PERF_RECORD_UNTHROTTLE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RECORD_FORK&quot;</span><span class="p">,</span>       <span class="n">PERF_RECORD_FORK</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RECORD_READ&quot;</span><span class="p">,</span>       <span class="n">PERF_RECORD_READ</span> <span class="p">},</span>
	<span class="p">{</span> <span class="s">&quot;RECORD_SAMPLE&quot;</span><span class="p">,</span>     <span class="n">PERF_RECORD_SAMPLE</span> <span class="p">},</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">},</span>
<span class="p">};</span>

<span class="k">static</span> <span class="n">PyMethodDef</span> <span class="n">perf__methods</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="p">.</span><span class="n">ml_name</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">,</span> <span class="p">}</span>
<span class="p">};</span>

<span class="n">PyMODINIT_FUNC</span> <span class="nf">initperf</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
	<span class="n">PyObject</span> <span class="o">*</span><span class="n">obj</span><span class="p">;</span>
	<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
	<span class="n">PyObject</span> <span class="o">*</span><span class="n">dict</span><span class="p">,</span> <span class="o">*</span><span class="n">module</span> <span class="o">=</span> <span class="n">Py_InitModule</span><span class="p">(</span><span class="s">&quot;perf&quot;</span><span class="p">,</span> <span class="n">perf__methods</span><span class="p">);</span>

	<span class="k">if</span> <span class="p">(</span><span class="n">module</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span>
	    <span class="n">pyrf_event__setup_types</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span>
	    <span class="n">pyrf_evlist__setup_types</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span>
	    <span class="n">pyrf_evsel__setup_types</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span>
	    <span class="n">pyrf_thread_map__setup_types</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span>
	    <span class="n">pyrf_cpu_map__setup_types</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
		<span class="k">return</span><span class="p">;</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_evlist__type</span><span class="p">);</span>
	<span class="n">PyModule_AddObject</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&quot;evlist&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pyrf_evlist__type</span><span class="p">);</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_evsel__type</span><span class="p">);</span>
	<span class="n">PyModule_AddObject</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&quot;evsel&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pyrf_evsel__type</span><span class="p">);</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_thread_map__type</span><span class="p">);</span>
	<span class="n">PyModule_AddObject</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&quot;thread_map&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pyrf_thread_map__type</span><span class="p">);</span>

	<span class="n">Py_INCREF</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pyrf_cpu_map__type</span><span class="p">);</span>
	<span class="n">PyModule_AddObject</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="s">&quot;cpu_map&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">PyObject</span><span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">pyrf_cpu_map__type</span><span class="p">);</span>

	<span class="n">dict</span> <span class="o">=</span> <span class="n">PyModule_GetDict</span><span class="p">(</span><span class="n">module</span><span class="p">);</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">dict</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
		<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>

	<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">perf__constants</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
		<span class="n">obj</span> <span class="o">=</span> <span class="n">PyInt_FromLong</span><span class="p">(</span><span class="n">perf__constants</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">value</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
			<span class="k">goto</span> <span class="n">error</span><span class="p">;</span>
		<span class="n">PyDict_SetItemString</span><span class="p">(</span><span class="n">dict</span><span class="p">,</span> <span class="n">perf__constants</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">name</span><span class="p">,</span> <span class="n">obj</span><span class="p">);</span>
		<span class="n">Py_DECREF</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
	<span class="p">}</span>

<span class="nl">error:</span>
	<span class="k">if</span> <span class="p">(</span><span class="n">PyErr_Occurred</span><span class="p">())</span>
		<span class="n">PyErr_SetString</span><span class="p">(</span><span class="n">PyExc_ImportError</span><span class="p">,</span> <span class="s">&quot;perf: Init failed!&quot;</span><span class="p">);</span>
<span class="p">}</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:3}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../javascript/docco.min.js"></script>
</html>
