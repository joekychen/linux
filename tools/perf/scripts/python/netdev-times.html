<!DOCTYPE html>
<html><head><title>joekychen/linux » tools › perf › scripts › python › netdev-times.py

</title>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="generator" content="Docco">
<link rel="stylesheet" media="all" href="../../../../stylesheets/docco.min.css" />


</head>
<body>
<div id="container">
<div id="background"></div>
<table cellpadding="0" cellspacing="0">
<thead><tr><th class="docs"><a id="home" href="../../../../index.html"></a><h1>netdev-times.py</h1></th><th class="code"></th></tr></thead>
<tbody>


<tr id="section-1"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-1">&#182;</a></div><p>Display a process of packets and processed time.
It helps us to investigate networking or network device.</p>

<p>options
tx: show only tx chart
rx: show only rx chart
dev=: show only thing related to specified device
debug: work with debug mode. It shows buffer status.</p></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&#39;PERF_EXEC_PATH&#39;</span><span class="p">]</span> <span class="o">+</span> \
	<span class="s">&#39;/scripts/python/Perf-Trace-Util/lib/Perf/Trace&#39;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">perf_trace_context</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Core</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">Util</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">all_event_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="c"># insert all tracepoint event related with this script</span>
<span class="n">irq_dic</span> <span class="o">=</span> <span class="p">{};</span> <span class="c"># key is cpu and value is a list which stacks irqs</span></pre></div></td></tr>


<tr id="section-2"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-2">&#182;</a></div><p>which raise NET_RX softirq</p></td><td class="code"><div class="highlight"><pre><span class="n">net_rx_dic</span> <span class="o">=</span> <span class="p">{};</span> <span class="c"># key is cpu and value include time of NET_RX softirq-entry</span></pre></div></td></tr>


<tr id="section-3"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-3">&#182;</a></div><p>and a list which stacks receive</p></td><td class="code"><div class="highlight"><pre><span class="n">receive_hunk_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="c"># a list which include a sequence of receive events</span>
<span class="n">rx_skb_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="c"># received packet list for matching</span></pre></div></td></tr>


<tr id="section-4"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-4">&#182;</a></div><p>skb<em>copy</em>datagram_iovec</p></td><td class="code"><div class="highlight"><pre><span class="n">buffer_budget</span> <span class="o">=</span> <span class="mi">65536</span><span class="p">;</span> <span class="c"># the budget of rx_skb_list, tx_queue_list and</span></pre></div></td></tr>


<tr id="section-5"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-5">&#182;</a></div><p>tx<em>xmit</em>list</p></td><td class="code"><div class="highlight"><pre><span class="n">of_count_rx_skb_list</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c"># overflow count</span>

<span class="n">tx_queue_list</span> <span class="o">=</span> <span class="p">[];</span> <span class="c"># list of packets which pass through dev_queue_xmit</span>
<span class="n">of_count_tx_queue_list</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c"># overflow count</span>

<span class="n">tx_xmit_list</span> <span class="o">=</span> <span class="p">[];</span>  <span class="c"># list of packets which pass through dev_hard_start_xmit</span>
<span class="n">of_count_tx_xmit_list</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c"># overflow count</span>

<span class="n">tx_free_list</span> <span class="o">=</span> <span class="p">[];</span>  <span class="c"># list of packets which is freed</span></pre></div></td></tr>


<tr id="section-6"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-6">&#182;</a></div><p>options</p></td><td class="code"><div class="highlight"><pre><span class="n">show_tx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">show_rx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">dev</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c"># store a name of device specified by option &quot;dev=&quot;</span>
<span class="n">debug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div></td></tr>


<tr id="section-7"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-7">&#182;</a></div><p>indices of event_info tuple</p></td><td class="code"><div class="highlight"><pre><span class="n">EINFO_IDX_NAME</span><span class="o">=</span>   <span class="mi">0</span>
<span class="n">EINFO_IDX_CONTEXT</span><span class="o">=</span><span class="mi">1</span>
<span class="n">EINFO_IDX_CPU</span><span class="o">=</span>    <span class="mi">2</span>
<span class="n">EINFO_IDX_TIME</span><span class="o">=</span>   <span class="mi">3</span>
<span class="n">EINFO_IDX_PID</span><span class="o">=</span>    <span class="mi">4</span>
<span class="n">EINFO_IDX_COMM</span><span class="o">=</span>   <span class="mi">5</span></pre></div></td></tr>


<tr id="section-8"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-8">&#182;</a></div><p>Calculate a time interval(msec) from src(nsec) to dst(nsec)</p></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">diff_msec</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">dst</span> <span class="o">-</span> <span class="n">src</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1000000.0</span></pre></div></td></tr>


<tr id="section-9"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-9">&#182;</a></div><p>Display a process of transmitting a packet</p></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_transmit</span><span class="p">(</span><span class="n">hunk</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">dev</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">hunk</span><span class="p">[</span><span class="s">&#39;dev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="k">print</span> <span class="s">&quot;</span><span class="si">%7s</span><span class="s"> </span><span class="si">%5d</span><span class="s"> </span><span class="si">%6d</span><span class="s">.</span><span class="si">%06d</span><span class="s">sec </span><span class="si">%12.3f</span><span class="s">msec      </span><span class="si">%12.3f</span><span class="s">msec&quot;</span> <span class="o">%</span> \
		<span class="p">(</span><span class="n">hunk</span><span class="p">[</span><span class="s">&#39;dev&#39;</span><span class="p">],</span> <span class="n">hunk</span><span class="p">[</span><span class="s">&#39;len&#39;</span><span class="p">],</span>
		<span class="n">nsecs_secs</span><span class="p">(</span><span class="n">hunk</span><span class="p">[</span><span class="s">&#39;queue_t&#39;</span><span class="p">]),</span>
		<span class="n">nsecs_nsecs</span><span class="p">(</span><span class="n">hunk</span><span class="p">[</span><span class="s">&#39;queue_t&#39;</span><span class="p">])</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span>
		<span class="n">diff_msec</span><span class="p">(</span><span class="n">hunk</span><span class="p">[</span><span class="s">&#39;queue_t&#39;</span><span class="p">],</span> <span class="n">hunk</span><span class="p">[</span><span class="s">&#39;xmit_t&#39;</span><span class="p">]),</span>
		<span class="n">diff_msec</span><span class="p">(</span><span class="n">hunk</span><span class="p">[</span><span class="s">&#39;xmit_t&#39;</span><span class="p">],</span> <span class="n">hunk</span><span class="p">[</span><span class="s">&#39;free_t&#39;</span><span class="p">]))</span></pre></div></td></tr>


<tr id="section-10"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-10">&#182;</a></div><p>Format for displaying rx packet processing</p></td><td class="code"><div class="highlight"><pre><span class="n">PF_IRQ_ENTRY</span><span class="o">=</span> <span class="s">&quot;  irq_entry(+</span><span class="si">%.3f</span><span class="s">msec irq=</span><span class="si">%d</span><span class="s">:</span><span class="si">%s</span><span class="s">)&quot;</span>
<span class="n">PF_SOFT_ENTRY</span><span class="o">=</span><span class="s">&quot;  softirq_entry(+</span><span class="si">%.3f</span><span class="s">msec)&quot;</span>
<span class="n">PF_NAPI_POLL</span><span class="o">=</span> <span class="s">&quot;  napi_poll_exit(+</span><span class="si">%.3f</span><span class="s">msec </span><span class="si">%s</span><span class="s">)&quot;</span>
<span class="n">PF_JOINT</span><span class="o">=</span>     <span class="s">&quot;         |&quot;</span>
<span class="n">PF_WJOINT</span><span class="o">=</span>    <span class="s">&quot;         |            |&quot;</span>
<span class="n">PF_NET_RECV</span><span class="o">=</span>  <span class="s">&quot;         |---netif_receive_skb(+</span><span class="si">%.3f</span><span class="s">msec skb=</span><span class="si">%x</span><span class="s"> len=</span><span class="si">%d</span><span class="s">)&quot;</span>
<span class="n">PF_NET_RX</span><span class="o">=</span>    <span class="s">&quot;         |---netif_rx(+</span><span class="si">%.3f</span><span class="s">msec skb=</span><span class="si">%x</span><span class="s">)&quot;</span>
<span class="n">PF_CPY_DGRAM</span><span class="o">=</span> <span class="s">&quot;         |      skb_copy_datagram_iovec(+</span><span class="si">%.3f</span><span class="s">msec </span><span class="si">%d</span><span class="s">:</span><span class="si">%s</span><span class="s">)&quot;</span>
<span class="n">PF_KFREE_SKB</span><span class="o">=</span> <span class="s">&quot;         |      kfree_skb(+</span><span class="si">%.3f</span><span class="s">msec location=</span><span class="si">%x</span><span class="s">)&quot;</span>
<span class="n">PF_CONS_SKB</span><span class="o">=</span>  <span class="s">&quot;         |      consume_skb(+</span><span class="si">%.3f</span><span class="s">msec)&quot;</span></pre></div></td></tr>


<tr id="section-11"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-11">&#182;</a></div><p>Display a process of received packets and interrputs associated with
a NET_RX softirq</p></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">print_receive</span><span class="p">(</span><span class="n">hunk</span><span class="p">):</span>
	<span class="n">show_hunk</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">irq_list</span> <span class="o">=</span> <span class="n">hunk</span><span class="p">[</span><span class="s">&#39;irq_list&#39;</span><span class="p">]</span>
	<span class="n">cpu</span> <span class="o">=</span> <span class="n">irq_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;cpu&#39;</span><span class="p">]</span>
	<span class="n">base_t</span> <span class="o">=</span> <span class="n">irq_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;irq_ent_t&#39;</span><span class="p">]</span></pre></div></td></tr>


<tr id="section-12"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-12">&#182;</a></div><p>check if this hunk should be showed</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="n">dev</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irq_list</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">irq_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="n">show_hunk</span> <span class="o">=</span> <span class="mi">1</span>
				<span class="k">break</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">show_hunk</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">show_hunk</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span>

	<span class="k">print</span> <span class="s">&quot;</span><span class="si">%d</span><span class="s">.</span><span class="si">%06d</span><span class="s">sec cpu=</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
		<span class="p">(</span><span class="n">nsecs_secs</span><span class="p">(</span><span class="n">base_t</span><span class="p">),</span> <span class="n">nsecs_nsecs</span><span class="p">(</span><span class="n">base_t</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="n">cpu</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irq_list</span><span class="p">)):</span>
		<span class="k">print</span> <span class="n">PF_IRQ_ENTRY</span> <span class="o">%</span> \
			<span class="p">(</span><span class="n">diff_msec</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span> <span class="n">irq_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;irq_ent_t&#39;</span><span class="p">]),</span>
			<span class="n">irq_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;irq&#39;</span><span class="p">],</span> <span class="n">irq_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;name&#39;</span><span class="p">])</span>
		<span class="k">print</span> <span class="n">PF_JOINT</span>
		<span class="n">irq_event_list</span> <span class="o">=</span> <span class="n">irq_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s">&#39;event_list&#39;</span><span class="p">]</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">irq_event_list</span><span class="p">)):</span>
			<span class="n">irq_event</span> <span class="o">=</span> <span class="n">irq_event_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">irq_event</span><span class="p">[</span><span class="s">&#39;event&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;netif_rx&#39;</span><span class="p">:</span>
				<span class="k">print</span> <span class="n">PF_NET_RX</span> <span class="o">%</span> \
					<span class="p">(</span><span class="n">diff_msec</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span> <span class="n">irq_event</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]),</span>
					<span class="n">irq_event</span><span class="p">[</span><span class="s">&#39;skbaddr&#39;</span><span class="p">])</span>
				<span class="k">print</span> <span class="n">PF_JOINT</span>
	<span class="k">print</span> <span class="n">PF_SOFT_ENTRY</span> <span class="o">%</span> \
		<span class="n">diff_msec</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span> <span class="n">hunk</span><span class="p">[</span><span class="s">&#39;sirq_ent_t&#39;</span><span class="p">])</span>
	<span class="k">print</span> <span class="n">PF_JOINT</span>
	<span class="n">event_list</span> <span class="o">=</span> <span class="n">hunk</span><span class="p">[</span><span class="s">&#39;event_list&#39;</span><span class="p">]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event_list</span><span class="p">)):</span>
		<span class="n">event</span> <span class="o">=</span> <span class="n">event_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;event_name&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;napi_poll&#39;</span><span class="p">:</span>
			<span class="k">print</span> <span class="n">PF_NAPI_POLL</span> <span class="o">%</span> \
			    <span class="p">(</span><span class="n">diff_msec</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;event_t&#39;</span><span class="p">]),</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;dev&#39;</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">event_list</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
				<span class="k">print</span> <span class="s">&quot;&quot;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">print</span> <span class="n">PF_JOINT</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">print</span> <span class="n">PF_NET_RECV</span> <span class="o">%</span> \
			    <span class="p">(</span><span class="n">diff_msec</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;event_t&#39;</span><span class="p">]),</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;skbaddr&#39;</span><span class="p">],</span>
				<span class="n">event</span><span class="p">[</span><span class="s">&#39;len&#39;</span><span class="p">])</span>
			<span class="k">if</span> <span class="s">&#39;comm&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">print</span> <span class="n">PF_WJOINT</span>
				<span class="k">print</span> <span class="n">PF_CPY_DGRAM</span> <span class="o">%</span> \
					<span class="p">(</span><span class="n">diff_msec</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;comm_t&#39;</span><span class="p">]),</span>
					<span class="n">event</span><span class="p">[</span><span class="s">&#39;pid&#39;</span><span class="p">],</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;comm&#39;</span><span class="p">])</span>
			<span class="k">elif</span> <span class="s">&#39;handle&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
				<span class="k">print</span> <span class="n">PF_WJOINT</span>
				<span class="k">if</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;handle&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;kfree_skb&quot;</span><span class="p">:</span>
					<span class="k">print</span> <span class="n">PF_KFREE_SKB</span> <span class="o">%</span> \
						<span class="p">(</span><span class="n">diff_msec</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span>
						<span class="n">event</span><span class="p">[</span><span class="s">&#39;comm_t&#39;</span><span class="p">]),</span>
						<span class="n">event</span><span class="p">[</span><span class="s">&#39;location&#39;</span><span class="p">])</span>
				<span class="k">elif</span> <span class="n">event</span><span class="p">[</span><span class="s">&#39;handle&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;consume_skb&quot;</span><span class="p">:</span>
					<span class="k">print</span> <span class="n">PF_CONS_SKB</span> <span class="o">%</span> \
						<span class="n">diff_msec</span><span class="p">(</span><span class="n">base_t</span><span class="p">,</span>
							<span class="n">event</span><span class="p">[</span><span class="s">&#39;comm_t&#39;</span><span class="p">])</span>
			<span class="k">print</span> <span class="n">PF_JOINT</span>

<span class="k">def</span> <span class="nf">trace_begin</span><span class="p">():</span>
	<span class="k">global</span> <span class="n">show_tx</span>
	<span class="k">global</span> <span class="n">show_rx</span>
	<span class="k">global</span> <span class="n">dev</span>
	<span class="k">global</span> <span class="n">debug</span>

	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)):</span>
		<span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">arg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&#39;tx&#39;</span><span class="p">:</span>
			<span class="n">show_tx</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span><span class="s">&#39;rx&#39;</span><span class="p">:</span>
			<span class="n">show_rx</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="k">elif</span> <span class="n">arg</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;dev=&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
			<span class="n">dev</span> <span class="o">=</span> <span class="n">arg</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
		<span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s">&#39;debug&#39;</span><span class="p">:</span>
			<span class="n">debug</span> <span class="o">=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="n">show_tx</span> <span class="o">==</span> <span class="mi">0</span>  <span class="ow">and</span> <span class="n">show_rx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="n">show_tx</span> <span class="o">=</span> <span class="mi">1</span>
		<span class="n">show_rx</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">trace_end</span><span class="p">():</span></pre></div></td></tr>


<tr id="section-13"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-13">&#182;</a></div><p>order all events in time</p></td><td class="code"><div class="highlight"><pre>	<span class="n">all_event_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="p">:</span><span class="nb">cmp</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">EINFO_IDX_TIME</span><span class="p">],</span>
					    <span class="n">b</span><span class="p">[</span><span class="n">EINFO_IDX_TIME</span><span class="p">]))</span></pre></div></td></tr>


<tr id="section-14"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-14">&#182;</a></div><p>process all events</p></td><td class="code"><div class="highlight"><pre>	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">all_event_list</span><span class="p">)):</span>
		<span class="n">event_info</span> <span class="o">=</span> <span class="n">all_event_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">name</span> <span class="o">=</span> <span class="n">event_info</span><span class="p">[</span><span class="n">EINFO_IDX_NAME</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;irq__softirq_exit&#39;</span><span class="p">:</span>
			<span class="n">handle_irq_softirq_exit</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;irq__softirq_entry&#39;</span><span class="p">:</span>
			<span class="n">handle_irq_softirq_entry</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;irq__softirq_raise&#39;</span><span class="p">:</span>
			<span class="n">handle_irq_softirq_raise</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;irq__irq_handler_entry&#39;</span><span class="p">:</span>
			<span class="n">handle_irq_handler_entry</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;irq__irq_handler_exit&#39;</span><span class="p">:</span>
			<span class="n">handle_irq_handler_exit</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;napi__napi_poll&#39;</span><span class="p">:</span>
			<span class="n">handle_napi_poll</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;net__netif_receive_skb&#39;</span><span class="p">:</span>
			<span class="n">handle_netif_receive_skb</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;net__netif_rx&#39;</span><span class="p">:</span>
			<span class="n">handle_netif_rx</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;skb__skb_copy_datagram_iovec&#39;</span><span class="p">:</span>
			<span class="n">handle_skb_copy_datagram_iovec</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;net__net_dev_queue&#39;</span><span class="p">:</span>
			<span class="n">handle_net_dev_queue</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;net__net_dev_xmit&#39;</span><span class="p">:</span>
			<span class="n">handle_net_dev_xmit</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;skb__kfree_skb&#39;</span><span class="p">:</span>
			<span class="n">handle_kfree_skb</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;skb__consume_skb&#39;</span><span class="p">:</span>
			<span class="n">handle_consume_skb</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-15"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-15">&#182;</a></div><p>display receive hunks</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="n">show_rx</span><span class="p">:</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">receive_hunk_list</span><span class="p">)):</span>
			<span class="n">print_receive</span><span class="p">(</span><span class="n">receive_hunk_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span></pre></div></td></tr>


<tr id="section-16"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-16">&#182;</a></div><p>display transmit hunks</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="n">show_tx</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;   dev    len      Qdisc        &quot;</span> \
			<span class="s">&quot;       netdevice             free&quot;</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_free_list</span><span class="p">)):</span>
			<span class="n">print_transmit</span><span class="p">(</span><span class="n">tx_free_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
		<span class="k">print</span> <span class="s">&quot;debug buffer status&quot;</span>
		<span class="k">print</span> <span class="s">&quot;----------------------------&quot;</span>
		<span class="k">print</span> <span class="s">&quot;xmit Qdisc:remain:</span><span class="si">%d</span><span class="s"> overflow:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
			<span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_queue_list</span><span class="p">),</span> <span class="n">of_count_tx_queue_list</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">&quot;xmit netdevice:remain:</span><span class="si">%d</span><span class="s"> overflow:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
			<span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_xmit_list</span><span class="p">),</span> <span class="n">of_count_tx_xmit_list</span><span class="p">)</span>
		<span class="k">print</span> <span class="s">&quot;receive:remain:</span><span class="si">%d</span><span class="s"> overflow:</span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> \
			<span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rx_skb_list</span><span class="p">),</span> <span class="n">of_count_rx_skb_list</span><span class="p">)</span></pre></div></td></tr>


<tr id="section-17"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-17">&#182;</a></div><p>called from perf, when it finds a correspoinding event</p></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">irq__softirq_entry</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">symbol_str</span><span class="p">(</span><span class="s">&quot;irq__softirq_entry&quot;</span><span class="p">,</span> <span class="s">&quot;vec&quot;</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;NET_RX&quot;</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">irq__softirq_exit</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">symbol_str</span><span class="p">(</span><span class="s">&quot;irq__softirq_entry&quot;</span><span class="p">,</span> <span class="s">&quot;vec&quot;</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;NET_RX&quot;</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">irq__softirq_raise</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">):</span>
	<span class="k">if</span> <span class="n">symbol_str</span><span class="p">(</span><span class="s">&quot;irq__softirq_entry&quot;</span><span class="p">,</span> <span class="s">&quot;vec&quot;</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="o">!=</span> <span class="s">&quot;NET_RX&quot;</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">irq__irq_handler_entry</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">irq</span><span class="p">,</span> <span class="n">irq_name</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">irq</span><span class="p">,</span> <span class="n">irq_name</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">irq__irq_handler_exit</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">irq</span><span class="p">,</span> <span class="n">ret</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">irq</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">napi__napi_poll</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">napi</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">napi</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">net__netif_receive_skb</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">skbaddr</span><span class="p">,</span>
			<span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">net__netif_rx</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">skbaddr</span><span class="p">,</span>
			<span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">net__net_dev_queue</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">net__net_dev_xmit</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">rc</span> <span class="p">,</span><span class="n">dev_name</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">skb__kfree_skb</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">location</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">skb__consume_skb</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">skbaddr</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">skb__skb_copy_datagram_iovec</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
	<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">):</span>
	<span class="n">event_info</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">nsecs</span><span class="p">(</span><span class="n">sec</span><span class="p">,</span> <span class="n">nsec</span><span class="p">),</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
			<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">)</span>
	<span class="n">all_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event_info</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handle_irq_handler_entry</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">irq</span><span class="p">,</span> <span class="n">irq_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">if</span> <span class="n">cpu</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">irq_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">irq_record</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;irq&#39;</span><span class="p">:</span><span class="n">irq</span><span class="p">,</span> <span class="s">&#39;name&#39;</span><span class="p">:</span><span class="n">irq_name</span><span class="p">,</span> <span class="s">&#39;cpu&#39;</span><span class="p">:</span><span class="n">cpu</span><span class="p">,</span> <span class="s">&#39;irq_ent_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">}</span>
	<span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irq_record</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handle_irq_handler_exit</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">irq</span><span class="p">,</span> <span class="n">ret</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">if</span> <span class="n">cpu</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">irq_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="k">return</span>
	<span class="n">irq_record</span> <span class="o">=</span> <span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
	<span class="k">if</span> <span class="n">irq</span> <span class="o">!=</span> <span class="n">irq_record</span><span class="p">[</span><span class="s">&#39;irq&#39;</span><span class="p">]:</span>
		<span class="k">return</span>
	<span class="n">irq_record</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;irq_ext_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">})</span></pre></div></td></tr>


<tr id="section-18"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-18">&#182;</a></div><p>if an irq doesn't include NET_RX softirq, drop.</p></td><td class="code"><div class="highlight"><pre>	<span class="k">if</span> <span class="s">&#39;event_list&#39;</span> <span class="ow">in</span> <span class="n">irq_record</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irq_record</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handle_irq_softirq_raise</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">if</span> <span class="n">cpu</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">irq_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> \
	<span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="n">irq_record</span> <span class="o">=</span> <span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
	<span class="k">if</span> <span class="s">&#39;event_list&#39;</span> <span class="ow">in</span> <span class="n">irq_record</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">irq_event_list</span> <span class="o">=</span> <span class="n">irq_record</span><span class="p">[</span><span class="s">&#39;event_list&#39;</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">irq_event_list</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">irq_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;time&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">,</span> <span class="s">&#39;event&#39;</span><span class="p">:</span><span class="s">&#39;sirq_raise&#39;</span><span class="p">})</span>
	<span class="n">irq_record</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;event_list&#39;</span><span class="p">:</span><span class="n">irq_event_list</span><span class="p">})</span>
	<span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irq_record</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handle_irq_softirq_entry</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="n">net_rx_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;sirq_ent_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">,</span> <span class="s">&#39;event_list&#39;</span><span class="p">:[]}</span>

<span class="k">def</span> <span class="nf">handle_irq_softirq_exit</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">vec</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="n">irq_list</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">event_list</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">if</span> <span class="n">cpu</span> <span class="ow">in</span> <span class="n">irq_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">irq_list</span> <span class="o">=</span> <span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span>
		<span class="k">del</span> <span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">cpu</span> <span class="ow">in</span> <span class="n">net_rx_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">sirq_ent_t</span> <span class="o">=</span> <span class="n">net_rx_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s">&#39;sirq_ent_t&#39;</span><span class="p">]</span>
		<span class="n">event_list</span> <span class="o">=</span> <span class="n">net_rx_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s">&#39;event_list&#39;</span><span class="p">]</span>
		<span class="k">del</span> <span class="n">net_rx_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span>
	<span class="k">if</span> <span class="n">irq_list</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">event_list</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="n">rec_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;sirq_ent_t&#39;</span><span class="p">:</span><span class="n">sirq_ent_t</span><span class="p">,</span> <span class="s">&#39;sirq_ext_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">,</span>
		    <span class="s">&#39;irq_list&#39;</span><span class="p">:</span><span class="n">irq_list</span><span class="p">,</span> <span class="s">&#39;event_list&#39;</span><span class="p">:</span><span class="n">event_list</span><span class="p">}</span></pre></div></td></tr>


<tr id="section-19"><td class="docs"><div class="pilwrap"><a class="pilcrow" href="#section-19">&#182;</a></div><p>merge information realted to a NET_RX softirq</p></td><td class="code"><div class="highlight"><pre>	<span class="n">receive_hunk_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec_data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handle_napi_poll</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">napi</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">if</span> <span class="n">cpu</span> <span class="ow">in</span> <span class="n">net_rx_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">event_list</span> <span class="o">=</span> <span class="n">net_rx_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s">&#39;event_list&#39;</span><span class="p">]</span>
		<span class="n">rec_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;event_name&#39;</span><span class="p">:</span><span class="s">&#39;napi_poll&#39;</span><span class="p">,</span>
				<span class="s">&#39;dev&#39;</span><span class="p">:</span><span class="n">dev_name</span><span class="p">,</span> <span class="s">&#39;event_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">}</span>
		<span class="n">event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec_data</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handle_netif_rx</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
		<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">if</span> <span class="n">cpu</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">irq_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> \
	<span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="n">irq_record</span> <span class="o">=</span> <span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
	<span class="k">if</span> <span class="s">&#39;event_list&#39;</span> <span class="ow">in</span> <span class="n">irq_record</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">irq_event_list</span> <span class="o">=</span> <span class="n">irq_record</span><span class="p">[</span><span class="s">&#39;event_list&#39;</span><span class="p">]</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="n">irq_event_list</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">irq_event_list</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s">&#39;time&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">,</span> <span class="s">&#39;event&#39;</span><span class="p">:</span><span class="s">&#39;netif_rx&#39;</span><span class="p">,</span>
		<span class="s">&#39;skbaddr&#39;</span><span class="p">:</span><span class="n">skbaddr</span><span class="p">,</span> <span class="s">&#39;skblen&#39;</span><span class="p">:</span><span class="n">skblen</span><span class="p">,</span> <span class="s">&#39;dev_name&#39;</span><span class="p">:</span><span class="n">dev_name</span><span class="p">})</span>
	<span class="n">irq_record</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;event_list&#39;</span><span class="p">:</span><span class="n">irq_event_list</span><span class="p">})</span>
	<span class="n">irq_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">irq_record</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">handle_netif_receive_skb</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="k">global</span> <span class="n">of_count_rx_skb_list</span>

	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
		<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">if</span> <span class="n">cpu</span> <span class="ow">in</span> <span class="n">net_rx_dic</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
		<span class="n">rec_data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;event_name&#39;</span><span class="p">:</span><span class="s">&#39;netif_receive_skb&#39;</span><span class="p">,</span>
			    <span class="s">&#39;event_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">,</span> <span class="s">&#39;skbaddr&#39;</span><span class="p">:</span><span class="n">skbaddr</span><span class="p">,</span> <span class="s">&#39;len&#39;</span><span class="p">:</span><span class="n">skblen</span><span class="p">}</span>
		<span class="n">event_list</span> <span class="o">=</span> <span class="n">net_rx_dic</span><span class="p">[</span><span class="n">cpu</span><span class="p">][</span><span class="s">&#39;event_list&#39;</span><span class="p">]</span>
		<span class="n">event_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rec_data</span><span class="p">)</span>
		<span class="n">rx_skb_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">rec_data</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx_skb_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">buffer_budget</span><span class="p">:</span>
			<span class="n">rx_skb_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
			<span class="n">of_count_rx_skb_list</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">handle_net_dev_queue</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="k">global</span> <span class="n">of_count_tx_queue_list</span>

	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
		<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="n">skb</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;dev&#39;</span><span class="p">:</span><span class="n">dev_name</span><span class="p">,</span> <span class="s">&#39;skbaddr&#39;</span><span class="p">:</span><span class="n">skbaddr</span><span class="p">,</span> <span class="s">&#39;len&#39;</span><span class="p">:</span><span class="n">skblen</span><span class="p">,</span> <span class="s">&#39;queue_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">}</span>
	<span class="n">tx_queue_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skb</span><span class="p">)</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx_queue_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">buffer_budget</span><span class="p">:</span>
		<span class="n">tx_queue_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
		<span class="n">of_count_tx_queue_list</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">handle_net_dev_xmit</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="k">global</span> <span class="n">of_count_tx_xmit_list</span>

	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
		<span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">,</span> <span class="n">rc</span><span class="p">,</span> <span class="n">dev_name</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="c"># NETDEV_TX_OK</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_queue_list</span><span class="p">)):</span>
			<span class="n">skb</span> <span class="o">=</span> <span class="n">tx_queue_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">skb</span><span class="p">[</span><span class="s">&#39;skbaddr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">skbaddr</span><span class="p">:</span>
				<span class="n">skb</span><span class="p">[</span><span class="s">&#39;xmit_t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
				<span class="n">tx_xmit_list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">skb</span><span class="p">)</span>
				<span class="k">del</span> <span class="n">tx_queue_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tx_xmit_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">buffer_budget</span><span class="p">:</span>
					<span class="n">tx_xmit_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
					<span class="n">of_count_tx_xmit_list</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="k">return</span>

<span class="k">def</span> <span class="nf">handle_kfree_skb</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span>
		<span class="n">skbaddr</span><span class="p">,</span> <span class="n">protocol</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_queue_list</span><span class="p">)):</span>
		<span class="n">skb</span> <span class="o">=</span> <span class="n">tx_queue_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">skb</span><span class="p">[</span><span class="s">&#39;skbaddr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">skbaddr</span><span class="p">:</span>
			<span class="k">del</span> <span class="n">tx_queue_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="k">return</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_xmit_list</span><span class="p">)):</span>
		<span class="n">skb</span> <span class="o">=</span> <span class="n">tx_xmit_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">skb</span><span class="p">[</span><span class="s">&#39;skbaddr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">skbaddr</span><span class="p">:</span>
			<span class="n">skb</span><span class="p">[</span><span class="s">&#39;free_t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
			<span class="n">tx_free_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span>
			<span class="k">del</span> <span class="n">tx_xmit_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="k">return</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rx_skb_list</span><span class="p">)):</span>
		<span class="n">rec_data</span> <span class="o">=</span> <span class="n">rx_skb_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">rec_data</span><span class="p">[</span><span class="s">&#39;skbaddr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">skbaddr</span><span class="p">:</span>
			<span class="n">rec_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;handle&#39;</span><span class="p">:</span><span class="s">&quot;kfree_skb&quot;</span><span class="p">,</span>
					<span class="s">&#39;comm&#39;</span><span class="p">:</span><span class="n">comm</span><span class="p">,</span> <span class="s">&#39;pid&#39;</span><span class="p">:</span><span class="n">pid</span><span class="p">,</span> <span class="s">&#39;comm_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">})</span>
			<span class="k">del</span> <span class="n">rx_skb_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="k">return</span>

<span class="k">def</span> <span class="nf">handle_consume_skb</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">skbaddr</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tx_xmit_list</span><span class="p">)):</span>
		<span class="n">skb</span> <span class="o">=</span> <span class="n">tx_xmit_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">skb</span><span class="p">[</span><span class="s">&#39;skbaddr&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">skbaddr</span><span class="p">:</span>
			<span class="n">skb</span><span class="p">[</span><span class="s">&#39;free_t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span>
			<span class="n">tx_free_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">skb</span><span class="p">)</span>
			<span class="k">del</span> <span class="n">tx_xmit_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="k">return</span>

<span class="k">def</span> <span class="nf">handle_skb_copy_datagram_iovec</span><span class="p">(</span><span class="n">event_info</span><span class="p">):</span>
	<span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">cpu</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">comm</span><span class="p">,</span> <span class="n">skbaddr</span><span class="p">,</span> <span class="n">skblen</span><span class="p">)</span> <span class="o">=</span> <span class="n">event_info</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rx_skb_list</span><span class="p">)):</span>
		<span class="n">rec_data</span> <span class="o">=</span> <span class="n">rx_skb_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="k">if</span> <span class="n">skbaddr</span> <span class="o">==</span> <span class="n">rec_data</span><span class="p">[</span><span class="s">&#39;skbaddr&#39;</span><span class="p">]:</span>
			<span class="n">rec_data</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;handle&#39;</span><span class="p">:</span><span class="s">&quot;skb_copy_datagram_iovec&quot;</span><span class="p">,</span>
					<span class="s">&#39;comm&#39;</span><span class="p">:</span><span class="n">comm</span><span class="p">,</span> <span class="s">&#39;pid&#39;</span><span class="p">:</span><span class="n">pid</span><span class="p">,</span> <span class="s">&#39;comm_t&#39;</span><span class="p">:</span><span class="n">time</span><span class="p">})</span>
			<span class="k">del</span> <span class="n">rx_skb_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
			<span class="k">return</span>

</pre></div></td></tr>

</tbody>
</table>
</div>

</body>
<script>docas={repo:"joekychen/linux",depth:4}</script>
<script>document.write('<script src=' + ('__proto__' in {} ? 'http://cdnjs.cloudflare.com/ajax/libs/zepto/1.0rc1/zepto.min.js' : 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js')+'><\\/script>')</script>
<script src="http://baoshan.github.com/moment/min/moment.min.js"></script>
<script src="../../../../javascript/docco.min.js"></script>
</html>
